"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[6296],{98084:(Wh,Tr,z)=>{z.d(Tr,{J6:()=>qn,YP:()=>hn,aI:()=>Vn,dj:()=>gn,hq:()=>_n,kE:()=>ot,l9:()=>Hn,l_:()=>ai,vk:()=>Di,wT:()=>Wn});var Ve=z(42218);const hn=Ve.z.enum(["quantitative","ordinal","nominal","temporal"]),gn=Ve.z.enum(["area","bar","trail","line","point","circle","text","arc"]),Wn=Ve.z.enum(["x","y","color","opacity","order","size","xOffset","yOffset","text","theta","tooltip","detail","stroke"]),Vn=Ve.z.enum(["ascending","descending"]),ot=Ve.z.enum(["linear","log","sqrt","time"]),_n=Ve.z.enum(["outside","inside"]),ai=Ve.z.enum(["none","small","medium","large"]),Hn=Ve.z.enum(["default","number","scientific","percent"]),Di=Ve.z.enum(["argmax","argmin","count","average","distinct","max","median","min","sum","variance","none"]),qn=Ve.z.enum(["yearmonthdatehours","yearmonthdate","yearmonth","yearweek","year","monthdatehours","monthdate","month","week","datehours","date","day","hours"])},77638:(Wh,Tr,z)=>{z.d(Tr,{A:()=>ut});var Ve=z(63998);const hn={};function gn(ce,re){ce===void 0&&(ce=hn),re===void 0&&(re=hn);const ne=Object.keys(ce),fe=Object.keys(re);return ce===re||ne.length===fe.length&&ne.every(lt=>ce[lt]===re[lt])}var Wn=z(19926);function Vn(ce){return!!ce&&{}.toString.call(ce)==="[object Function]"}function ot(ce,re,ne){ne&&(Vn(ne)?ne(ce.data(re)):ce.change(re,Wn.eM.changeset().remove(()=>!0).insert(ne)))}function _n(ce,re){Object.keys(re).forEach(ne=>{ot(ce,ne,re[ne])})}var ai=z(47528),Hn=z.n(ai);function Di(ce){const re=new Set;return ce.forEach(ne=>{Object.keys(ne).forEach(fe=>{re.add(fe)})}),re}const qn=()=>{};function b(ce,re){const ne=Object.keys(re);return ne.forEach(fe=>{try{ce.addSignalListener(fe,re[fe])}catch(lt){console.warn("Cannot add invalid signal listener.",lt)}}),ne.length>0}var Lo=z(59252),ws=z.n(Lo);function Ds(ce,re){if(ce===re)return!1;const ne={width:!1,height:!1,isExpensive:!1},fe=Di([ce,re]);return fe.has("width")&&(!("width"in ce)||!("width"in re)||ce.width!==re.width)&&("width"in ce&&typeof ce.width=="number"?ne.width=ce.width:ne.isExpensive=!0),fe.has("height")&&(!("height"in ce)||!("height"in re)||ce.height!==re.height)&&("height"in ce&&typeof ce.height=="number"?ne.height=ce.height:ne.isExpensive=!0),fe.delete("width"),fe.delete("height"),[...fe].some(lt=>!(lt in ce)||!(lt in re)||!ws()(ce[lt],re[lt]))&&(ne.isExpensive=!0),ne.width!==!1||ne.height!==!1||ne.isExpensive?ne:!1}function on(ce,re){const ne=Object.keys(re);return ne.forEach(fe=>{try{ce.removeSignalListener(fe,re[fe])}catch(lt){console.warn("Cannot remove invalid signal listener.",lt)}}),ne.length>0}function ki(ce){const{spec:re,width:ne,height:fe}=ce;return typeof ne<"u"&&typeof fe<"u"?{...re,width:ne,height:fe}:typeof ne<"u"?{...re,width:ne}:typeof fe<"u"?{...re,height:fe}:re}function sn(ce,re,ne){return re in ce?Object.defineProperty(ce,re,{value:ne,enumerable:!0,configurable:!0,writable:!0}):ce[re]=ne,ce}class ro extends Ve.PureComponent{constructor(){super(...arguments),sn(this,"containerRef",Ve.createRef()),sn(this,"resultPromise",void 0),sn(this,"handleError",re=>{const{onError:ne=qn}=this.props;ne(re,this.containerRef.current),console.warn(re)}),sn(this,"modifyView",re=>{this.resultPromise&&this.resultPromise.then(ne=>(ne&&re(ne.view),!0)).catch(this.handleError)})}componentDidMount(){this.createView()}componentDidUpdate(re){const ne=Di([this.props,re]);if(ne.delete("className"),ne.delete("signalListeners"),ne.delete("spec"),ne.delete("style"),ne.delete("width"),ne.delete("height"),Array.from(ne).some(fe=>this.props[fe]!==re[fe]))this.clearView(),this.createView();else{const fe=Ds(ki(this.props),ki(re)),{signalListeners:lt}=this.props,{signalListeners:jt}=re;if(fe)if(fe.isExpensive)this.clearView(),this.createView();else{const mt=!gn(lt,jt);this.modifyView(kt=>{fe.width!==!1&&kt.width(fe.width),fe.height!==!1&&kt.height(fe.height),mt&&(jt&&on(kt,jt),lt&&b(kt,lt)),kt.run()})}else gn(lt,jt)||this.modifyView(mt=>{jt&&on(mt,jt),lt&&b(mt,lt),mt.run()})}}componentWillUnmount(){this.clearView()}createView(){const{spec:re,onNewView:ne,signalListeners:fe={},width:lt,height:jt,...mt}=this.props;if(this.containerRef.current){const kt=ki(this.props);this.resultPromise=(0,Wn.Ay)(this.containerRef.current,kt,mt).then(zt=>{if(zt){const{view:xt}=zt;b(xt,fe)&&xt.run()}return zt}).catch(this.handleError),ne&&this.modifyView(ne)}}clearView(){return this.resultPromise&&this.resultPromise.then(re=>{re&&re.finalize()}).catch(this.handleError),this.resultPromise=void 0,this}render(){const{className:re,style:ne}=this.props;return Ve.createElement("div",{ref:this.containerRef,className:re,style:ne})}}sn(ro,"propTypes",{className:Hn().string,onError:Hn().func});function Rr(){return Rr=Object.assign||function(ce){for(var re=1;re<arguments.length;re++){var ne=arguments[re];for(var fe in ne)Object.prototype.hasOwnProperty.call(ne,fe)&&(ce[fe]=ne[fe])}return ce},Rr.apply(this,arguments)}function an(ce,re,ne){return re in ce?Object.defineProperty(ce,re,{value:ne,enumerable:!0,configurable:!0,writable:!0}):ce[re]=ne,ce}const Ce={};class Be extends Ve.PureComponent{constructor(){super(...arguments),an(this,"vegaEmbed",Ve.createRef()),an(this,"handleNewView",re=>{this.update();const{onNewView:ne=qn}=this.props;ne(re)})}componentDidMount(){this.update()}componentDidUpdate(re){gn(this.props.data,re.data)||this.update()}update(){const{data:re}=this.props;this.vegaEmbed.current&&re&&Object.keys(re).length>0&&this.vegaEmbed.current.modifyView(ne=>{_n(ne,re),ne.resize().run()})}render(){const{data:re,...ne}=this.props;return Ve.createElement(ro,Rr({ref:this.vegaEmbed},ne,{onNewView:this.handleNewView}))}}an(Be,"defaultProps",{data:Ce});function Pe(){return Pe=Object.assign||function(ce){for(var re=1;re<arguments.length;re++){var ne=arguments[re];for(var fe in ne)Object.prototype.hasOwnProperty.call(ne,fe)&&(ce[fe]=ne[fe])}return ce},Pe.apply(this,arguments)}function ut(ce){return Ve.createElement(Be,Pe({},ce,{mode:"vega-lite"}))}},19926:(Wh,Tr,z)=>{z.d(Tr,{Ay:()=>Pc,eM:()=>Yi});var Ve={};z.r(Ve),z.d(Ve,{accessPathDepth:()=>Ms,accessPathWithDatum:()=>sg,accessWithDatumToUnescapedPath:()=>ht,compile:()=>y2,contains:()=>Ue,deepEqual:()=>Kn,deleteNestedProperty:()=>Xu,duplicate:()=>_e,entries:()=>er,every:()=>ng,fieldIntersection:()=>og,flatAccessWithDatum:()=>Jc,getFirstDefined:()=>It,hasIntersection:()=>ig,hasProperty:()=>ie,hash:()=>He,internalField:()=>Ku,isBoolean:()=>qu,isEmpty:()=>dt,isEqual:()=>uA,isInternalField:()=>ag,isNullOrFalse:()=>tg,isNumeric:()=>Bs,keys:()=>te,logicalExpr:()=>za,mergeDeep:()=>w1,never:()=>F1,normalize:()=>t0,normalizeAngle:()=>Qu,omit:()=>Yn,pick:()=>Go,prefixGenerator:()=>rg,removePathFromField:()=>Wo,replaceAll:()=>Mr,replacePathInField:()=>ci,resetIdCounter:()=>ef,setEqual:()=>D1,some:()=>La,stringify:()=>Se,titleCase:()=>_s,unique:()=>_r,uniqueId:()=>Yu,vals:()=>Jt,varName:()=>Ft,version:()=>x2});var hn={};z.r(hn),z.d(hn,{carbong10:()=>tD,carbong100:()=>iD,carbong90:()=>nD,carbonwhite:()=>eD,dark:()=>R2,excel:()=>N2,fivethirtyeight:()=>B2,ggplot2:()=>Gm,googlecharts:()=>V2,latimes:()=>P2,powerbi:()=>Q2,quartz:()=>U2,urbaninstitute:()=>Qx,version:()=>rD,vox:()=>j2});var gn=z(26869),Wn=z(38389),Vn=z.n(Wn),ot=z(4656);function _n(n,r,s){let u;r.x2&&(r.x?(s&&n.x>n.x2&&(u=n.x,n.x=n.x2,n.x2=u),n.width=n.x2-n.x):n.x=n.x2-(n.width||0)),r.xc&&(n.x=n.xc-(n.width||0)/2),r.y2&&(r.y?(s&&n.y>n.y2&&(u=n.y,n.y=n.y2,n.y2=u),n.height=n.y2-n.y):n.y=n.y2-(n.height||0)),r.yc&&(n.y=n.yc-(n.height||0)/2)}var ai={NaN:NaN,E:Math.E,LN2:Math.LN2,LN10:Math.LN10,LOG2E:Math.LOG2E,LOG10E:Math.LOG10E,PI:Math.PI,SQRT1_2:Math.SQRT1_2,SQRT2:Math.SQRT2,MIN_VALUE:Number.MIN_VALUE,MAX_VALUE:Number.MAX_VALUE},Hn={"*":(n,r)=>n*r,"+":(n,r)=>n+r,"-":(n,r)=>n-r,"/":(n,r)=>n/r,"%":(n,r)=>n%r,">":(n,r)=>n>r,"<":(n,r)=>n<r,"<=":(n,r)=>n<=r,">=":(n,r)=>n>=r,"==":(n,r)=>n==r,"!=":(n,r)=>n!=r,"===":(n,r)=>n===r,"!==":(n,r)=>n!==r,"&":(n,r)=>n&r,"|":(n,r)=>n|r,"^":(n,r)=>n^r,"<<":(n,r)=>n<<r,">>":(n,r)=>n>>r,">>>":(n,r)=>n>>>r},Di={"+":n=>+n,"-":n=>-n,"~":n=>~n,"!":n=>!n};const qn=Array.prototype.slice,b=(n,r,s)=>{const u=s?s(r[0]):r[0];return u[n].apply(u,qn.call(r,1))},Lo=(n,r,s,u,c,d,p)=>new Date(n,r||0,s??1,u||0,c||0,d||0,p||0);var ws={isNaN:Number.isNaN,isFinite:Number.isFinite,abs:Math.abs,acos:Math.acos,asin:Math.asin,atan:Math.atan,atan2:Math.atan2,ceil:Math.ceil,cos:Math.cos,exp:Math.exp,floor:Math.floor,log:Math.log,max:Math.max,min:Math.min,pow:Math.pow,random:Math.random,round:Math.round,sin:Math.sin,sqrt:Math.sqrt,tan:Math.tan,clamp:(n,r,s)=>Math.max(r,Math.min(s,n)),now:Date.now,utc:Date.UTC,datetime:Lo,date:n=>new Date(n).getDate(),day:n=>new Date(n).getDay(),year:n=>new Date(n).getFullYear(),month:n=>new Date(n).getMonth(),hours:n=>new Date(n).getHours(),minutes:n=>new Date(n).getMinutes(),seconds:n=>new Date(n).getSeconds(),milliseconds:n=>new Date(n).getMilliseconds(),time:n=>new Date(n).getTime(),timezoneoffset:n=>new Date(n).getTimezoneOffset(),utcdate:n=>new Date(n).getUTCDate(),utcday:n=>new Date(n).getUTCDay(),utcyear:n=>new Date(n).getUTCFullYear(),utcmonth:n=>new Date(n).getUTCMonth(),utchours:n=>new Date(n).getUTCHours(),utcminutes:n=>new Date(n).getUTCMinutes(),utcseconds:n=>new Date(n).getUTCSeconds(),utcmilliseconds:n=>new Date(n).getUTCMilliseconds(),length:n=>n.length,join:function(){return b("join",arguments)},indexof:function(){return b("indexOf",arguments)},lastindexof:function(){return b("lastIndexOf",arguments)},slice:function(){return b("slice",arguments)},reverse:n=>n.slice().reverse(),parseFloat,parseInt,upper:n=>String(n).toUpperCase(),lower:n=>String(n).toLowerCase(),substring:function(){return b("substring",arguments,String)},split:function(){return b("split",arguments,String)},replace:function(){return b("replace",arguments,String)},trim:n=>String(n).trim(),regexp:RegExp,test:(n,r)=>RegExp(n).test(r)};const Ds=["view","item","group","xy","x","y"],on=new Set([Function,eval,setTimeout,setInterval]);typeof setImmediate=="function"&&on.add(setImmediate);const ki={Literal:(n,r)=>r.value,Identifier:(n,r)=>{const s=r.name;return n.memberDepth>0?s:s==="datum"?n.datum:s==="event"?n.event:s==="item"?n.item:ai[s]||n.params["$"+s]},MemberExpression:(n,r)=>{const s=!r.computed,u=n(r.object);s&&(n.memberDepth+=1);const c=n(r.property);if(s&&(n.memberDepth-=1),on.has(u[c])){console.error(`Prevented interpretation of member "${c}" which could lead to insecure code execution`);return}return u[c]},CallExpression:(n,r)=>{const s=r.arguments;let u=r.callee.name;return u.startsWith("_")&&(u=u.slice(1)),u==="if"?n(s[0])?n(s[1]):n(s[2]):(n.fn[u]||ws[u]).apply(n.fn,s.map(n))},ArrayExpression:(n,r)=>r.elements.map(n),BinaryExpression:(n,r)=>Hn[r.operator](n(r.left),n(r.right)),UnaryExpression:(n,r)=>Di[r.operator](n(r.argument)),ConditionalExpression:(n,r)=>n(r.test)?n(r.consequent):n(r.alternate),LogicalExpression:(n,r)=>r.operator==="&&"?n(r.left)&&n(r.right):n(r.left)||n(r.right),ObjectExpression:(n,r)=>r.properties.reduce((s,u)=>{n.memberDepth+=1;const c=n(u.key);return n.memberDepth-=1,on.has(n(u.value))?console.error(`Prevented interpretation of property "${c}" which could lead to insecure code execution`):s[c]=n(u.value),s},{})};function sn(n,r,s,u,c,d){const p=y=>ki[y.type](p,y);return p.memberDepth=0,p.fn=Object.create(r),p.params=s,p.datum=u,p.event=c,p.item=d,Ds.forEach(y=>p.fn[y]=function(){return c.vega[y](...arguments)}),p(n)}var ro={operator(n,r){const s=r.ast,u=n.functions;return c=>sn(s,u,c)},parameter(n,r){const s=r.ast,u=n.functions;return(c,d)=>sn(s,u,d,c)},event(n,r){const s=r.ast,u=n.functions;return c=>sn(s,u,void 0,void 0,c)},handler(n,r){const s=r.ast,u=n.functions;return(c,d)=>{const p=d.item&&d.item.datum;return sn(s,u,c,p,d)}},encode(n,r){const{marktype:s,channels:u}=r,c=n.functions,d=s==="group"||s==="image"||s==="rect";return(p,y)=>{const E=p.datum;let A=0,F;for(const $ in u)F=sn(u[$].ast,c,y,E,void 0,p),p[$]!==F&&(p[$]=F,A=1);return s!=="rule"&&_n(p,u,d),A}}};const Rr={rE:"5.23.0"};function an(n,r,s){return n.fields=r||[],n.fname=s,n}function Ce(n){return n==null?null:n.fname}function Be(n){return n==null?null:n.fields}function Pe(n){return n.length===1?ut(n[0]):ce(n)}const ut=n=>function(r){return r[n]},ce=n=>{const r=n.length;return function(s){for(let u=0;u<r;++u)s=s[n[u]];return s}};function re(n){throw Error(n)}function ne(n){const r=[],s=n.length;let u=null,c=0,d="",p,y,E;n=n+"";function A(){r.push(d+n.substring(p,y)),d="",p=y+1}for(p=y=0;y<s;++y)if(E=n[y],E==="\\")d+=n.substring(p,y++),p=y;else if(E===u)A(),u=null,c=-1;else{if(u)continue;p===c&&E==='"'||p===c&&E==="'"?(p=y+1,u=E):E==="."&&!c?y>p?A():p=y+1:E==="["?(y>p&&A(),c=p=y+1):E==="]"&&(c||re("Access path missing open bracket: "+n),c>0&&A(),c=0,p=y+1)}return c&&re("Access path missing closing bracket: "+n),u&&re("Access path missing closing quote: "+n),y>p&&(y++,A()),r}function fe(n,r,s){const u=ne(n);return n=u.length===1?u[0]:n,an((s&&s.get||Pe)(u),[n],r||n)}const lt=fe("id"),jt=an(n=>n,[],"identity"),mt=an(()=>0,[],"zero"),kt=an(()=>1,[],"one"),zt=an(()=>!0,[],"true"),xt=an(()=>!1,[],"false");function Zt(n,r,s){const u=[r].concat([].slice.call(s));console[n].apply(console,u)}const un=0,$i=1,Cn=2,Mn=3,pn=4;function ui(n,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Zt,u=n||un;return{level(c){return arguments.length?(u=+c,this):u},error(){return u>=$i&&s(r||"error","ERROR",arguments),this},warn(){return u>=Cn&&s(r||"warn","WARN",arguments),this},info(){return u>=Mn&&s(r||"log","INFO",arguments),this},debug(){return u>=pn&&s(r||"log","DEBUG",arguments),this}}}var pe=Array.isArray;function We(n){return n===Object(n)}const Ta=n=>n!=="__proto__";function Vc(){for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return r.reduce((u,c)=>{for(const d in c)if(d==="signals")u.signals=li(u.signals,c.signals);else{const p=d==="legend"?{layout:1}:d==="style"?!0:null;ks(u,d,c[d],p)}return u},{})}function ks(n,r,s,u){if(!Ta(r))return;let c,d;if(We(s)&&!pe(s)){d=We(n[r])?n[r]:n[r]={};for(c in s)u&&(u===!0||u[c])?ks(d,c,s[c]):Ta(c)&&(d[c]=s[c])}else n[r]=s}function li(n,r){if(n==null)return r;const s={},u=[];function c(d){s[d.name]||(s[d.name]=1,u.push(d))}return r.forEach(c),n.forEach(c),u}function oo(n){return n[n.length-1]}function zo(n){return n==null||n===""?null:+n}const Gu=n=>r=>n*Math.exp(r),Wu=n=>r=>Math.log(n*r),Io=n=>r=>Math.sign(r)*Math.log1p(Math.abs(r/n)),Ra=n=>r=>Math.sign(r)*Math.expm1(Math.abs(r))*n,Na=n=>r=>r<0?-Math.pow(-r,n):Math.pow(r,n);function $s(n,r,s,u){const c=s(n[0]),d=s(oo(n)),p=(d-c)*r;return[u(c-p),u(d-p)]}function Vh(n,r){return $s(n,r,zo,jt)}function Hh(n,r){var s=Math.sign(n[0]);return $s(n,r,Wu(s),Gu(s))}function Vu(n,r,s){return $s(n,r,Na(s),Na(1/s))}function Hc(n,r,s){return $s(n,r,Io(s),Ra(s))}function _a(n,r,s,u,c){const d=u(n[0]),p=u(oo(n)),y=r!=null?u(r):(d+p)/2;return[c(y+(d-y)*s),c(y+(p-y)*s)]}function so(n,r,s){return _a(n,r,s,zo,jt)}function Hu(n,r,s){const u=Math.sign(n[0]);return _a(n,r,s,Wu(u),Gu(u))}function Os(n,r,s,u){return _a(n,r,s,Na(u),Na(1/u))}function v1(n,r,s,u){return _a(n,r,s,Io(u),Ra(u))}function b1(n){return 1+~~(new Date(n).getMonth()/3)}function qh(n){return 1+~~(new Date(n).getUTCMonth()/3)}function vt(n){return n!=null?pe(n)?n:[n]:[]}function Xh(n,r,s){let u=n[0],c=n[1],d;return c<u&&(d=c,c=u,u=d),d=c-u,d>=s-r?[r,s]:[u=Math.min(Math.max(u,r),s-d),u+d]}function Ts(n){return typeof n=="function"}const qc="descending";function x1(n,r,s){s=s||{},r=vt(r)||[];const u=[],c=[],d={},p=s.comparator||Po;return vt(n).forEach((y,E)=>{y!=null&&(u.push(r[E]===qc?-1:1),c.push(y=Ts(y)?y:fe(y,null,s)),(Be(y)||[]).forEach(A=>d[A]=1))}),c.length===0?null:an(p(c,u),Object.keys(d))}const Nr=(n,r)=>(n<r||n==null)&&r!=null?-1:(n>r||r==null)&&n!=null?1:(r=r instanceof Date?+r:r,(n=n instanceof Date?+n:n)!==n&&r===r?-1:r!==r&&n===n?1:0),Po=(n,r)=>n.length===1?Xc(n[0],r[0]):Yc(n,r,n.length),Xc=(n,r)=>function(s,u){return Nr(n(s),n(u))*r},Yc=(n,r,s)=>(r.push(0),function(u,c){let d,p=0,y=-1;for(;p===0&&++y<s;)d=n[y],p=Nr(d(u),d(c));return p*r[y]});function Yh(n){return Ts(n)?n:()=>n}function Kh(n,r){let s;return u=>{s&&clearTimeout(s),s=setTimeout(()=>(r(u),s=null),n)}}function Uo(n){for(let r,s,u=1,c=arguments.length;u<c;++u){r=arguments[u];for(s in r)n[s]=r[s]}return n}function Qh(n,r){let s=0,u,c,d,p;if(n&&(u=n.length))if(r==null){for(c=n[s];s<u&&(c==null||c!==c);c=n[++s]);for(d=p=c;s<u;++s)c=n[s],c!=null&&(c<d&&(d=c),c>p&&(p=c))}else{for(c=r(n[s]);s<u&&(c==null||c!==c);c=r(n[++s]));for(d=p=c;s<u;++s)c=r(n[s]),c!=null&&(c<d&&(d=c),c>p&&(p=c))}return[d,p]}function Ma(n,r){const s=n.length;let u=-1,c,d,p,y,E;if(r==null){for(;++u<s;)if(d=n[u],d!=null&&d>=d){c=p=d;break}if(u===s)return[-1,-1];for(y=E=u;++u<s;)d=n[u],d!=null&&(c>d&&(c=d,y=u),p<d&&(p=d,E=u))}else{for(;++u<s;)if(d=r(n[u],u,n),d!=null&&d>=d){c=p=d;break}if(u===s)return[-1,-1];for(y=E=u;++u<s;)d=r(n[u],u,n),d!=null&&(c>d&&(c=d,y=u),p<d&&(p=d,E=u))}return[y,E]}const jo=Object.prototype.hasOwnProperty;function tt(n,r){return jo.call(n,r)}const ao={};function E1(n){let r={},s;function u(d){return tt(r,d)&&r[d]!==ao}const c={size:0,empty:0,object:r,has:u,get(d){return u(d)?r[d]:void 0},set(d,p){return u(d)||(++c.size,r[d]===ao&&--c.empty),r[d]=p,this},delete(d){return u(d)&&(--c.size,++c.empty,r[d]=ao),this},clear(){c.size=c.empty=0,c.object=r={}},test(d){return arguments.length?(s=d,c):s},clean(){const d={};let p=0;for(const y in r){const E=r[y];E!==ao&&(!s||!s(E))&&(d[y]=E,++p)}c.size=p,c.empty=0,c.object=r=d}};return n&&Object.keys(n).forEach(d=>{c.set(d,n[d])}),c}function Zh(n,r,s,u,c,d){if(!s&&s!==0)return d;const p=+s;let y=n[0],E=oo(n),A;E<y&&(A=y,y=E,E=A),A=Math.abs(r-y);const F=Math.abs(E-r);return A<F&&A<=p?u:F<=p?c:d}function Kc(n,r,s){const u=n.prototype=Object.create(r.prototype);return Object.defineProperty(u,"constructor",{value:n,writable:!0,enumerable:!0,configurable:!0}),Uo(u,s)}function Jh(n,r,s,u){let c=r[0],d=r[r.length-1],p;return c>d&&(p=c,c=d,d=p),s=s===void 0||s,u=u===void 0||u,(s?c<=n:c<n)&&(u?n<=d:n<d)}function Ji(n){return typeof n=="boolean"}function N(n){return Object.prototype.toString.call(n)==="[object Date]"}function P(n){return n&&Ts(n[Symbol.iterator])}function j(n){return typeof n=="number"}function X(n){return Object.prototype.toString.call(n)==="[object RegExp]"}function U(n){return typeof n=="string"}function K(n,r,s){n&&(n=r?vt(n).map(y=>y.replace(/\\(.)/g,"$1")):vt(n));const u=n&&n.length,c=s&&s.get||Pe,d=y=>c(r?[y]:ne(y));let p;if(!u)p=function(){return""};else if(u===1){const y=d(n[0]);p=function(E){return""+y(E)}}else{const y=n.map(d);p=function(E){let A=""+y[0](E),F=0;for(;++F<u;)A+="|"+y[F](E);return A}}return an(p,n,"key")}function se(n,r){const s=n[0],u=oo(n),c=+r;return c?c===1?u:s+c*(u-s):s}const de=1e4;function ze(n){n=+n||de;let r,s,u;const c=()=>{r={},s={},u=0},d=(p,y)=>(++u>n&&(s=r,r={},u=1),r[p]=y);return c(),{clear:c,has:p=>tt(r,p)||tt(s,p),get:p=>tt(r,p)?r[p]:tt(s,p)?d(p,s[p]):void 0,set:(p,y)=>tt(r,p)?r[p]=y:d(p,y)}}function $t(n,r,s,u){const c=r.length,d=s.length;if(!d)return r;if(!c)return s;const p=u||new r.constructor(c+d);let y=0,E=0,A=0;for(;y<c&&E<d;++A)p[A]=n(r[y],s[E])>0?s[E++]:r[y++];for(;y<c;++y,++A)p[A]=r[y];for(;E<d;++E,++A)p[A]=s[E];return p}function Xn(n,r){let s="";for(;--r>=0;)s+=n;return s}function Dk(n,r,s,u){const c=s||" ",d=n+"",p=r-d.length;return p<=0?d:u==="left"?Xn(c,p)+d:u==="center"?Xn(c,~~(p/2))+d+Xn(c,Math.ceil(p/2)):d+Xn(c,p)}function kk(n){return n&&oo(n)-n[0]||0}function Ze(n){return pe(n)?"["+n.map(Ze)+"]":We(n)||U(n)?JSON.stringify(n).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):n}function A1(n){return n==null||n===""?null:!n||n==="false"||n==="0"?!1:!!n}const C1=n=>j(n)||N(n)?n:Date.parse(n);function rA(n,r){return r=r||C1,n==null||n===""?null:r(n)}function eg(n){return n==null||n===""?null:n+""}function oA(n){const r={},s=n.length;for(let u=0;u<s;++u)r[n[u]]=!0;return r}function sA(n,r,s,u){const c=u??"\u2026",d=n+"",p=d.length,y=Math.max(0,r-c.length);return p<=r?d:s==="left"?c+d.slice(p-y):s==="center"?d.slice(0,Math.ceil(y/2))+c+d.slice(p-~~(y/2)):d.slice(0,y)+c}function S1(n,r,s){if(n)if(r){const u=n.length;for(let c=0;c<u;++c){const d=r(n[c]);d&&s(d,c,n)}}else n.forEach(s)}function Qc(n){return ie(n,"or")}function Zc(n){return ie(n,"and")}function Rs(n){return ie(n,"not")}function Ba(n,r){if(Rs(n))Ba(n.not,r);else if(Zc(n))for(const s of n.and)Ba(s,r);else if(Qc(n))for(const s of n.or)Ba(s,r);else r(n)}function Ns(n,r){return Rs(n)?{not:Ns(n.not,r)}:Zc(n)?{and:n.and.map(s=>Ns(s,r))}:Qc(n)?{or:n.or.map(s=>Ns(s,r))}:r(n)}const _e=structuredClone;function F1(n){throw new Error(n)}function Go(n,r){const s={};for(const u of r)tt(n,u)&&(s[u]=n[u]);return s}function Yn(n,r){const s={...n};for(const u of r)delete s[u];return s}Set.prototype.toJSON=function(){return`Set(${[...this].map(n=>Se(n)).join(",")})`};function He(n){if(j(n))return n;const r=U(n)?n:Se(n);if(r.length<250)return r;let s=0;for(let u=0;u<r.length;u++){const c=r.charCodeAt(u);s=(s<<5)-s+c,s=s&s}return s}function tg(n){return n===!1||n===null}function Ue(n,r){return n.includes(r)}function La(n,r){let s=0;for(const[u,c]of n.entries())if(r(c,u,s++))return!0;return!1}function ng(n,r){let s=0;for(const[u,c]of n.entries())if(!r(c,u,s++))return!1;return!0}function w1(n,...r){for(const s of r)aA(n,s??{});return n}function aA(n,r){for(const s of te(r))ks(n,s,r[s],!0)}function _r(n,r){const s=[],u={};let c;for(const d of n)c=r(d),!(c in u)&&(u[c]=1,s.push(d));return s}function uA(n,r){const s=te(n),u=te(r);if(s.length!==u.length)return!1;for(const c of s)if(n[c]!==r[c])return!1;return!0}function D1(n,r){if(n.size!==r.size)return!1;for(const s of n)if(!r.has(s))return!1;return!0}function ig(n,r){for(const s of n)if(r.has(s))return!0;return!1}function rg(n){const r=new Set;for(const s of n){const c=ne(s).map((p,y)=>y===0?p:`[${p}]`),d=c.map((p,y)=>c.slice(0,y+1).join(""));for(const p of d)r.add(p)}return r}function og(n,r){return n===void 0||r===void 0?!0:ig(rg(n),rg(r))}function dt(n){return te(n).length===0}const te=Object.keys,Jt=Object.values,er=Object.entries;function qu(n){return n===!0||n===!1}function Ft(n){const r=n.replace(/\W/g,"_");return(n.match(/^\d+/)?"_":"")+r}function za(n,r){return Rs(n)?`!(${za(n.not,r)})`:Zc(n)?`(${n.and.map(s=>za(s,r)).join(") && (")})`:Qc(n)?`(${n.or.map(s=>za(s,r)).join(") || (")})`:r(n)}function Xu(n,r){if(r.length===0)return!0;const s=r.shift();return s in n&&Xu(n[s],r)&&delete n[s],dt(n)}function _s(n){return n.charAt(0).toUpperCase()+n.substr(1)}function sg(n,r="datum"){const s=ne(n),u=[];for(let c=1;c<=s.length;c++){const d=`[${s.slice(0,c).map(Ze).join("][")}]`;u.push(`${r}${d}`)}return u.join(" && ")}function Jc(n,r="datum"){return`${r}[${Ze(ne(n).join("."))}]`}function ht(n){return`datum['${n.replaceAll("'","\\'")}']`}function lA(n){return n.replace(/(\[|\]|\.|'|")/g,"\\$1")}function ci(n){return`${ne(n).map(lA).join("\\.")}`}function Mr(n,r,s){return n.replace(new RegExp(r.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),s)}function Wo(n){return`${ne(n).join(".")}`}function Ms(n){return n?ne(n).length:0}function It(...n){return n.find(r=>r!==void 0)}let k1=42;function Yu(n){const r=++k1;return n?String(n)+r:r}function ef(){k1=42}function Ku(n){return ag(n)?n:`__${n}`}function ag(n){return n.startsWith("__")}function Qu(n){if(n!==void 0)return(n%360+360)%360}function Bs(n){return j(n)?!0:!isNaN(n)&&!isNaN(parseFloat(n))}const we=Object.getPrototypeOf(structuredClone({}));function Kn(n,r){if(n===r)return!0;if(n&&r&&typeof n=="object"&&typeof r=="object"){if(n.constructor.name!==r.constructor.name)return!1;let s,u;if(Array.isArray(n)){if(s=n.length,s!=r.length)return!1;for(u=s;u--!==0;)if(!Kn(n[u],r[u]))return!1;return!0}if(n instanceof Map&&r instanceof Map){if(n.size!==r.size)return!1;for(const d of n.entries())if(!r.has(d[0]))return!1;for(const d of n.entries())if(!Kn(d[1],r.get(d[0])))return!1;return!0}if(n instanceof Set&&r instanceof Set){if(n.size!==r.size)return!1;for(const d of n.entries())if(!r.has(d[0]))return!1;return!0}if(ArrayBuffer.isView(n)&&ArrayBuffer.isView(r)){if(s=n.length,s!=r.length)return!1;for(u=s;u--!==0;)if(n[u]!==r[u])return!1;return!0}if(n.constructor===RegExp)return n.source===r.source&&n.flags===r.flags;if(n.valueOf!==Object.prototype.valueOf&&n.valueOf!==we.valueOf)return n.valueOf()===r.valueOf();if(n.toString!==Object.prototype.toString&&n.toString!==we.toString)return n.toString()===r.toString();const c=Object.keys(n);if(s=c.length,s!==Object.keys(r).length)return!1;for(u=s;u--!==0;)if(!Object.prototype.hasOwnProperty.call(r,c[u]))return!1;for(u=s;u--!==0;){const d=c[u];if(!Kn(n[d],r[d]))return!1}return!0}return n!==n&&r!==r}function Se(n){const r=[];return function s(u){if(u&&u.toJSON&&typeof u.toJSON=="function"&&(u=u.toJSON()),u===void 0)return;if(typeof u=="number")return isFinite(u)?""+u:"null";if(typeof u!="object")return JSON.stringify(u);let c,d;if(Array.isArray(u)){for(d="[",c=0;c<u.length;c++)c&&(d+=","),d+=s(u[c])||"null";return d+"]"}if(u===null)return"null";if(r.includes(u))throw new TypeError("Converting circular structure to JSON");const p=r.push(u)-1,y=Object.keys(u).sort();for(d="",c=0;c<y.length;c++){const E=y[c],A=s(u[E]);A&&(d&&(d+=","),d+=JSON.stringify(E)+":"+A)}return r.splice(p,1),`{${d}}`}(n)}function ie(n,r){return We(n)&&tt(n,r)&&n[r]!==void 0}const Oi="row",Br="column",Lr="facet",wt="x",Ot="y",Qn="x2",fi="y2",Vo="xOffset",Ia="yOffset",tr="radius",uo="radius2",Ti="theta",Ke="theta2",Ri="latitude",nr="longitude",ir="latitude2",Ni="longitude2",rr="time",Gt="color",zr="fill",Ir="stroke",Zn="shape",lo="size",Ls="angle",co="opacity",Ho="fillOpacity",qo="strokeOpacity",Xo="strokeWidth",Yo="strokeDash",Zu="text",Pa="order",Ju="detail",zs="key",Sn="tooltip",or="href",_i="url",tf="description",$1={x:1,y:1,x2:1,y2:1},Is={theta:1,theta2:1,radius:1,radius2:1};function ug(n){return tt(Is,n)}const Ps={longitude:1,longitude2:1,latitude:1,latitude2:1};function lg(n){switch(n){case Ri:return"y";case ir:return"y2";case nr:return"x";case Ni:return"x2"}}function cg(n){return tt(Ps,n)}const Ko=te(Ps),el={...$1,...Is,...Ps,xOffset:1,yOffset:1,color:1,fill:1,stroke:1,time:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1};function Us(n){return n===Gt||n===zr||n===Ir}const tl={row:1,column:1,facet:1},Jn=te(tl),fg={...el,...tl},cA=te(fg),{order:$k,detail:Ok,tooltip:fA,...O1}=fg,{row:Tk,column:Rk,facet:T1,...R1}=O1,Nk=te(O1),_k=te(R1);function dA(n){return tt(R1,n)}function dg(n){return tt(fg,n)}const hA=[Qn,fi,ir,Ni,Ke,uo];function js(n){return sr(n)!==n}function sr(n){switch(n){case Qn:return wt;case fi:return Ot;case ir:return Ri;case Ni:return nr;case Ke:return Ti;case uo:return tr}return n}function q(n){if(ug(n))switch(n){case Ti:return"startAngle";case Ke:return"endAngle";case tr:return"outerRadius";case uo:return"innerRadius"}return n}function Bn(n){switch(n){case wt:return Qn;case Ot:return fi;case Ri:return ir;case nr:return Ni;case Ti:return Ke;case tr:return uo}}function Ln(n){switch(n){case wt:case Qn:return"width";case Ot:case fi:return"height"}}function hg(n){switch(n){case wt:return"xOffset";case Ot:return"yOffset";case Qn:return"x2Offset";case fi:return"y2Offset";case Ti:return"thetaOffset";case tr:return"radiusOffset";case Ke:return"theta2Offset";case uo:return"radius2Offset"}}function nf(n){switch(n){case wt:return"xOffset";case Ot:return"yOffset"}}function gg(n){switch(n){case"xOffset":return"x";case"yOffset":return"y"}}const gA=te(el),{x:pA,y:mA,x2:N1,y2:_1,xOffset:M1,yOffset:yA,latitude:ar,longitude:Mk,latitude2:vA,longitude2:bA,theta:Bk,theta2:Lk,radius:zk,radius2:xA,...pg}=el,nl=te(pg),Ua={x:1,y:1},ur=te(Ua);function Tt(n){return tt(Ua,n)}const ja={theta:1,radius:1},EA=te(ja);function Ga(n){return n==="width"?wt:Ot}const il={xOffset:1,yOffset:1},B1=te(il);function Gs(n){return tt(il,n)}const rf={time:1},L1=te(rf);function of(n){return n in rf}const{text:AA,tooltip:z1,href:I1,url:P1,description:U1,detail:CA,key:j1,order:sf,...rl}=pg,ol=te(rl);function Wa(n){return tt(pg,n)}function mg(n){switch(n){case Gt:case zr:case Ir:case lo:case Zn:case co:case Xo:case Yo:return!0;case Ho:case qo:case Ls:case rr:return!1}}const yg={...Ua,...ja,...il,...rl},af=te(yg);function lr(n){return tt(yg,n)}function vg(n,r){return G1(n)[r]}const bg={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},{geoshape:Ik,...SA}=bg;function G1(n){switch(n){case Gt:case zr:case Ir:case tf:case Ju:case zs:case Sn:case or:case Pa:case co:case Ho:case qo:case Xo:case Lr:case Oi:case Br:return bg;case wt:case Ot:case Vo:case Ia:case Ri:case nr:case rr:return SA;case Qn:case fi:case ir:case Ni:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case lo:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case Yo:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case Zn:return{point:"always",geoshape:"always"};case Zu:return{text:"always"};case Ls:return{point:"always",square:"always",text:"always"};case _i:return{image:"always"};case Ti:return{text:"always",arc:"always"};case tr:return{text:"always",arc:"always"};case Ke:case uo:return{arc:"always"}}}function uf(n){switch(n){case wt:case Ot:case Ti:case tr:case Vo:case Ia:case lo:case Ls:case Xo:case co:case Ho:case qo:case rr:case Qn:case fi:case Ke:case uo:return;case Lr:case Oi:case Br:case Zn:case Yo:case Zu:case Sn:case or:case _i:case tf:return"discrete";case Gt:case zr:case Ir:return"flexible";case Ri:case nr:case ir:case Ni:case Ju:case zs:case Pa:return}}const W1={argmax:1,argmin:1,average:1,count:1,distinct:1,exponential:1,exponentialb:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},FA={count:1,min:1,max:1};function fo(n){return ie(n,"argmin")}function Qo(n){return ie(n,"argmax")}function xg(n){return U(n)&&tt(W1,n)}const lf=new Set(["count","valid","missing","distinct"]);function cf(n){return U(n)&&lf.has(n)}function wA(n){return U(n)&&Ue(["min","max"],n)}const DA=new Set(["count","sum","distinct","valid","missing"]),kA=new Set(["mean","average","median","q1","q3","min","max"]);function Va(n){return Ji(n)&&(n=Ml(n,void 0)),"bin"+te(n).map(r=>sl(n[r])?Ft(`_${r}_${er(n[r])}`):Ft(`_${r}_${n[r]}`)).join("")}function nt(n){return n===!0||ho(n)&&!n.binned}function mn(n){return n==="binned"||ho(n)&&n.binned===!0}function ho(n){return We(n)}function sl(n){return ie(n,"param")}function ff(n){switch(n){case Oi:case Br:case lo:case Gt:case zr:case Ir:case Xo:case co:case Ho:case qo:case Zn:return 6;case Yo:return 4;default:return 10}}function al(n){return ie(n,"expr")}function Wt(n,{level:r}={level:0}){const s=te(n||{}),u={};for(const c of s)u[c]=r===0?di(n[c]):Wt(n[c],{level:r-1});return u}function Ha(n){const{anchor:r,frame:s,offset:u,orient:c,angle:d,limit:p,color:y,subtitleColor:E,subtitleFont:A,subtitleFontSize:F,subtitleFontStyle:$,subtitleFontWeight:_,subtitleLineHeight:L,subtitlePadding:T,...B}=n,G={...B,...y?{fill:y}:{}},H={...r?{anchor:r}:{},...s?{frame:s}:{},...u?{offset:u}:{},...c?{orient:c}:{},...d!==void 0?{angle:d}:{},...p!==void 0?{limit:p}:{}},Z={...E?{subtitleColor:E}:{},...A?{subtitleFont:A}:{},...F?{subtitleFontSize:F}:{},...$?{subtitleFontStyle:$}:{},..._?{subtitleFontWeight:_}:{},...L?{subtitleLineHeight:L}:{},...T?{subtitlePadding:T}:{}},ve=Go(n,["align","baseline","dx","dy","limit"]);return{titleMarkConfig:G,subtitleMarkConfig:ve,nonMarkTitleProperties:H,subtitle:Z}}function Zo(n){return U(n)||pe(n)&&U(n[0])}function xe(n){return ie(n,"signal")}function Jo(n){return ie(n,"step")}function $A(n){return pe(n)?!1:ie(n,"fields")&&!ie(n,"data")}function OA(n){return pe(n)?!1:ie(n,"fields")&&ie(n,"data")}function go(n){return pe(n)?!1:ie(n,"field")&&ie(n,"data")}const TA=te({aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1,url:1,smooth:1}),V1={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},ul=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"],Fn=" \u2013 ";function po(n){const r=pe(n.condition)?n.condition.map(df):df(n.condition);return{...di(n),condition:r}}function di(n){if(al(n)){const{expr:r,...s}=n;return{signal:r,...s}}return n}function df(n){if(al(n)){const{expr:r,...s}=n;return{signal:r,...s}}return n}function Et(n){if(al(n)){const{expr:r,...s}=n;return{signal:r,...s}}return xe(n)?n:n!==void 0?{value:n}:void 0}function Eg(n){return xe(n)?n.signal:Ze(n)}function Ag(n){return xe(n)?n.signal:Ze(n.value)}function cr(n){return xe(n)?n.signal:n==null?null:Ze(n)}function Cg(n,r,s){for(const u of s){const c=Pr(u,r.markDef,r.config);c!==void 0&&(n[u]=Et(c))}return n}function H1(n){return[].concat(n.type,n.style??[])}function ct(n,r,s,u={}){const{vgChannel:c,ignoreVgConfig:d}=u;return c&&ie(r,c)?r[c]:r[n]!==void 0?r[n]:d&&(!c||c===n)?void 0:Pr(n,r,s,u)}function Pr(n,r,s,{vgChannel:u}={}){const c=hf(n,r,s.style);return It(u?c:void 0,c,u?s[r.type][u]:void 0,s[r.type][n],u?s.mark[u]:s.mark[n])}function hf(n,r,s){return q1(n,H1(r),s)}function q1(n,r,s){r=vt(r);let u;for(const c of r){const d=s[c];ie(d,n)&&(u=d[n])}return u}function Sg(n,r){return vt(n).reduce((s,u)=>(s.field.push(le(u,r)),s.order.push(u.sort??"ascending"),s),{field:[],order:[]})}function X1(n,r){const s=[...n];return r.forEach(u=>{for(const c of s)if(Kn(c,u))return;s.push(u)}),s}function Fg(n,r){return Kn(n,r)||!r?n:n?[...vt(n),...vt(r)].join(", "):r}function gf(n,r){const s=n.value,u=r.value;if(s==null||u===null)return{explicit:n.explicit,value:null};if((Zo(s)||xe(s))&&(Zo(u)||xe(u)))return{explicit:n.explicit,value:Fg(s,u)};if(Zo(s)||xe(s))return{explicit:n.explicit,value:s};if(Zo(u)||xe(u))return{explicit:n.explicit,value:u};if(!Zo(s)&&!xe(s)&&!Zo(u)&&!xe(u))return{explicit:n.explicit,value:X1(s,u)};throw new Error("It should never reach here")}function pf(n){return`Invalid specification ${Se(n)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}const RA='Autosize "fit" only works for single views and layered views.';function Y1(n){return`${n=="width"?"Width":"Height"} "container" only works for single views and layered views.`}function wg(n){const r=n=="width"?"Width":"Height",s=n=="width"?"x":"y";return`${r} "container" only works well with autosize "fit" or "fit-${s}".`}function mf(n){return n?`Dropping "fit-${n}" because spec has discrete ${Ln(n)}.`:'Dropping "fit" because spec has discrete size.'}function yf(n){return`Unknown field for ${n}. Cannot calculate view size.`}function vf(n){return`Cannot project a selection on encoding channel "${n}", which has no field.`}function NA(n,r){return`Cannot project a selection on encoding channel "${n}" as it uses an aggregate function ("${r}").`}function K1(n){return`The "nearest" transform is not supported for ${n} marks.`}function Q1(n){return`Selection not supported for ${n} yet.`}function Dg(n){return`Cannot find a selection named "${n}".`}const kg="Scale bindings are currently only supported for scales with unbinned, continuous domains.",bf="Sequntial scales are deprecated. The available quantitative scale type values are linear, log, pow, sqrt, symlog, time and utc",Z1="Legend bindings are only supported for selections over an individual field or encoding channel.";function _A(n){return`Lookups can only be performed on selection parameters. "${n}" is a variable parameter.`}function $g(n){return`Cannot define and lookup the "${n}" selection in the same view. Try moving the lookup into a second, layered view?`}const Og="The same selection must be used to override scale domains in a layered view.",Tg='Interval selections should be initialized using "x", "y", "longitude", or "latitude" keys.';function Rg(n){return`Unknown repeated value "${n}".`}function Ng(n){return`The "columns" property cannot be used when "${n}" has nested row/column.`}const xf="Multiple timer selections in one unit spec are not supported. Ignoring all but the first.",_g="Animation involving facet, layer, or concat is currently unsupported.";function Mg(n){return`A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": ${(0,ot.stringValue)(n)}.`}function MA(n,r,s,u){return(n.length?"Multiple ":"No ")+`matching ${(0,ot.stringValue)(r)} encoding found for selection ${(0,ot.stringValue)(s.param)}. Using "field": ${(0,ot.stringValue)(u)}.`}const BA="Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415).";function LA(n){return`Unrecognized parse "${n}".`}function Ef(n,r,s){return`An ancestor parsed field "${n}" as ${s} but a child wants to parse the field as ${r}.`}const Bg="Attempt to add the same child twice.";function J1(n){return`Ignoring an invalid transform: ${Se(n)}.`}const zA='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.';function Lg(n){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${n} are dropped.`}function IA(n){const{parentProjection:r,projection:s}=n;return`Layer's shared projection ${Se(r)} is overridden by a child projection ${Se(s)}.`}const zg="Arc marks uses theta channel rather than angle, replacing angle with theta.";function Ig(n){return`${n}Offset dropped because ${n} is continuous`}function ey(n,r,s){return`Channel ${n} is a ${r}. Converted to {value: ${Se(s)}}.`}function ty(n){return`Invalid field type "${n}".`}function ny(n,r){return`Invalid field type "${n}" for aggregate: "${r}", using "quantitative" instead.`}function PA(n){return`Invalid aggregation operator "${n}".`}function UA(n,r){return`Missing type for channel "${n}", using "${r}" instead.`}function Af(n,r){const{fill:s,stroke:u}=r;return`Dropping color ${n} as the plot also has ${s&&u?"fill and stroke":s?"fill":"stroke"}.`}function jA(n){return`Position range does not support relative band size for ${n}.`}function Pg(n,r){return`Dropping ${Se(n)} from channel "${r}" since it does not contain any data field, datum, value, or signal.`}const GA="Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.";function ll(n,r,s){return`${n} dropped as it is incompatible with "${r}"${s?` when ${s}`:""}.`}function iy(n){return`${n} encoding has no scale, so specified scale is ignored.`}function WA(n){return`${n}-encoding is dropped as ${n} is not a valid encoding channel.`}function ry(n){return`${n} encoding should be discrete (ordinal / nominal / binned).`}function Ug(n){return`${n} encoding should be discrete (ordinal / nominal / binned) or use a discretizing scale (e.g. threshold).`}function VA(n){return`Facet encoding dropped as ${n.join(" and ")} ${n.length>1?"are":"is"} also specified.`}function Cf(n,r){return`Using discrete channel "${n}" to encode "${r}" field can be misleading as it does not encode ${r==="ordinal"?"order":"magnitude"}.`}function jg(n){return`The ${n} for range marks cannot be an expression`}function Gg(n,r){return`Line mark is for continuous lines and thus cannot be used with ${n&&r?"x2 and y2":n?"x2":"y2"}. We will use the rule mark (line segments) instead.`}function oy(n,r){return`Specified orient "${n}" overridden with "${r}".`}const sy="Custom domain scale cannot be unioned with default field-based domain.";function ay(n){return`Cannot use the scale property "${n}" with non-color channel.`}function uy(n){return`Cannot use the relative band size with ${n} scale.`}function ly(n){return`Using unaggregated domain with raw field has no effect (${Se(n)}).`}function HA(n){return`Unaggregated domain not applicable for "${n}" since it produces values outside the origin domain of the source data.`}function cl(n){return`Unaggregated domain is currently unsupported for log scale (${Se(n)}).`}function qA(n){return`Cannot apply size to non-oriented mark "${n}".`}function XA(n,r,s){return`Channel "${n}" does not work with "${r}" scale. We are using "${s}" scale instead.`}function cy(n,r){return`FieldDef does not work with "${n}" scale. We are using "${r}" scale instead.`}function Wg(n,r,s){return`${s}-scale's "${r}" is dropped as it does not work with ${n} scale.`}function Uk(n,r){return`Scale type "${r}" does not work with mark "${n}".`}function Sf(n){return`The step for "${n}" is dropped because the ${n==="width"?"x":"y"} is continuous.`}function YA(n,r,s,u){return`Conflicting ${r.toString()} property "${n.toString()}" (${Se(s)} and ${Se(u)}). Using ${Se(s)}.`}function KA(n,r,s,u){return`Conflicting ${r.toString()} property "${n.toString()}" (${Se(s)} and ${Se(u)}). Using the union of the two domains.`}function QA(n){return`Setting the scale to be independent for "${n}" means we also have to set the guide (axis or legend) to be independent.`}function ZA(n){return`Dropping sort property ${Se(n)} as unioned domains only support boolean or op "count", "min", and "max".`}const fy="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",JA="Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect.",eC="Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect.",tC="Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.",jk="Invalid channel for axis.";function nC(n){return`Cannot stack "${n}" if there is already "${n}2".`}function iC(n){return`Stack is applied to a non-linear scale (${n}).`}function rC(n){return`Stacking is applied even though the aggregate function is non-summative ("${n}").`}function Ff(n,r){return`Invalid ${n}: ${Se(r)}.`}function oC(n){return`Dropping day from datetime ${Se(n)} as day cannot be combined with other units.`}function sC(n,r){return`${r?"extent ":""}${r&&n?"and ":""}${n?"center ":""}${r&&n?"are ":"is "}not needed when data are aggregated.`}function dy(n,r,s){return`${n} is not usually used with ${r} for ${s}.`}function aC(n,r){return`Continuous axis should not have customized aggregation function ${n}; ${r} already agregates the axis.`}function wf(n){return`1D error band does not support ${n}.`}function hy(n){return`Channel ${n} is required for "binned" bin.`}function gy(n){return`Channel ${n} should not be used with "binned" bin.`}function uC(n){return`Domain for ${n} is required for threshold scale.`}var lC=function(n,r,s,u,c){if(u==="m")throw new TypeError("Private method is not writable");if(u==="a"&&!c)throw new TypeError("Private accessor was defined without a setter");if(typeof r=="function"?n!==r||!c:!r.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return u==="a"?c.call(n,s):c?c.value=s:r.set(n,s),s},Ws=function(n,r,s,u){if(s==="a"&&!u)throw new TypeError("Private accessor was defined without a getter");if(typeof r=="function"?n!==r||!u:!r.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return s==="m"?u:s==="a"?u.call(n):u?u.value:r.get(n)},zn;const py=ui(Cn);let ei=py;class cC{constructor(){this.warns=[],this.infos=[],this.debugs=[],zn.set(this,Warn)}level(r){return r?(lC(this,zn,r,"f"),this):Ws(this,zn,"f")}warn(...r){return Ws(this,zn,"f")>=Warn&&this.warns.push(...r),this}info(...r){return Ws(this,zn,"f")>=Info&&this.infos.push(...r),this}debug(...r){return Ws(this,zn,"f")>=Debug&&this.debugs.push(...r),this}error(...r){if(Ws(this,zn,"f")>=ErrorLevel)throw Error(...r);return this}}zn=new WeakMap;function Gk(n){return()=>{ei=new cC,n(ei),Vg()}}function fC(n){return ei=n,ei}function Vg(){return ei=py,ei}function Hg(...n){ei.error(...n)}function oe(...n){ei.warn(...n)}function Wk(...n){ei.info(...n)}function qa(...n){ei.debug(...n)}function fr(n){if(n&&We(n)){for(const r of Yg)if(ie(n,r))return!0}return!1}const my=["january","february","march","april","may","june","july","august","september","october","november","december"],dC=my.map(n=>n.substr(0,3)),yy=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],qg=yy.map(n=>n.substr(0,3));function hC(n){if(Bs(n)&&(n=+n),j(n))return n>4&&oe(Ff("quarter",n)),n-1;throw new Error(Ff("quarter",n))}function gC(n){if(Bs(n)&&(n=+n),j(n))return n-1;{const r=n.toLowerCase(),s=my.indexOf(r);if(s!==-1)return s;const u=r.substr(0,3),c=dC.indexOf(u);if(c!==-1)return c;throw new Error(Ff("month",n))}}function pC(n){if(Bs(n)&&(n=+n),j(n))return n%7;{const r=n.toLowerCase(),s=yy.indexOf(r);if(s!==-1)return s;const u=r.substr(0,3),c=qg.indexOf(u);if(c!==-1)return c;throw new Error(Ff("day",n))}}function Xg(n,r){const s=[];if(r&&n.day!==void 0&&te(n).length>1&&(oe(oC(n)),n=_e(n),delete n.day),n.year!==void 0?s.push(n.year):s.push(2012),n.month!==void 0){const u=r?gC(n.month):n.month;s.push(u)}else if(n.quarter!==void 0){const u=r?hC(n.quarter):n.quarter;s.push(j(u)?u*3:`${u}*3`)}else s.push(0);if(n.date!==void 0)s.push(n.date);else if(n.day!==void 0){const u=r?pC(n.day):n.day;s.push(j(u)?u+1:`${u}+1`)}else s.push(1);for(const u of["hours","minutes","seconds","milliseconds"]){const c=n[u];s.push(typeof c>"u"?0:c)}return s}function Vs(n){const s=Xg(n,!0).join(", ");return n.utc?`utc(${s})`:`datetime(${s})`}function mC(n){const s=Xg(n,!1).join(", ");return n.utc?`utc(${s})`:`datetime(${s})`}function yC(n){const r=Xg(n,!0);return n.utc?+new Date(Date.UTC(...r)):+new Date(...r)}const vy={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},Yg=te(vy);function vC(n){return(0,ot.hasOwnProperty)(vy,n)}const Vk={utcyear:1,utcquarter:1,utcmonth:1,utcweek:1,utcday:1,utcdayofyear:1,utcdate:1,utchours:1,utcminutes:1,utcseconds:1,utcmilliseconds:1},Hk={yearquarter:1,yearquartermonth:1,yearmonth:1,yearmonthdate:1,yearmonthdatehours:1,yearmonthdatehoursminutes:1,yearmonthdatehoursminutesseconds:1,yearweek:1,yearweekday:1,yearweekdayhours:1,yearweekdayhoursminutes:1,yearweekdayhoursminutesseconds:1,yeardayofyear:1,quartermonth:1,monthdate:1,monthdatehours:1,monthdatehoursminutes:1,monthdatehoursminutesseconds:1,weekday:1,weekdayhours:1,weekdayhoursminutes:1,weekdayhoursminutesseconds:1,dayhours:1,dayhoursminutes:1,dayhoursminutesseconds:1,hoursminutes:1,hoursminutesseconds:1,minutesseconds:1,secondsmilliseconds:1},Xk={...{binnedyear:1,binnedyearquarter:1,binnedyearquartermonth:1,binnedyearmonth:1,binnedyearmonthdate:1,binnedyearmonthdatehours:1,binnedyearmonthdatehoursminutes:1,binnedyearmonthdatehoursminutesseconds:1,binnedyearweek:1,binnedyearweekday:1,binnedyearweekdayhours:1,binnedyearweekdayhoursminutes:1,binnedyearweekdayhoursminutesseconds:1,binnedyeardayofyear:1},...{binnedutcyear:1,binnedutcyearquarter:1,binnedutcyearquartermonth:1,binnedutcyearmonth:1,binnedutcyearmonthdate:1,binnedutcyearmonthdatehours:1,binnedutcyearmonthdatehoursminutes:1,binnedutcyearmonthdatehoursminutesseconds:1,binnedutcyearweek:1,binnedutcyearweekday:1,binnedutcyearweekdayhours:1,binnedutcyearweekdayhoursminutes:1,binnedutcyearweekdayhoursminutesseconds:1,binnedutcyeardayofyear:1}};function Mi(n){return We(n)?n.binned:Ur(n)}function Ur(n){return n&&n.startsWith("binned")}const Df={utcyearquarter:1,utcyearquartermonth:1,utcyearmonth:1,utcyearmonthdate:1,utcyearmonthdatehours:1,utcyearmonthdatehoursminutes:1,utcyearmonthdatehoursminutesseconds:1,utcyearweek:1,utcyearweekday:1,utcyearweekdayhours:1,utcyearweekdayhoursminutes:1,utcyearweekdayhoursminutesseconds:1,utcyeardayofyear:1,utcquartermonth:1,utcmonthdate:1,utcmonthdatehours:1,utcmonthdatehoursminutes:1,utcmonthdatehoursminutesseconds:1,utcweekday:1,utcweekdayhours:1,utcweekdayhoursminutes:1,utcweekdayhoursminutesseconds:1,utcdayhours:1,utcdayhoursminutes:1,utcdayhoursminutesseconds:1,utchoursminutes:1,utchoursminutesseconds:1,utcminutesseconds:1,utcsecondsmilliseconds:1};function Hs(n){return n.startsWith("utc")}function kf(n){return n.substring(3)}const qs={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function jr(n){return Yg.filter(r=>Xs(n,r))}function dr(n){const r=jr(n);return r[r.length-1]}function Xs(n,r){const s=n.indexOf(r);return!(s<0||s>0&&r==="seconds"&&n.charAt(s-1)==="i"||n.length>s+3&&r==="day"&&n.charAt(s+3)==="o"||s>0&&r==="year"&&n.charAt(s-1)==="f")}function Xa(n,r,{end:s}={end:!1}){const u=sg(r),c=Hs(n)?"utc":"";function d(E){return E==="quarter"?`(${c}quarter(${u})-1)`:`${c}${E}(${u})`}let p;const y={};for(const E of Yg)Xs(n,E)&&(y[E]=d(E),p=E);return s&&(y[p]+="+1"),mC(y)}function fl(n){if(!n)return;const r=jr(n);return`timeUnitSpecifier(${Se(r)}, ${Se(qs)})`}function $f(n,r,s){if(!n)return;const u=fl(n);return`${s||Hs(n)?"utc":"time"}Format(${r}, ${u})`}function qt(n){if(!n)return;let r;return U(n)?Ur(n)?r={unit:n.substring(6),binned:!0}:r={unit:n}:We(n)&&(r={...n,...n.unit?{unit:n.unit}:{}}),Hs(r.unit)&&(r.utc=!0,r.unit=kf(r.unit)),r}function Kg(n){const{utc:r,...s}=qt(n);return s.unit?(r?"utc":"")+te(s).map(u=>Ft(`${u==="unit"?"":`_${u}_`}${s[u]}`)).join(""):(r?"utc":"")+"timeunit"+te(s).map(u=>Ft(`_${u}_${s[u]}`)).join("")}function Qg(n,r=s=>s){const s=qt(n),u=dr(s.unit);if(u&&u!=="day"){const c={year:2001,month:1,date:1,hours:0,minutes:0,seconds:0,milliseconds:0},{step:d,part:p}=Ya(u,s.step),y={...c,[p]:+c[p]+d};return`${r(Vs(y))} - ${r(Vs(c))}`}}const Zg={year:1,month:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1};function en(n){return(0,ot.hasOwnProperty)(Zg,n)}function Ya(n,r=1){if(en(n))return{part:n,step:r};switch(n){case"day":case"dayofyear":return{part:"date",step:r};case"quarter":return{part:"month",step:r*3};case"week":return{part:"date",step:r*7}}}function dl(n){return ie(n,"param")}function ti(n){return!!n?.field&&n.equal!==void 0}function hl(n){return!!n?.field&&n.lt!==void 0}function Jg(n){return!!n?.field&&n.lte!==void 0}function ep(n){return!!n?.field&&n.gt!==void 0}function gl(n){return!!n?.field&&n.gte!==void 0}function Of(n){if(n?.field){if(pe(n.range)&&n.range.length===2)return!0;if(xe(n.range))return!0}return!1}function tp(n){return!!n?.field&&(pe(n.oneOf)||pe(n.in))}function bC(n){return!!n?.field&&n.valid!==void 0}function xy(n){return tp(n)||ti(n)||Of(n)||hl(n)||ep(n)||Jg(n)||gl(n)}function Gr(n,r){return Yf(n,{timeUnit:r,wrapTime:!0})}function Ey(n,r){return n.map(s=>Gr(s,r))}function pl(n,r=!0){const{field:s}=n,u=qt(n.timeUnit),{unit:c,binned:d}=u||{},p=le(n,{expr:"datum"}),y=c?`time(${d?p:Xa(c,s)})`:p;if(ti(n))return`${y}===${Gr(n.equal,c)}`;if(hl(n)){const E=n.lt;return`${y}<${Gr(E,c)}`}else if(ep(n)){const E=n.gt;return`${y}>${Gr(E,c)}`}else if(Jg(n)){const E=n.lte;return`${y}<=${Gr(E,c)}`}else if(gl(n)){const E=n.gte;return`${y}>=${Gr(E,c)}`}else{if(tp(n))return`indexof([${Ey(n.oneOf,c).join(",")}], ${y}) !== -1`;if(bC(n))return ml(y,n.valid);if(Of(n)){const{range:E}=Wt(n),A=xe(E)?{signal:`${E.signal}[0]`}:E[0],F=xe(E)?{signal:`${E.signal}[1]`}:E[1];if(A!==null&&F!==null&&r)return"inrange("+y+", ["+Gr(A,c)+", "+Gr(F,c)+"])";const $=[];return A!==null&&$.push(`${y} >= ${Gr(A,c)}`),F!==null&&$.push(`${y} <= ${Gr(F,c)}`),$.length>0?$.join(" && "):"true"}}throw new Error(`Invalid field predicate: ${Se(n)}`)}function ml(n,r=!0){return r?`isValid(${n}) && isFinite(+${n})`:`!isValid(${n}) || !isFinite(+${n})`}function Ay(n){return xy(n)&&n.timeUnit?{...n,timeUnit:qt(n.timeUnit)}:n}const Ys={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"};function Yk(n){return hasOwnProperty(Ys,n)}function it(n){return n==="quantitative"||n==="temporal"}function np(n){return n==="ordinal"||n==="nominal"}const hi=Ys.quantitative,yl=Ys.ordinal,hr=Ys.temporal,vl=Ys.nominal,Ks=Ys.geojson,Kk=te(Ys);function Cy(n){if(n)switch(n=n.toLowerCase(),n){case"q":case hi:return"quantitative";case"t":case hr:return"temporal";case"o":case yl:return"ordinal";case"n":case vl:return"nominal";case Ks:return"geojson"}}const ln={LINEAR:"linear",LOG:"log",POW:"pow",SQRT:"sqrt",SYMLOG:"symlog",IDENTITY:"identity",SEQUENTIAL:"sequential",TIME:"time",UTC:"utc",QUANTILE:"quantile",QUANTIZE:"quantize",THRESHOLD:"threshold",BIN_ORDINAL:"bin-ordinal",ORDINAL:"ordinal",POINT:"point",BAND:"band"},Tf={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"},xC=te(Tf);function Rf(n,r){const s=Tf[n],u=Tf[r];return s===u||s==="ordinal-position"&&u==="time"||u==="ordinal-position"&&s==="time"}const Sy={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function EC(n){return Sy[n]}const ip=new Set(["linear","log","pow","sqrt","symlog"]),Nf=new Set([...ip,"time","utc"]);function Fy(n){return ip.has(n)}const wy=new Set(["quantile","quantize","threshold"]),AC=new Set([...Nf,...wy,"sequential","identity"]),Dy=new Set(["ordinal","bin-ordinal","point","band"]),CC=new Set(["time","utc"]);function tn(n){return Dy.has(n)}function gi(n){return AC.has(n)}function pi(n){return Nf.has(n)}function Ka(n){return wy.has(n)}const SC={pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,tickBandPaddingInner:.25,bandWithNestedOffsetPaddingInner:.2,bandWithNestedOffsetPaddingOuter:.2,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:4,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4,zero:!0,framesPerSecond:2,animationDuration:5};function FC(n){return!U(n)&&ie(n,"name")}function ky(n){return ie(n,"param")}function wC(n){return ie(n,"unionWith")}function rp(n){return We(n)&&"field"in n}const op={type:1,domain:1,domainMax:1,domainMin:1,domainMid:1,domainRaw:1,align:1,range:1,rangeMax:1,rangeMin:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},$y=te(op),{type:DC,domain:kC,range:Oy,rangeMax:$C,rangeMin:OC,scheme:Qk,...TC}=op,RC=te(TC);function sp(n,r){switch(r){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!["point","band","identity"].includes(n);case"bins":return!["point","band","identity","ordinal"].includes(n);case"round":return pi(n)||n==="band"||n==="point";case"padding":case"rangeMin":case"rangeMax":return pi(n)||["point","band"].includes(n);case"paddingOuter":case"align":return["point","band"].includes(n);case"paddingInner":return n==="band";case"domainMax":case"domainMid":case"domainMin":case"domainRaw":case"clamp":return pi(n);case"nice":return pi(n)||n==="quantize"||n==="threshold";case"exponent":return n==="pow";case"base":return n==="log";case"constant":return n==="symlog";case"zero":return gi(n)&&!Ue(["log","time","utc","threshold","quantile"],n)}}function ap(n,r){switch(r){case"interpolate":case"scheme":case"domainMid":return Us(n)?void 0:ay(r);case"align":case"type":case"bins":case"domain":case"domainMax":case"domainMin":case"domainRaw":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeMax":case"rangeMin":case"reverse":case"round":case"clamp":case"zero":return}}function NC(n,r){return Ue([yl,vl],r)?n===void 0||tn(n):r===hr?Ue([ln.TIME,ln.UTC,void 0],n):r===hi?Fy(n)||Ka(n)||n===void 0:!0}function Ty(n,r,s=!1){if(!lr(n))return!1;switch(n){case wt:case Ot:case Vo:case Ia:case Ti:case tr:return pi(r)||r==="band"?!0:r==="point"?!s:!1;case rr:return Ue(["linear","band"],r);case lo:case Xo:case co:case Ho:case qo:case Ls:return pi(r)||Ka(r)||Ue(["band","point","ordinal"],r);case Gt:case zr:case Ir:return r!=="band";case Yo:case Zn:return r==="ordinal"||Ka(r)}}function _C(n){return We(n)&&"value"in n}const wn={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},up=wn.arc,_f=wn.area,Mf=wn.bar,Ry=wn.image,bl=wn.line,Bf=wn.point,Lf=wn.rect,Qa=wn.rule,lp=wn.text,Bi=wn.tick,Ny=wn.trail,zf=wn.circle,xl=wn.square,_y=wn.geoshape;function Zk(n){return hasOwnProperty(wn,n)}const Jk=null;function es(n){return["line","area","trail"].includes(n)}function El(n){return["rect","bar","image","arc","tick"].includes(n)}const Qs=new Set(te(wn));function gr(n){return ie(n,"type")}function Zs(n){const r=gr(n)?n.type:n;return Qs.has(r)}const MC=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit"],Js=["fill","fillOpacity"],Wr=[...MC,...Js],If=te({color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBandSize:1,timeUnitBandPosition:1}),Cl=["binSpacing","continuousBandSize","discreteBandSize","minBandSize"],My={area:["line","point"],bar:Cl,rect:Cl,line:["point"],tick:["bandSize","thickness",...Cl]},BC={color:"#4c78a8",invalid:"break-paths-show-path-domains",timeUnitBandSize:1},mi=te({mark:1,arc:1,area:1,bar:1,circle:1,image:1,line:1,point:1,rect:1,rule:1,square:1,text:1,tick:1,trail:1,geoshape:1});function ea(n){return ie(n,"band")}const Sl={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]},Pf={binSpacing:0,continuousBandSize:5,minBandSize:.25,timeUnitBandPosition:.5},By={...Pf,binSpacing:1},Ly={...Pf,thickness:1};function cp(n){return gr(n)?n.type:n}function zy(n,{isPath:r}){return n===void 0||n==="break-paths-show-path-domains"?r?"break-paths-show-domains":"filter":n===null?"show":n}function Vr({markDef:n,config:r,scaleChannel:s,scaleType:u,isCountAggregate:c}){if(!u||!gi(u)||c)return"always-valid";const d=zy(ct("invalid",n,r),{isPath:es(n.type)});return r.scale?.invalid?.[s]!==void 0?"show":d}function zC(n){return n==="break-paths-filter-domains"||n==="break-paths-show-domains"}function Iy({scaleName:n,scale:r,mode:s}){const u=`domain('${n}')`;if(!r||!n)return;const c=`${u}[0]`,d=`peek(${u})`,p=r.domainHasZero();return p==="definitely"?{scale:n,value:0}:p==="maybe"?{signal:`scale('${n}', inrange(0, ${u}) ? 0 : ${s==="zeroOrMin"?c:d})`}:{signal:`scale('${n}', ${s==="zeroOrMin"?c:d})`}}function Py({scaleChannel:n,channelDef:r,scale:s,scaleName:u,markDef:c,config:d}){const p=s?.get("type"),y=Li(r),E=cf(y?.aggregate),A=Vr({scaleChannel:n,markDef:c,config:d,scaleType:p,isCountAggregate:E});if(y&&A==="show"){const F=d.scale.invalid?.[n]??"zero-or-min";return{test:ml(le(y,{expr:"datum"}),!1),...IC(F,s,u)}}}function IC(n,r,s){if(_C(n)){const{value:u}=n;return xe(u)?{signal:u.signal}:{value:u}}return Iy({scale:r,scaleName:s,mode:"zeroOrMin"})}function pr(n){const{channel:r,channelDef:s,markDef:u,scale:c,scaleName:d,config:p}=n,y=sr(r),E=ta(n),A=Py({scaleChannel:y,channelDef:s,scale:c,scaleName:d,markDef:u,config:p});return A!==void 0?[A,E]:E}function Uf(n){const{datum:r}=n;return fr(r)?Vs(r):`${Se(r)}`}function ts(n,r,s,u){const c={};if(r&&(c.scale=r),yi(n)){const{datum:d}=n;fr(d)?c.signal=Vs(d):xe(d)?c.signal=d.signal:al(d)?c.signal=d.expr:c.value=d}else c.field=le(n,s);if(u){const{offset:d,band:p}=u;d&&(c.offset=d),p&&(c.band=p)}return c}function Fl({scaleName:n,fieldOrDatumDef:r,fieldOrDatumDef2:s,offset:u,startSuffix:c,endSuffix:d="end",bandPosition:p=.5}){const y=!xe(p)&&0<p&&p<1?"datum":void 0,E=le(r,{expr:y,suffix:c}),A=s!==void 0?le(s,{expr:y}):le(r,{suffix:d,expr:y}),F={};if(p===0||p===1){F.scale=n;const $=p===0?E:A;F.field=$}else{const $=xe(p)?`(1-${p.signal}) * ${E} + ${p.signal} * ${A}`:`${1-p} * ${E} + ${p} * ${A}`;F.signal=`scale("${n}", ${$})`}return u&&(F.offset=u),F}function wl({scaleName:n,fieldDef:r}){const s=le(r,{expr:"datum"}),u=le(r,{expr:"datum",suffix:"end"});return`abs(scale("${n}", ${u}) - scale("${n}", ${s}))`}function ta({channel:n,channelDef:r,channel2Def:s,markDef:u,config:c,scaleName:d,scale:p,stack:y,offset:E,defaultRef:A,bandPosition:F}){if(r){if(Me(r)){const $=p?.get("type");if(Mt(r)){F??(F=ns({fieldDef:r,fieldDef2:s,markDef:u,config:c}));const{bin:_,timeUnit:L,type:T}=r;if(nt(_)||F&&L&&T===hr)return y?.impute?ts(r,d,{binSuffix:"mid"},{offset:E}):F&&!tn($)?Fl({scaleName:d,fieldOrDatumDef:r,bandPosition:F,offset:E}):ts(r,d,as(r,n)?{binSuffix:"range"}:{},{offset:E});if(mn(_)){if(ae(s))return Fl({scaleName:d,fieldOrDatumDef:r,fieldOrDatumDef2:s,bandPosition:F,offset:E});oe(hy(n===wt?Qn:fi))}}return ts(r,d,tn($)?{binSuffix:"range"}:{},{offset:E,band:$==="band"?F??r.bandPosition??.5:void 0})}else if(vr(r)){const $=r.value,_=E?{offset:E}:{};return{...mo(n,$),..._}}}return Ts(A)&&(A=A()),A&&{...A,...E?{offset:E}:{}}}function mo(n,r){return Ue(["x","x2"],n)&&r==="width"?{field:{group:"width"}}:Ue(["y","y2"],n)&&r==="height"?{field:{group:"height"}}:Et(r)}function na(n){return n&&n!=="number"&&n!=="time"}function Uy(n,r,s){return`${n}(${r}${s?`, ${Se(s)}`:""})`}const PC=" \u2013 ";function fp({fieldOrDatumDef:n,format:r,formatType:s,expr:u,normalizeStack:c,config:d}){if(na(s))return mr({fieldOrDatumDef:n,format:r,formatType:s,expr:u,config:d});const p=jy(n,u,c),y=Dt(n);if(r===void 0&&s===void 0&&d.customFormatTypes){if(y==="quantitative"){if(c&&d.normalizedNumberFormatType)return mr({fieldOrDatumDef:n,format:d.normalizedNumberFormat,formatType:d.normalizedNumberFormatType,expr:u,config:d});if(d.numberFormatType)return mr({fieldOrDatumDef:n,format:d.numberFormat,formatType:d.numberFormatType,expr:u,config:d})}if(y==="temporal"&&d.timeFormatType&&ae(n)&&n.timeUnit===void 0)return mr({fieldOrDatumDef:n,format:d.timeFormat,formatType:d.timeFormatType,expr:u,config:d})}if(Dn(n)){const E=jC({field:p,timeUnit:ae(n)?qt(n.timeUnit)?.unit:void 0,format:r,formatType:d.timeFormatType,rawTimeFormat:d.timeFormat,isUTCScale:ra(n)&&n.scale?.type===ln.UTC});return E?{signal:E}:void 0}if(r=dp({type:y,specifiedFormat:r,config:d,normalizeStack:c}),ae(n)&&nt(n.bin)){const E=le(n,{expr:u,binSuffix:"end"});return{signal:Dl(p,E,r,s,d)}}else return r||Dt(n)==="quantitative"?{signal:`${Vy(p,r)}`}:{signal:`isValid(${p}) ? ${p} : ""+${p}`}}function jy(n,r,s){return ae(n)?s?`${le(n,{expr:r,suffix:"end"})}-${le(n,{expr:r,suffix:"start"})}`:le(n,{expr:r}):Uf(n)}function mr({fieldOrDatumDef:n,format:r,formatType:s,expr:u,normalizeStack:c,config:d,field:p}){if(p??(p=jy(n,u,c)),p!=="datum.value"&&ae(n)&&nt(n.bin)){const y=le(n,{expr:u,binSuffix:"end"});return{signal:Dl(p,y,r,s,d)}}return{signal:Uy(s,p,r)}}function Gy(n,r,s,u,c,d){if(!(U(u)&&na(u))&&!(s===void 0&&u===void 0&&c.customFormatTypes&&Dt(n)==="quantitative"&&(c.normalizedNumberFormatType&&vo(n)&&n.stack==="normalize"||c.numberFormatType))){if(vo(n)&&n.stack==="normalize"&&c.normalizedNumberFormat)return dp({type:"quantitative",config:c,normalizeStack:!0});if(Dn(n)){const p=ae(n)?qt(n.timeUnit)?.unit:void 0;return p===void 0&&c.customFormatTypes&&c.timeFormatType?void 0:UC({specifiedFormat:s,timeUnit:p,config:c,omitTimeFormatConfig:d})}return dp({type:r,specifiedFormat:s,config:c})}}function Wy(n,r,s){if(n&&(xe(n)||n==="number"||n==="time"))return n;if(Dn(r)&&s!=="time"&&s!=="utc")return ae(r)&&qt(r?.timeUnit)?.utc?"utc":"time"}function dp({type:n,specifiedFormat:r,config:s,normalizeStack:u}){if(U(r))return r;if(n===hi)return u?s.normalizedNumberFormat:s.numberFormat}function UC({specifiedFormat:n,timeUnit:r,config:s,omitTimeFormatConfig:u}){return n||(r?{signal:fl(r)}:u?void 0:s.timeFormat)}function Vy(n,r){return`format(${n}, "${r||""}")`}function Hy(n,r,s,u){return na(s)?Uy(s,n,r):Vy(n,(U(r)?r:void 0)??u.numberFormat)}function Dl(n,r,s,u,c){if(s===void 0&&u===void 0&&c.customFormatTypes&&c.numberFormatType)return Dl(n,r,c.numberFormat,c.numberFormatType,c);const d=Hy(n,s,u,c),p=Hy(r,s,u,c);return`${ml(n,!1)} ? "null" : ${d} + "${PC}" + ${p}`}function jC({field:n,timeUnit:r,format:s,formatType:u,rawTimeFormat:c,isUTCScale:d}){return!r||s?!r&&u?`${u}(${n}, '${s}')`:(s=U(s)?s:c,`${d?"utc":"time"}Format(${n}, '${s}')`):$f(r,n,d)}const jf="min",GC={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function kl(n){return tt(GC,n)}function WC(n){return ie(n,"encoding")}function yo(n){return n&&(n.op==="count"||ie(n,"field"))}function qy(n){return n&&pe(n)}function $l(n){return ie(n,"row")||ie(n,"column")}function hp(n){return ie(n,"header")}function Gf(n){return ie(n,"facet")}function VC(n){return ie(n,"param")}function HC(n){return!U(n)&&ie(n,"repeat")}function Wf(n){const{field:r,timeUnit:s,bin:u,aggregate:c}=n;return{...s?{timeUnit:s}:{},...u?{bin:u}:{},...c?{aggregate:c}:{},field:r}}function gp(n){return ie(n,"sort")}function ns({fieldDef:n,fieldDef2:r,markDef:s,config:u}){if(Me(n)&&n.bandPosition!==void 0)return n.bandPosition;if(ae(n)){const{timeUnit:c,bin:d}=n;if(c&&!r)return Pr("timeUnitBandPosition",s,u);if(nt(d))return .5}}function Xy({channel:n,fieldDef:r,fieldDef2:s,markDef:u,config:c,scaleType:d,useVlSizeChannel:p}){const y=Ln(n),E=ct(p?"size":y,u,c,{vgChannel:y});if(E!==void 0)return E;if(ae(r)){const{timeUnit:A,bin:F}=r;if(A&&!s)return{band:Pr("timeUnitBandSize",u,c)};if(nt(F)&&!tn(d))return{band:1}}if(El(u.type))return d?tn(d)?c[u.type]?.discreteBandSize||{band:1}:c[u.type]?.continuousBandSize:c[u.type]?.discreteBandSize}function ia(n,r,s,u){return nt(n.bin)||n.timeUnit&&Mt(n)&&n.type==="temporal"?ns({fieldDef:n,fieldDef2:r,markDef:s,config:u})!==void 0:!1}function Yy(n){return ie(n,"sort")&&!ie(n,"field")}function Ol(n){return ie(n,"condition")}function Vf(n){const r=n?.condition;return!!r&&!pe(r)&&ae(r)}function Za(n){const r=n?.condition;return!!r&&!pe(r)&&Me(r)}function Ky(n){const r=n?.condition;return!!r&&(pe(r)||vr(r))}function ae(n){return ie(n,"field")||n?.aggregate==="count"}function Dt(n){return n?.type}function yi(n){return ie(n,"datum")}function yr(n){return Mt(n)&&!Ja(n)||Tl(n)}function pp(n){return Mt(n)&&n.type==="quantitative"&&!n.bin||Tl(n)}function Tl(n){return yi(n)&&j(n.datum)}function Me(n){return ae(n)||yi(n)}function Mt(n){return n&&(ie(n,"field")||n.aggregate==="count")&&ie(n,"type")}function vr(n){return ie(n,"value")}function ra(n){return ie(n,"scale")||ie(n,"sort")}function vo(n){return ie(n,"axis")||ie(n,"stack")||ie(n,"impute")}function Rl(n){return ie(n,"legend")}function Nl(n){return ie(n,"format")||ie(n,"formatType")}function oa(n){return Yn(n,["legend","axis","header","scale"])}function mp(n){return ie(n,"op")}function le(n,r={}){let s=n.field;const u=r.prefix;let c=r.suffix,d="";if(is(n))s=Ku("count");else{let p;if(!r.nofn)if(mp(n))p=n.op;else{const{bin:y,aggregate:E,timeUnit:A}=n;nt(y)?(p=Va(y),c=(r.binSuffix??"")+(r.suffix??"")):E?Qo(E)?(d=`["${s}"]`,s=`argmax_${E.argmax}`):fo(E)?(d=`["${s}"]`,s=`argmin_${E.argmin}`):p=String(E):A&&!Mi(A)&&(p=Kg(A),c=(!["range","mid"].includes(r.binSuffix)&&r.binSuffix||"")+(r.suffix??""))}p&&(s=s?`${p}_${s}`:p)}return c&&(s=`${s}_${c}`),u&&(s=`${u}_${s}`),r.forAs?Wo(s):r.expr?Jc(s,r.expr)+d:ci(s)+d}function Ja(n){switch(n.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return ae(n)&&!!n.bin;case"temporal":return!1}throw new Error(ty(n.type))}function yp(n){return ra(n)&&Ka(n.scale?.type)}function is(n){return n.aggregate==="count"}function Hf(n,r){const{field:s,bin:u,timeUnit:c,aggregate:d}=n;if(d==="count")return r.countTitle;if(nt(u))return`${s} (binned)`;if(c&&!Mi(c)){const p=qt(c)?.unit;if(p)return`${s} (${jr(p).join("-")})`}else if(d)return Qo(d)?`${s} for max ${d.argmax}`:fo(d)?`${s} for min ${d.argmin}`:`${_s(d)} of ${s}`;return s}function Qy(n){const{aggregate:r,bin:s,timeUnit:u,field:c}=n;if(Qo(r))return`${c} for argmax(${r.argmax})`;if(fo(r))return`${c} for argmin(${r.argmin})`;const d=u&&!Mi(u)?qt(u):void 0,p=r||d?.unit||d?.maxbins&&"timeunit"||nt(s)&&"bin";return p?`${p.toUpperCase()}(${c})`:c}const vp=(n,r)=>{switch(r.fieldTitle){case"plain":return n.field;case"functional":return Qy(n);default:return Hf(n,r)}};let rs=vp;function os(n){rs=n}function bp(){os(vp)}function ss(n,r,{allowDisabling:s,includeDefault:u=!0}){const c=sa(n)?.title;if(!ae(n))return c??n.title;const d=n,p=u?xp(d,r):void 0;return s?It(c,d.title,p):c??d.title??p}function sa(n){if(vo(n)&&n.axis)return n.axis;if(Rl(n)&&n.legend)return n.legend;if(hp(n)&&n.header)return n.header}function xp(n,r){return rs(n,r)}function _l(n){if(Nl(n)){const{format:r,formatType:s}=n;return{format:r,formatType:s}}else{const r=sa(n)??{},{format:s,formatType:u}=r;return{format:s,formatType:u}}}function Zy(n,r){switch(r){case"latitude":case"longitude":return"quantitative";case"row":case"column":case"facet":case"shape":case"strokeDash":return"nominal";case"order":return"ordinal"}if(gp(n)&&pe(n.sort))return"ordinal";const{aggregate:s,bin:u,timeUnit:c}=n;if(c)return"temporal";if(u||s&&!Qo(s)&&!fo(s))return"quantitative";if(ra(n)&&n.scale?.type)switch(Tf[n.scale.type]){case"numeric":case"discretizing":return"quantitative";case"time":return"temporal"}return"nominal"}function Li(n){if(ae(n))return n;if(Vf(n))return n.condition}function At(n){if(Me(n))return n;if(Za(n))return n.condition}function qf(n,r,s,u={}){if(U(n)||j(n)||Ji(n)){const c=U(n)?"string":j(n)?"number":"boolean";return oe(ey(r,c,n)),{value:n}}return Me(n)?eu(n,r,s,u):Za(n)?{...n,condition:eu(n.condition,r,s,u)}:n}function eu(n,r,s,u){if(Nl(n)){const{format:c,formatType:d,...p}=n;if(na(d)&&!s.customFormatTypes)return oe(Lg(r)),eu(p,r,s,u)}else{const c=vo(n)?"axis":Rl(n)?"legend":hp(n)?"header":null;if(c&&n[c]){const{format:d,formatType:p,...y}=n[c];if(na(p)&&!s.customFormatTypes)return oe(Lg(r)),eu({...n,[c]:y},r,s,u)}}return ae(n)?Xf(n,r,u):Ep(n)}function Ep(n){let r=n.type;if(r)return n;const{datum:s}=n;return r=j(s)?"quantitative":U(s)?"nominal":fr(s)?"temporal":void 0,{...n,type:r}}function Xf(n,r,{compositeMark:s=!1}={}){const{aggregate:u,timeUnit:c,bin:d,field:p}=n,y={...n};if(!s&&u&&!xg(u)&&!Qo(u)&&!fo(u)&&(oe(PA(u)),delete y.aggregate),c&&(y.timeUnit=qt(c)),p&&(y.field=`${p}`),nt(d)&&(y.bin=Ml(d,r)),mn(d)&&!Tt(r)&&oe(gy(r)),Mt(y)){const{type:E}=y,A=Cy(E);E!==A&&(y.type=A),E!=="quantitative"&&cf(u)&&(oe(ny(E,u)),y.type="quantitative")}else if(!js(r)){const E=Zy(y,r);y.type=E}if(Mt(y)){const{compatible:E,warning:A}=tu(y,r)||{};E===!1&&oe(A)}if(gp(y)&&U(y.sort)){const{sort:E}=y;if(kl(E))return{...y,sort:{encoding:E}};const A=E.substring(1);if(E.charAt(0)==="-"&&kl(A))return{...y,sort:{encoding:A,order:"descending"}}}if(hp(y)){const{header:E}=y;if(E){const{orient:A,...F}=E;if(A)return{...y,header:{...F,labelOrient:E.labelOrient||A,titleOrient:E.titleOrient||A}}}}return y}function Ml(n,r){return Ji(n)?{maxbins:ff(r)}:n==="binned"?{binned:!0}:!n.maxbins&&!n.step?{...n,maxbins:ff(r)}:n}const br={compatible:!0};function tu(n,r){const s=n.type;if(s==="geojson"&&r!=="shape")return{compatible:!1,warning:`Channel ${r} should not be used with a geojson data.`};switch(r){case Oi:case Br:case Lr:return Ja(n)?br:{compatible:!1,warning:ry(r)};case wt:case Ot:case Vo:case Ia:case Gt:case zr:case Ir:case Zu:case Ju:case zs:case Sn:case or:case _i:case Ls:case Ti:case tr:case tf:return br;case nr:case Ni:case Ri:case ir:return s!==hi?{compatible:!1,warning:`Channel ${r} should be used with a quantitative field only, not ${n.type} field.`}:br;case co:case Ho:case qo:case Xo:case lo:case Ke:case uo:case Qn:case fi:case rr:return s==="nominal"&&!n.sort?{compatible:!1,warning:`Channel ${r} should not be used with an unsorted discrete field.`}:br;case Zn:case Yo:return!Ja(n)&&!yp(n)?{compatible:!1,warning:Ug(r)}:br;case Pa:return n.type==="nominal"&&!("sort"in n)?{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}:br}}function Dn(n){const{formatType:r}=_l(n);return r==="time"||!r&&Jy(n)}function Jy(n){return n&&(n.type==="temporal"||ae(n)&&!!n.timeUnit)}function Yf(n,{timeUnit:r,type:s,wrapTime:u,undefinedIfExprNotRequired:c}){const d=r&&qt(r)?.unit;let p=d||s==="temporal",y;return al(n)?y=n.expr:xe(n)?y=n.signal:fr(n)?(p=!0,y=Vs(n)):(U(n)||j(n))&&p&&(y=`datetime(${Se(n)})`,vC(d)&&(j(n)&&n<1e4||U(n)&&isNaN(Date.parse(n)))&&(y=Vs({[d]:n}))),y?u&&p?`time(${y})`:y:c?void 0:Se(n)}function Ap(n,r){const{type:s}=n;return r.map(u=>{const c=ae(n)&&!Mi(n.timeUnit)?n.timeUnit:void 0,d=Yf(u,{timeUnit:c,type:s,undefinedIfExprNotRequired:!0});return d!==void 0?{signal:d}:u})}function as(n,r){return nt(n.bin)?lr(r)&&["ordinal","nominal"].includes(n.type):(console.warn("Only call this method for binned field defs."),!1)}const ev={labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDashOffset"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDashOffset"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"}};function Hr(n){return n?.condition}const tv=["domain","grid","labels","ticks","title"],Cp={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"both",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},zi={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},Bl={...zi,style:1,labelExpr:1,encoding:1};function Kf(n){return tt(Bl,n)}const t3=te(Bl),Ll=te({axis:1,axisBand:1,axisBottom:1,axisDiscrete:1,axisLeft:1,axisPoint:1,axisQuantitative:1,axisRight:1,axisTemporal:1,axisTop:1,axisX:1,axisXBand:1,axisXDiscrete:1,axisXPoint:1,axisXQuantitative:1,axisXTemporal:1,axisY:1,axisYBand:1,axisYDiscrete:1,axisYPoint:1,axisYQuantitative:1,axisYTemporal:1});function vi(n){return ie(n,"mark")}class nu{constructor(r,s){this.name=r,this.run=s}hasMatchingType(r){return vi(r)?cp(r.mark)===this.name:!1}}function bi(n,r){const s=n&&n[r];return s?pe(s)?La(s,u=>!!u.field):ae(s)||Vf(s):!1}function Qf(n,r){const s=n&&n[r];return s?pe(s)?La(s,u=>!!u.field):ae(s)||yi(s)||Za(s):!1}function nv(n,r){if(Tt(r)){const s=n[r];if((ae(s)||yi(s))&&(np(s.type)||ae(s)&&s.timeUnit)){const u=nf(r);return Qf(n,u)}}return!1}function Sp(n){return La(cA,r=>{if(bi(n,r)){const s=n[r];if(pe(s))return La(s,u=>!!u.aggregate);{const u=Li(s);return u&&!!u.aggregate}}return!1})}function iv(n,r){const s=[],u=[],c=[],d=[],p={};return wp(n,(y,E)=>{if(ae(y)){const{field:A,aggregate:F,bin:$,timeUnit:_,...L}=y;if(F||_||$){const B=sa(y)?.title;let G=le(y,{forAs:!0});const H={...B?[]:{title:ss(y,r,{allowDisabling:!0})},...L,field:G};if(F){let Z;if(Qo(F)?(Z="argmax",G=le({op:"argmax",field:F.argmax},{forAs:!0}),H.field=`${G}.${A}`):fo(F)?(Z="argmin",G=le({op:"argmin",field:F.argmin},{forAs:!0}),H.field=`${G}.${A}`):F!=="boxplot"&&F!=="errorbar"&&F!=="errorband"&&(Z=F),Z){const ve={op:Z,as:G};A&&(ve.field=A),d.push(ve)}}else if(s.push(G),Mt(y)&&nt($)){if(u.push({bin:$,field:A,as:G}),s.push(le(y,{binSuffix:"end"})),as(y,E)&&s.push(le(y,{binSuffix:"range"})),Tt(E)){const Z={field:`${G}_end`};p[`${E}2`]=Z}H.bin="binned",js(E)||(H.type=hi)}else if(_&&!Mi(_)){c.push({timeUnit:_,field:A,as:G});const Z=Mt(y)&&y.type!==hr&&"time";Z&&(E===Zu||E===Sn?H.formatType=Z:Wa(E)?H.legend={formatType:Z,...H.legend}:Tt(E)&&(H.axis={formatType:Z,...H.axis}))}p[E]=H}else s.push(A),p[E]=n[E]}else p[E]=n[E]}),{bins:u,timeUnits:c,aggregate:d,groupby:s,encoding:p}}function XC(n,r,s){const u=vg(r,s);if(u){if(u==="binned"){const c=n[r===Qn?wt:Ot];return!!(ae(c)&&ae(n[r])&&mn(c.bin))}}else return!1;return!0}function Fp(n,r,s,u){const c={};for(const d of te(n))dg(d)||oe(WA(d));for(let d of gA){if(!n[d])continue;const p=n[d];if(Gs(d)){const y=gg(d),E=c[y];if(ae(E)&&it(E.type)&&ae(p)&&!E.timeUnit){oe(Ig(y));continue}}if(d==="angle"&&r==="arc"&&!n.theta&&(oe(zg),d=Ti),!XC(n,d,r)){oe(ll(d,r));continue}if(d===lo&&r==="line"&&Li(n[d])?.aggregate){oe(GA);continue}if(d===Gt&&(s?"fill"in n:"stroke"in n)){oe(Af("encoding",{fill:"fill"in n,stroke:"stroke"in n}));continue}if(d===Ju||d===Pa&&!pe(p)&&!vr(p)||d===Sn&&pe(p)){if(p){if(d===Pa){const y=n[d];if(Yy(y)){c[d]=y;continue}}c[d]=vt(p).reduce((y,E)=>(ae(E)?y.push(Xf(E,d)):oe(Pg(E,d)),y),[])}}else{if(d===Sn&&p===null)c[d]=null;else if(!ae(p)&&!yi(p)&&!vr(p)&&!Ol(p)&&!xe(p)){oe(Pg(p,d));continue}c[d]=qf(p,d,u)}}return c}function Zf(n,r){const s={};for(const u of te(n)){const c=qf(n[u],u,r,{compositeMark:!0});s[u]=c}return s}function YC(n){const r=[];for(const s of te(n))if(bi(n,s)){const u=n[s],c=vt(u);for(const d of c)ae(d)?r.push(d):Vf(d)&&r.push(d.condition)}return r}function wp(n,r,s){if(n)for(const u of te(n)){const c=n[u];if(pe(c))for(const d of c)r.call(s,d,u);else r.call(s,c,u)}}function KC(n,r,s,u){return n?te(n).reduce((c,d)=>{const p=n[d];return pe(p)?p.reduce((y,E)=>r.call(u,y,E,d),c):r.call(u,c,p,d)},s):s}function Jf(n,r){return te(r).reduce((s,u)=>{switch(u){case wt:case Ot:case or:case tf:case _i:case Qn:case fi:case Vo:case Ia:case Ti:case Ke:case tr:case uo:case rr:case Ri:case nr:case ir:case Ni:case Zu:case Zn:case Ls:case Sn:return s;case Pa:if(n==="line"||n==="trail")return s;case Ju:case zs:{const c=r[u];if(pe(c)||ae(c))for(const d of vt(c))d.aggregate||s.push(le(d,{}));return s}case lo:if(n==="trail")return s;case Gt:case zr:case Ir:case co:case Ho:case qo:case Yo:case Xo:{const c=Li(r[u]);return c&&!c.aggregate&&s.push(le(c,{})),s}}},[])}function QC(n){const{tooltip:r,...s}=n;if(!r)return{filteredEncoding:s};let u,c;if(pe(r)){for(const d of r)d.aggregate?(u||(u=[]),u.push(d)):(c||(c=[]),c.push(d));u&&(s.tooltip=u)}else r.aggregate?s.tooltip=r:c=r;return pe(c)&&c.length===1&&(c=c[0]),{customTooltipWithoutAggregatedField:c,filteredEncoding:s}}function Dp(n,r,s,u=!0){if("tooltip"in s)return{tooltip:s.tooltip};const c=n.map(({fieldPrefix:p,titlePrefix:y})=>{const E=u?` of ${ed(r)}`:"";return{field:p+r.field,type:r.type,title:xe(y)?{signal:`${y}"${escape(E)}"`}:y+E}}),d=YC(s).map(oa);return{tooltip:[...c,..._r(d,He)]}}function ed(n){const{title:r,field:s}=n;return It(r,s)}function td(n,r,s,u,c){const{scale:d,axis:p}=s;return({partName:y,mark:E,positionPrefix:A,endPositionPrefix:F=void 0,extraEncoding:$={}})=>{const _=ed(s);return rv(n,y,c,{mark:E,encoding:{[r]:{field:`${A}_${s.field}`,type:s.type,..._!==void 0?{title:_}:{},...d!==void 0?{scale:d}:{},...p!==void 0?{axis:p}:{}},...U(F)?{[`${r}2`]:{field:`${F}_${s.field}`}}:{},...u,...$}})}}function rv(n,r,s,u){const{clip:c,color:d,opacity:p}=n,y=n.type;return n[r]||n[r]===void 0&&s[r]?[{...u,mark:{...s[r],...c?{clip:c}:{},...d?{color:d}:{},...p?{opacity:p}:{},...gr(u.mark)?u.mark:{type:u.mark},style:`${y}-${String(r)}`,...Ji(n[r])?{}:n[r]}}]:[]}function kp(n,r,s){const{encoding:u}=n,c=r==="vertical"?"y":"x",d=u[c],p=u[`${c}2`],y=u[`${c}Error`],E=u[`${c}Error2`];return{continuousAxisChannelDef:nd(d,s),continuousAxisChannelDef2:nd(p,s),continuousAxisChannelDefError:nd(y,s),continuousAxisChannelDefError2:nd(E,s),continuousAxis:c}}function nd(n,r){if(n?.aggregate){const{aggregate:s,...u}=n;return s!==r&&oe(aC(s,r)),u}else return n}function ov(n,r){const{mark:s,encoding:u}=n,{x:c,y:d}=u;if(gr(s)&&s.orient)return s.orient;if(yr(c)){if(yr(d)){const p=ae(c)&&c.aggregate,y=ae(d)&&d.aggregate;if(!p&&y===r)return"vertical";if(!y&&p===r)return"horizontal";if(p===r&&y===r)throw new Error("Both x and y cannot have aggregate");return Dn(d)&&!Dn(c)?"horizontal":"vertical"}return"horizontal"}else{if(yr(d))return"vertical";throw new Error(`Need a valid continuous axis for ${r}s`)}}const id="boxplot",ZC=["box","median","outliers","rule","ticks"],zl=new nu(id,av);function sv(n){return j(n)?"tukey":n}function av(n,{config:r}){n={...n,encoding:Zf(n.encoding,r)};const{mark:s,encoding:u,params:c,projection:d,...p}=n,y=gr(s)?s:{type:s};c&&oe(Q1("boxplot"));const E=y.extent??r.boxplot.extent,A=ct("size",y,r),F=y.invalid,$=sv(E),{bins:_,timeUnits:L,transform:T,continuousAxisChannelDef:B,continuousAxis:G,groupby:H,aggregate:Z,encodingWithoutContinuousAxis:ve,ticksOrient:De,boxOrient:be,customTooltipWithoutAggregatedField:$e}=JC(n,E,r),Re=Wo(B.field),{color:me,size:Ut,...dn}=ve,wi=XE=>td(y,G,B,XE,r.boxplot),Qt=wi(dn),ye=wi(ve),he=(We(r.boxplot.box)?r.boxplot.box.color:r.mark.color)||"#4c78a8",Te=wi({...dn,...Ut?{size:Ut}:{},color:{condition:{test:`${ht(`lower_box_${B.field}`)} >= ${ht(`upper_box_${B.field}`)}`,...me||{value:he}}}}),Oe=Dp([{fieldPrefix:$==="min-max"?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:$==="min-max"?"lower_whisker_":"min_",titlePrefix:"Min"}],B,ve),Ne={type:"tick",color:"black",opacity:1,orient:De,invalid:F,aria:!1},Fe=$==="min-max"?Oe:Dp([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],B,ve),Ie=[...Qt({partName:"rule",mark:{type:"rule",invalid:F,aria:!1},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",extraEncoding:Fe}),...Qt({partName:"rule",mark:{type:"rule",invalid:F,aria:!1},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",extraEncoding:Fe}),...Qt({partName:"ticks",mark:Ne,positionPrefix:"lower_whisker",extraEncoding:Fe}),...Qt({partName:"ticks",mark:Ne,positionPrefix:"upper_whisker",extraEncoding:Fe})],at=[...$!=="tukey"?Ie:[],...ye({partName:"box",mark:{type:"bar",...A?{size:A}:{},orient:be,invalid:F,ariaRoleDescription:"box"},positionPrefix:"lower_box",endPositionPrefix:"upper_box",extraEncoding:Oe}),...Te({partName:"median",mark:{type:"tick",invalid:F,...We(r.boxplot.median)&&r.boxplot.median.color?{color:r.boxplot.median.color}:{},...A?{size:A}:{},orient:De,aria:!1},positionPrefix:"mid_box",extraEncoding:Oe})];if($==="min-max")return{...p,transform:(p.transform??[]).concat(T),layer:at};const je=ht(`lower_box_${B.field}`),St=ht(`upper_box_${B.field}`),Rn=`(${St} - ${je})`,Lt=`${je} - ${E} * ${Rn}`,Cs=`${St} + ${E} * ${Rn}`,Bh=ht(B.field),WE={joinaggregate:uv(B.field),groupby:H},VE={transform:[{filter:`(${Lt} <= ${Bh}) && (${Bh} <= ${Cs})`},{aggregate:[{op:"min",field:B.field,as:`lower_whisker_${Re}`},{op:"max",field:B.field,as:`upper_whisker_${Re}`},{op:"min",field:`lower_box_${B.field}`,as:`lower_box_${Re}`},{op:"max",field:`upper_box_${B.field}`,as:`upper_box_${Re}`},...Z],groupby:H}],layer:Ie},{tooltip:S3,...lk}=dn,{scale:f1,axis:ck}=B,Ss=ed(B),HE=Yn(ck,["title"]),d1=rv(y,"outliers",r.boxplot,{transform:[{filter:`(${Bh} < ${Lt}) || (${Bh} > ${Cs})`}],mark:"point",encoding:{[G]:{field:B.field,type:B.type,...Ss!==void 0?{title:Ss}:{},...f1!==void 0?{scale:f1}:{},...dt(HE)?{}:{axis:HE}},...lk,...me?{color:me}:{},...$e?{tooltip:$e}:{}}})[0];let Lh;const qE=[..._,...L,WE];return d1?Lh={transform:qE,layer:[d1,VE]}:(Lh=VE,Lh.transform.unshift(...qE)),{...p,layer:[Lh,{transform:T,layer:at}]}}function uv(n){const r=Wo(n);return[{op:"q1",field:n,as:`lower_box_${r}`},{op:"q3",field:n,as:`upper_box_${r}`}]}function JC(n,r,s){const u=ov(n,id),{continuousAxisChannelDef:c,continuousAxis:d}=kp(n,u,id),p=c.field,y=Wo(p),E=sv(r),A=[...uv(p),{op:"median",field:p,as:`mid_box_${y}`},{op:"min",field:p,as:(E==="min-max"?"lower_whisker_":"min_")+y},{op:"max",field:p,as:(E==="min-max"?"upper_whisker_":"max_")+y}],F=E==="min-max"||E==="tukey"?[]:[{calculate:`${ht(`upper_box_${y}`)} - ${ht(`lower_box_${y}`)}`,as:`iqr_${y}`},{calculate:`min(${ht(`upper_box_${y}`)} + ${ht(`iqr_${y}`)} * ${r}, ${ht(`max_${y}`)})`,as:`upper_whisker_${y}`},{calculate:`max(${ht(`lower_box_${y}`)} - ${ht(`iqr_${y}`)} * ${r}, ${ht(`min_${y}`)})`,as:`lower_whisker_${y}`}],{[d]:$,..._}=n.encoding,{customTooltipWithoutAggregatedField:L,filteredEncoding:T}=QC(_),{bins:B,timeUnits:G,aggregate:H,groupby:Z,encoding:ve}=iv(T,s),De=u==="vertical"?"horizontal":"vertical",be=u,$e=[...B,...G,{aggregate:[...H,...A],groupby:Z},...F];return{bins:B,timeUnits:G,transform:$e,groupby:Z,aggregate:H,continuousAxisChannelDef:c,continuousAxis:d,encodingWithoutContinuousAxis:ve,ticksOrient:De,boxOrient:be,customTooltipWithoutAggregatedField:L}}const $p="errorbar",eS=["ticks","rule"],tS=new nu($p,iu);function iu(n,{config:r}){n={...n,encoding:Zf(n.encoding,r)};const{transform:s,continuousAxisChannelDef:u,continuousAxis:c,encodingWithoutContinuousAxis:d,ticksOrient:p,markDef:y,outerSpec:E,tooltipEncoding:A}=Il(n,$p,r);delete d.size;const F=td(y,c,u,d,r.errorbar),$=y.thickness,_=y.size,L={type:"tick",orient:p,aria:!1,...$!==void 0?{thickness:$}:{},..._!==void 0?{size:_}:{}},T=[...F({partName:"ticks",mark:L,positionPrefix:"lower",extraEncoding:A}),...F({partName:"ticks",mark:L,positionPrefix:"upper",extraEncoding:A}),...F({partName:"rule",mark:{type:"rule",ariaRoleDescription:"errorbar",...$!==void 0?{size:$}:{}},positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:A})];return{...E,transform:s,...T.length>1?{layer:T}:{...T[0]}}}function Op(n,r){const{encoding:s}=n;if(Tp(s))return{orient:ov(n,r),inputType:"raw"};const u=Rp(s),c=rd(s),d=s.x,p=s.y;if(u){if(c)throw new Error(`${r} cannot be both type aggregated-upper-lower and aggregated-error`);const y=s.x2,E=s.y2;if(Me(y)&&Me(E))throw new Error(`${r} cannot have both x2 and y2`);if(Me(y)){if(yr(d))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error(`Both x and x2 have to be quantitative in ${r}`)}else if(Me(E)){if(yr(p))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error(`Both y and y2 have to be quantitative in ${r}`)}throw new Error("No ranged axis")}else{const y=s.xError,E=s.xError2,A=s.yError,F=s.yError2;if(Me(E)&&!Me(y))throw new Error(`${r} cannot have xError2 without xError`);if(Me(F)&&!Me(A))throw new Error(`${r} cannot have yError2 without yError`);if(Me(y)&&Me(A))throw new Error(`${r} cannot have both xError and yError with both are quantiative`);if(Me(y)){if(yr(d))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}else if(Me(A)){if(yr(p))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}function Tp(n){return(Me(n.x)||Me(n.y))&&!Me(n.x2)&&!Me(n.y2)&&!Me(n.xError)&&!Me(n.xError2)&&!Me(n.yError)&&!Me(n.yError2)}function Rp(n){return Me(n.x2)||Me(n.y2)}function rd(n){return Me(n.xError)||Me(n.xError2)||Me(n.yError)||Me(n.yError2)}function Il(n,r,s){const{mark:u,encoding:c,params:d,projection:p,...y}=n,E=gr(u)?u:{type:u};d&&oe(Q1(r));const{orient:A,inputType:F}=Op(n,r),{continuousAxisChannelDef:$,continuousAxisChannelDef2:_,continuousAxisChannelDefError:L,continuousAxisChannelDefError2:T,continuousAxis:B}=kp(n,A,r),{errorBarSpecificAggregate:G,postAggregateCalculates:H,tooltipSummary:Z,tooltipTitleWithFieldName:ve}=nS(E,$,_,L,T,F,r,s),{[B]:De,[B==="x"?"x2":"y2"]:be,[B==="x"?"xError":"yError"]:$e,[B==="x"?"xError2":"yError2"]:Re,...me}=c,{bins:Ut,timeUnits:dn,aggregate:wi,groupby:Qt,encoding:ye}=iv(me,s),he=[...wi,...G],Te=F!=="raw"?[]:Qt,Oe=Dp(Z,$,ye,ve);return{transform:[...y.transform??[],...Ut,...dn,...he.length===0?[]:[{aggregate:he,groupby:Te}],...H],groupby:Te,continuousAxisChannelDef:$,continuousAxis:B,encodingWithoutContinuousAxis:ye,ticksOrient:A==="vertical"?"horizontal":"vertical",markDef:E,outerSpec:y,tooltipEncoding:Oe}}function nS(n,r,s,u,c,d,p,y){let E=[],A=[];const F=r.field;let $,_=!1;if(d==="raw"){const L=n.center?n.center:n.extent?n.extent==="iqr"?"median":"mean":y.errorbar.center,T=n.extent?n.extent:L==="mean"?"stderr":"iqr";if(L==="median"!=(T==="iqr")&&oe(dy(L,T,p)),T==="stderr"||T==="stdev")E=[{op:T,field:F,as:`extent_${F}`},{op:L,field:F,as:`center_${F}`}],A=[{calculate:`${ht(`center_${F}`)} + ${ht(`extent_${F}`)}`,as:`upper_${F}`},{calculate:`${ht(`center_${F}`)} - ${ht(`extent_${F}`)}`,as:`lower_${F}`}],$=[{fieldPrefix:"center_",titlePrefix:_s(L)},{fieldPrefix:"upper_",titlePrefix:lv(L,T,"+")},{fieldPrefix:"lower_",titlePrefix:lv(L,T,"-")}],_=!0;else{let B,G,H;T==="ci"?(B="mean",G="ci0",H="ci1"):(B="median",G="q1",H="q3"),E=[{op:G,field:F,as:`lower_${F}`},{op:H,field:F,as:`upper_${F}`},{op:B,field:F,as:`center_${F}`}],$=[{fieldPrefix:"upper_",titlePrefix:ss({field:F,aggregate:H,type:"quantitative"},y,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:ss({field:F,aggregate:G,type:"quantitative"},y,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:ss({field:F,aggregate:B,type:"quantitative"},y,{allowDisabling:!1})}]}}else{(n.center||n.extent)&&oe(sC(n.center,n.extent)),d==="aggregated-upper-lower"?($=[],A=[{calculate:ht(s.field),as:`upper_${F}`},{calculate:ht(F),as:`lower_${F}`}]):d==="aggregated-error"&&($=[{fieldPrefix:"",titlePrefix:F}],A=[{calculate:`${ht(F)} + ${ht(u.field)}`,as:`upper_${F}`}],c?A.push({calculate:`${ht(F)} + ${ht(c.field)}`,as:`lower_${F}`}):A.push({calculate:`${ht(F)} - ${ht(u.field)}`,as:`lower_${F}`}));for(const L of A)$.push({fieldPrefix:L.as.substring(0,6),titlePrefix:Mr(Mr(L.calculate,"datum['",""),"']","")})}return{postAggregateCalculates:A,errorBarSpecificAggregate:E,tooltipSummary:$,tooltipTitleWithFieldName:_}}function lv(n,r,s){return`${_s(n)} ${s} ${r}`}const Np="errorband",iS=["band","borders"],rS=new nu(Np,cv);function cv(n,{config:r}){n={...n,encoding:Zf(n.encoding,r)};const{transform:s,continuousAxisChannelDef:u,continuousAxis:c,encodingWithoutContinuousAxis:d,markDef:p,outerSpec:y,tooltipEncoding:E}=Il(n,Np,r),A=p,F=td(A,c,u,d,r.errorband),$=n.encoding.x!==void 0&&n.encoding.y!==void 0;let _={type:$?"area":"rect"},L={type:$?"line":"rule"};const T={...A.interpolate?{interpolate:A.interpolate}:{},...A.tension&&A.interpolate?{tension:A.tension}:{}};return $?(_={..._,...T,ariaRoleDescription:"errorband"},L={...L,...T,aria:!1}):A.interpolate?oe(wf("interpolate")):A.tension&&oe(wf("tension")),{...y,transform:s,layer:[...F({partName:"band",mark:_,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:E}),...F({partName:"borders",mark:L,positionPrefix:"lower",extraEncoding:E}),...F({partName:"borders",mark:L,positionPrefix:"upper",extraEncoding:E})]}}const ru={};function _p(n,r,s){const u=new nu(n,r);ru[n]={normalizer:u,parts:s}}function n3(n){delete ru[n]}function oS(){return te(ru)}_p(id,av,ZC),_p($p,iu,eS),_p(Np,cv,iS);const sS=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],Mp={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},fv={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},aS=te(Mp),uS=te(fv),dv=te({header:1,headerRow:1,headerColumn:1,headerFacet:1}),hv=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],cS={gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},gv={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1},i3=te(gv),Ii="_vgsid_",xi={point:{on:"click",fields:[Ii],toggle:"event.shiftKey",resolve:"global",clear:"dblclick"},interval:{on:"[pointerdown, window:pointerup] > window:pointermove!",encodings:["x","y"],translate:"[pointerdown, window:pointerup] > window:pointermove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function od(n){return n==="legend"||!!n?.legend}function ou(n){return od(n)&&We(n)}function sd(n){return!!n?.select}function ad(n){const r=[];for(const s of n||[]){if(sd(s))continue;const{expr:u,bind:c,...d}=s;if(c&&u){const p={...d,bind:c,init:u};r.push(p)}else{const p={...d,...u?{update:u}:{},...c?{bind:c}:{}};r.push(p)}}return r}function pv(n){return xr(n)||Bp(n)||Pi(n)}function Pi(n){return ie(n,"concat")}function xr(n){return ie(n,"vconcat")}function Bp(n){return ie(n,"hconcat")}function su({step:n,offsetIsDiscrete:r}){return r?n.for??"offset":"position"}function Ui(n){return ie(n,"step")}function bo(n){return ie(n,"view")||ie(n,"width")||ie(n,"height")}const mv=20,Pl=te({align:1,bounds:1,center:1,columns:1,spacing:1});function ud(n,r,s){const u=s[r],c={},{spacing:d,columns:p}=u;d!==void 0&&(c.spacing=d),p!==void 0&&(Gf(n)&&!$l(n.facet)||Pi(n))&&(c.columns=p),xr(n)&&(c.columns=1);for(const y of Pl)if(n[y]!==void 0)if(y==="spacing"){const E=n[y];c[y]=j(E)?E:{row:E.row??d,column:E.column??d}}else c[y]=n[y];return c}function Ul(n,r){return n[r]??n[r==="width"?"continuousWidth":"continuousHeight"]}function Lp(n,r){const s=us(n,r);return Ui(s)?s.step:jl}function us(n,r){const s=n[r]??n[r==="width"?"discreteWidth":"discreteHeight"];return It(s,{step:n.step})}const jl=20,fS={continuousWidth:200,continuousHeight:200,step:jl};function yv(n){return hasProperty(n,"scheme")}const dS={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:fS,mark:BC,arc:{},area:{},bar:By,circle:{},geoshape:{},image:{},line:{},point:{},rect:Pf,rule:{color:"black"},square:{},text:{color:"black"},tick:Ly,trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:SC,projection:{},legend:cS,header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:xi,style:{},title:{},facet:{spacing:mv},concat:{spacing:mv},normalizedNumberFormat:".0%"},xo=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],vv={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},bv={blue:xo[0],orange:xo[1],red:xo[2],teal:xo[3],green:xo[4],yellow:xo[5],purple:xo[6],pink:xo[7],brown:xo[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function hS(n={}){return{signals:[{name:"color",value:We(n)?{...bv,...n}:bv}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}function Ei(n){return{signals:[{name:"fontSize",value:We(n)?{...vv,...n}:vv}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}function zp(n){return{text:{font:n},style:{"guide-label":{font:n},"guide-title":{font:n},"group-title":{font:n},"group-subtitle":{font:n}}}}function Ip(n){const r=te(n||{}),s={};for(const u of r){const c=n[u];s[u]=Hr(c)?po(c):di(c)}return s}function xv(n){const r=te(n),s={};for(const u of r)s[u]=Ip(n[u]);return s}const gS=[...mi,...Ll,...dv,"background","padding","legend","lineBreak","scale","style","title","view"];function Pp(n={}){const{color:r,font:s,fontSize:u,selection:c,...d}=n,p=Vc({},_e(dS),s?zp(s):{},r?hS(r):{},u?Ei(u):{},d||{});c&&ks(p,"selection",c,!0);const y=Yn(p,gS);for(const E of["background","lineBreak","padding"])p[E]&&(y[E]=di(p[E]));for(const E of mi)p[E]&&(y[E]=Wt(p[E]));for(const E of Ll)p[E]&&(y[E]=Ip(p[E]));for(const E of dv)p[E]&&(y[E]=Wt(p[E]));if(p.legend&&(y.legend=Wt(p.legend)),p.scale){const{invalid:E,...A}=p.scale,F=Wt(E,{level:1});y.scale={...Wt(A),...te(F).length>0?{invalid:F}:{}}}return p.style&&(y.style=xv(p.style)),p.title&&(y.title=Wt(p.title)),p.view&&(y.view=Wt(p.view)),y}const Ev=new Set(["view",...Qs]),Av=["color","fontSize","background","padding","facet","concat","numberFormat","numberFormatType","normalizedNumberFormat","normalizedNumberFormatType","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],Cv={view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"],...My};function Sv(n){n=_e(n);for(const r of Av)delete n[r];if(n.axis)for(const r in n.axis)Hr(n.axis[r])&&delete n.axis[r];if(n.legend)for(const r of sS)delete n.legend[r];if(n.mark){for(const r of If)delete n.mark[r];n.mark.tooltip&&We(n.mark.tooltip)&&delete n.mark.tooltip}n.params&&(n.signals=(n.signals||[]).concat(ad(n.params)),delete n.params);for(const r of Ev){for(const u of If)delete n[r][u];const s=Cv[r];if(s)for(const u of s)delete n[r][u];Up(n,r)}for(const r of oS())delete n[r];ls(n);for(const r in n)We(n[r])&&dt(n[r])&&delete n[r];return dt(n)?void 0:n}function ls(n){const{titleMarkConfig:r,subtitleMarkConfig:s,subtitle:u}=Ha(n.title);dt(r)||(n.style["group-title"]={...n.style["group-title"],...r}),dt(s)||(n.style["group-subtitle"]={...n.style["group-subtitle"],...s}),dt(u)?delete n.title:n.title=u}function Up(n,r,s,u){const c=u?n[r][u]:n[r];r==="view"&&(s="cell");const d={...c,...n.style[s??r]};dt(d)||(n.style[s??r]=d),u||delete n[r]}function Pt(n){return ie(n,"layer")}function ji(n){return ie(n,"repeat")}function Fv(n){return!pe(n.repeat)&&ie(n.repeat,"layer")}class au{map(r,s){return Gf(r)?this.mapFacet(r,s):ji(r)?this.mapRepeat(r,s):Bp(r)?this.mapHConcat(r,s):xr(r)?this.mapVConcat(r,s):Pi(r)?this.mapConcat(r,s):this.mapLayerOrUnit(r,s)}mapLayerOrUnit(r,s){if(Pt(r))return this.mapLayer(r,s);if(vi(r))return this.mapUnit(r,s);throw new Error(pf(r))}mapLayer(r,s){return{...r,layer:r.layer.map(u=>this.mapLayerOrUnit(u,s))}}mapHConcat(r,s){return{...r,hconcat:r.hconcat.map(u=>this.map(u,s))}}mapVConcat(r,s){return{...r,vconcat:r.vconcat.map(u=>this.map(u,s))}}mapConcat(r,s){const{concat:u,...c}=r;return{...c,concat:u.map(d=>this.map(d,s))}}mapFacet(r,s){return{...r,spec:this.map(r.spec,s)}}mapRepeat(r,s){return{...r,spec:this.map(r.spec,s)}}}const pS={zero:1,center:1,normalize:1};function jp(n){return tt(pS,n)}const mS=new Set([up,Mf,_f,Qa,Bf,zf,xl,bl,lp,Bi]),Gl=new Set([Mf,_f,up]);function uu(n){return ae(n)&&Dt(n)==="quantitative"&&!n.bin}function wv(n,r,{orient:s,type:u}){const c=r==="x"?"y":"radius",d=r==="x"&&["bar","area"].includes(u),p=n[r],y=n[c];if(ae(p)&&ae(y))if(uu(p)&&uu(y)){if(p.stack)return r;if(y.stack)return c;const E=ae(p)&&!!p.aggregate,A=ae(y)&&!!y.aggregate;if(E!==A)return E?r:c;if(d){if(s==="vertical")return c;if(s==="horizontal")return r}}else{if(uu(p))return r;if(uu(y))return c}else{if(uu(p))return d&&s==="vertical"?void 0:r;if(uu(y))return d&&s==="horizontal"?void 0:c}}function yS(n){switch(n){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}function Gp(n,r){const s=gr(n)?n:{type:n},u=s.type;if(!mS.has(u))return null;const c=wv(r,"x",s)||wv(r,"theta",s);if(!c)return null;const d=r[c],p=ae(d)?le(d,{}):void 0,y=yS(c),E=[],A=new Set;if(r[y]){const B=r[y],G=ae(B)?le(B,{}):void 0;G&&G!==p&&(E.push(y),A.add(G))}const F=y==="x"?"xOffset":"yOffset",$=r[F],_=ae($)?le($,{}):void 0;_&&_!==p&&(E.push(F),A.add(_));const L=nl.reduce((B,G)=>{if(G!=="tooltip"&&bi(r,G)){const H=r[G];for(const Z of vt(H)){const ve=Li(Z);if(ve.aggregate)continue;const De=le(ve,{});(!De||!A.has(De))&&B.push({channel:G,fieldDef:ve})}}return B},[]);let T;return d.stack!==void 0?Ji(d.stack)?T=d.stack?"zero":null:T=d.stack:Gl.has(u)&&(T="zero"),!T||!jp(T)||Sp(r)&&L.length===0?null:(d?.scale?.type&&d?.scale?.type!==ln.LINEAR&&d?.stack&&oe(iC(d.scale.type)),Me(r[Bn(c)])?(d.stack!==void 0&&oe(nC(c)),null):(ae(d)&&d.aggregate&&!DA.has(d.aggregate)&&oe(rC(d.aggregate)),{groupbyChannels:E,groupbyFields:A,fieldChannel:c,impute:d.impute===null?!1:es(u),stackBy:L,offset:T}))}function Wl(n,r,s){const u=Wt(n),c=ct("orient",u,s);if(u.orient=ld(u.type,r,c),c!==void 0&&c!==u.orient&&oe(oy(u.orient,c)),u.type==="bar"&&u.orient){const E=ct("cornerRadiusEnd",u,s);if(E!==void 0){const A=u.orient==="horizontal"&&r.x2||u.orient==="vertical"&&r.y2?["cornerRadius"]:Sl[u.orient];for(const F of A)u[F]=E;u.cornerRadiusEnd!==void 0&&delete u.cornerRadiusEnd}}const d=ct("opacity",u,s),p=ct("fillOpacity",u,s);return d===void 0&&p===void 0&&(u.opacity=Wp(u.type,r)),ct("cursor",u,s)===void 0&&(u.cursor=Dv(u,r,s)),u}function Dv(n,r,s){return r.href||n.href||ct("href",n,s)?"pointer":n.cursor}function Wp(n,r){if(Ue([Bf,Bi,zf,xl],n)&&!Sp(r))return .7}function vS(n,r,{graticule:s}){if(s)return!1;const u=Pr("filled",n,r),c=n.type;return It(u,c!==Bf&&c!==bl&&c!==Qa)}function ld(n,r,s){switch(n){case Bf:case zf:case xl:case lp:case Lf:case Ry:return}const{x:u,y:c,x2:d,y2:p}=r;switch(n){case Mf:if(ae(u)&&(mn(u.bin)||ae(c)&&c.aggregate&&!u.aggregate))return"vertical";if(ae(c)&&(mn(c.bin)||ae(u)&&u.aggregate&&!c.aggregate))return"horizontal";if(p||d){if(s)return s;if(!d)return(ae(u)&&u.type===hi&&!nt(u.bin)||Tl(u))&&ae(c)&&mn(c.bin)?"horizontal":"vertical";if(!p)return(ae(c)&&c.type===hi&&!nt(c.bin)||Tl(c))&&ae(u)&&mn(u.bin)?"vertical":"horizontal"}case Qa:if(d&&!(ae(u)&&mn(u.bin))&&p&&!(ae(c)&&mn(c.bin)))return;case _f:if(p)return ae(c)&&mn(c.bin)?"horizontal":"vertical";if(d)return ae(u)&&mn(u.bin)?"vertical":"horizontal";if(n===Qa){if(u&&!c)return"vertical";if(c&&!u)return"horizontal"}case bl:case Bi:{const y=pp(u),E=pp(c);if(s)return s;if(y&&!E)return n!=="tick"?"horizontal":"vertical";if(!y&&E)return n!=="tick"?"vertical":"horizontal";if(y&&E)return"vertical";{const A=Mt(u)&&u.type===hr,F=Mt(c)&&c.type===hr;if(A&&!F)return"vertical";if(!A&&F)return"horizontal"}return}}return"vertical"}function cd(n){const{point:r,line:s,...u}=n;return te(u).length>1?u:u.type}function kv(n){for(const r of["line","area","rule","trail"])n[r]&&(n={...n,[r]:Yn(n[r],["point","line"])});return n}function Vl(n,r={},s){return n.point==="transparent"?{opacity:0}:n.point?We(n.point)?n.point:{}:n.point!==void 0?null:r.point||s.shape?We(r.point)?r.point:{}:void 0}function $v(n,r={}){return n.line?n.line===!0?{}:n.line:n.line!==void 0?null:r.line?r.line===!0?{}:r.line:void 0}class Ov{constructor(){this.name="path-overlay"}hasMatchingType(r,s){if(vi(r)){const{mark:u,encoding:c}=r,d=gr(u)?u:{type:u};switch(d.type){case"line":case"rule":case"trail":return!!Vl(d,s[d.type],c);case"area":return!!Vl(d,s[d.type],c)||!!$v(d,s[d.type])}}return!1}run(r,s,u){const{config:c}=s,{params:d,projection:p,mark:y,name:E,encoding:A,...F}=r,$=Zf(A,c),_=gr(y)?y:{type:y},L=Vl(_,c[_.type],$),T=_.type==="area"&&$v(_,c[_.type]),B=[{name:E,...d?{params:d}:{},mark:cd({..._.type==="area"&&_.opacity===void 0&&_.fillOpacity===void 0?{opacity:.7}:{},..._}),encoding:Yn($,["shape"])}],G=Gp(Wl(_,$,c),$);let H=$;if(G){const{fieldChannel:Z,offset:ve}=G;H={...$,[Z]:{...$[Z],...ve?{stack:ve}:{}}}}return H=Yn(H,["y2","x2"]),T&&B.push({...p?{projection:p}:{},mark:{type:"line",...Go(_,["clip","interpolate","tension","tooltip"]),...T},encoding:H}),L&&B.push({...p?{projection:p}:{},mark:{type:"point",opacity:1,filled:!0,...Go(_,["clip","tooltip"]),...L},encoding:H}),u({...F,layer:B},{...s,config:kv(c)})}}function fd(n,r){return r?$l(n)?Hl(n,r):Tv(n,r):n}function dd(n,r){return r?Hl(n,r):n}function lu(n,r,s){const u=r[n];if(HC(u)){if(u.repeat in s)return{...r,[n]:s[u.repeat]};oe(Rg(u.repeat));return}return r}function Tv(n,r){if(n=lu("field",n,r),n!==void 0){if(n===null)return null;if(gp(n)&&yo(n.sort)){const s=lu("field",n.sort,r);n={...n,...s?{sort:s}:{}}}return n}}function Rv(n,r){if(ae(n))return Tv(n,r);{const s=lu("datum",n,r);return s!==n&&!s.type&&(s.type="nominal"),s}}function Vp(n,r){if(Me(n)){const s=Rv(n,r);if(s)return s;if(Ol(n))return{condition:n.condition}}else{if(Za(n)){const s=Rv(n.condition,r);if(s)return{...n,condition:s};{const{condition:u,...c}=n;return c}}return n}}function Hl(n,r){const s={};for(const u in n)if(ie(n,u)){const c=n[u];if(pe(c))s[u]=c.map(d=>Vp(d,r)).filter(d=>d);else{const d=Vp(c,r);d!==void 0&&(s[u]=d)}}return s}class hd{constructor(){this.name="RuleForRangedLine"}hasMatchingType(r){if(vi(r)){const{encoding:s,mark:u}=r;if(u==="line"||gr(u)&&u.type==="line")for(const c of hA){const d=sr(c),p=s[d];if(s[c]&&(ae(p)&&!mn(p.bin)||yi(p)))return!0}}return!1}run(r,s,u){const{encoding:c,mark:d}=r;return oe(Gg(!!c.x2,!!c.y2)),u({...r,mark:We(d)?{...d,type:"rule"}:"rule"},s)}}class gd extends au{constructor(){super(...arguments),this.nonFacetUnitNormalizers=[zl,tS,rS,new Ov,new hd]}map(r,s){if(vi(r)){const u=bi(r.encoding,Oi),c=bi(r.encoding,Br),d=bi(r.encoding,Lr);if(u||c||d)return this.mapFacetedUnit(r,s)}return super.map(r,s)}mapUnit(r,s){const{parentEncoding:u,parentProjection:c}=s,d=dd(r.encoding,s.repeater),p={...r,...r.name?{name:[s.repeaterPrefix,r.name].filter(E=>E).join("_")}:{},...d?{encoding:d}:{}};if(u||c)return this.mapUnitWithParentEncodingOrProjection(p,s);const y=this.mapLayerOrUnit.bind(this);for(const E of this.nonFacetUnitNormalizers)if(E.hasMatchingType(p,s.config))return E.run(p,s,y);return p}mapRepeat(r,s){return Fv(r)?this.mapLayerRepeat(r,s):this.mapNonLayerRepeat(r,s)}mapLayerRepeat(r,s){const{repeat:u,spec:c,...d}=r,{row:p,column:y,layer:E}=u,{repeater:A={},repeaterPrefix:F=""}=s;return p||y?this.mapRepeat({...r,repeat:{...p?{row:p}:{},...y?{column:y}:{}},spec:{repeat:{layer:E},spec:c}},s):{...d,layer:E.map($=>{const _={...A,layer:$},L=`${(c.name?`${c.name}_`:"")+F}child__layer_${Ft($)}`,T=this.mapLayerOrUnit(c,{...s,repeater:_,repeaterPrefix:L});return T.name=L,T})}}mapNonLayerRepeat(r,s){const{repeat:u,spec:c,data:d,...p}=r;!pe(u)&&r.columns&&(r=Yn(r,["columns"]),oe(Ng("repeat")));const y=[],{repeater:E={},repeaterPrefix:A=""}=s,F=!pe(u)&&u.row||[E?E.row:null],$=!pe(u)&&u.column||[E?E.column:null],_=pe(u)&&u||[E?E.repeat:null];for(const T of _)for(const B of F)for(const G of $){const H={repeat:T,row:B,column:G,layer:E.layer},Z=(c.name?`${c.name}_`:"")+A+"child__"+(pe(u)?`${Ft(T)}`:(u.row?`row_${Ft(B)}`:"")+(u.column?`column_${Ft(G)}`:"")),ve=this.map(c,{...s,repeater:H,repeaterPrefix:Z});ve.name=Z,y.push(Yn(ve,["data"]))}const L=pe(u)?r.columns:u.column?u.column.length:1;return{data:c.data??d,align:"all",...p,columns:L,concat:y}}mapFacet(r,s){const{facet:u}=r;return $l(u)&&r.columns&&(r=Yn(r,["columns"]),oe(Ng("facet"))),super.mapFacet(r,s)}mapUnitWithParentEncodingOrProjection(r,s){const{encoding:u,projection:c}=r,{parentEncoding:d,parentProjection:p,config:y}=s,E=pd({parentProjection:p,projection:c}),A=Nv({parentEncoding:d,encoding:dd(u,s.repeater)});return this.mapUnit({...r,...E?{projection:E}:{},...A?{encoding:A}:{}},{config:y})}mapFacetedUnit(r,s){const{row:u,column:c,facet:d,...p}=r.encoding,{mark:y,width:E,projection:A,height:F,view:$,params:_,encoding:L,...T}=r,{facetMapping:B,layout:G}=this.getFacetMappingAndLayout({row:u,column:c,facet:d},s),H=dd(p,s.repeater);return this.mapFacet({...T,...G,facet:B,spec:{...E?{width:E}:{},...F?{height:F}:{},...$?{view:$}:{},...A?{projection:A}:{},mark:y,encoding:H,..._?{params:_}:{}}},s)}getFacetMappingAndLayout(r,s){const{row:u,column:c,facet:d}=r;if(u||c){d&&oe(VA([...u?[Oi]:[],...c?[Br]:[]]));const p={},y={};for(const E of[Oi,Br]){const A=r[E];if(A){const{align:F,center:$,spacing:_,columns:L,...T}=A;p[E]=T;for(const B of["align","center","spacing"])A[B]!==void 0&&(y[B]??(y[B]={}),y[B][E]=A[B])}}return{facetMapping:p,layout:y}}else{const{align:p,center:y,spacing:E,columns:A,...F}=d;return{facetMapping:fd(F,s.repeater),layout:{...p?{align:p}:{},...y?{center:y}:{},...E?{spacing:E}:{},...A?{columns:A}:{}}}}}mapLayer(r,{parentEncoding:s,parentProjection:u,...c}){const{encoding:d,projection:p,...y}=r,E={...c,parentEncoding:Nv({parentEncoding:s,encoding:d,layer:!0}),parentProjection:pd({parentProjection:u,projection:p})};return super.mapLayer({...y,...r.name?{name:[E.repeaterPrefix,r.name].filter(A=>A).join("_")}:{}},E)}}function Nv({parentEncoding:n,encoding:r={},layer:s}){let u={};if(n){const c=new Set([...te(n),...te(r)]);for(const d of c){const p=r[d],y=n[d];if(Me(p)){const E={...y,...p};u[d]=E}else Za(p)?u[d]={...p,condition:{...y,...p.condition}}:p||p===null?u[d]=p:(s||vr(y)||xe(y)||Me(y)||pe(y))&&(u[d]=y)}}else u=r;return!u||dt(u)?void 0:u}function pd(n){const{parentProjection:r,projection:s}=n;return r&&s&&oe(IA({parentProjection:r,projection:s})),s??r}function aa(n){return ie(n,"filter")}function Hp(n){return ie(n,"stop")}function cu(n){return ie(n,"lookup")}function bS(n){return ie(n,"data")}function _v(n){return ie(n,"param")}function xS(n){return ie(n,"pivot")}function ql(n){return ie(n,"density")}function Mv(n){return ie(n,"quantile")}function Bv(n){return ie(n,"regression")}function ES(n){return ie(n,"loess")}function AS(n){return ie(n,"sample")}function md(n){return ie(n,"window")}function CS(n){return ie(n,"joinaggregate")}function SS(n){return ie(n,"flatten")}function Lv(n){return ie(n,"calculate")}function yd(n){return ie(n,"bin")}function zv(n){return ie(n,"impute")}function qp(n){return ie(n,"timeUnit")}function Xp(n){return ie(n,"aggregate")}function Yp(n){return ie(n,"stack")}function Iv(n){return ie(n,"fold")}function Kp(n){return ie(n,"extent")&&!ie(n,"density")&&!ie(n,"regression")}function Pv(n){return n.map(r=>aa(r)?{filter:Ns(r.filter,Ay)}:r)}class FS extends au{map(r,s){return s.emptySelections??(s.emptySelections={}),s.selectionPredicates??(s.selectionPredicates={}),r=Qp(r,s),super.map(r,s)}mapLayerOrUnit(r,s){if(r=Qp(r,s),r.encoding){const u={};for(const[c,d]of er(r.encoding))u[c]=Zp(d,s);r={...r,encoding:u}}return super.mapLayerOrUnit(r,s)}mapUnit(r,s){const{selection:u,...c}=r;return u?{...c,params:er(u).map(([d,p])=>{const{init:y,bind:E,empty:A,...F}=p;F.type==="single"?(F.type="point",F.toggle=!1):F.type==="multi"&&(F.type="point"),s.emptySelections[d]=A!=="none";for(const $ of Jt(s.selectionPredicates[d]??{}))$.empty=A!=="none";return{name:d,value:y,select:F,bind:E}})}:r}}function Qp(n,r){const{transform:s,...u}=n;if(s){const c=s.map(d=>{if(aa(d))return{filter:vd(d,r)};if(yd(d)&&ho(d.bin))return{...d,bin:Jp(d.bin)};if(cu(d)){const{selection:p,...y}=d.from;return p?{...d,from:{param:p,...y}}:d}return d});return{...u,transform:c}}return n}function Zp(n,r){const s=_e(n);if(ae(s)&&ho(s.bin)&&(s.bin=Jp(s.bin)),ra(s)&&s.scale?.domain?.selection){const{selection:u,...c}=s.scale.domain;s.scale.domain={...c,...u?{param:u}:{}}}if(Ol(s))if(pe(s.condition))s.condition=s.condition.map(u=>{const{selection:c,param:d,test:p,...y}=u;return d?u:{...y,test:vd(u,r)}});else{const{selection:u,param:c,test:d,...p}=Zp(s.condition,r);s.condition=c?s.condition:{...p,test:vd(s.condition,r)}}return s}function Jp(n){const r=n.extent;if(r?.selection){const{selection:s,...u}=r;return{...n,extent:{...u,param:s}}}return n}function vd(n,r){const s=u=>Ns(u,c=>{var d;const p=r.emptySelections[c]??!0,y={param:c,empty:p};return(d=r.selectionPredicates)[c]??(d[c]=[]),r.selectionPredicates[c].push(y),y});return n.selection?s(n.selection):Ns(n.test||n.filter,u=>u.selection?s(u.selection):u)}class e0 extends au{map(r,s){const u=s.selections??[];if(r.params&&!vi(r)){const c=[];for(const d of r.params)sd(d)?u.push(d):c.push(d);r.params=c}return s.selections=u,super.map(r,s)}mapUnit(r,s){const u=s.selections;if(!u||!u.length)return r;const c=(s.path??[]).concat(r.name),d=[];for(const p of u)if(!p.views||!p.views.length)d.push(p);else for(const y of p.views)(U(y)&&(y===r.name||c.includes(y))||pe(y)&&y.map(E=>c.indexOf(E)).every((E,A,F)=>E!==-1&&(A===0||E>F[A-1])))&&d.push(p);return d.length&&(r.params=d),r}}for(const n of["mapFacet","mapRepeat","mapHConcat","mapVConcat","mapLayer"]){const r=e0.prototype[n];e0.prototype[n]=function(s,u){return r.call(this,s,wS(s,u))}}function wS(n,r){return n.name?{...r,path:(r.path??[]).concat(n.name)}:r}function t0(n,r){r===void 0&&(r=Pp(n.config));const s=$S(n,r),{width:u,height:c}=n,d=Gv(s,{width:u,height:c,autosize:n.autosize},r);return{...s,...d?{autosize:d}:{}}}const DS=new gd,kS=new FS,Uv=new e0;function $S(n,r={}){const s={config:r};return Uv.map(DS.map(kS.map(n,s),s),s)}function jv(n){return U(n)?{type:n}:n??{}}function Gv(n,r,s){let{width:u,height:c}=r;const d=vi(n)||Pt(n),p={};d?u=="container"&&c=="container"?(p.type="fit",p.contains="padding"):u=="container"?(p.type="fit-x",p.contains="padding"):c=="container"&&(p.type="fit-y",p.contains="padding"):(u=="container"&&(oe(Y1("width")),u=void 0),c=="container"&&(oe(Y1("height")),c=void 0));const y={type:"pad",...p,...s?jv(s.autosize):{},...jv(n.autosize)};if(y.type==="fit"&&!d&&(oe(RA),y.type="pad"),u=="container"&&!(y.type=="fit"||y.type=="fit-x")&&oe(wg("width")),c=="container"&&!(y.type=="fit"||y.type=="fit-y")&&oe(wg("height")),!Kn(y,{type:"pad"}))return y}function OS(n){return["fit","fit-x","fit-y"].includes(n)}function n0(n){return n?`fit-${Ga(n)}`:"fit"}const Wv=["background","padding"];function i0(n,r){const s={};for(const u of Wv)n&&n[u]!==void 0&&(s[u]=di(n[u]));return r&&(s.params=n.params),s}class Gi{constructor(r={},s={}){this.explicit=r,this.implicit=s}clone(){return new Gi(_e(this.explicit),_e(this.implicit))}combine(){return{...this.explicit,...this.implicit}}get(r){return It(this.explicit[r],this.implicit[r])}getWithExplicit(r){return this.explicit[r]!==void 0?{explicit:!0,value:this.explicit[r]}:this.implicit[r]!==void 0?{explicit:!1,value:this.implicit[r]}:{explicit:!1,value:void 0}}setWithExplicit(r,{value:s,explicit:u}){s!==void 0&&this.set(r,s,u)}set(r,s,u){return delete this[u?"implicit":"explicit"][r],this[u?"explicit":"implicit"][r]=s,this}copyKeyFromSplit(r,{explicit:s,implicit:u}){s[r]!==void 0?this.set(r,s[r],!0):u[r]!==void 0&&this.set(r,u[r],!1)}copyKeyFromObject(r,s){s[r]!==void 0&&this.set(r,s[r],!0)}copyAll(r){for(const s of te(r.combine())){const u=r.getWithExplicit(s);this.setWithExplicit(s,u)}}}function Ai(n){return{explicit:!0,value:n}}function ni(n){return{explicit:!1,value:n}}function fu(n){return(r,s,u,c)=>{const d=n(r.value,s.value);return d>0?r:d<0?s:Xl(r,s,u,c)}}function Xl(n,r,s,u){return n.explicit&&r.explicit&&oe(YA(s,u,n.value,r.value)),n}function Ct(n,r,s,u,c=Xl){return n===void 0||n.value===void 0?r:n.explicit&&!r.explicit?n:r.explicit&&!n.explicit?r:Kn(n.value,r.value)?n:c(n,r,s,u)}class r0 extends Gi{constructor(r={},s={},u=!1){super(r,s),this.explicit=r,this.implicit=s,this.parseNothing=u}clone(){const r=super.clone();return r.parseNothing=this.parseNothing,r}}function ua(n){return ie(n,"url")}function Yl(n){return ie(n,"values")}function Vv(n){return ie(n,"name")&&!ua(n)&&!Yl(n)&&!cs(n)}function cs(n){return n&&(o0(n)||Hv(n)||Er(n))}function o0(n){return ie(n,"sequence")}function Hv(n){return ie(n,"sphere")}function Er(n){return ie(n,"graticule")}var Ge;(function(n){n[n.Raw=0]="Raw",n[n.Main=1]="Main",n[n.Row=2]="Row",n[n.Column=3]="Column",n[n.Lookup=4]="Lookup",n[n.PreFilterInvalid=5]="PreFilterInvalid",n[n.PostFilterInvalid=6]="PostFilterInvalid"})(Ge||(Ge={}));function qv({invalid:n,isPath:r}){switch(zy(n,{isPath:r})){case"filter":return{marks:"exclude-invalid-values",scales:"exclude-invalid-values"};case"break-paths-show-domains":return{marks:r?"include-invalid-values":"exclude-invalid-values",scales:"include-invalid-values"};case"break-paths-filter-domains":return{marks:r?"include-invalid-values":"exclude-invalid-values",scales:"exclude-invalid-values"};case"show":return{marks:"include-invalid-values",scales:"include-invalid-values"}}}function Kl(n){const{marks:r,scales:s}=qv(n);return r===s?Ge.Main:s==="include-invalid-values"?Ge.PreFilterInvalid:Ge.PostFilterInvalid}var Eo=z(82722);class qe{constructor(r,s){this.debugName=s,this._children=[],this._parent=null,r&&(this.parent=r)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(r){this._parent=r,r&&r.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(r,s){if(this._children.includes(r)){oe(Bg);return}s!==void 0?this._children.splice(s,0,r):this._children.push(r)}removeChild(r){const s=this._children.indexOf(r);return this._children.splice(s,1),s}remove(){let r=this._parent.removeChild(this);for(const s of this._children)s._parent=this._parent,this._parent.addChild(s,r++)}insertAsParentOf(r){const s=r.parent;s.removeChild(this),this.parent=s,r.parent=this}swapWithParent(){const r=this._parent,s=r.parent;for(const c of this._children)c.parent=r;this._children=[],r.removeChild(this);const u=r.parent.removeChild(r);this._parent=s,s.addChild(this,u),r.parent=this}}class yt extends qe{clone(){const r=new this.constructor;return r.debugName=`clone_${this.debugName}`,r._source=this._source,r._name=`clone_${this._name}`,r.type=this.type,r.refCounts=this.refCounts,r.refCounts[r._name]=0,r}constructor(r,s,u,c){super(r,s),this.type=u,this.refCounts=c,this._source=this._name=s,this.refCounts&&!(this._name in this.refCounts)&&(this.refCounts[this._name]=0)}dependentFields(){return new Set}producedFields(){return new Set}hash(){return this._hash===void 0&&(this._hash=`Output ${Yu()}`),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(r){this._source=r}}function s0(n){return n.as!==void 0}function a0(n){return`${n}_end`}class Ar extends qe{clone(){return new Ar(null,_e(this.timeUnits))}constructor(r,s){super(r),this.timeUnits=s}static makeFromEncoding(r,s){const u=s.reduceFieldDef((c,d,p)=>{const{field:y,timeUnit:E}=d;if(E){let A;if(Mi(E)){if(Bt(s)){const{mark:F,markDef:$,config:_}=s,L=ns({fieldDef:d,markDef:$,config:_});(El(F)||L)&&(A={timeUnit:qt(E),field:y})}}else A={as:le(d,{forAs:!0}),field:y,timeUnit:E};if(Bt(s)){const{mark:F,markDef:$,config:_}=s,L=ns({fieldDef:d,markDef:$,config:_});El(F)&&Tt(p)&&L!==.5&&(A.rectBandPosition=L)}A&&(c[He(A)]=A)}return c},{});return dt(u)?null:new Ar(r,u)}static makeFromTransform(r,s){const{timeUnit:u,...c}={...s},d=qt(u),p={...c,timeUnit:d};return new Ar(r,{[He(p)]:p})}merge(r){this.timeUnits={...this.timeUnits};for(const s in r.timeUnits)this.timeUnits[s]||(this.timeUnits[s]=r.timeUnits[s]);for(const s of r.children)r.removeChild(s),s.parent=this;r.remove()}removeFormulas(r){const s={};for(const[u,c]of er(this.timeUnits)){const d=s0(c)?c.as:`${c.field}_end`;r.has(d)||(s[u]=c)}this.timeUnits=s}producedFields(){return new Set(Jt(this.timeUnits).map(r=>s0(r)?r.as:a0(r.field)))}dependentFields(){return new Set(Jt(this.timeUnits).map(r=>r.field))}hash(){return`TimeUnit ${He(this.timeUnits)}`}assemble(){const r=[];for(const s of Jt(this.timeUnits)){const{rectBandPosition:u}=s,c=qt(s.timeUnit);if(s0(s)){const{field:d,as:p}=s,{unit:y,utc:E,...A}=c,F=[p,`${p}_end`];r.push({field:ci(d),type:"timeunit",...y?{units:jr(y)}:{},...E?{timezone:"utc"}:{},...A,as:F}),r.push(...xd(F,u,c))}else if(s){const{field:d}=s,p=d.replaceAll("\\.","."),y=Xv({timeUnit:c,field:p}),E=a0(p);r.push({type:"formula",expr:y,as:E}),r.push(...xd([p,E],u,c))}}return r}}const bd="offsetted_rect_start",ii="offsetted_rect_end";function Xv({timeUnit:n,field:r,reverse:s}){const{unit:u,utc:c}=n,d=dr(u),{part:p,step:y}=Ya(d,n.step);return`${c?"utcOffset":"timeOffset"}('${p}', ${ht(r)}, ${s?-y:y})`}function xd([n,r],s,u){if(s!==void 0&&s!==.5){const c=ht(n),d=ht(r);return[{type:"formula",expr:u0([Xv({timeUnit:u,field:n,reverse:!0}),c],s+.5),as:`${n}_${bd}`},{type:"formula",expr:u0([c,d],s+.5),as:`${n}_${ii}`}]}return[]}function u0([n,r],s){return`${1-s} * ${n} + ${s} * ${r}`}const du="_tuple_fields";class Yv{constructor(...r){this.items=r,this.hasChannel={},this.hasField={},this.hasSelectionId=!1}}const Kv={defined:()=>!0,parse:(n,r,s)=>{const u=r.name,c=r.project??(r.project=new Yv),d={},p={},y=new Set,E=(T,B)=>{const G=B==="visual"?T.channel:T.field;let H=Ft(`${u}_${G}`);for(let Z=1;y.has(H);Z++)H=Ft(`${u}_${G}_${Z}`);return y.add(H),{[B]:H}},A=r.type,F=n.config.selection[A],$=s.value!==void 0?vt(s.value):null;let{fields:_,encodings:L}=We(s.select)?s.select:{};if(!_&&!L&&$){for(const T of $)if(We(T))for(const B of te(T))dA(B)?(L||(L=[])).push(B):A==="interval"?(oe(Tg),L=F.encodings):(_??(_=[])).push(B)}!_&&!L&&(L=F.encodings,"fields"in F&&(_=F.fields));for(const T of L??[]){const B=n.fieldDef(T);if(B){let G=B.field;if(B.aggregate){oe(NA(T,B.aggregate));continue}else if(!G){oe(vf(T));continue}if(B.timeUnit&&!Mi(B.timeUnit)){G=n.vgField(T);const H={timeUnit:B.timeUnit,as:G,field:B.field};p[He(H)]=H}if(!d[G]){const H=A==="interval"&&lr(T)&&gi(n.getScaleComponent(T).get("type"))?"R":B.bin?"R-RE":"E",Z={field:G,channel:T,type:H,index:c.items.length};Z.signals={...E(Z,"data"),...E(Z,"visual")},c.items.push(d[G]=Z),c.hasField[G]=d[G],c.hasSelectionId=c.hasSelectionId||G===Ii,cg(T)?(Z.geoChannel=T,Z.channel=lg(T),c.hasChannel[Z.channel]=d[G]):c.hasChannel[T]=d[G]}}else oe(vf(T))}for(const T of _??[]){if(c.hasField[T])continue;const B={type:"E",field:T,index:c.items.length};B.signals={...E(B,"data")},c.items.push(B),c.hasField[T]=B,c.hasSelectionId=c.hasSelectionId||T===Ii}$&&(r.init=$.map(T=>c.items.map(B=>We(T)?T[B.geoChannel||B.channel]!==void 0?T[B.geoChannel||B.channel]:T[B.field]:T))),dt(p)||(c.timeUnit=new Ar(null,p))},signals:(n,r,s)=>{const u=r.name+du;return s.filter(d=>d.name===u).length>0||r.project.hasSelectionId?s:s.concat({name:u,value:r.project.items.map(Ad)})}},l0="_curr",Cr="anim_value",Wi="anim_clock",hu="eased_anim_clock",c0="min_extent",f0="max_range_extent",d0="last_tick_at",Ed="is_playing",Qv=1/60*1e3,h0=(n,r)=>[{name:hu,update:Wi},{name:`${n}_domain`,init:`domain('${r}')`},{name:c0,init:`extent(${n}_domain)[0]`},{name:f0,init:`extent(range('${r}'))[1]`},{name:Cr,update:`invert('${r}', ${hu})`}],NS={defined:n=>n.type==="point",topLevelSignals:(n,r,s)=>(qr(r)&&(s=s.concat([{name:Wi,init:"0",on:[{events:{type:"timer",throttle:Qv},update:`${Ed} ? (${Wi} + (now() - ${d0}) > ${f0} ? 0 : ${Wi} + (now() - ${d0})) : ${Wi}`}]},{name:d0,init:"now()",on:[{events:[{signal:Wi},{signal:Ed}],update:"now()"}]},{name:Ed,init:"true"}])),s),signals:(n,r,s)=>{const u=r.name,c=u+du,d=r.project,p="(item().isVoronoi ? datum.datum : datum)",y=Jt(n.component.selection??{}).reduce((F,$)=>$.type==="interval"?F.concat($.name+Xt):F,[]).map(F=>`indexof(item().mark.name, '${F}') < 0`).join(" && "),E=`datum && item().mark.marktype !== 'group' && indexof(item().mark.role, 'legend') < 0${y?` && ${y}`:""}`;let A=`unit: ${fa(n)}, `;if(r.project.hasSelectionId)A+=`${Ii}: ${p}[${Ze(Ii)}]`;else if(qr(r))A+=`fields: ${c}, values: [${Cr} ? ${Cr} : ${c0}]`;else{const F=d.items.map($=>n.fieldDef($.channel)?.bin?`[${p}[${Ze(n.vgField($.channel,{}))}], ${p}[${Ze(n.vgField($.channel,{binSuffix:"end"}))}]]`:`${p}[${Ze($.field)}]`).join(", ");A+=`fields: ${c}, values: [${F}]`}if(qr(r))return s.concat(h0(r.name,n.scaleName(rr)),[{name:u+Si,on:[{events:[{signal:hu},{signal:Cr}],update:`{${A}}`,force:!0}]}]);{const F=r.events;return s.concat([{name:u+Si,on:F?[{events:F,update:`${E} ? {${A}} : null`,force:!0}]:[]}])}}};function Ad(n){const{signals:r,hasLegend:s,index:u,...c}=n;return c.field=ci(c.field),c}function fs(n,r=!0,s=jt){if(pe(n)){const u=n.map(c=>fs(c,r,s));return r?`[${u.join(", ")}]`:u}else if(fr(n))return s(r?Vs(n):yC(n));return r?s(Se(n)):n}function _S(n,r){for(const s of Jt(n.component.selection??{})){const u=s.name;let c=`${u}${Si}, ${s.resolve==="global"?"true":`{unit: ${fa(n)}}`}`;for(const d of wd)d.defined(s)&&(d.signals&&(r=d.signals(n,s,r)),d.modifyExpr&&(c=d.modifyExpr(n,s,c)));r.push({name:u+VS,on:[{events:{signal:s.name+Si},update:`modify(${Ze(s.name+Hi)}, ${c})`}]})}return g0(r)}function MS(n,r){if(n.component.selection&&te(n.component.selection).length){const s=Ze(n.getName("cell"));r.unshift({name:"facet",value:{},on:[{events:(0,Eo.P)("pointermove","scope"),update:`isTuple(facet) ? facet : group(${s}).datum`}]})}return g0(r)}function gu(n,r){let s=!1;for(const u of Jt(n.component.selection??{})){const c=u.name,d=Ze(c+Hi);if(r.filter(y=>y.name===c).length===0){const y=u.resolve==="global"?"union":u.resolve,E=u.type==="point"?", true, true)":")";r.push({name:u.name,update:`${O0}(${d}, ${Ze(y)}${E}`})}s=!0;for(const y of wd)y.defined(u)&&y.topLevelSignals&&(r=y.topLevelSignals(n,u,r))}return s&&r.filter(c=>c.name==="unit").length===0&&r.unshift({name:"unit",value:{},on:[{events:"pointermove",update:"isTuple(group()) ? group() : unit"}]}),g0(r)}function Sr(n,r){const s=[],u=[],c=fa(n,{escape:!1});for(const d of Jt(n.component.selection??{})){const p={name:d.name+Hi};if(d.project.hasSelectionId&&(p.transform=[{type:"collect",sort:{field:Ii}}]),d.init){const E=d.project.items.map(Ad);p.values=d.project.hasSelectionId?d.init.map(A=>({unit:c,[Ii]:fs(A,!1)[0]})):d.init.map(A=>({unit:c,fields:E,values:fs(A,!1)}))}if([...s,...r].filter(E=>E.name===d.name+Hi).length||s.push(p),qr(d)&&r.length){const E=n.lookupDataSource(n.getDataName(Ge.Main)),A=r.find($=>$.name===E),F=A.transform.find($=>$.type==="filter"&&$.expr.includes("vlSelectionTest"));if(F){A.transform=A.transform.filter(_=>_!==F);const $={name:A.name+l0,source:A.name,transform:[F]};u.push($)}}}return s.concat(r,u)}function Vi(n,r){for(const s of Jt(n.component.selection??{}))for(const u of wd)u.defined(s)&&u.marks&&(r=u.marks(n,s,r));return r}function ds(n,r){for(const s of n.children)Bt(s)&&(r=Vi(s,r));return r}function BS(n,r,s,u){const c=Hb(n,r.param,r);return{signal:gi(s.get("type"))&&pe(u)&&u[0]>u[1]?`isValid(${c}) && reverse(${c})`:c}}function g0(n){return n.map(r=>(r.on&&!r.on.length&&delete r.on,r))}const Ao={defined:n=>n.type==="interval"&&n.resolve==="global"&&n.bind&&n.bind==="scales",parse:(n,r)=>{const s=r.scales=[];for(const u of r.project.items){const c=u.channel;if(!lr(c))continue;const d=n.getScaleComponent(c),p=d?d.get("type"):void 0;if(p=="sequential"&&oe(bf),!d||!gi(p)){oe(kg);continue}d.set("selectionExtent",{param:r.name,field:u.field},!0),s.push(u)}},topLevelSignals:(n,r,s)=>{const u=r.scales.filter(p=>s.filter(y=>y.name===p.signals.data).length===0);if(!n.parent||Zl(n)||u.length===0)return s;const c=s.find(p=>p.name===r.name);let d=c.update;if(d.includes(O0))c.update=`{${u.map(p=>`${Ze(ci(p.field))}: ${p.signals.data}`).join(", ")}}`;else{for(const p of u){const y=`${Ze(ci(p.field))}: ${p.signals.data}`;d.includes(y)||(d=`${d.substring(0,d.length-1)}, ${y}}`)}c.update=d}return s.concat(u.map(p=>({name:p.signals.data})))},signals:(n,r,s)=>{if(n.parent&&!Zl(n))for(const u of r.scales){const c=s.find(d=>d.name===u.signals.data);c.push="outer",delete c.value,delete c.update}return s}};function Ql(n,r){return`domain(${Ze(n.scaleName(r))})`}function Zl(n){return n.parent&&Qr(n.parent)&&(!n.parent.parent||Zl(n.parent.parent))}const Xt="_brush",Zv="_scale_trigger",Jl="geo_interval_init_tick",ec="_init",p0="_center",LS={defined:n=>n.type==="interval",parse:(n,r,s)=>{var u;if(n.hasProjection){const c={...(0,ot.isObject)(s.select)?s.select:{}};c.fields=[Ii],c.encodings||(c.encodings=s.value?te(s.value):[nr,Ri]),s.select={type:"interval",...c}}if(r.translate&&!Ao.defined(r)){const c=`!event.item || event.item.mark.name !== ${Ze(r.name+Xt)}`;for(const d of r.events){if(!d.between){oe(`${d} is not an ordered event stream for interval selections.`);continue}const p=vt((u=d.between[0]).filter??(u.filter=[]));p.includes(c)||p.push(c)}}},signals:(n,r,s)=>{const u=r.name,c=u+Si,d=Jt(r.project.hasChannel).filter(y=>y.channel===wt||y.channel===Ot),p=r.init?r.init[0]:null;if(s.push(...d.reduce((y,E)=>y.concat(zS(n,r,E,p&&p[E.index])),[])),n.hasProjection){const y=Ze(n.projectionName()),E=n.projectionName()+p0,{x:A,y:F}=r.project.hasChannel,$=A&&A.signals.visual,_=F&&F.signals.visual,L=A?p&&p[A.index]:`${E}[0]`,T=F?p&&p[F.index]:`${E}[1]`,B=be=>n.getSizeSignalRef(be).signal,G=`[[${$?$+"[0]":"0"}, ${_?_+"[0]":"0"}],[${$?$+"[1]":B("width")}, ${_?_+"[1]":B("height")}]]`;p&&(s.unshift({name:u+ec,init:`[scale(${y}, [${A?L[0]:L}, ${F?T[0]:T}]), scale(${y}, [${A?L[1]:L}, ${F?T[1]:T}])]`}),(!A||!F)&&(s.find($e=>$e.name===E)||s.unshift({name:E,update:`invert(${y}, [${B("width")}/2, ${B("height")}/2])`})));const H=`intersect(${G}, {markname: ${Ze(n.getName("marks"))}}, unit.mark)`,Z=`{unit: ${fa(n)}}`,ve=`vlSelectionTuples(${H}, ${Z})`,De=d.map(be=>be.signals.visual);return s.concat({name:c,on:[{events:[...De.length?[{signal:De.join(" || ")}]:[],...p?[{signal:Jl}]:[]],update:ve}]})}else{if(!Ao.defined(r)){const A=u+Zv,F=d.map($=>{const _=$.channel,{data:L,visual:T}=$.signals,B=Ze(n.scaleName(_)),G=n.getScaleComponent(_).get("type"),H=gi(G)?"+":"";return`(!isArray(${L}) || (${H}invert(${B}, ${T})[0] === ${H}${L}[0] && ${H}invert(${B}, ${T})[1] === ${H}${L}[1]))`});F.length&&s.push({name:A,value:{},on:[{events:d.map($=>({scale:n.scaleName($.channel)})),update:F.join(" && ")+` ? ${A} : {}`}]})}const y=d.map(A=>A.signals.data),E=`unit: ${fa(n)}, fields: ${u+du}, values`;return s.concat({name:c,...p?{init:`{${E}: ${fs(p)}}`}:{},...y.length?{on:[{events:[{signal:y.join(" || ")}],update:`${y.join(" && ")} ? {${E}: [${y}]} : null`}]}:{}})}},topLevelSignals:(n,r,s)=>(Bt(n)&&n.hasProjection&&r.init&&(s.filter(c=>c.name===Jl).length||s.unshift({name:Jl,value:null,on:[{events:"timer{1}",update:`${Jl} === null ? {} : ${Jl}`}]})),s),marks:(n,r,s)=>{const u=r.name,{x:c,y:d}=r.project.hasChannel,p=c?.signals.visual,y=d?.signals.visual,E=`data(${Ze(r.name+Hi)})`;if(Ao.defined(r)||!c&&!d)return s;const A={x:c!==void 0?{signal:`${p}[0]`}:{value:0},y:d!==void 0?{signal:`${y}[0]`}:{value:0},x2:c!==void 0?{signal:`${p}[1]`}:{field:{group:"width"}},y2:d!==void 0?{signal:`${y}[1]`}:{field:{group:"height"}}};if(r.resolve==="global")for(const G of te(A))A[G]=[{test:`${E}.length && ${E}[0].unit === ${fa(n)}`,...A[G]},{value:0}];const{fill:F,fillOpacity:$,cursor:_,...L}=r.mark,T=te(L).reduce((G,H)=>(G[H]=[{test:[c!==void 0&&`${p}[0] !== ${p}[1]`,d!==void 0&&`${y}[0] !== ${y}[1]`].filter(Z=>Z).join(" && "),value:L[H]},{value:null}],G),{}),B=_??(r.translate?"move":null);return[{name:`${u+Xt}_bg`,type:"rect",clip:!0,encode:{enter:{fill:{value:F},fillOpacity:{value:$}},update:A}},...s,{name:u+Xt,type:"rect",clip:!0,encode:{enter:{...B?{cursor:{value:B}}:{},fill:{value:"transparent"}},update:{...A,...T}}}]}};function zS(n,r,s,u){const c=!n.hasProjection,d=s.channel,p=s.signals.visual,y=Ze(c?n.scaleName(d):n.projectionName()),E=_=>`scale(${y}, ${_})`,A=n.getSizeSignalRef(d===wt?"width":"height").signal,F=`${d}(unit)`,$=r.events.reduce((_,L)=>[..._,{events:L.between[0],update:`[${F}, ${F}]`},{events:L,update:`[${p}[0], clamp(${F}, 0, ${A})]`}],[]);if(c){const _=s.signals.data,L=Ao.defined(r),T=n.getScaleComponent(d),B=T?T.get("type"):void 0,G=u?{init:fs(u,!0,E)}:{value:[]};return $.push({events:{signal:r.name+Zv},update:gi(B)?`[${E(`${_}[0]`)}, ${E(`${_}[1]`)}]`:"[0, 0]"}),L?[{name:_,on:[]}]:[{name:p,...G,on:$},{name:_,...u?{init:fs(u)}:{},on:[{events:{signal:p},update:`${p}[0] === ${p}[1] ? null : invert(${y}, ${p})`}]}]}else{const _=d===wt?0:1,L=r.name+ec,T=u?{init:`[${L}[0][${_}], ${L}[1][${_}]]`}:{value:[]};return[{name:p,...T,on:$}]}}function hs({model:n,channelDef:r,vgChannel:s,invalidValueRef:u,mainRefFn:c}){const d=Ol(r)&&r.condition;let p=[];d&&(p=vt(d).map(A=>{const F=c(A);if(VC(A)){const{param:$,empty:_}=A;return{test:Vb(n,{param:$,empty:_}),...F}}else return{test:zd(n,A.test),...F}})),u!==void 0&&p.push(u);const y=c(r);return y!==void 0&&p.push(y),p.length>1||p.length===1&&p[0].test?{[s]:p}:p.length===1?{[s]:p[0]}:{}}function Cd(n,r="text"){const s=n.encoding[r];return hs({model:n,channelDef:s,vgChannel:r,mainRefFn:u=>tc(u,n.config),invalidValueRef:void 0})}function tc(n,r,s="datum"){if(n){if(vr(n))return Et(n.value);if(Me(n)){const{format:u,formatType:c}=_l(n);return fp({fieldOrDatumDef:n,format:u,formatType:c,expr:s,config:r})}}}function m0(n,r={}){const{encoding:s,markDef:u,config:c,stack:d}=n,p=s.tooltip;if(pe(p))return{tooltip:v0({tooltip:p},d,c,r)};{const y=r.reactiveGeom?"datum.datum":"datum";return hs({model:n,channelDef:p,vgChannel:"tooltip",mainRefFn:A=>{const F=tc(A,c,y);if(F)return F;if(A===null)return;let $=ct("tooltip",u,c);if($===!0&&($={content:"encoding"}),U($))return{value:$};if(We($))return xe($)?$:$.content==="encoding"?v0(s,d,c,r):{signal:y}},invalidValueRef:void 0})}}function y0(n,r,s,{reactiveGeom:u}={}){const c={...s,...s.tooltipFormat},d=new Set,p=u?"datum.datum":"datum",y=[];function E(F,$){const _=sr($),L=Mt(F)?F:{...F,type:n[_].type},T=L.title||xp(L,c),B=vt(T).join(", ").replaceAll(/"/g,'\\"');let G;if(Tt($)){const H=$==="x"?"x2":"y2",Z=Li(n[H]);if(mn(L.bin)&&Z){const ve=le(L,{expr:p}),De=le(Z,{expr:p}),{format:be,formatType:$e}=_l(L);G=Dl(ve,De,be,$e,c),d.add(H)}}if((Tt($)||$===Ti||$===tr)&&r&&r.fieldChannel===$&&r.offset==="normalize"){const{format:H,formatType:Z}=_l(L);G=fp({fieldOrDatumDef:L,format:H,formatType:Z,expr:p,config:c,normalizeStack:!0}).signal}G??(G=tc(L,c,p).signal),y.push({channel:$,key:B,value:G})}wp(n,(F,$)=>{ae(F)?E(F,$):Vf(F)&&E(F.condition,$)});const A={};for(const{channel:F,key:$,value:_}of y)!d.has(F)&&!A[$]&&(A[$]=_);return A}function v0(n,r,s,{reactiveGeom:u}={}){const c=y0(n,r,s,{reactiveGeom:u}),d=er(c).map(([p,y])=>`"${p}": ${y}`);return d.length>0?{signal:`{${d.join(", ")}}`}:void 0}function eb(n){const{markDef:r,config:s}=n,u=ct("aria",r,s);return u===!1?{}:{...u?{aria:u}:{},...IS(n),...PS(n)}}function IS(n){const{mark:r,markDef:s,config:u}=n;if(u.aria===!1)return{};const c=ct("ariaRoleDescription",s,u);return c!=null?{ariaRoleDescription:{value:c}}:tt(V1,r)?{}:{ariaRoleDescription:{value:r}}}function PS(n){const{encoding:r,markDef:s,config:u,stack:c}=n,d=r.description;if(d)return hs({model:n,channelDef:d,vgChannel:"description",mainRefFn:E=>tc(E,n.config),invalidValueRef:void 0});const p=ct("description",s,u);if(p!=null)return{description:Et(p)};if(u.aria===!1)return{};const y=y0(r,c,u);if(!dt(y))return{description:{signal:er(y).map(([E,A],F)=>`"${F>0?"; ":""}${E}: " + (${A})`).join(" + ")}}}function cn(n,r,s={}){const{markDef:u,encoding:c,config:d}=r,{vgChannel:p}=s;let{defaultRef:y,defaultValue:E}=s;const A=c[n];y===void 0&&(E??(E=ct(n,u,d,{vgChannel:p,ignoreVgConfig:!Ol(A)})),E!==void 0&&(y=Et(E)));const F={markDef:u,config:d,scaleName:r.scaleName(n),scale:r.getScaleComponent(n)},$=Py({...F,scaleChannel:n,channelDef:A});return hs({model:r,channelDef:A,vgChannel:p??n,invalidValueRef:$,mainRefFn:L=>ta({...F,channel:n,channelDef:L,stack:null,defaultRef:y})})}function b0(n,r={filled:void 0}){const{markDef:s,encoding:u,config:c}=n,{type:d}=s,p=r.filled??ct("filled",s,c),y=Ue(["bar","point","circle","square","geoshape"],d)?"transparent":void 0,E=ct(p===!0?"color":void 0,s,c,{vgChannel:"fill"})??c.mark[p===!0&&"color"]??y,A=ct(p===!1?"color":void 0,s,c,{vgChannel:"stroke"})??c.mark[p===!1&&"color"],F=p?"fill":"stroke",$={...E?{fill:Et(E)}:{},...A?{stroke:Et(A)}:{}};return s.color&&(p?s.fill:s.stroke)&&oe(Af("property",{fill:"fill"in s,stroke:"stroke"in s})),{...$,...cn("color",n,{vgChannel:F,defaultValue:p?E:A}),...cn("fill",n,{defaultValue:u.fill?E:void 0}),...cn("stroke",n,{defaultValue:u.stroke?A:void 0})}}function tb(n){const{encoding:r,mark:s}=n,u=r.order;return!es(s)&&vr(u)?hs({model:n,channelDef:u,vgChannel:"zindex",mainRefFn:c=>Et(c.value),invalidValueRef:void 0}):{}}function pu({channel:n,markDef:r,encoding:s={},model:u,bandPosition:c}){const d=`${n}Offset`,p=r[d],y=s[d];if((d==="xOffset"||d==="yOffset")&&y)return{offsetType:"encoding",offset:ta({channel:d,channelDef:y,markDef:r,config:u?.config,scaleName:u.scaleName(d),scale:u.getScaleComponent(d),stack:null,defaultRef:Et(p),bandPosition:c})};const E=r[d];return E?{offsetType:"visual",offset:E}:{}}function yn(n,r,{defaultPos:s,vgChannel:u}){const{encoding:c,markDef:d,config:p,stack:y}=r,E=c[n],A=c[Bn(n)],F=r.scaleName(n),$=r.getScaleComponent(n),{offset:_,offsetType:L}=pu({channel:n,markDef:d,encoding:c,model:r,bandPosition:.5}),T=nc({model:r,defaultPos:s,channel:n,scaleName:F,scale:$}),B=!E&&Tt(n)&&(c.latitude||c.longitude)?{field:r.getName(n)}:Sd({channel:n,channelDef:E,channel2Def:A,markDef:d,config:p,scaleName:F,scale:$,stack:y,offset:_,defaultRef:T,bandPosition:L==="encoding"?0:void 0});return B?{[u||n]:B}:void 0}function Sd(n){const{channel:r,channelDef:s,scaleName:u,stack:c,offset:d,markDef:p}=n;if(Me(s)&&c&&r===c.fieldChannel){if(ae(s)){let y=s.bandPosition;if(y===void 0&&p.type==="text"&&(r==="radius"||r==="theta")&&(y=.5),y!==void 0)return Fl({scaleName:u,fieldOrDatumDef:s,startSuffix:"start",bandPosition:y,offset:d})}return ts(s,u,{suffix:"end"},{offset:d})}return pr(n)}function nc({model:n,defaultPos:r,channel:s,scaleName:u,scale:c}){const{markDef:d,config:p}=n;return()=>{const y=sr(s),E=q(s),A=ct(s,d,p,{vgChannel:E});if(A!==void 0)return mo(s,A);switch(r){case"zeroOrMin":return Fd({scaleName:u,scale:c,mode:"zeroOrMin",mainChannel:y,config:p});case"zeroOrMax":return Fd({scaleName:u,scale:c,mode:{zeroOrMax:{widthSignal:n.width.signal,heightSignal:n.height.signal}},mainChannel:y,config:p});case"mid":return{...n[Ln(s)],mult:.5}}}}function Fd({mainChannel:n,config:r,...s}){const u=Iy(s),{mode:c}=s;if(u)return u;switch(n){case"radius":{if(c==="zeroOrMin")return{value:0};const{widthSignal:d,heightSignal:p}=c.zeroOrMax;return{signal:`min(${d},${p})/2`}}case"theta":return c==="zeroOrMin"?{value:0}:{signal:"2*PI"};case"x":return c==="zeroOrMin"?{value:0}:{field:{group:"width"}};case"y":return c==="zeroOrMin"?{field:{group:"height"}}:{value:0}}}const gs={left:"x",center:"xc",right:"x2"},ps={top:"y",middle:"yc",bottom:"y2"};function x0(n,r,s,u="middle"){if(n==="radius"||n==="theta")return q(n);const c=n==="x"?"align":"baseline",d=ct(c,r,s);let p;return xe(d)?(oe(jg(c)),p=void 0):p=d,n==="x"?gs[p||(u==="top"?"left":"center")]:ps[p||u]}function la(n,r,{defaultPos:s,defaultPos2:u,range:c}){return c?E0(n,r,{defaultPos:s,defaultPos2:u}):yn(n,r,{defaultPos:s})}function E0(n,r,{defaultPos:s,defaultPos2:u}){const{markDef:c,config:d}=r,p=Bn(n),y=Ln(n),E=A0(r,u,p),A=E[y]?x0(n,c,d):q(n);return{...yn(n,r,{defaultPos:s,vgChannel:A}),...E}}function A0(n,r,s){const{encoding:u,mark:c,markDef:d,stack:p,config:y}=n,E=sr(s),A=Ln(s),F=q(s),$=u[E],_=n.scaleName(E),L=n.getScaleComponent(E),{offset:T}=s in u||s in d?pu({channel:s,markDef:d,encoding:u,model:n}):pu({channel:E,markDef:d,encoding:u,model:n});if(!$&&(s==="x2"||s==="y2")&&(u.latitude||u.longitude)){const G=Ln(s),H=n.markDef[G];return H!=null?{[G]:{value:H}}:{[F]:{field:n.getName(s)}}}const B=US({channel:s,channelDef:$,channel2Def:u[s],markDef:d,config:y,scaleName:_,scale:L,stack:p,offset:T,defaultRef:void 0});return B!==void 0?{[F]:B}:ic(s,d)||ic(s,{[s]:hf(s,d,y.style),[A]:hf(A,d,y.style)})||ic(s,y[c])||ic(s,y.mark)||{[F]:nc({model:n,defaultPos:r,channel:s,scaleName:_,scale:L})()}}function US({channel:n,channelDef:r,channel2Def:s,markDef:u,config:c,scaleName:d,scale:p,stack:y,offset:E,defaultRef:A}){return Me(r)&&y&&n.charAt(0)===y.fieldChannel.charAt(0)?ts(r,d,{suffix:"start"},{offset:E}):pr({channel:n,channelDef:s,scaleName:d,scale:p,stack:y,markDef:u,config:c,offset:E,defaultRef:A})}function ic(n,r){const s=Ln(n),u=q(n);if(r[u]!==void 0)return{[u]:mo(n,r[u])};if(r[n]!==void 0)return{[u]:mo(n,r[n])};if(r[s]){const c=r[s];if(ea(c))oe(jA(s));else return{[s]:mo(n,c)}}}function Co(n,r){const{config:s,encoding:u,markDef:c}=n,d=c.type,p=Bn(r),y=Ln(r),E=u[r],A=u[p],F=n.getScaleComponent(r),$=F?F.get("type"):void 0,_=c.orient,L=u[y]??u.size??ct("size",c,s,{vgChannel:y}),T=hg(r),B=d==="bar"&&(r==="x"?_==="vertical":_==="horizontal")||d==="tick"&&(r==="y"?_==="vertical":_==="horizontal");return ae(E)&&(nt(E.bin)||mn(E.bin)||E.timeUnit&&!A)&&!(L&&!ea(L))&&!u[T]&&!tn($)?rb({fieldDef:E,fieldDef2:A,channel:r,model:n}):(Me(E)&&tn($)||B)&&!A?ib(E,r,n):E0(r,n,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function nb(n,r,s,u,c,d,p){if(ea(c))if(s){const E=s.get("type");if(E==="band"){let A=`bandwidth('${r}')`;c.band!==1&&(A=`${c.band} * ${A}`);const F=Pr("minBandSize",{type:p},u);return{signal:F?`max(${cr(F)}, ${A})`:A}}else c.band!==1&&(oe(uy(E)),c=void 0)}else return{mult:c.band,field:{group:n}};else{if(xe(c))return c;if(c)return{value:c}}if(s){const E=s.get("range");if(Jo(E)&&j(E.step))return{value:E.step-2}}if(!d){const{bandPaddingInner:E,barBandPaddingInner:A,rectBandPaddingInner:F,tickBandPaddingInner:$}=u.scale,_=It(E,p==="tick"?$:p==="bar"?A:F);if(xe(_))return{signal:`(1 - (${_.signal})) * ${n}`};if(j(_))return{signal:`${1-_} * ${n}`}}return{value:Lp(u.view,n)-2}}function ib(n,r,s){const{markDef:u,encoding:c,config:d,stack:p}=s,y=u.orient,E=s.scaleName(r),A=s.getScaleComponent(r),F=Ln(r),$=Bn(r),_=hg(r),L=s.scaleName(_),T=s.getScaleComponent(nf(r)),B=u.type==="tick"||y==="horizontal"&&r==="y"||y==="vertical"&&r==="x";let G;(c.size||u.size)&&(B?G=cn("size",s,{vgChannel:F,defaultRef:Et(u.size)}):oe(qA(u.type)));const H=!!G,Z=Xy({channel:r,fieldDef:n,markDef:u,config:d,scaleType:(A||T)?.get("type"),useVlSizeChannel:B});G=G||{[F]:nb(F,L||E,T||A,d,Z,!!n,u.type)};const ve=(A||T)?.get("type")==="band"&&ea(Z)&&!H?"top":"middle",De=x0(r,u,d,ve),be=De==="xc"||De==="yc",{offset:$e,offsetType:Re}=pu({channel:r,markDef:u,encoding:c,model:s,bandPosition:be?.5:0}),me=pr({channel:r,channelDef:n,markDef:u,config:d,scaleName:E,scale:A,stack:p,offset:$e,defaultRef:nc({model:s,defaultPos:"mid",channel:r,scaleName:E,scale:A}),bandPosition:be?Re==="encoding"?0:.5:xe(Z)?{signal:`(1-${Z})/2`}:ea(Z)?(1-Z.band)/2:0});if(F)return{[De]:me,...G};{const Ut=q($),dn=G[F],wi=$e?{...dn,offset:$e}:dn;return{[De]:me,[Ut]:pe(me)?[me[0],{...me[1],offset:wi}]:{...me,offset:wi}}}}function C0(n,r,s,u,c,d,p){if(ug(n))return 0;const y=n==="x"||n==="y2",E=y?-r/2:r/2;if(xe(s)||xe(c)||xe(u)||d){const A=cr(s),F=cr(c),$=cr(u),_=cr(d),T=d?`(${p} < ${_} ? ${y?"":"-"}0.5 * (${_} - (${p})) : ${E})`:E,B=$?`${$} + `:"",G=A?`(${A} ? -1 : 1) * `:"",H=F?`(${F} + ${T})`:T;return{signal:B+G+H}}else return c=c||0,u+(s?-c-E:+c+E)}function rb({fieldDef:n,fieldDef2:r,channel:s,model:u}){const{config:c,markDef:d,encoding:p}=u,y=u.getScaleComponent(s),E=u.scaleName(s),A=y?y.get("type"):void 0,F=y.get("reverse"),$=Xy({channel:s,fieldDef:n,markDef:d,config:c,scaleType:A}),L=u.component.axes[s]?.[0]?.get("translate")??.5,T=Tt(s)?ct("binSpacing",d,c)??0:0,B=Bn(s),G=q(s),H=q(B),Z=Pr("minBandSize",d,c),{offset:ve}=pu({channel:s,markDef:d,encoding:p,model:u,bandPosition:0}),{offset:De}=pu({channel:B,markDef:d,encoding:p,model:u,bandPosition:0}),be=wl({fieldDef:n,scaleName:E}),$e=C0(s,T,F,L,ve,Z,be),Re=C0(B,T,F,L,De??ve,Z,be),me=xe($)?{signal:`(1-${$.signal})/2`}:ea($)?(1-$.band)/2:.5,Ut=ns({fieldDef:n,fieldDef2:r,markDef:d,config:c});if(nt(n.bin)||n.timeUnit){const dn=n.timeUnit&&Ut!==.5;return{[H]:ob({fieldDef:n,scaleName:E,bandPosition:me,offset:Re,useRectOffsetField:dn}),[G]:ob({fieldDef:n,scaleName:E,bandPosition:xe(me)?{signal:`1-${me.signal}`}:1-me,offset:$e,useRectOffsetField:dn})}}else if(mn(n.bin)){const dn=ts(n,E,{},{offset:Re});if(ae(r))return{[H]:dn,[G]:ts(r,E,{},{offset:$e})};if(ho(n.bin)&&n.bin.step)return{[H]:dn,[G]:{signal:`scale("${E}", ${le(n,{expr:"datum"})} + ${n.bin.step})`,offset:$e}}}oe(hy(B))}function ob({fieldDef:n,scaleName:r,bandPosition:s,offset:u,useRectOffsetField:c}){return Fl({scaleName:r,fieldOrDatumDef:n,bandPosition:s,offset:u,...c?{startSuffix:bd,endSuffix:ii}:{}})}const jS=new Set(["aria","width","height"]);function Ci(n,r){const{fill:s=void 0,stroke:u=void 0}=r.color==="include"?b0(n):{};return{...sb(n.markDef,r),...S0("fill",s),...S0("stroke",u),...cn("opacity",n),...cn("fillOpacity",n),...cn("strokeOpacity",n),...cn("strokeWidth",n),...cn("strokeDash",n),...tb(n),...m0(n),...Cd(n,"href"),...eb(n)}}function S0(n,r){return r?{[n]:r}:{}}function sb(n,r){return TA.reduce((s,u)=>(!jS.has(u)&&ie(n,u)&&r[u]!=="ignore"&&(s[u]=Et(n[u])),s),{})}function fn(n){const{config:r,markDef:s}=n,u=new Set;if(n.forEachFieldDef((c,d)=>{let p;if(!lr(d)||!(p=n.getScaleType(d)))return;const y=cf(c.aggregate),E=Vr({scaleChannel:d,markDef:s,config:r,scaleType:p,isCountAggregate:y});if(zC(E)){const A=n.vgField(d,{expr:"datum",binSuffix:n.stack?.impute?"mid":void 0});A&&u.add(A)}}),u.size>0)return{defined:{signal:[...u].map(d=>ml(d,!0)).join(" && ")}}}function ca(n,r){if(r!==void 0)return{[n]:Et(r)}}const F0="voronoi",ab={defined:n=>n.type==="point"&&n.nearest,parse:(n,r)=>{if(r.events)for(const s of r.events)s.markname=n.getName(F0)},marks:(n,r,s)=>{const{x:u,y:c}=r.project.hasChannel,d=n.mark;if(es(d))return oe(K1(d)),s;const p={name:n.getName(F0),type:"path",interactive:!0,from:{data:n.getName("marks")},encode:{update:{fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0},...m0(n,{reactiveGeom:!0})}},transform:[{type:"voronoi",x:{expr:u||!c?"datum.datum.x || 0":"0"},y:{expr:c||!u?"datum.datum.y || 0":"0"},size:[n.getSizeSignalRef("width"),n.getSizeSignalRef("height")]}]};let y=0,E=!1;return s.forEach((A,F)=>{const $=A.name??"";$===n.component.mark[0].name?y=F:$.includes(F0)&&(E=!0)}),E||s.splice(y+1,0,p),s}},D0={defined:n=>n.type==="point"&&n.resolve==="global"&&n.bind&&n.bind!=="scales"&&!od(n.bind),parse:(n,r,s)=>yb(r,s),topLevelSignals:(n,r,s)=>{const u=r.name,c=r.project,d=r.bind,p=r.init&&r.init[0],y=ab.defined(r)?"(item().isVoronoi ? datum.datum : datum)":"datum";return c.items.forEach((E,A)=>{const F=Ft(`${u}_${E.field}`);s.filter(_=>_.name===F).length||s.unshift({name:F,...p?{init:fs(p[A])}:{value:null},on:r.events?[{events:r.events,update:`datum && item().mark.marktype !== 'group' ? ${y}[${Ze(E.field)}] : null`}]:[],bind:d[E.field]??d[E.channel]??d})}),s},signals:(n,r,s)=>{const u=r.name,c=r.project,d=s.find(A=>A.name===u+Si),p=u+du,y=c.items.map(A=>Ft(`${u}_${A.field}`)),E=y.map(A=>`${A} !== null`).join(" && ");return y.length&&(d.update=`${E} ? {fields: ${p}, values: [${y.join(", ")}]} : null`),delete d.value,delete d.on,s}},rc="_toggle",ub={defined:n=>n.type==="point"&&!qr(n)&&!!n.toggle,signals:(n,r,s)=>s.concat({name:r.name+rc,value:!1,on:[{events:r.events,update:r.toggle}]}),modifyExpr:(n,r)=>{const s=r.name+Si,u=r.name+rc;return`${u} ? null : ${s}, `+(r.resolve==="global"?`${u} ? null : true, `:`${u} ? null : {unit: ${fa(n)}}, `)+`${u} ? ${s} : null`}},Rt={defined:n=>n.clear!==void 0&&n.clear!==!1&&!qr(n),parse:(n,r)=>{r.clear&&(r.clear=U(r.clear)?(0,Eo.P)(r.clear,"view"):r.clear)},topLevelSignals:(n,r,s)=>{if(D0.defined(r))for(const u of r.project.items){const c=s.findIndex(d=>d.name===Ft(`${r.name}_${u.field}`));c!==-1&&s[c].on.push({events:r.clear,update:"null"})}return s},signals:(n,r,s)=>{function u(c,d){c!==-1&&s[c].on&&s[c].on.push({events:r.clear,update:d})}if(r.type==="interval")for(const c of r.project.items){const d=s.findIndex(p=>p.name===c.signals.visual);if(u(d,"[0, 0]"),d===-1){const p=s.findIndex(y=>y.name===c.signals.data);u(p,"null")}}else{let c=s.findIndex(d=>d.name===r.name+Si);u(c,"null"),ub.defined(r)&&(c=s.findIndex(d=>d.name===r.name+rc),u(c,"false"))}return s}},k0={defined:n=>{const r=n.resolve==="global"&&n.bind&&od(n.bind),s=n.project.items.length===1&&n.project.items[0].field!==Ii;return r&&!s&&oe(Z1),r&&s},parse:(n,r,s)=>{const u=_e(s);if(u.select=U(u.select)?{type:u.select,toggle:r.toggle}:{...u.select,toggle:r.toggle},yb(r,u),(0,ot.isObject)(s.select)&&(s.select.on||s.select.clear)){const p='event.item && indexof(event.item.mark.role, "legend") < 0';for(const y of r.events)y.filter=vt(y.filter??[]),y.filter.includes(p)||y.filter.push(p)}const c=ou(r.bind)?r.bind.legend:"click",d=U(c)?(0,Eo.P)(c,"view"):vt(c);r.bind={legend:{merge:d}}},topLevelSignals:(n,r,s)=>{const u=r.name,c=ou(r.bind)&&r.bind.legend,d=p=>y=>{const E=_e(y);return E.markname=p,E};for(const p of r.project.items){if(!p.hasLegend)continue;const y=`${Ft(p.field)}_legend`,E=`${u}_${y}`;if(s.filter(F=>F.name===E).length===0){const F=c.merge.map(d(`${y}_symbols`)).concat(c.merge.map(d(`${y}_labels`))).concat(c.merge.map(d(`${y}_entries`)));s.unshift({name:E,...r.init?{}:{value:null},on:[{events:F,update:"isDefined(datum.value) ? datum.value : item().items[0].items[0].datum.value",force:!0},{events:c.merge,update:`!event.item || !datum ? null : ${E}`,force:!0}]})}}return s},signals:(n,r,s)=>{const u=r.name,c=r.project,d=s.find(_=>_.name===u+Si),p=u+du,y=c.items.filter(_=>_.hasLegend).map(_=>Ft(`${u}_${Ft(_.field)}_legend`)),A=`${y.map(_=>`${_} !== null`).join(" && ")} ? {fields: ${p}, values: [${y.join(", ")}]} : null`;r.events&&y.length>0?d.on.push({events:y.map(_=>({signal:_})),update:A}):y.length>0&&(d.update=A,delete d.value,delete d.on);const F=s.find(_=>_.name===u+rc),$=ou(r.bind)&&r.bind.legend;return F&&(r.events?F.on.push({...F.on[0],events:$}):F.on[0].events=$),s}},lb=k0;function GS(n,r,s){const u=n.fieldDef(r)?.field;for(const c of Jt(n.component.selection??{})){const d=c.project.hasField[u]??c.project.hasChannel[r];if(d&&k0.defined(c)){const p=s.get("selections")??[];p.push(c.name),s.set("selections",p,!1),d.hasLegend=!0}}}const cb="_translate_anchor",fb="_translate_delta",db={defined:n=>n.type==="interval"&&n.translate,signals:(n,r,s)=>{const u=r.name,c=Ao.defined(r),d=u+cb,{x:p,y}=r.project.hasChannel;let E=(0,Eo.P)(r.translate,"scope");return c||(E=E.map(A=>(A.between[0].markname=u+Xt,A))),s.push({name:d,value:{},on:[{events:E.map(A=>A.between[0]),update:"{x: x(unit), y: y(unit)"+(p!==void 0?`, extent_x: ${c?Ql(n,wt):`slice(${p.signals.visual})`}`:"")+(y!==void 0?`, extent_y: ${c?Ql(n,Ot):`slice(${y.signals.visual})`}`:"")+"}"}]},{name:u+fb,value:{},on:[{events:E,update:`{x: ${d}.x - x(unit), y: ${d}.y - y(unit)}`}]}),p!==void 0&&hb(n,r,p,"width",s),y!==void 0&&hb(n,r,y,"height",s),s}};function hb(n,r,s,u,c){const d=r.name,p=d+cb,y=d+fb,E=s.channel,A=Ao.defined(r),F=c.find(be=>be.name===s.signals[A?"data":"visual"]),$=n.getSizeSignalRef(u).signal,_=n.getScaleComponent(E),L=_&&_.get("type"),T=_&&_.get("reverse"),B=A?E===wt?T?"":"-":T?"-":"":"",G=`${p}.extent_${E}`,H=`${B}${y}.${E} / ${A?`${$}`:`span(${G})`}`,Z=!A||!_?"panLinear":L==="log"?"panLog":L==="symlog"?"panSymlog":L==="pow"?"panPow":"panLinear",ve=A?L==="pow"?`, ${_.get("exponent")??1}`:L==="symlog"?`, ${_.get("constant")??1}`:"":"",De=`${Z}(${G}, ${H}${ve})`;F.on.push({events:{signal:y},update:A?De:`clampRange(${De}, 0, ${$})`})}const gb="_zoom_anchor",pb="_zoom_delta",WS={defined:n=>n.type==="interval"&&n.zoom,signals:(n,r,s)=>{const u=r.name,c=Ao.defined(r),d=u+pb,{x:p,y}=r.project.hasChannel,E=Ze(n.scaleName(wt)),A=Ze(n.scaleName(Ot));let F=(0,Eo.P)(r.zoom,"scope");return c||(F=F.map($=>($.markname=u+Xt,$))),s.push({name:u+gb,on:[{events:F,update:c?"{"+[E?`x: invert(${E}, x(unit))`:"",A?`y: invert(${A}, y(unit))`:""].filter($=>$).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:d,on:[{events:F,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),p!==void 0&&mb(n,r,p,"width",s),y!==void 0&&mb(n,r,y,"height",s),s}};function mb(n,r,s,u,c){const d=r.name,p=s.channel,y=Ao.defined(r),E=c.find(Z=>Z.name===s.signals[y?"data":"visual"]),A=n.getSizeSignalRef(u).signal,F=n.getScaleComponent(p),$=F&&F.get("type"),_=y?Ql(n,p):E.name,L=d+pb,T=`${d}${gb}.${p}`,B=!y||!F?"zoomLinear":$==="log"?"zoomLog":$==="symlog"?"zoomSymlog":$==="pow"?"zoomPow":"zoomLinear",G=y?$==="pow"?`, ${F.get("exponent")??1}`:$==="symlog"?`, ${F.get("constant")??1}`:"":"",H=`${B}(${_}, ${T}, ${L}${G})`;E.on.push({events:{signal:L},update:y?H:`clampRange(${H}, 0, ${A})`})}const Hi="_store",Si="_tuple",VS="_modify",c3="_selection_domain_",O0="vlSelectionResolve",wd=[NS,LS,Kv,ub,D0,Ao,lb,Rt,db,WS,ab];function HS(n){let r=n.parent;for(;r&&!Fi(r);)r=r.parent;return r}function fa(n,{escape:r}={escape:!0}){let s=r?Ze(n.name):n.name;const u=HS(n);if(u){const{facet:c}=u;for(const d of Jn)c[d]&&(s+=` + '__facet_${d}_' + (facet[${Ze(u.vgField(d))}])`)}return s}function Dd(n){return Jt(n.component.selection??{}).reduce((r,s)=>r||s.project.hasSelectionId,!1)}function yb(n,r){((0,ot.isString)(r.select)||!r.select.on)&&delete n.events,((0,ot.isString)(r.select)||!r.select.clear)&&delete n.clear,((0,ot.isString)(r.select)||!r.select.toggle)&&delete n.toggle}function qr(n){return n.events?.find(r=>"type"in r&&r.type==="timer")}var oc=z(79028);const vb="RawCode",qS="Literal",XS="Property",bb="Identifier",xb="ArrayExpression",YS="BinaryExpression",KS="CallExpression",QS="ConditionalExpression",ZS="LogicalExpression",T0="MemberExpression",Eb="ObjectExpression",JS="UnaryExpression";function qi(n){this.type=n}qi.prototype.visit=function(n){let r,s,u;if(n(this))return 1;for(r=eF(this),s=0,u=r.length;s<u;++s)if(r[s].visit(n))return 1};function eF(n){switch(n.type){case xb:return n.elements;case YS:case ZS:return[n.left,n.right];case KS:return[n.callee].concat(n.arguments);case QS:return[n.test,n.consequent,n.alternate];case T0:return[n.object,n.property];case Eb:return n.properties;case XS:return[n.key,n.value];case JS:return[n.argument];case bb:case qS:case vb:default:return[]}}var Fr,Ee,Q,kn,gt,kd=1,sc=2,da=3,So=4,mu=5,ha=6,ri=7,yu=8,tF=9;Fr={},Fr[kd]="Boolean",Fr[sc]="<end>",Fr[da]="Identifier",Fr[So]="Keyword",Fr[mu]="Null",Fr[ha]="Numeric",Fr[ri]="Punctuator",Fr[yu]="String",Fr[tF]="RegularExpression";var Ab="ArrayExpression",nF="BinaryExpression",iF="CallExpression",rF="ConditionalExpression",Cb="Identifier",oF="Literal",Sb="LogicalExpression",sF="MemberExpression",aF="ObjectExpression",uF="Property",lF="UnaryExpression",nn="Unexpected token %0",R0="Unexpected number",Fb="Unexpected string",wb="Unexpected identifier",Db="Unexpected reserved word",kb="Unexpected end of input",$d="Invalid regular expression",ac="Invalid regular expression: missing /",$b="Octal literals are not allowed in strict mode.",cF="Duplicate data property in object literal not allowed in strict mode",vn="ILLEGAL",uc="Disabled.",Ob=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),fF=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function Od(n,r){if(!n)throw new Error("ASSERT: "+r)}function Fo(n){return n>=48&&n<=57}function N0(n){return"0123456789abcdefABCDEF".includes(n)}function lc(n){return"01234567".includes(n)}function dF(n){return n===32||n===9||n===11||n===12||n===160||n>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].includes(n)}function cc(n){return n===10||n===13||n===8232||n===8233}function fc(n){return n===36||n===95||n>=65&&n<=90||n>=97&&n<=122||n===92||n>=128&&Ob.test(String.fromCharCode(n))}function Td(n){return n===36||n===95||n>=65&&n<=90||n>=97&&n<=122||n>=48&&n<=57||n===92||n>=128&&fF.test(String.fromCharCode(n))}const hF={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function Tb(){for(;Q<kn;){const n=Ee.charCodeAt(Q);if(dF(n)||cc(n))++Q;else break}}function _0(n){var r,s,u,c=0;for(s=n==="u"?4:2,r=0;r<s;++r)Q<kn&&N0(Ee[Q])?(u=Ee[Q++],c=c*16+"0123456789abcdef".indexOf(u.toLowerCase())):Je({},nn,vn);return String.fromCharCode(c)}function gF(){var n,r,s,u;for(n=Ee[Q],r=0,n==="}"&&Je({},nn,vn);Q<kn&&(n=Ee[Q++],!!N0(n));)r=r*16+"0123456789abcdef".indexOf(n.toLowerCase());return(r>1114111||n!=="}")&&Je({},nn,vn),r<=65535?String.fromCharCode(r):(s=(r-65536>>10)+55296,u=(r-65536&1023)+56320,String.fromCharCode(s,u))}function Rb(){var n,r;for(n=Ee.charCodeAt(Q++),r=String.fromCharCode(n),n===92&&(Ee.charCodeAt(Q)!==117&&Je({},nn,vn),++Q,n=_0("u"),(!n||n==="\\"||!fc(n.charCodeAt(0)))&&Je({},nn,vn),r=n);Q<kn&&(n=Ee.charCodeAt(Q),!!Td(n));)++Q,r+=String.fromCharCode(n),n===92&&(r=r.substr(0,r.length-1),Ee.charCodeAt(Q)!==117&&Je({},nn,vn),++Q,n=_0("u"),(!n||n==="\\"||!Td(n.charCodeAt(0)))&&Je({},nn,vn),r+=n);return r}function pF(){var n,r;for(n=Q++;Q<kn;){if(r=Ee.charCodeAt(Q),r===92)return Q=n,Rb();if(Td(r))++Q;else break}return Ee.slice(n,Q)}function mF(){var n,r,s;return n=Q,r=Ee.charCodeAt(Q)===92?Rb():pF(),r.length===1?s=da:hF.hasOwnProperty(r)?s=So:r==="null"?s=mu:r==="true"||r==="false"?s=kd:s=da,{type:s,value:r,start:n,end:Q}}function M0(){var n=Q,r=Ee.charCodeAt(Q),s,u=Ee[Q],c,d,p;switch(r){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++Q,{type:ri,value:String.fromCharCode(r),start:n,end:Q};default:if(s=Ee.charCodeAt(Q+1),s===61)switch(r){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return Q+=2,{type:ri,value:String.fromCharCode(r)+String.fromCharCode(s),start:n,end:Q};case 33:case 61:return Q+=2,Ee.charCodeAt(Q)===61&&++Q,{type:ri,value:Ee.slice(n,Q),start:n,end:Q}}}if(p=Ee.substr(Q,4),p===">>>=")return Q+=4,{type:ri,value:p,start:n,end:Q};if(d=p.substr(0,3),d===">>>"||d==="<<="||d===">>=")return Q+=3,{type:ri,value:d,start:n,end:Q};if(c=d.substr(0,2),u===c[1]&&"+-<>&|".includes(u)||c==="=>")return Q+=2,{type:ri,value:c,start:n,end:Q};if(c==="//"&&Je({},nn,vn),"<>=!+-*%&|^/".includes(u))return++Q,{type:ri,value:u,start:n,end:Q};Je({},nn,vn)}function yF(n){let r="";for(;Q<kn&&N0(Ee[Q]);)r+=Ee[Q++];return r.length===0&&Je({},nn,vn),fc(Ee.charCodeAt(Q))&&Je({},nn,vn),{type:ha,value:parseInt("0x"+r,16),start:n,end:Q}}function B0(n){let r="0"+Ee[Q++];for(;Q<kn&&lc(Ee[Q]);)r+=Ee[Q++];return(fc(Ee.charCodeAt(Q))||Fo(Ee.charCodeAt(Q)))&&Je({},nn,vn),{type:ha,value:parseInt(r,8),octal:!0,start:n,end:Q}}function Nb(){var n,r,s;if(s=Ee[Q],Od(Fo(s.charCodeAt(0))||s===".","Numeric literal must start with a decimal digit or a decimal point"),r=Q,n="",s!=="."){if(n=Ee[Q++],s=Ee[Q],n==="0"){if(s==="x"||s==="X")return++Q,yF(r);if(lc(s))return B0(r);s&&Fo(s.charCodeAt(0))&&Je({},nn,vn)}for(;Fo(Ee.charCodeAt(Q));)n+=Ee[Q++];s=Ee[Q]}if(s==="."){for(n+=Ee[Q++];Fo(Ee.charCodeAt(Q));)n+=Ee[Q++];s=Ee[Q]}if(s==="e"||s==="E")if(n+=Ee[Q++],s=Ee[Q],(s==="+"||s==="-")&&(n+=Ee[Q++]),Fo(Ee.charCodeAt(Q)))for(;Fo(Ee.charCodeAt(Q));)n+=Ee[Q++];else Je({},nn,vn);return fc(Ee.charCodeAt(Q))&&Je({},nn,vn),{type:ha,value:parseFloat(n),start:r,end:Q}}function L0(){var n="",r,s,u,c,d=!1;for(r=Ee[Q],Od(r==="'"||r==='"',"String literal must starts with a quote"),s=Q,++Q;Q<kn;)if(u=Ee[Q++],u===r){r="";break}else if(u==="\\")if(u=Ee[Q++],!u||!cc(u.charCodeAt(0)))switch(u){case"u":case"x":Ee[Q]==="{"?(++Q,n+=gF()):n+=_0(u);break;case"n":n+=`
`;break;case"r":n+="\r";break;case"t":n+="	";break;case"b":n+="\b";break;case"f":n+="\f";break;case"v":n+="\v";break;default:lc(u)?(c="01234567".indexOf(u),c!==0&&(d=!0),Q<kn&&lc(Ee[Q])&&(d=!0,c=c*8+"01234567".indexOf(Ee[Q++]),"0123".includes(u)&&Q<kn&&lc(Ee[Q])&&(c=c*8+"01234567".indexOf(Ee[Q++]))),n+=String.fromCharCode(c)):n+=u;break}else u==="\r"&&Ee[Q]===`
`&&++Q;else{if(cc(u.charCodeAt(0)))break;n+=u}return r!==""&&Je({},nn,vn),{type:yu,value:n,octal:d,start:s,end:Q}}function _b(n,r){let s=n;r.includes("u")&&(s=s.replace(/\\u\{([0-9a-fA-F]+)\}/g,(u,c)=>{if(parseInt(c,16)<=1114111)return"x";Je({},$d)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(s)}catch{Je({},$d)}try{return new RegExp(n,r)}catch{return null}}function Rd(){var n,r,s,u,c;for(n=Ee[Q],Od(n==="/","Regular expression literal must start with a slash"),r=Ee[Q++],s=!1,u=!1;Q<kn;)if(n=Ee[Q++],r+=n,n==="\\")n=Ee[Q++],cc(n.charCodeAt(0))&&Je({},ac),r+=n;else if(cc(n.charCodeAt(0)))Je({},ac);else if(s)n==="]"&&(s=!1);else if(n==="/"){u=!0;break}else n==="["&&(s=!0);return u||Je({},ac),c=r.substr(1,r.length-2),{value:c,literal:r}}function vF(){var n,r,s;for(r="",s="";Q<kn&&(n=Ee[Q],!!Td(n.charCodeAt(0)));)++Q,n==="\\"&&Q<kn?Je({},nn,vn):(s+=n,r+=n);return s.search(/[^gimuy]/g)>=0&&Je({},$d,s),{value:s,literal:r}}function dc(){var n,r,s,u;return gt=null,Tb(),n=Q,r=Rd(),s=vF(),u=_b(r.value,s.value),{literal:r.literal+s.literal,value:u,regex:{pattern:r.value,flags:s.value},start:n,end:Q}}function bF(n){return n.type===da||n.type===So||n.type===kd||n.type===mu}function Xr(){if(Tb(),Q>=kn)return{type:sc,start:Q,end:Q};const n=Ee.charCodeAt(Q);return fc(n)?mF():n===40||n===41||n===59?M0():n===39||n===34?L0():n===46?Fo(Ee.charCodeAt(Q+1))?Nb():M0():Fo(n)?Nb():M0()}function In(){const n=gt;return Q=n.end,gt=Xr(),Q=n.end,n}function Mb(){const n=Q;gt=Xr(),Q=n}function xF(n){const r=new qi(Ab);return r.elements=n,r}function Bb(n,r,s){const u=new qi(n==="||"||n==="&&"?Sb:nF);return u.operator=n,u.left=r,u.right=s,u}function EF(n,r){const s=new qi(iF);return s.callee=n,s.arguments=r,s}function AF(n,r,s){const u=new qi(rF);return u.test=n,u.consequent=r,u.alternate=s,u}function z0(n){const r=new qi(Cb);return r.name=n,r}function vu(n){const r=new qi(oF);return r.value=n.value,r.raw=Ee.slice(n.start,n.end),n.regex&&(r.raw==="//"&&(r.raw="/(?:)/"),r.regex=n.regex),r}function Nd(n,r,s){const u=new qi(sF);return u.computed=n==="[",u.object=r,u.property=s,u.computed||(s.member=!0),u}function CF(n){const r=new qi(aF);return r.properties=n,r}function Lb(n,r,s){const u=new qi(uF);return u.key=r,u.value=s,u.kind=n,u}function zb(n,r){const s=new qi(lF);return s.operator=n,s.argument=r,s.prefix=!0,s}function Je(n,r){var s,u=Array.prototype.slice.call(arguments,2),c=r.replace(/%(\d)/g,(d,p)=>(Od(p<u.length,"Message reference must be in range"),u[p]));throw s=new Error(c),s.index=Q,s.description=c,s}function bu(n){n.type===sc&&Je(n,kb),n.type===ha&&Je(n,R0),n.type===yu&&Je(n,Fb),n.type===da&&Je(n,wb),n.type===So&&Je(n,Db),Je(n,nn,n.value)}function bn(n){const r=In();(r.type!==ri||r.value!==n)&&bu(r)}function ft(n){return gt.type===ri&&gt.value===n}function ms(n){return gt.type===So&&gt.value===n}function I0(){const n=[];for(Q=gt.start,bn("[");!ft("]");)ft(",")?(In(),n.push(null)):(n.push(ga()),ft("]")||bn(","));return In(),xF(n)}function Ib(){Q=gt.start;const n=In();return n.type===yu||n.type===ha?(n.octal&&Je(n,$b),vu(n)):z0(n.value)}function Pb(){var n,r,s,u;if(Q=gt.start,n=gt,n.type===da)return s=Ib(),bn(":"),u=ga(),Lb("init",s,u);if(n.type===sc||n.type===ri)bu(n);else return r=Ib(),bn(":"),u=ga(),Lb("init",r,u)}function SF(){var n=[],r,s,u,c={},d=String;for(Q=gt.start,bn("{");!ft("}");)r=Pb(),r.key.type===Cb?s=r.key.name:s=d(r.key.value),u="$"+s,Object.prototype.hasOwnProperty.call(c,u)?Je({},cF):c[u]=!0,n.push(r),ft("}")||bn(",");return bn("}"),CF(n)}function P0(){bn("(");const n=q0();return bn(")"),n}const U0={if:1};function j0(){var n,r,s;if(ft("("))return P0();if(ft("["))return I0();if(ft("{"))return SF();if(n=gt.type,Q=gt.start,n===da||U0[gt.value])s=z0(In().value);else if(n===yu||n===ha)gt.octal&&Je(gt,$b),s=vu(In());else{if(n===So)throw new Error(uc);n===kd?(r=In(),r.value=r.value==="true",s=vu(r)):n===mu?(r=In(),r.value=null,s=vu(r)):ft("/")||ft("/=")?(s=vu(dc()),Mb()):bu(In())}return s}function FF(){const n=[];if(bn("("),!ft(")"))for(;Q<kn&&(n.push(ga()),!ft(")"));)bn(",");return bn(")"),n}function G0(){Q=gt.start;const n=In();return bF(n)||bu(n),z0(n.value)}function W0(){return bn("."),G0()}function wF(){bn("[");const n=q0();return bn("]"),n}function V0(){var n,r,s;for(n=j0();;)if(ft("."))s=W0(),n=Nd(".",n,s);else if(ft("("))r=FF(),n=EF(n,r);else if(ft("["))s=wF(),n=Nd("[",n,s);else break;return n}function _d(){const n=V0();if(gt.type===ri&&(ft("++")||ft("--")))throw new Error(uc);return n}function Md(){var n,r;if(gt.type!==ri&&gt.type!==So)r=_d();else{if(ft("++")||ft("--"))throw new Error(uc);if(ft("+")||ft("-")||ft("~")||ft("!"))n=In(),r=Md(),r=zb(n.value,r);else{if(ms("delete")||ms("void")||ms("typeof"))throw new Error(uc);r=_d()}}return r}function Bd(n){let r=0;if(n.type!==ri&&n.type!==So)return 0;switch(n.value){case"||":r=1;break;case"&&":r=2;break;case"|":r=3;break;case"^":r=4;break;case"&":r=5;break;case"==":case"!=":case"===":case"!==":r=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":r=7;break;case"<<":case">>":case">>>":r=8;break;case"+":case"-":r=9;break;case"*":case"/":case"%":r=11;break}return r}function H0(){var n,r,s,u,c,d,p,y,E,A;if(n=gt,E=Md(),u=gt,c=Bd(u),c===0)return E;for(u.prec=c,In(),r=[n,gt],p=Md(),d=[E,u,p];(c=Bd(gt))>0;){for(;d.length>2&&c<=d[d.length-2].prec;)p=d.pop(),y=d.pop().value,E=d.pop(),r.pop(),s=Bb(y,E,p),d.push(s);u=In(),u.prec=c,d.push(u),r.push(gt),s=Md(),d.push(s)}for(A=d.length-1,s=d[A],r.pop();A>1;)r.pop(),s=Bb(d[A-1].value,d[A-2],s),A-=2;return s}function ga(){var n,r,s;return n=H0(),ft("?")&&(In(),r=ga(),bn(":"),s=ga(),n=AF(n,r,s)),n}function q0(){const n=ga();if(ft(","))throw new Error(uc);return n}function Ub(n){Ee=n,Q=0,kn=Ee.length,gt=null,Mb();const r=q0();if(gt.type!==sc)throw new Error("Unexpect token after expression.");return r}var DF={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function jb(n){function r(p,y,E,A){let F=n(y[0]);return E&&(F=E+"("+F+")",E.lastIndexOf("new ",0)===0&&(F="("+F+")")),F+"."+p+(A<0?"":A===0?"()":"("+y.slice(1).map(n).join(",")+")")}function s(p,y,E){return A=>r(p,A,y,E)}const u="new Date",c="String",d="RegExp";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",hypot:"Math.hypot",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(p){p.length<3&&error("Missing arguments to clamp function."),p.length>3&&error("Too many arguments to clamp function.");const y=p.map(n);return"Math.max("+y[1]+", Math.min("+y[2]+","+y[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:u,date:s("getDate",u,0),day:s("getDay",u,0),year:s("getFullYear",u,0),month:s("getMonth",u,0),hours:s("getHours",u,0),minutes:s("getMinutes",u,0),seconds:s("getSeconds",u,0),milliseconds:s("getMilliseconds",u,0),time:s("getTime",u,0),timezoneoffset:s("getTimezoneOffset",u,0),utcdate:s("getUTCDate",u,0),utcday:s("getUTCDay",u,0),utcyear:s("getUTCFullYear",u,0),utcmonth:s("getUTCMonth",u,0),utchours:s("getUTCHours",u,0),utcminutes:s("getUTCMinutes",u,0),utcseconds:s("getUTCSeconds",u,0),utcmilliseconds:s("getUTCMilliseconds",u,0),length:s("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:s("toUpperCase",c,0),lower:s("toLowerCase",c,0),substring:s("substring",c),split:s("split",c),trim:s("trim",c,0),regexp:d,test:s("test",d),if:function(p){p.length<3&&error("Missing arguments to if function."),p.length>3&&error("Too many arguments to if function.");const y=p.map(n);return"("+y[0]+"?"+y[1]+":"+y[2]+")"}}}function kF(n){const r=n&&n.length-1;return r&&(n[0]==='"'&&n[r]==='"'||n[0]==="'"&&n[r]==="'")?n.slice(1,-1):n}function f3(n){n=n||{};const r=n.allowed?toSet(n.allowed):{},s=n.forbidden?toSet(n.forbidden):{},u=n.constants||DF,c=(n.functions||jb)($),d=n.globalvar,p=n.fieldvar,y=isFunction(d)?d:T=>`${d}["${T}"]`;let E={},A={},F=0;function $(T){if(isString(T))return T;const B=_[T.type];return B==null&&error("Unsupported type: "+T.type),B(T)}const _={Literal:T=>T.raw,Identifier:T=>{const B=T.name;return F>0?B:hasOwnProperty(s,B)?error("Illegal identifier: "+B):hasOwnProperty(u,B)?u[B]:hasOwnProperty(r,B)?B:(E[B]=1,y(B))},MemberExpression:T=>{const B=!T.computed,G=$(T.object);B&&(F+=1);const H=$(T.property);return G===p&&(A[kF(H)]=1),B&&(F-=1),G+(B?"."+H:"["+H+"]")},CallExpression:T=>{T.callee.type!=="Identifier"&&error("Illegal callee type: "+T.callee.type);const B=T.callee.name,G=T.arguments,H=hasOwnProperty(c,B)&&c[B];return H||error("Unrecognized function: "+B),isFunction(H)?H(G):H+"("+G.map($).join(",")+")"},ArrayExpression:T=>"["+T.elements.map($).join(",")+"]",BinaryExpression:T=>"("+$(T.left)+" "+T.operator+" "+$(T.right)+")",UnaryExpression:T=>"("+T.operator+$(T.argument)+")",ConditionalExpression:T=>"("+$(T.test)+"?"+$(T.consequent)+":"+$(T.alternate)+")",LogicalExpression:T=>"("+$(T.left)+T.operator+$(T.right)+")",ObjectExpression:T=>"{"+T.properties.map($).join(",")+"}",Property:T=>{F+=1;const B=$(T.key);return F-=1,B+":"+$(T.value)}};function L(T){const B={code:$(T),globals:Object.keys(E),fields:Object.keys(A)};return E={},A={},B}return L.functions=c,L.constants=u,L}function Ld(n){const r=[];return n.type==="Identifier"?[n.name]:n.type==="Literal"?[n.value]:(n.type==="MemberExpression"&&(r.push(...Ld(n.object)),r.push(...Ld(n.property))),r)}function Gb(n){return n.object.type==="MemberExpression"?Gb(n.object):n.object.name==="datum"}function Wb(n){const r=Ub(n),s=new Set;return r.visit(u=>{u.type==="MemberExpression"&&Gb(u)&&s.add(Ld(u).slice(1).join("."))}),s}class xu extends qe{clone(){return new xu(null,this.model,_e(this.filter))}constructor(r,s,u){super(r),this.model=s,this.filter=u,this.expr=zd(this.model,this.filter,this),this._dependentFields=Wb(this.expr)}dependentFields(){return this._dependentFields}producedFields(){return new Set}assemble(){return{type:"filter",expr:this.expr}}hash(){return`Filter ${this.expr}`}}function $F(n,r){const s={},u=n.config.selection;if(!r||!r.length)return s;let c=0;for(const d of r){const p=Ft(d.name),y=d.select,E=U(y)?y:y.type,A=We(y)?_e(y):{type:E},F=u[E];for(const L in F)L==="fields"||L==="encodings"||(L==="mark"&&(A.mark={...F.mark,...A.mark}),(A[L]===void 0||A[L]===!0)&&(A[L]=_e(F[L]??A[L])));const $=s[p]={...A,name:p,type:E,init:d.value,bind:d.bind,events:U(A.on)?(0,Eo.P)(A.on,"scope"):vt(_e(A.on))};if(qr($)&&(c++,c>1)){delete s[p];continue}const _=_e(d);for(const L of wd)L.defined($)&&L.parse&&L.parse(n,$,_)}return c>1&&oe(xf),s}function Vb(n,r,s,u="datum"){const c=U(r)?r:r.param,d=Ft(c),p=Ze(d+Hi);let y;try{y=n.getSelectionComponent(d,c)}catch{return`!!${d}`}if(y.project.timeUnit){const _=s??n.component.data.raw,L=y.project.timeUnit.clone();_.parent?L.insertAsParentOf(_):_.parent=L}const E=y.project.hasSelectionId?"vlSelectionIdTest(":"vlSelectionTest(",A=y.resolve==="global"?")":`, ${Ze(y.resolve)})`,F=`${E}${p}, ${u}${A}`,$=`length(data(${p}))`;return r.empty===!1?`${$} && ${F}`:`!${$} || ${F}`}function Hb(n,r,s){const u=Ft(r),c=s.encoding;let d=s.field,p;try{p=n.getSelectionComponent(u,r)}catch{return u}if(!c&&!d)d=p.project.items[0].field,p.project.items.length>1&&oe(Mg(d));else if(c&&!d){const y=p.project.items.filter(E=>E.channel===c);!y.length||y.length>1?(d=p.project.items[0].field,oe(MA(y,c,s,d))):d=y[0].field}return`${p.name}[${Ze(ci(d))}]`}function OF(n,r){for(const[s,u]of er(n.component.selection??{})){const c=n.getName(`lookup_${s}`);n.component.data.outputNodes[c]=u.materialized=new yt(new xu(r,n,{param:s}),c,Ge.Lookup,n.component.data.outputNodeRefCounts)}}function zd(n,r,s){return za(r,u=>U(u)?u:dl(u)?Vb(n,u,s):pl(u))}function TF(n,r){if(n)return pe(n)&&!Zo(n)?n.map(s=>xp(s,r)).join(", "):n}function Id(n,r,s,u){var c,d;n.encode??(n.encode={}),(c=n.encode)[r]??(c[r]={}),(d=n.encode[r]).update??(d.update={}),n.encode[r].update[s]=u}function wo(n,r,s,u={header:!1}){const{disable:c,orient:d,scale:p,labelExpr:y,title:E,zindex:A,...F}=n.combine();if(!c){for(const $ in F){const _=$,L=Cp[_],T=F[_];if(L&&L!==r&&L!=="both")delete F[_];else if(Hr(T)){const{condition:B,...G}=T,H=vt(B),Z=ev[_];if(Z){const{vgProp:ve,part:De}=Z,be=[...H.map($e=>{const{test:Re,...me}=$e;return{test:zd(null,Re),...me}}),G];Id(F,De,ve,be),delete F[_]}else if(Z===null){const ve={signal:H.map(De=>{const{test:be,...$e}=De;return`${zd(null,be)} ? ${Ag($e)} : `}).join("")+Ag(G)};F[_]=ve}}else if(xe(T)){const B=ev[_];if(B){const{vgProp:G,part:H}=B;Id(F,H,G,T),delete F[_]}}Ue(["labelAlign","labelBaseline"],_)&&F[_]===null&&delete F[_]}if(r==="grid"){if(!F.grid)return;if(F.encode){const{grid:$}=F.encode;F.encode={...$?{grid:$}:{}},dt(F.encode)&&delete F.encode}return{scale:p,orient:d,...F,domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:It(A,0)}}else{if(!u.header&&n.mainExtracted)return;if(y!==void 0){let _=y;F.encode?.labels?.update&&xe(F.encode.labels.update.text)&&(_=Mr(y,"datum.label",F.encode.labels.update.text.signal)),Id(F,"labels","text",{signal:_})}if(F.labelAlign===null&&delete F.labelAlign,F.encode){for(const _ of tv)n.hasAxisPart(_)||delete F.encode[_];dt(F.encode)&&delete F.encode}const $=TF(E,s);return{scale:p,orient:d,grid:!1,...$?{title:$}:{},...F,...s.aria===!1?{aria:!1}:{},zindex:It(A,0)}}}}function Pd(n){const{axes:r}=n.component,s=[];for(const u of ur)if(r[u]){for(const c of r[u])if(!c.get("disable")&&!c.get("gridScale")){const d=u==="x"?"height":"width",p=n.getSizeSignalRef(d).signal;d!==p&&s.push({name:d,update:p})}}return s}function RF(n,r){const{x:s=[],y:u=[]}=n;return[...s.map(c=>wo(c,"grid",r)),...u.map(c=>wo(c,"grid",r)),...s.map(c=>wo(c,"main",r)),...u.map(c=>wo(c,"main",r))].filter(c=>c)}function X0(n,r,s,u){return Object.assign.apply(null,[{},...n.map(c=>{if(c==="axisOrient"){const d=s==="x"?"bottom":"left",p=r[s==="x"?"axisBottom":"axisLeft"]||{},y=r[s==="x"?"axisTop":"axisRight"]||{},E=new Set([...te(p),...te(y)]),A={};for(const F of E.values())A[F]={signal:`${u.signal} === "${d}" ? ${cr(p[F])} : ${cr(y[F])}`};return A}return r[c]})])}function Y0(n,r,s,u){const c=r==="band"?["axisDiscrete","axisBand"]:r==="point"?["axisDiscrete","axisPoint"]:Fy(r)?["axisQuantitative"]:r==="time"||r==="utc"?["axisTemporal"]:[],d=n==="x"?"axisX":"axisY",p=xe(s)?"axisOrient":`axis${_s(s)}`,y=[...c,...c.map(A=>d+A.substr(4))],E=["axis",p,d];return{vlOnlyAxisConfig:X0(y,u,n,s),vgAxisConfig:X0(E,u,n,s),axisConfigStyle:NF([...E,...y],u)}}function NF(n,r){const s=[{}];for(const u of n){let c=r[u]?.style;if(c){c=vt(c);for(const d of c)s.push(r.style[d])}}return Object.assign.apply(null,s)}function K0(n,r,s,u={}){const c=q1(n,s,r);if(c!==void 0)return{configFrom:"style",configValue:c};for(const d of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(u[d]?.[n]!==void 0)return{configFrom:d,configValue:u[d][n]};return{}}const Q0={scale:({model:n,channel:r})=>n.scaleName(r),format:({format:n})=>n,formatType:({formatType:n})=>n,grid:({fieldOrDatumDef:n,axis:r,scaleType:s})=>r.grid??_F(s,n),gridScale:({model:n,channel:r})=>MF(n,r),labelAlign:({axis:n,labelAngle:r,orient:s,channel:u})=>n.labelAlign||Xb(r,s,u),labelAngle:({labelAngle:n})=>n,labelBaseline:({axis:n,labelAngle:r,orient:s,channel:u})=>n.labelBaseline||qb(r,s,u),labelFlush:({axis:n,fieldOrDatumDef:r,channel:s})=>n.labelFlush??Yb(r.type,s),labelOverlap:({axis:n,fieldOrDatumDef:r,scaleType:s})=>n.labelOverlap??LF(r.type,s,ae(r)&&!!r.timeUnit,ae(r)?r.sort:void 0),orient:({orient:n})=>n,tickCount:({channel:n,model:r,axis:s,fieldOrDatumDef:u,scaleType:c})=>{const d=n==="x"?"width":n==="y"?"height":void 0,p=d?r.getSizeSignalRef(d):void 0;return s.tickCount??IF({fieldOrDatumDef:u,scaleType:c,size:p,values:s.values})},tickMinStep:PF,title:({axis:n,model:r,channel:s})=>{if(n.title!==void 0)return n.title;const u=Kb(r,s);if(u!==void 0)return u;const c=r.typedFieldDef(s),d=s==="x"?"x2":"y2",p=r.fieldDef(d);return X1(c?[Wf(c)]:[],ae(p)?[Wf(p)]:[])},values:({axis:n,fieldOrDatumDef:r})=>UF(n,r),zindex:({axis:n,fieldOrDatumDef:r,mark:s})=>n.zindex??jF(s,r)};function _F(n,r){return!tn(n)&&ae(r)&&!nt(r?.bin)&&!mn(r?.bin)}function MF(n,r){const s=r==="x"?"y":"x";if(n.getScaleComponent(s))return n.scaleName(s)}function BF(n,r,s,u,c){const d=r?.labelAngle;if(d!==void 0)return xe(d)?d:Qu(d);{const{configValue:p}=K0("labelAngle",u,r?.style,c);return p!==void 0?Qu(p):s===wt&&Ue([vl,yl],n.type)&&!(ae(n)&&n.timeUnit)?270:void 0}}function Z0(n){return`(((${n.signal} % 360) + 360) % 360)`}function qb(n,r,s,u){if(n!==void 0)if(s==="x"){if(xe(n)){const c=Z0(n),d=xe(r)?`(${r.signal} === "top")`:r==="top";return{signal:`(45 < ${c} && ${c} < 135) || (225 < ${c} && ${c} < 315) ? "middle" :(${c} <= 45 || 315 <= ${c}) === ${d} ? "bottom" : "top"`}}if(45<n&&n<135||225<n&&n<315)return"middle";if(xe(r)){const c=n<=45||315<=n?"===":"!==";return{signal:`${r.signal} ${c} "top" ? "bottom" : "top"`}}return(n<=45||315<=n)==(r==="top")?"bottom":"top"}else{if(xe(n)){const c=Z0(n),d=xe(r)?`(${r.signal} === "left")`:r==="left";return{signal:`${c} <= 45 || 315 <= ${c} || (135 <= ${c} && ${c} <= 225) ? ${u?'"middle"':"null"} : (45 <= ${c} && ${c} <= 135) === ${d} ? "top" : "bottom"`}}if(n<=45||315<=n||135<=n&&n<=225)return u?"middle":null;if(xe(r)){const c=45<=n&&n<=135?"===":"!==";return{signal:`${r.signal} ${c} "left" ? "top" : "bottom"`}}return(45<=n&&n<=135)==(r==="left")?"top":"bottom"}}function Xb(n,r,s){if(n===void 0)return;const u=s==="x",c=u?0:90,d=u?"bottom":"left";if(xe(n)){const p=Z0(n),y=xe(r)?`(${r.signal} === "${d}")`:r===d;return{signal:`(${c?`(${p} + 90)`:p} % 180 === 0) ? ${u?null:'"center"'} :(${c} < ${p} && ${p} < ${180+c}) === ${y} ? "left" : "right"`}}if((n+c)%180===0)return u?null:"center";if(xe(r)){const p=c<n&&n<180+c?"===":"!==";return{signal:`${`${r.signal} ${p} "${d}"`} ? "left" : "right"`}}return(c<n&&n<180+c)==(r===d)?"left":"right"}function Yb(n,r){if(r==="x"&&Ue(["quantitative","temporal"],n))return!0}function LF(n,r,s,u){if(s&&!We(u)||n!=="nominal"&&n!=="ordinal")return r==="log"||r==="symlog"?"greedy":!0}function zF(n){return n==="x"?"bottom":"left"}function IF({fieldOrDatumDef:n,scaleType:r,size:s,values:u}){if(!u&&!tn(r)&&r!=="log"){if(ae(n)){if(nt(n.bin))return{signal:`ceil(${s.signal}/10)`};if(n.timeUnit&&Ue(["month","hours","day","quarter"],qt(n.timeUnit)?.unit))return}return{signal:`ceil(${s.signal}/40)`}}}function PF({format:n,fieldOrDatumDef:r}){if(n==="d")return 1;if(ae(r)){const{timeUnit:s}=r;if(s){const u=Qg(s);if(u)return{signal:u}}}}function Kb(n,r){const s=r==="x"?"x2":"y2",u=n.fieldDef(r),c=n.fieldDef(s),d=u?u.title:void 0,p=c?c.title:void 0;if(d&&p)return Fg(d,p);if(d)return d;if(p)return p;if(d!==void 0)return d;if(p!==void 0)return p}function UF(n,r){const s=n.values;if(pe(s))return Ap(r,s);if(xe(s))return s}function jF(n,r){return n==="rect"&&Ja(r)?1:0}class Eu extends qe{clone(){return new Eu(null,_e(this.transform))}constructor(r,s){super(r),this.transform=s,this._dependentFields=Wb(this.transform.calculate)}static parseAllForSortIndex(r,s){return s.forEachFieldDef((u,c)=>{if(ra(u)&&qy(u.sort)){const{field:d,timeUnit:p}=u,y=u.sort,E=y.map((A,F)=>`${pl({field:d,timeUnit:p,equal:A})} ? ${F} : `).join("")+y.length;r=new Eu(r,{calculate:E,as:Au(u,c,{forAs:!0})})}}),r}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return`Calculate ${He(this.transform)}`}}function Au(n,r,s){return le(n,{prefix:r,suffix:"sort_index",...s})}function Cu(n,r){return Ue(["top","bottom"],r)?"column":Ue(["left","right"],r)||n==="row"?"row":"column"}function ys(n,r,s,u){const c=u==="row"?s.headerRow:u==="column"?s.headerColumn:s.headerFacet;return It((r||{})[n],c[n],s.header[n])}function Ud(n,r,s,u){const c={};for(const d of n){const p=ys(d,r||{},s,u);p!==void 0&&(c[d]=p)}return c}const J0=["row","column"],wr=["header","footer"];function GF(n,r){const s=n.component.layoutHeaders[r].title,u=n.config?n.config:void 0,c=n.component.layoutHeaders[r].facetFieldDef?n.component.layoutHeaders[r].facetFieldDef:void 0,{titleAnchor:d,titleAngle:p,titleOrient:y}=Ud(["titleAnchor","titleAngle","titleOrient"],c.header,u,r),E=Cu(r,y),A=Qu(p);return{name:`${r}-title`,type:"group",role:`${E}-title`,title:{text:s,...r==="row"?{orient:"left"}:{},style:"guide-title",...Zb(A,E),...Qb(E,A,d),...jd(u,c,r,aS,Mp)}}}function Qb(n,r,s="middle"){switch(s){case"start":return{align:"left"};case"end":return{align:"right"}}const u=Xb(r,n==="row"?"left":"top",n==="row"?"y":"x");return u?{align:u}:{}}function Zb(n,r){const s=qb(n,r==="row"?"left":"top",r==="row"?"y":"x",!0);return s?{baseline:s}:{}}function em(n,r){const s=n.component.layoutHeaders[r],u=[];for(const c of wr)if(s[c])for(const d of s[c]){const p=nm(n,r,c,s,d);p!=null&&u.push(p)}return u}function tm(n,r){const{sort:s}=n;return yo(s)?{field:le(s,{expr:"datum"}),order:s.order??"ascending"}:pe(s)?{field:Au(n,r,{expr:"datum"}),order:"ascending"}:{field:le(n,{expr:"datum"}),order:s??"ascending"}}function hc(n,r,s){const{format:u,formatType:c,labelAngle:d,labelAnchor:p,labelOrient:y,labelExpr:E}=Ud(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],n.header,s,r),A=fp({fieldOrDatumDef:n,format:u,formatType:c,expr:"parent",config:s}).signal,F=Cu(r,y);return{text:{signal:E?Mr(Mr(E,"datum.label",A),"datum.value",le(n,{expr:"parent"})):A},...r==="row"?{orient:"left"}:{},style:"guide-label",frame:"group",...Zb(d,F),...Qb(F,d,p),...jd(s,n,r,uS,fv)}}function nm(n,r,s,u,c){if(c){let d=null;const{facetFieldDef:p}=u,y=n.config?n.config:void 0;if(p&&c.labels){const{labelOrient:$}=Ud(["labelOrient"],p.header,y,r);(r==="row"&&!Ue(["top","bottom"],$)||r==="column"&&!Ue(["left","right"],$))&&(d=hc(p,r,y))}const E=Fi(n)&&!$l(n.facet),A=c.axes,F=A?.length>0;if(d||F){const $=r==="row"?"height":"width";return{name:n.getName(`${r}_${s}`),type:"group",role:`${r}-${s}`,...u.facetFieldDef?{from:{data:n.getName(`${r}_domain`)},sort:tm(p,r)}:{},...F&&E?{from:{data:n.getName(`facet_domain_${r}`)}}:{},...d?{title:d}:{},...c.sizeSignal?{encode:{update:{[$]:c.sizeSignal}}}:{},...F?{axes:A}:{}}}}return null}const im={column:{start:0,end:1},row:{start:1,end:0}};function Jb(n,r){return im[r][n]}function rm(n,r){const s={};for(const u of Jn){const c=n[u];if(c?.facetFieldDef){const{titleAnchor:d,titleOrient:p}=Ud(["titleAnchor","titleOrient"],c.facetFieldDef.header,r,u),y=Cu(u,p),E=Jb(d,y);E!==void 0&&(s[y]=E)}}return dt(s)?void 0:s}function jd(n,r,s,u,c){const d={};for(const p of u){if(!c[p])continue;const y=ys(p,r?.header,n,s);y!==void 0&&(d[c[p]]=y)}return d}function gc(n){return[...pc(n,"width"),...pc(n,"height"),...pc(n,"childWidth"),...pc(n,"childHeight")]}function pc(n,r){const s=r==="width"?"x":"y",u=n.component.layoutSize.get(r);if(!u||u==="merged")return[];const c=n.getSizeSignalRef(r).signal;if(u==="step"){const d=n.getScaleComponent(s);if(d){const p=d.get("type"),y=d.get("range");if(tn(p)&&Jo(y)){const E=n.scaleName(s);return Fi(n.parent)&&n.parent.component.resolve.scale[s]==="independent"?[Gd(E,y)]:[Gd(E,y),{name:c,update:Wd(E,d,`domain('${E}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}else if(u=="container"){const d=c.endsWith("width"),p=d?"containerSize()[0]":"containerSize()[1]",y=Ul(n.config.view,d?"width":"height"),E=`isFinite(${p}) ? ${p} : ${y}`;return[{name:c,init:E,on:[{update:E,events:"window:resize"}]}]}else return[{name:c,value:u}]}function Gd(n,r){const s=`${n}_step`;return xe(r.step)?{name:s,update:r.step.signal}:{name:s,value:r.step}}function Wd(n,r,s){const u=r.get("type"),c=r.get("padding"),d=It(r.get("paddingOuter"),c);let p=r.get("paddingInner");return p=u==="band"?p!==void 0?p:c:1,`bandspace(${s}, ${cr(p)}, ${cr(d)}) * ${n}_step`}function Vd(n){return n==="childWidth"?"width":n==="childHeight"?"height":n}function ex(n,r){return te(n).reduce((s,u)=>({...s,...hs({model:r,channelDef:n[u],vgChannel:u,mainRefFn:c=>Et(c.value),invalidValueRef:void 0})}),{})}function tx(n,r){if(Fi(r))return n==="theta"?"independent":"shared";if(Qr(r))return"shared";if(wc(r))return Tt(n)||n==="theta"||n==="radius"?"independent":"shared";throw new Error("invalid model type for resolve")}function mc(n,r){const s=n.scale[r],u=Tt(r)?"axis":"legend";return s==="independent"?(n[u][r]==="shared"&&oe(QA(r)),"independent"):n[u][r]||"shared"}const Hd={...gv,disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1},nx=te(Hd);class Do extends Gi{}const $n={symbols:yc,gradient:vs,labels:Dr,entries:WF};function yc(n,{fieldOrDatumDef:r,model:s,channel:u,legendCmpt:c,legendType:d}){if(d!=="symbol")return;const{markDef:p,encoding:y,config:E,mark:A}=s,F=p.filled&&A!=="trail";let $={...Cg({},s,Wr),...b0(s,{filled:F})};const _=c.get("symbolOpacity")??E.legend.symbolOpacity,L=c.get("symbolFillColor")??E.legend.symbolFillColor,T=c.get("symbolStrokeColor")??E.legend.symbolStrokeColor,B=_===void 0?ix(y.opacity)??p.opacity:void 0;if($.fill){if(u==="fill"||F&&u===Gt)delete $.fill;else if(ie($.fill,"field"))L?delete $.fill:($.fill=Et(E.legend.symbolBaseFillColor??"black"),$.fillOpacity=Et(B??1));else if(pe($.fill)){const G=om(y.fill??y.color)??p.fill??(F&&p.color);G&&($.fill=Et(G))}}if($.stroke){if(u==="stroke"||!F&&u===Gt)delete $.stroke;else if(ie($.stroke,"field")||T)delete $.stroke;else if(pe($.stroke)){const G=It(om(y.stroke||y.color),p.stroke,F?p.color:void 0);G&&($.stroke={value:G})}}if(u!==co){const G=ae(r)&&ko(s,c,r);G?$.opacity=[{test:G,...Et(B??1)},Et(E.legend.unselectedOpacity)]:B&&($.opacity=Et(B))}return $={...$,...n},dt($)?void 0:$}function vs(n,{model:r,legendType:s,legendCmpt:u}){if(s!=="gradient")return;const{config:c,markDef:d,encoding:p}=r;let y={};const A=(u.get("gradientOpacity")??c.legend.gradientOpacity)===void 0?ix(p.opacity)||d.opacity:void 0;return A&&(y.opacity=Et(A)),y={...y,...n},dt(y)?void 0:y}function Dr(n,{fieldOrDatumDef:r,model:s,channel:u,legendCmpt:c}){const d=s.legend(u)||{},p=s.config,y=ae(r)?ko(s,c,r):void 0,E=y?[{test:y,value:1},{value:p.legend.unselectedOpacity}]:void 0,{format:A,formatType:F}=d;let $;na(F)?$=mr({fieldOrDatumDef:r,field:"datum.value",format:A,formatType:F,config:p}):A===void 0&&F===void 0&&p.customFormatTypes&&(r.type==="quantitative"&&p.numberFormatType?$=mr({fieldOrDatumDef:r,field:"datum.value",format:p.numberFormat,formatType:p.numberFormatType,config:p}):r.type==="temporal"&&p.timeFormatType&&ae(r)&&r.timeUnit===void 0&&($=mr({fieldOrDatumDef:r,field:"datum.value",format:p.timeFormat,formatType:p.timeFormatType,config:p})));const _={...E?{opacity:E}:{},...$?{text:$}:{},...n};return dt(_)?void 0:_}function WF(n,{legendCmpt:r}){return r.get("selections")?.length?{...n,fill:{value:"transparent"}}:n}function ix(n){return vc(n,(r,s)=>Math.max(r,s.value))}function om(n){return vc(n,(r,s)=>It(r,s.value))}function vc(n,r){if(Ky(n))return vt(n.condition).reduce(r,n.value);if(vr(n))return n.value}function ko(n,r,s){const u=r.get("selections");if(!u?.length)return;const c=Ze(s.field);return u.map(d=>`(!length(data(${Ze(Ft(d)+Hi)})) || (${d}[${c}] && indexof(${d}[${c}], datum.value) >= 0))`).join(" || ")}const rx={direction:({direction:n})=>n,format:({fieldOrDatumDef:n,legend:r,config:s})=>{const{format:u,formatType:c}=r;return Gy(n,n.type,u,c,s,!1)},formatType:({legend:n,fieldOrDatumDef:r,scaleType:s})=>{const{formatType:u}=n;return Wy(u,r,s)},gradientLength:n=>{const{legend:r,legendConfig:s}=n;return r.gradientLength??s.gradientLength??sm(n)},labelOverlap:({legend:n,legendConfig:r,scaleType:s})=>n.labelOverlap??r.labelOverlap??am(s),symbolType:({legend:n,markDef:r,channel:s,encoding:u})=>n.symbolType??HF(r.type,s,u.shape,r.shape),title:({fieldOrDatumDef:n,config:r})=>ss(n,r,{allowDisabling:!0}),type:({legendType:n,scaleType:r,channel:s})=>{if(Us(s)&&pi(r)){if(n==="gradient")return}else if(n==="symbol")return;return n},values:({fieldOrDatumDef:n,legend:r})=>VF(r,n)};function VF(n,r){const s=n.values;if(pe(s))return Ap(r,s);if(xe(s))return s}function HF(n,r,s,u){if(r!=="shape"){const c=om(s)??u;if(c)return c}switch(n){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}function d3(n){if(n==="gradient")return 20}function qF(n){const{legend:r}=n;return It(r.type,XF(n))}function XF({channel:n,timeUnit:r,scaleType:s}){if(Us(n)){if(Ue(["quarter","month","day"],r))return"symbol";if(pi(s))return"gradient"}return"symbol"}function YF({legendConfig:n,legendType:r,orient:s,legend:u}){return u.direction??n[r?"gradientDirection":"symbolDirection"]??ox(s,r)}function ox(n,r){switch(n){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return r==="gradient"?"horizontal":void 0}}function sm({legendConfig:n,model:r,direction:s,orient:u,scaleType:c}){const{gradientHorizontalMaxLength:d,gradientHorizontalMinLength:p,gradientVerticalMaxLength:y,gradientVerticalMinLength:E}=n;if(pi(c))return s==="horizontal"?u==="top"||u==="bottom"?qd(r,"width",p,d):p:qd(r,"height",E,y)}function qd(n,r,s,u){return{signal:`clamp(${n.getSizeSignalRef(r).signal}, ${s}, ${u})`}}function am(n){if(Ue(["quantile","threshold","log","symlog"],n))return"greedy"}function Xd(n){const r=Bt(n)?um(n):ZF(n);return n.component.legends=r,r}function um(n){const{encoding:r}=n,s={};for(const u of[Gt,...hv]){const c=At(r[u]);!c||!n.getScaleComponent(u)||u===Zn&&ae(c)&&c.type===Ks||(s[u]=QF(n,u))}return s}function lm(n,r){const s=n.scaleName(r);if(n.mark==="trail"){if(r==="color")return{stroke:s};if(r==="size")return{strokeWidth:s}}return r==="color"?n.markDef.filled?{fill:s}:{stroke:s}:{[r]:s}}function KF(n,r,s,u){switch(r){case"disable":return s!==void 0;case"values":return!!s?.values;case"title":if(r==="title"&&n===u?.title)return!0}return n===(s||{})[r]}function QF(n,r){let s=n.legend(r);const{markDef:u,encoding:c,config:d}=n,p=d.legend,y=new Do({},lm(n,r));GS(n,r,y);const E=s!==void 0?!s:p.disable;if(y.set("disable",E,s!==void 0),E)return y;s=s||{};const A=n.getScaleComponent(r).get("type"),F=At(c[r]),$=ae(F)?qt(F.timeUnit)?.unit:void 0,_=s.orient||d.legend.orient||"right",L=qF({legend:s,channel:r,timeUnit:$,scaleType:A}),T=YF({legend:s,legendType:L,orient:_,legendConfig:p}),B={legend:s,channel:r,model:n,markDef:u,encoding:c,fieldOrDatumDef:F,legendConfig:p,config:d,scaleType:A,orient:_,legendType:L,direction:T};for(const De of nx){if(L==="gradient"&&De.startsWith("symbol")||L==="symbol"&&De.startsWith("gradient"))continue;const be=De in rx?rx[De](B):s[De];if(be!==void 0){const $e=KF(be,De,s,n.fieldDef(r));($e||d.legend[De]===void 0)&&y.set(De,be,$e)}}const G=s?.encoding??{},H=y.get("selections"),Z={},ve={fieldOrDatumDef:F,model:n,channel:r,legendCmpt:y,legendType:L};for(const De of["labels","legend","title","symbols","gradient","entries"]){const be=ex(G[De]??{},n),$e=De in $n?$n[De](be,ve):be;$e!==void 0&&!dt($e)&&(Z[De]={...H?.length&&ae(F)?{name:`${Ft(F.field)}_legend_${De}`}:{},...H?.length?{interactive:!!H}:{},update:$e})}return dt(Z)||y.set("encode",Z,!!s?.encoding),y}function ZF(n){const{legends:r,resolve:s}=n.component;for(const u of n.children){Xd(u);for(const c of te(u.component.legends))s.legend[c]=mc(n.component.resolve,c),s.legend[c]==="shared"&&(r[c]=sx(r[c],u.component.legends[c]),r[c]||(s.legend[c]="independent",delete r[c]))}for(const u of te(r))for(const c of n.children)c.component.legends[u]&&s.legend[u]==="shared"&&delete c.component.legends[u];return r}function sx(n,r){if(!n)return r.clone();const s=n.getWithExplicit("orient"),u=r.getWithExplicit("orient");if(s.explicit&&u.explicit&&s.value!==u.value)return;let c=!1;for(const d of nx){const p=Ct(n.getWithExplicit(d),r.getWithExplicit(d),d,"legend",(y,E)=>{switch(d){case"symbolType":return JF(y,E);case"title":return gf(y,E);case"type":return c=!0,ni("symbol")}return Xl(y,E,d,"legend")});n.setWithExplicit(d,p)}return c&&(n.implicit?.encode?.gradient&&Xu(n.implicit,["encode","gradient"]),n.explicit?.encode?.gradient&&Xu(n.explicit,["encode","gradient"])),n}function JF(n,r){return r.value==="circle"?r:n}function ew(n,r,s,u){var c,d;n.encode??(n.encode={}),(c=n.encode)[r]??(c[r]={}),(d=n.encode[r]).update??(d.update={}),n.encode[r].update[s]=u}function ax(n){const r=n.component.legends,s={};for(const c of te(r)){const d=n.getScaleComponent(c),p=Se(d.get("domains"));if(s[p])for(const y of s[p])sx(y,r[c])||s[p].push(r[c]);else s[p]=[r[c].clone()]}return Jt(s).flat().map(c=>cm(c,n.config)).filter(c=>c!==void 0)}function cm(n,r){const{disable:s,labelExpr:u,selections:c,...d}=n.combine();if(!s){if(r.aria===!1&&d.aria==null&&(d.aria=!1),d.encode?.symbols){const p=d.encode.symbols.update;p.fill&&p.fill.value!=="transparent"&&!p.stroke&&!d.stroke&&(p.stroke={value:"transparent"});for(const y of hv)d[y]&&delete p[y]}if(d.title||delete d.title,u!==void 0){let p=u;d.encode?.labels?.update&&xe(d.encode.labels.update.text)&&(p=Mr(u,"datum.label",d.encode.labels.update.text.signal)),ew(d,"labels","text",{signal:p})}return d}}function ux(n){return Qr(n)||wc(n)?fm(n):dm(n)}function fm(n){return n.children.reduce((r,s)=>r.concat(s.assembleProjections()),dm(n))}function dm(n){const r=n.component.projection;if(!r||r.merged)return[];const s=r.combine(),{name:u}=s;if(r.data){const c={signal:`[${r.size.map(p=>p.signal).join(", ")}]`},d=r.data.reduce((p,y)=>{const E=xe(y)?y.signal:`data('${n.lookupDataSource(y)}')`;return Ue(p,E)||p.push(E),p},[]);if(d.length<=0)throw new Error("Projection's fit didn't find any data sources");return[{name:u,size:c,fit:{signal:d.length>1?`[${d.join(", ")}]`:d[0]},...s}]}else return[{name:u,translate:{signal:"[width / 2, height / 2]"},...s}]}const hm=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class Yd extends Gi{constructor(r,s,u,c){super({...s},{name:r}),this.specifiedProjection=s,this.size=u,this.data=c,this.merged=!1}get isFit(){return!!this.data}}function lx(n){n.component.projection=Bt(n)?gm(n):nw(n)}function gm(n){if(n.hasProjection){const r=Wt(n.specifiedProjection),s=!(r&&(r.scale!=null||r.translate!=null)),u=s?[n.getSizeSignalRef("width"),n.getSizeSignalRef("height")]:void 0,c=s?tw(n):void 0,d=new Yd(n.projectionName(!0),{...Wt(n.config.projection),...r},u,c);return d.get("type")||d.set("type","equalEarth",!1),d}}function tw(n){const r=[],{encoding:s}=n;for(const u of[[nr,Ri],[Ni,ir]])(At(s[u[0]])||At(s[u[1]]))&&r.push({signal:n.getName(`geojson_${r.length}`)});return n.channelHasField(Zn)&&n.typedFieldDef(Zn).type===Ks&&r.push({signal:n.getName(`geojson_${r.length}`)}),r.length===0&&r.push(n.requestDataName(Ge.Main)),r}function pm(n,r){const s=ng(hm,c=>!!(!tt(n.explicit,c)&&!tt(r.explicit,c)||tt(n.explicit,c)&&tt(r.explicit,c)&&Kn(n.get(c),r.get(c))));if(Kn(n.size,r.size)){if(s)return n;if(Kn(n.explicit,{}))return r;if(Kn(r.explicit,{}))return n}return null}function nw(n){if(n.children.length===0)return;let r;for(const u of n.children)lx(u);const s=ng(n.children,u=>{const c=u.component.projection;if(c)if(r){const d=pm(r,c);return d&&(r=d),!!d}else return r=c,!0;else return!0});if(r&&s){const u=n.projectionName(!0),c=new Yd(u,r.specifiedProjection,r.size,_e(r.data));for(const d of n.children){const p=d.component.projection;p&&(p.isFit&&c.data.push(...d.component.projection.data),d.renameProjection(p.get("name"),u),p.merged=!0)}return c}}function iw(n,r,s,u){if(as(r,s)){const c=Bt(n)?n.axis(s)??n.legend(s)??{}:{},d=le(r,{expr:"datum"}),p=le(r,{expr:"datum",binSuffix:"end"});return{formulaAs:le(r,{binSuffix:"range",forAs:!0}),formula:Dl(d,p,c.format,c.formatType,u)}}return{}}function cx(n,r){return`${Va(n)}_${r}`}function mm(n,r){return{signal:n.getName(`${r}_bins`),extentSignal:n.getName(`${r}_extent`)}}function pa(n,r,s){const u=Ml(s,void 0)??{},c=cx(u,r);return n.getName(`${c}_bins`)}function Kd(n){return"as"in n}function fx(n,r,s){let u,c;Kd(n)?u=U(n.as)?[n.as,`${n.as}_end`]:[n.as[0],n.as[1]]:u=[le(n,{forAs:!0}),le(n,{binSuffix:"end",forAs:!0})];const d={...Ml(r,void 0)},p=cx(d,n.field),{signal:y,extentSignal:E}=mm(s,p);if(sl(d.extent)){const F=d.extent;c=Hb(s,F.param,F),delete d.extent}const A={bin:d,field:n.field,as:[u],...y?{signal:y}:{},...E?{extentSignal:E}:{},...c?{span:c}:{}};return{key:p,binComponent:A}}class Yr extends qe{clone(){return new Yr(null,_e(this.bins))}constructor(r,s){super(r),this.bins=s}static makeFromEncoding(r,s){const u=s.reduceFieldDef((c,d,p)=>{if(Mt(d)&&nt(d.bin)){const{key:y,binComponent:E}=fx(d,d.bin,s);c[y]={...E,...c[y],...iw(s,d,p,s.config)}}return c},{});return dt(u)?null:new Yr(r,u)}static makeFromTransform(r,s,u){const{key:c,binComponent:d}=fx(s,s.bin,u);return new Yr(r,{[c]:d})}merge(r,s){for(const u of te(r.bins))u in this.bins?(s(r.bins[u].signal,this.bins[u].signal),this.bins[u].as=_r([...this.bins[u].as,...r.bins[u].as],He)):this.bins[u]=r.bins[u];for(const u of r.children)r.removeChild(u),u.parent=this;r.remove()}producedFields(){return new Set(Jt(this.bins).map(r=>r.as).flat(2))}dependentFields(){return new Set(Jt(this.bins).map(r=>r.field))}hash(){return`Bin ${He(this.bins)}`}assemble(){return Jt(this.bins).flatMap(r=>{const s=[],[u,...c]=r.as,{extent:d,...p}=r.bin,y={type:"bin",field:ci(r.field),as:u,signal:r.signal,...sl(d)?{extent:null}:{extent:d},...r.span?{span:{signal:`span(${r.span})`}}:{},...p};!d&&r.extentSignal&&(s.push({type:"extent",field:ci(r.field),signal:r.extentSignal}),y.extent={signal:r.extentSignal}),s.push(y);for(const E of c)for(let A=0;A<2;A++)s.push({type:"formula",expr:le({field:u[A]},{expr:"datum"}),as:E[A]});return r.formula&&s.push({type:"formula",expr:r.formula,as:r.formulaAs}),s})}}function rw(n,r,s,u){const c=Bt(u)?u.encoding[Bn(r)]:void 0;if(Mt(s)&&Bt(u)&&ia(s,c,u.markDef,u.config)){n.add(le(s,{})),n.add(le(s,{suffix:"end"}));const{mark:d,markDef:p,config:y}=u,E=ns({fieldDef:s,markDef:p,config:y});El(d)&&E!==.5&&Tt(r)&&(n.add(le(s,{suffix:bd})),n.add(le(s,{suffix:ii}))),s.bin&&as(s,r)&&n.add(le(s,{binSuffix:"range"}))}else if(cg(r)){const d=lg(r);n.add(u.getName(d))}else n.add(le(s));return ra(s)&&rp(s.scale?.range)&&n.add(s.scale.range.field),n}function ow(n,r){for(const s of te(r)){const u=r[s];for(const c of te(u))s in n?n[s][c]=new Set([...n[s][c]??[],...u[c]]):n[s]={[c]:u[c]}}}class kr extends qe{clone(){return new kr(null,new Set(this.dimensions),_e(this.measures))}constructor(r,s,u){super(r),this.dimensions=s,this.measures=u}get groupBy(){return this.dimensions}static makeFromEncoding(r,s){let u=!1;s.forEachFieldDef(p=>{p.aggregate&&(u=!0)});const c={},d=new Set;return!u||(s.forEachFieldDef((p,y)=>{const{aggregate:E,field:A}=p;if(E)if(E==="count")c["*"]??(c["*"]={}),c["*"].count=new Set([le(p,{forAs:!0})]);else{if(fo(E)||Qo(E)){const F=fo(E)?"argmin":"argmax",$=E[F];c[$]??(c[$]={}),c[$][F]=new Set([le({op:F,field:$},{forAs:!0})])}else c[A]??(c[A]={}),c[A][E]=new Set([le(p,{forAs:!0})]);lr(y)&&s.scaleDomain(y)==="unaggregated"&&(c[A]??(c[A]={}),c[A].min=new Set([le({field:A,aggregate:"min"},{forAs:!0})]),c[A].max=new Set([le({field:A,aggregate:"max"},{forAs:!0})]))}else rw(d,y,p,s)}),d.size+te(c).length===0)?null:new kr(r,d,c)}static makeFromTransform(r,s){var u;const c=new Set,d={};for(const p of s.aggregate){const{op:y,field:E,as:A}=p;y&&(y==="count"?(d["*"]??(d["*"]={}),d["*"].count=new Set([A||le(p,{forAs:!0})])):(d[E]??(d[E]={}),(u=d[E])[y]??(u[y]=new Set),d[E][y].add(A||le(p,{forAs:!0}))))}for(const p of s.groupby??[])c.add(p);return c.size+te(d).length===0?null:new kr(r,c,d)}merge(r){return D1(this.dimensions,r.dimensions)?(ow(this.measures,r.measures),!0):(qa("different dimensions, cannot merge"),!1)}addDimensions(r){r.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...te(this.measures)])}producedFields(){const r=new Set;for(const s of te(this.measures))for(const u of te(this.measures[s])){const c=this.measures[s][u];c.size===0?r.add(`${u}_${s}`):c.forEach(r.add,r)}return r}hash(){return`Aggregate ${He({dimensions:this.dimensions,measures:this.measures})}`}assemble(){const r=[],s=[],u=[];for(const d of te(this.measures))for(const p of te(this.measures[d]))for(const y of this.measures[d][p])u.push(y),r.push(p),s.push(d==="*"?null:ci(d));return{type:"aggregate",groupby:[...this.dimensions].map(ci),ops:r,fields:s,as:u}}}class ma extends qe{constructor(r,s,u,c){super(r),this.model=s,this.name=u,this.data=c;for(const d of Jn){const p=s.facet[d];if(p){const{bin:y,sort:E}=p;this[d]={name:s.getName(`${d}_domain`),fields:[le(p),...nt(y)?[le(p,{binSuffix:"end"})]:[]],...yo(E)?{sortField:E}:pe(E)?{sortIndexField:Au(p,d)}:{}}}}this.childModel=s.child}hash(){let r="Facet";for(const s of Jn)this[s]&&(r+=` ${s.charAt(0)}:${He(this[s])}`);return r}get fields(){const r=[];for(const s of Jn)this[s]?.fields&&r.push(...this[s].fields);return r}dependentFields(){const r=new Set(this.fields);for(const s of Jn)this[s]&&(this[s].sortField&&r.add(this[s].sortField.field),this[s].sortIndexField&&r.add(this[s].sortIndexField));return r}producedFields(){return new Set}getSource(){return this.name}getChildIndependentFieldsWithStep(){const r={};for(const s of ur){const u=this.childModel.component.scales[s];if(u&&!u.merged){const c=u.get("type"),d=u.get("range");if(tn(c)&&Jo(d)){const p=Jd(this.childModel,s),y=Yt(p);y?r[s]=y:oe(yf(s))}}}return r}assembleRowColumnHeaderData(r,s,u){const c={row:"y",column:"x",facet:void 0}[r],d=[],p=[],y=[];c&&u&&u[c]&&(s?(d.push(`distinct_${u[c]}`),p.push("max")):(d.push(u[c]),p.push("distinct")),y.push(`distinct_${u[c]}`));const{sortField:E,sortIndexField:A}=this[r];if(E){const{op:F=jf,field:$}=E;d.push($),p.push(F),y.push(le(E,{forAs:!0}))}else A&&(d.push(A),p.push("max"),y.push(A));return{name:this[r].name,source:s??this.data,transform:[{type:"aggregate",groupby:this[r].fields,...d.length?{fields:d,ops:p,as:y}:{}}]}}assembleFacetHeaderData(r){const{columns:s}=this.model.layout,{layoutHeaders:u}=this.model.component,c=[],d={};for(const E of J0){for(const A of wr){const F=(u[E]&&u[E][A])??[];for(const $ of F)if($.axes?.length>0){d[E]=!0;break}}if(d[E]){const A=`length(data("${this.facet.name}"))`,F=E==="row"?s?{signal:`ceil(${A} / ${s})`}:1:s?{signal:`min(${A}, ${s})`}:{signal:A};c.push({name:`${this.facet.name}_${E}`,transform:[{type:"sequence",start:0,stop:F}]})}}const{row:p,column:y}=d;return(p||y)&&c.unshift(this.assembleRowColumnHeaderData("facet",null,r)),c}assemble(){const r=[];let s=null;const u=this.getChildIndependentFieldsWithStep(),{column:c,row:d,facet:p}=this;if(c&&d&&(u.x||u.y)){s=`cross_${this.column.name}_${this.row.name}`;const y=[].concat(u.x??[],u.y??[]),E=y.map(()=>"distinct");r.push({name:s,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:y,ops:E}]})}for(const y of[Br,Oi])this[y]&&r.push(this.assembleRowColumnHeaderData(y,s,u));if(p){const y=this.assembleFacetHeaderData(u);y&&r.push(...y)}return r}}function dx(n){return n.startsWith("'")&&n.endsWith("'")||n.startsWith('"')&&n.endsWith('"')?n.slice(1,-1):n}function sw(n,r){const s=sg(n);if(r==="number")return`toNumber(${s})`;if(r==="boolean")return`toBoolean(${s})`;if(r==="string")return`toString(${s})`;if(r==="date")return`toDate(${s})`;if(r==="flatten")return s;if(r.startsWith("date:")){const u=dx(r.slice(5,r.length));return`timeParse(${s},'${u}')`}else if(r.startsWith("utc:")){const u=dx(r.slice(4,r.length));return`utcParse(${s},'${u}')`}else return oe(LA(r)),null}function ya(n){const r={};return Ba(n.filter,s=>{if(xy(s)){let u=null;ti(s)?u=di(s.equal):Jg(s)?u=di(s.lte):hl(s)?u=di(s.lt):ep(s)?u=di(s.gt):gl(s)?u=di(s.gte):Of(s)?u=s.range[0]:tp(s)&&(u=(s.oneOf??s.in)[0]),u&&(fr(u)?r[s.field]="date":j(u)?r[s.field]="number":U(u)&&(r[s.field]="string")),s.timeUnit&&(r[s.field]="date")}}),r}function aw(n){const r={};function s(u){Dn(u)?r[u.field]="date":u.type==="quantitative"&&wA(u.aggregate)?r[u.field]="number":Ms(u.field)>1?u.field in r||(r[u.field]="flatten"):ra(u)&&yo(u.sort)&&Ms(u.sort.field)>1&&(u.sort.field in r||(r[u.sort.field]="flatten"))}if((Bt(n)||Fi(n))&&n.forEachFieldDef((u,c)=>{if(Mt(u))s(u);else{const d=sr(c),p=n.fieldDef(d);s({...u,type:p.type})}}),Bt(n)){const{mark:u,markDef:c,encoding:d}=n;if(es(u)&&!n.encoding.order){const p=c.orient==="horizontal"?"y":"x",y=d[p];ae(y)&&y.type==="quantitative"&&!(y.field in r)&&(r[y.field]="number")}}return r}function hx(n){const r={};if(Bt(n)&&n.component.selection)for(const s of te(n.component.selection)){const u=n.component.selection[s];for(const c of u.project.items)!c.channel&&Ms(c.field)>1&&(r[c.field]="flatten")}return r}class On extends qe{clone(){return new On(null,_e(this._parse))}constructor(r,s){super(r),this._parse=s}hash(){return`Parse ${He(this._parse)}`}static makeExplicit(r,s,u){let c={};const d=s.data;return!cs(d)&&d?.format?.parse&&(c=d.format.parse),this.makeWithAncestors(r,c,{},u)}static makeWithAncestors(r,s,u,c){for(const y of te(u)){const E=c.getWithExplicit(y);E.value!==void 0&&(E.explicit||E.value===u[y]||E.value==="derived"||u[y]==="flatten"?delete u[y]:oe(Ef(y,u[y],E.value)))}for(const y of te(s)){const E=c.get(y);E!==void 0&&(E===s[y]?delete s[y]:oe(Ef(y,s[y],E)))}const d=new Gi(s,u);c.copyAll(d);const p={};for(const y of te(d.combine())){const E=d.get(y);E!==null&&(p[y]=E)}return te(p).length===0||c.parseNothing?null:new On(r,p)}get parse(){return this._parse}merge(r){this._parse={...this._parse,...r.parse},r.remove()}assembleFormatParse(){const r={};for(const s of te(this._parse)){const u=this._parse[s];Ms(s)===1&&(r[s]=u)}return r}producedFields(){return new Set(te(this._parse))}dependentFields(){return new Set(te(this._parse))}assembleTransforms(r=!1){return te(this._parse).filter(s=>r?Ms(s)>1:!0).map(s=>{const u=sw(s,this._parse[s]);return u?{type:"formula",expr:u,as:Wo(s)}:null}).filter(s=>s!==null)}}class Kr extends qe{clone(){return new Kr(null)}constructor(r){super(r)}dependentFields(){return new Set}producedFields(){return new Set([Ii])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:Ii}}}class bc extends qe{clone(){return new bc(null,this.params)}constructor(r,s){super(r),this.params=s}dependentFields(){return new Set}producedFields(){}hash(){return`Graticule ${He(this.params)}`}assemble(){return{type:"graticule",...this.params===!0?{}:this.params}}}class xc extends qe{clone(){return new xc(null,this.params)}constructor(r,s){super(r),this.params=s}dependentFields(){return new Set}producedFields(){return new Set([this.params.as??"data"])}hash(){return`Hash ${He(this.params)}`}assemble(){return{type:"sequence",...this.params}}}class va extends qe{constructor(r){super(null),r??(r={name:"source"});let s;if(cs(r)||(s=r.format?{...Yn(r.format,["parse"])}:{}),Yl(r))this._data={values:r.values};else if(ua(r)){if(this._data={url:r.url},!s.type){let u=/(?:\.([^.]+))?$/.exec(r.url)[1];Ue(["json","csv","tsv","dsv","topojson"],u)||(u="json"),s.type=u}}else Hv(r)?this._data={values:[{type:"Sphere"}]}:(Vv(r)||cs(r))&&(this._data={});this._generator=cs(r),r.name&&(this._name=r.name),s&&!dt(s)&&(this._data.format=s)}dependentFields(){return new Set}producedFields(){}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(r){this._name=r}set parent(r){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return{name:this._name,...this._data,transform:[]}}}var Su=function(n,r,s,u,c){if(u==="m")throw new TypeError("Private method is not writable");if(u==="a"&&!c)throw new TypeError("Private accessor was defined without a setter");if(typeof r=="function"?n!==r||!c:!r.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return u==="a"?c.call(n,s):c?c.value=s:r.set(n,s),s},uw=function(n,r,s,u){if(s==="a"&&!u)throw new TypeError("Private accessor was defined without a getter");if(typeof r=="function"?n!==r||!u:!r.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return s==="m"?u:s==="a"?u.call(n):u?u.value:r.get(n)},Ec;function Fu(n){return n instanceof va||n instanceof bc||n instanceof xc}class Qd{constructor(){Ec.set(this,void 0),Su(this,Ec,!1,"f")}setModified(){Su(this,Ec,!0,"f")}get modifiedFlag(){return uw(this,Ec,"f")}}Ec=new WeakMap;class bs extends Qd{getNodeDepths(r,s,u){u.set(r,s);for(const c of r.children)this.getNodeDepths(c,s+1,u);return u}optimize(r){const u=[...this.getNodeDepths(r,0,new Map).entries()].sort((c,d)=>d[1]-c[1]);for(const c of u)this.run(c[0]);return this.modifiedFlag}}class ym extends Qd{optimize(r){this.run(r);for(const s of r.children)this.optimize(s);return this.modifiedFlag}}class lw extends ym{mergeNodes(r,s){const u=s.shift();for(const c of s)r.removeChild(c),c.parent=u,c.remove()}run(r){const s=r.children.map(c=>c.hash()),u={};for(let c=0;c<s.length;c++)u[s[c]]===void 0?u[s[c]]=[r.children[c]]:u[s[c]].push(r.children[c]);for(const c of te(u))u[c].length>1&&(this.setModified(),this.mergeNodes(r,u[c]))}}class vm extends ym{constructor(r){super(),this.requiresSelectionId=r&&Dd(r)}run(r){r instanceof Kr&&(this.requiresSelectionId&&(Fu(r.parent)||r.parent instanceof kr||r.parent instanceof On)||(this.setModified(),r.remove()))}}class bm extends Qd{optimize(r){return this.run(r,new Set),this.modifiedFlag}run(r,s){let u=new Set;r instanceof Ar&&(u=r.producedFields(),ig(u,s)&&(this.setModified(),r.removeFormulas(s),r.producedFields.length===0&&r.remove()));for(const c of r.children)this.run(c,new Set([...s,...u]))}}class cw extends ym{constructor(){super()}run(r){r instanceof yt&&!r.isRequired()&&(this.setModified(),r.remove())}}class ba extends bs{run(r){if(!Fu(r)&&!(r.numChildren()>1)){for(const s of r.children)if(s instanceof On)if(r instanceof On)this.setModified(),r.merge(s);else{if(og(r.producedFields(),s.dependentFields()))continue;this.setModified(),s.swapWithParent()}}}}class fw extends bs{run(r){const s=[...r.children],u=r.children.filter(c=>c instanceof On);if(r.numChildren()>1&&u.length>=1){const c={},d=new Set;for(const p of u){const y=p.parse;for(const E of te(y))E in c?c[E]!==y[E]&&d.add(E):c[E]=y[E]}for(const p of d)delete c[p];if(!dt(c)){this.setModified();const p=new On(r,c);for(const y of s){if(y instanceof On)for(const E of te(c))delete y.parse[E];r.removeChild(y),y.parent=p,y instanceof On&&te(y.parse).length===0&&y.remove()}}}}}class dw extends bs{run(r){r instanceof yt||r.numChildren()>0||r instanceof ma||r instanceof va||(this.setModified(),r.remove())}}class hw extends bs{run(r){const s=r.children.filter(c=>c instanceof Ar),u=s.pop();for(const c of s)this.setModified(),u.merge(c)}}class gw extends bs{run(r){const s=r.children.filter(c=>c instanceof kr),u={};for(const c of s){const d=He(c.groupBy);d in u||(u[d]=[]),u[d].push(c)}for(const c of te(u)){const d=u[c];if(d.length>1){const p=d.pop();for(const y of d)p.merge(y)&&(r.removeChild(y),y.parent=p,y.remove(),this.setModified())}}}}class gx extends bs{constructor(r){super(),this.model=r}run(r){const s=!(Fu(r)||r instanceof xu||r instanceof On||r instanceof Kr),u=[],c=[];for(const d of r.children)d instanceof Yr&&(s&&!og(r.producedFields(),d.dependentFields())?u.push(d):c.push(d));if(u.length>0){const d=u.pop();for(const p of u)d.merge(p,this.model.renameSignal.bind(this.model));this.setModified(),r instanceof Yr?r.merge(d,this.model.renameSignal.bind(this.model)):d.swapWithParent()}if(c.length>1){const d=c.pop();for(const p of c)d.merge(p,this.model.renameSignal.bind(this.model));this.setModified()}}}class pw extends bs{run(r){const s=[...r.children];if(!La(s,p=>p instanceof yt)||r.numChildren()<=1)return;const c=[];let d;for(const p of s)if(p instanceof yt){let y=p;for(;y.numChildren()===1;){const[E]=y.children;if(E instanceof yt)y=E;else break}c.push(...y.children),d?(r.removeChild(p),p.parent=d.parent,d.parent.removeChild(d),d.parent=y,this.setModified()):d=y}else c.push(p);if(c.length){this.setModified();for(const p of c)p.parent.removeChild(p),p.parent=d}}}class xa extends qe{clone(){return new xa(null,_e(this.transform))}constructor(r,s){super(r),this.transform=s}addDimensions(r){this.transform.groupby=_r(this.transform.groupby.concat(r),s=>s)}dependentFields(){const r=new Set;return this.transform.groupby&&this.transform.groupby.forEach(r.add,r),this.transform.joinaggregate.map(s=>s.field).filter(s=>s!==void 0).forEach(r.add,r),r}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(r){return r.as??le(r)}hash(){return`JoinAggregateTransform ${He(this.transform)}`}assemble(){const r=[],s=[],u=[];for(const d of this.transform.joinaggregate)s.push(d.op),u.push(this.getDefaultName(d)),r.push(d.field===void 0?null:d.field);const c=this.transform.groupby;return{type:"joinaggregate",as:u,ops:s,fields:r,...c!==void 0?{groupby:c}:{}}}}class wu extends qe{clone(){return new wu(null,{...this.filter})}constructor(r,s){super(r),this.filter=s}static make(r,s,u){const{config:c,markDef:d}=s,{marks:p,scales:y}=u;if(p==="include-invalid-values"&&y==="include-invalid-values")return null;const E=s.reduceFieldDef((A,F,$)=>{const _=lr($)&&s.getScaleComponent($);if(_){const L=_.get("type"),{aggregate:T}=F,B=Vr({scaleChannel:$,markDef:d,config:c,scaleType:L,isCountAggregate:cf(T)});B!=="show"&&B!=="always-valid"&&(A[F.field]=F)}return A},{});return te(E).length?new wu(r,E):null}dependentFields(){return new Set(te(this.filter))}producedFields(){return new Set}hash(){return`FilterInvalid ${He(this.filter)}`}assemble(){const r=te(this.filter).reduce((s,u)=>{const c=this.filter[u],d=le(c,{expr:"datum"});return c!==null&&(c.type==="temporal"?s.push(`(isDate(${d}) || (${xm(d)}))`):c.type==="quantitative"&&s.push(xm(d))),s},[]);return r.length>0?{type:"filter",expr:r.join(" && ")}:null}}function xm(n){return`isValid(${n}) && isFinite(+${n})`}function mw(n){return n.stack.stackBy.reduce((r,s)=>{const u=s.fieldDef,c=le(u);return c&&r.push(c),r},[])}function $r(n){return pe(n)&&n.every(r=>U(r))&&n.length>1}class $o extends qe{clone(){return new $o(null,_e(this._stack))}constructor(r,s){super(r),this._stack=s}static makeFromTransform(r,s){const{stack:u,groupby:c,as:d,offset:p="zero"}=s,y=[],E=[];if(s.sort!==void 0)for(const $ of s.sort)y.push($.field),E.push(It($.order,"ascending"));const A={field:y,order:E};let F;return $r(d)?F=d:U(d)?F=[d,`${d}_end`]:F=[`${s.stack}_start`,`${s.stack}_end`],new $o(r,{dimensionFieldDefs:[],stackField:u,groupby:c,offset:p,sort:A,facetby:[],as:F})}static makeFromEncoding(r,s){const u=s.stack,{encoding:c}=s;if(!u)return null;const{groupbyChannels:d,fieldChannel:p,offset:y,impute:E}=u,A=d.map(L=>{const T=c[L];return Li(T)}).filter(L=>!!L),F=mw(s),$=s.encoding.order;let _;if(pe($)||ae($))_=Sg($);else{const L=Yy($)?$.sort:p==="y"?"descending":"ascending";_=F.reduce((T,B)=>(T.field.includes(B)||(T.field.push(B),T.order.push(L)),T),{field:[],order:[]})}return new $o(r,{dimensionFieldDefs:A,stackField:s.vgField(p),facetby:[],stackby:F,sort:_,offset:y,impute:E,as:[s.vgField(p,{suffix:"start",forAs:!0}),s.vgField(p,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(r){this._stack.facetby.push(...r)}dependentFields(){const r=new Set;return r.add(this._stack.stackField),this.getGroupbyFields().forEach(r.add,r),this._stack.facetby.forEach(r.add,r),this._stack.sort.field.forEach(r.add,r),r}producedFields(){return new Set(this._stack.as)}hash(){return`Stack ${He(this._stack)}`}getGroupbyFields(){const{dimensionFieldDefs:r,impute:s,groupby:u}=this._stack;return r.length>0?r.map(c=>c.bin?s?[le(c,{binSuffix:"mid"})]:[le(c,{}),le(c,{binSuffix:"end"})]:[le(c)]).flat():u??[]}assemble(){const r=[],{facetby:s,dimensionFieldDefs:u,stackField:c,stackby:d,sort:p,offset:y,impute:E,as:A}=this._stack;if(E)for(const F of u){const{bandPosition:$=.5,bin:_}=F;if(_){const L=le(F,{expr:"datum"}),T=le(F,{expr:"datum",binSuffix:"end"});r.push({type:"formula",expr:`${xm(L)} ? ${$}*${L}+${1-$}*${T} : ${L}`,as:le(F,{binSuffix:"mid",forAs:!0})})}r.push({type:"impute",field:c,groupby:[...d,...s],key:le(F,{binSuffix:"mid"}),method:"value",value:0})}return r.push({type:"stack",groupby:[...this.getGroupbyFields(),...s],field:c,sort:p,as:A,offset:y}),r}}class Pn extends qe{clone(){return new Pn(null,_e(this.transform))}constructor(r,s){super(r),this.transform=s}addDimensions(r){this.transform.groupby=_r(this.transform.groupby.concat(r),s=>s)}dependentFields(){const r=new Set;return(this.transform.groupby??[]).forEach(r.add,r),(this.transform.sort??[]).forEach(s=>r.add(s.field)),this.transform.window.map(s=>s.field).filter(s=>s!==void 0).forEach(r.add,r),r}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(r){return r.as??le(r)}hash(){return`WindowTransform ${He(this.transform)}`}assemble(){const r=[],s=[],u=[],c=[];for(const $ of this.transform.window)s.push($.op),u.push(this.getDefaultName($)),c.push($.param===void 0?null:$.param),r.push($.field===void 0?null:$.field);const d=this.transform.frame,p=this.transform.groupby;if(d&&d[0]===null&&d[1]===null&&s.every($=>xg($)))return{type:"joinaggregate",as:u,ops:s,fields:r,...p!==void 0?{groupby:p}:{}};const y=[],E=[];if(this.transform.sort!==void 0)for(const $ of this.transform.sort)y.push($.field),E.push($.order??"ascending");const A={field:y,order:E},F=this.transform.ignorePeers;return{type:"window",params:c,as:u,ops:s,fields:r,sort:A,...F!==void 0?{ignorePeers:F}:{},...p!==void 0?{groupby:p}:{},...d!==void 0?{frame:d}:{}}}}function Ae(n){function r(s){if(!(s instanceof ma)){const u=s.clone();if(u instanceof yt){const c=st+u.getSource();u.setSource(c),n.model.component.data.outputNodes[c]=u}else(u instanceof kr||u instanceof $o||u instanceof Pn||u instanceof xa)&&u.addDimensions(n.fields);for(const c of s.children.flatMap(r))c.parent=u;return[u]}return s.children.flatMap(r)}return r}function Y(n){if(n instanceof ma)if(n.numChildren()===1&&!(n.children[0]instanceof yt)){const r=n.children[0];(r instanceof kr||r instanceof $o||r instanceof Pn||r instanceof xa)&&r.addDimensions(n.fields),r.swapWithParent(),Y(n)}else{const r=n.model.component.data.main;xn(r);const s=Ae(n),u=n.children.map(s).flat();for(const c of u)c.parent=r}else n.children.map(Y)}function xn(n){if(n instanceof yt&&n.type===Ge.Main&&n.numChildren()===1){const r=n.children[0];r instanceof ma||(r.swapWithParent(),xn(n))}}const st="scale_",Ea=5;function Aa(n){for(const r of n){for(const s of r.children)if(s.parent!==r)return!1;if(!Aa(r.children))return!1}return!0}function En(n,r){let s=!1;for(const u of r)s=n.optimize(u)||s;return s}function Oo(n,r,s){let u=n.sources,c=!1;return c=En(new cw,u)||c,c=En(new vm(r),u)||c,u=u.filter(d=>d.numChildren()>0),c=En(new dw,u)||c,u=u.filter(d=>d.numChildren()>0),s||(c=En(new ba,u)||c,c=En(new gx(r),u)||c,c=En(new bm,u)||c,c=En(new fw,u)||c,c=En(new gw,u)||c,c=En(new hw,u)||c,c=En(new lw,u)||c,c=En(new pw,u)||c),n.sources=u,c}function Zd(n,r){Aa(n.sources);let s=0,u=0;for(let c=0;c<Ea&&Oo(n,r,!0);c++)s++;n.sources.map(Y);for(let c=0;c<Ea&&Oo(n,r,!1);c++)u++;Aa(n.sources),Math.max(s,u)===Ea&&oe(`Maximum optimization runs(${Ea}) reached.`)}class Nt{constructor(r){Object.defineProperty(this,"signal",{enumerable:!0,get:r})}static fromName(r,s){return new Nt(()=>r(s))}}function Un(n){Bt(n)?Ac(n):yw(n)}function Ac(n){const r=n.component.scales;for(const s of te(r)){const u=bw(n,s);if(r[s].setWithExplicit("domains",u),Ew(n,s),n.component.data.isFaceted){let d=n;for(;!Fi(d)&&d.parent;)d=d.parent;if(d.component.resolve.scale[s]==="shared")for(const y of u.value)go(y)&&(y.data=st+y.data.replace(st,""))}}}function yw(n){for(const s of n.children)Un(s);const r=n.component.scales;for(const s of te(r)){let u,c=null;for(const d of n.children){const p=d.component.scales[s];if(p){u===void 0?u=p.getWithExplicit("domains"):u=Ct(u,p.getWithExplicit("domains"),"domains","scale",Cm);const y=p.get("selectionExtent");c&&y&&c.param!==y.param&&oe(Og),c=y}}r[s].setWithExplicit("domains",u),c&&r[s].set("selectionExtent",c,!0)}}function vw(n,r,s,u){if(n==="unaggregated"){const{valid:c,reason:d}=px(r,s);if(!c){oe(d);return}}else if(n===void 0&&u.useUnaggregatedDomain){const{valid:c}=px(r,s);if(c)return"unaggregated"}return n}function bw(n,r){const s=n.getScaleComponent(r).get("type"),{encoding:u}=n,c=vw(n.scaleDomain(r),n.typedFieldDef(r),s,n.config.scale);return c!==n.scaleDomain(r)&&(n.specifiedScales[r]={...n.specifiedScales[r],domain:c}),r==="x"&&At(u.x2)?At(u.x)?Ct(To(s,c,n,"x"),To(s,c,n,"x2"),"domain","scale",Cm):To(s,c,n,"x2"):r==="y"&&At(u.y2)?At(u.y)?Ct(To(s,c,n,"y"),To(s,c,n,"y2"),"domain","scale",Cm):To(s,c,n,"y2"):To(s,c,n,r)}function xw(n,r,s){return n.map(u=>({signal:`{data: ${Yf(u,{timeUnit:s,type:r})}}`}))}function Em(n,r,s){const u=qt(s)?.unit;return r==="temporal"||u?xw(n,r,u):[n]}function To(n,r,s,u){const{encoding:c,markDef:d,mark:p,config:y,stack:E}=s,A=At(c[u]),{type:F}=A,$=A.timeUnit,_=Kl({invalid:Pr("invalid",d,y),isPath:es(p)});if(wC(r)){const B=To(n,void 0,s,u),G=Em(r.unionWith,F,$);return Ai([...G,...B.value])}else{if(xe(r))return Ai([r]);if(r&&r!=="unaggregated"&&!ky(r))return Ai(Em(r,F,$))}if(E&&u===E.fieldChannel){if(E.offset==="normalize")return ni([[0,1]]);const B=s.requestDataName(_);return ni([{data:B,field:s.vgField(u,{suffix:"start"})},{data:B,field:s.vgField(u,{suffix:"end"})}])}const L=lr(u)&&ae(A)?Aw(s,u,n):void 0;if(yi(A)){const B=Em([A.datum],F,$);return ni(B)}const T=A;if(r==="unaggregated"){const{field:B}=A;return ni([{data:s.requestDataName(_),field:le({field:B,aggregate:"min"})},{data:s.requestDataName(_),field:le({field:B,aggregate:"max"})}])}else if(nt(T.bin)){if(tn(n))return ni(n==="bin-ordinal"?[]:[{data:qu(L)?s.requestDataName(_):s.requestDataName(Ge.Raw),field:s.vgField(u,as(T,u)?{binSuffix:"range"}:{}),sort:L===!0||!We(L)?{field:s.vgField(u,{}),op:"min"}:L}]);{const{bin:B}=T;if(nt(B)){const G=pa(s,T.field,B);return ni([new Nt(()=>{const H=s.getSignalName(G);return`[${H}.start, ${H}.stop]`})])}else return ni([{data:s.requestDataName(_),field:s.vgField(u,{})}])}}else if(T.timeUnit&&Ue(["time","utc"],n)){const B=c[Bn(u)];if(ia(T,B,d,y)){const G=s.requestDataName(_),H=ns({fieldDef:T,fieldDef2:B,markDef:d,config:y}),Z=El(p)&&H!==.5&&Tt(u);return ni([{data:G,field:s.vgField(u,Z?{suffix:bd}:{})},{data:G,field:s.vgField(u,{suffix:Z?ii:"end"})}])}}return ni(L?[{data:qu(L)?s.requestDataName(_):s.requestDataName(Ge.Raw),field:s.vgField(u),sort:L}]:[{data:s.requestDataName(_),field:s.vgField(u)}])}function Am(n,r){const{op:s,field:u,order:c}=n;return{op:s??(r?"sum":jf),...u?{field:ci(u)}:{},...c?{order:c}:{}}}function Ew(n,r){const s=n.component.scales[r],u=n.specifiedScales[r].domain,c=n.fieldDef(r)?.bin,d=ky(u)?u:void 0,p=ho(c)&&sl(c.extent)?c.extent:void 0;(d||p)&&s.set("selectionExtent",d??p,!0)}function Aw(n,r,s){if(!tn(s))return;const u=n.fieldDef(r),c=u.sort;if(qy(c))return{op:"min",field:Au(u,r),order:"ascending"};const{stack:d}=n,p=d?new Set([...d.groupbyFields,...d.stackBy.map(y=>y.fieldDef.field)]):void 0;if(yo(c)){const y=d&&!p.has(c.field);return Am(c,y)}else if(WC(c)){const{encoding:y,order:E}=c,A=n.fieldDef(y),{aggregate:F,field:$}=A,_=d&&!p.has($);if(fo(F)||Qo(F))return Am({field:le(A),order:E},_);if(xg(F)||!F)return Am({op:F,field:$,order:E},_)}else{if(c==="descending")return{op:"min",field:n.vgField(r),order:"descending"};if(Ue(["ascending",void 0],c))return!0}}function px(n,r){const{aggregate:s,type:u}=n;return s?U(s)&&!kA.has(s)?{valid:!1,reason:HA(s)}:u==="quantitative"&&r==="log"?{valid:!1,reason:cl(n)}:{valid:!0}:{valid:!1,reason:ly(n)}}function Cm(n,r,s,u){return n.explicit&&r.explicit&&oe(KA(s,u,n.value,r.value)),{explicit:n.explicit,value:[...n.value,...r.value]}}function Cw(n){const r=_r(n.map(p=>{if(go(p)){const{sort:y,...E}=p;return E}return p}),He),s=_r(n.map(p=>{if(go(p)){const y=p.sort;return y!==void 0&&!qu(y)&&("op"in y&&y.op==="count"&&delete y.field,y.order==="ascending"&&delete y.order),y}}).filter(p=>p!==void 0),He);if(r.length===0)return;if(r.length===1){const p=n[0];if(go(p)&&s.length>0){let y=s[0];if(s.length>1){oe(fy);const E=s.filter(A=>We(A)&&"op"in A&&A.op!=="min");s.every(A=>We(A)&&"op"in A)&&E.length===1?y=E[0]:y=!0}else if(We(y)&&"field"in y){const E=y.field;p.field===E&&(y=y.order?{order:y.order}:!0)}return{...p,sort:y}}return p}const u=_r(s.map(p=>qu(p)||!("op"in p)||U(p.op)&&tt(FA,p.op)?p:(oe(ZA(p)),!0)),He);let c;u.length===1?c=u[0]:u.length>1&&(oe(fy),c=!0);const d=_r(n.map(p=>go(p)?p.data:null),p=>p);return d.length===1&&d[0]!==null?{data:d[0],fields:r.map(y=>y.field),...c?{sort:c}:{}}:{fields:r,...c?{sort:c}:{}}}function Yt(n){if(go(n)&&U(n.field))return n.field;if($A(n)){let r;for(const s of n.fields)if(go(s)&&U(s.field)){if(!r)r=s.field;else if(r!==s.field)return oe(JA),r}return oe(eC),r}else if(OA(n)){oe(tC);const r=n.fields[0];return U(r)?r:void 0}}function Jd(n,r){const u=n.component.scales[r].get("domains").map(c=>(go(c)&&(c.data=n.lookupDataSource(c.data)),c));return Cw(u)}function mx(n){return Qr(n)||wc(n)?n.children.reduce((r,s)=>r.concat(mx(s)),yx(n)):yx(n)}function yx(n){return te(n.component.scales).reduce((r,s)=>{const u=n.component.scales[s];if(u.merged)return r;const c=u.combine(),{name:d,type:p,selectionExtent:y,domains:E,range:A,reverse:F,...$}=c,_=Sw(c.range,d,s,n),L=Jd(n,s),T=y?BS(n,y,u,L):null;return r.push({name:d,type:p,...L?{domain:L}:{},...T?{domainRaw:T}:{},range:_,...F!==void 0?{reverse:F}:{},...$}),r},[])}function Sw(n,r,s,u){if(Tt(s)){if(Jo(n))return{step:{signal:`${r}_step`}}}else if(We(n)&&go(n))return{...n,data:u.lookupDataSource(n.data)};return n}class vx extends Gi{constructor(r,s){super({},{name:r}),this.merged=!1,this.setWithExplicit("type",s)}domainHasZero(){const r=this.get("type");if(Ue([ln.LOG,ln.TIME,ln.UTC],r))return"definitely-not";const s=this.get("zero");if(s===!0||s===void 0&&Ue([ln.LINEAR,ln.SQRT,ln.POW],r))return"definitely";const u=this.get("domains");if(u.length>0){let c=!1,d=!1,p=!1;for(const y of u){if(pe(y)){const E=y[0],A=y[y.length-1];if(j(E)&&j(A))if(E<=0&&A>=0){c=!0;continue}else{d=!0;continue}}p=!0}if(c)return"definitely";if(d&&!p)return"definitely-not"}return"maybe"}}const Sm=["range","scheme"];function Fm(n){const r=n.component.scales;for(const s of af){const u=r[s];if(!u)continue;const c=Fw(s,n);u.setWithExplicit("range",c)}}function wm(n,r){const s=n.fieldDef(r);if(s?.bin){const{bin:u,field:c}=s,d=Ln(r),p=n.getName(d);if(We(u)&&u.binned&&u.step!==void 0)return new Nt(()=>{const y=n.scaleName(r),E=`(domain("${y}")[1] - domain("${y}")[0]) / ${u.step}`;return`${n.getSignalName(p)} / (${E})`});if(nt(u)){const y=pa(n,c,u);return new Nt(()=>{const E=n.getSignalName(y),A=`(${E}.stop - ${E}.start) / ${E}.step`;return`${n.getSignalName(p)} / (${A})`})}}}function Fw(n,r){const s=r.specifiedScales[n],{size:u}=r,d=r.getScaleComponent(n).get("type");for(const $ of Sm)if(s[$]!==void 0){const _=sp(d,$),L=ap(n,$);if(!_)oe(Wg(d,$,n));else if(L)oe(L);else switch($){case"range":{const T=s.range;if(pe(T)){if(Tt(n))return Ai(T.map(B=>{if(B==="width"||B==="height"){const G=r.getName(B),H=r.getSignalName.bind(r);return Nt.fromName(H,G)}return B}))}else if(We(T))return Ai({data:r.requestDataName(Ge.Main),field:T.field,sort:{op:"min",field:r.vgField(n)}});return Ai(T)}case"scheme":return Ai(An(s[$]))}}const p=n===wt||n==="xOffset"?"width":"height",y=u[p];if(Ui(y)){if(Tt(n))if(tn(d)){const $=bx(y,r,n);if($)return Ai({step:$})}else oe(Sf(p));else if(Gs(n)){const $=n===Vo?"x":"y";if(r.getScaleComponent($).get("type")==="band"){const T=Cc(y,d);if(T)return Ai(T)}}}const{rangeMin:E,rangeMax:A}=s,F=ww(n,r);return(E!==void 0||A!==void 0)&&sp(d,"rangeMin")&&pe(F)&&F.length===2?Ai([E??F[0],A??F[1]]):ni(F)}function An(n){return FC(n)?{scheme:n.name,...Yn(n,["name"])}:{scheme:n}}function Du(n,r,s,{center:u}={}){const c=Ln(n),d=r.getName(c),p=r.getSignalName.bind(r);return n===Ot&&gi(s)?u?[Nt.fromName(y=>`${p(y)}/2`,d),Nt.fromName(y=>`-${p(y)}/2`,d)]:[Nt.fromName(p,d),0]:u?[Nt.fromName(y=>`-${p(y)}/2`,d),Nt.fromName(y=>`${p(y)}/2`,d)]:[0,Nt.fromName(p,d)]}function ww(n,r){const{size:s,config:u,mark:c,encoding:d}=r,{type:p}=At(d[n]),E=r.getScaleComponent(n).get("type"),{domain:A,domainMid:F}=r.specifiedScales[n];switch(n){case wt:case Ot:{if(Ue(["point","band"],E)){const $=eh(n,s,u.view);if(Ui($))return{step:bx($,r,n)}}return Du(n,r,E)}case Vo:case Ia:return Ro(n,r,E);case lo:{const $=Fc(c,u),_=th(c,s,r,u);return Ka(E)?Dw($,_,Sc(E,u,A,n)):[$,_]}case Ti:return[0,Math.PI*2];case Ls:return[0,360];case tr:return[0,new Nt(()=>{const $=r.getSignalName(Fi(r.parent)?"child_width":"width"),_=r.getSignalName(Fi(r.parent)?"child_height":"height");return`min(${$},${_})/2`})];case rr:return{step:1e3/u.scale.framesPerSecond};case Xo:return[u.scale.minStrokeWidth,u.scale.maxStrokeWidth];case Yo:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case Zn:return"symbol";case Gt:case zr:case Ir:return E==="ordinal"?p==="nominal"?"category":"ordinal":F!==void 0?"diverging":c==="rect"||c==="geoshape"?"heatmap":"ramp";case co:case Ho:case qo:return[u.scale.minOpacity,u.scale.maxOpacity]}}function bx(n,r,s){const{encoding:u}=r,c=r.getScaleComponent(s),d=nf(s),p=u[d];if(su({step:n,offsetIsDiscrete:Me(p)&&np(p.type)})==="offset"&&Qf(u,d)){const E=r.getScaleComponent(d);let F=`domain('${r.scaleName(d)}').length`;if(E.get("type")==="band"){const _=E.get("paddingInner")??E.get("padding")??0,L=E.get("paddingOuter")??E.get("padding")??0;F=`bandspace(${F}, ${_}, ${L})`}const $=c.get("paddingInner")??c.get("padding");return{signal:`${n.step} * ${F} / (1-${Eg($)})`}}else return n.step}function Cc(n,r){if(su({step:n,offsetIsDiscrete:tn(r)})==="offset")return{step:n.step}}function Ro(n,r,s){const u=n===Vo?"x":"y",c=r.getScaleComponent(u);if(!c)return Du(u,r,s,{center:!0});const d=c.get("type"),p=r.scaleName(u),{markDef:y,config:E}=r;if(d==="band"){const A=eh(u,r.size,r.config.view);if(Ui(A)){const F=Cc(A,s);if(F)return F}return[0,{signal:`bandwidth('${p}')`}]}else{const A=r.encoding[u];if(ae(A)&&A.timeUnit){const F=Qg(A.timeUnit,T=>`scale('${p}', ${T})`),$=r.config.scale.bandWithNestedOffsetPaddingInner,_=ns({fieldDef:A,markDef:y,config:E})-.5,L=_!==0?` + ${_}`:"";if($){const T=xe($)?`${$.signal}/2`+L:`${$/2+_}`,B=xe($)?`(1 - ${$.signal}/2)`+L:`${1-$/2+_}`;return[{signal:`${T} * (${F})`},{signal:`${B} * (${F})`}]}return[0,{signal:F}]}return F1(`Cannot use ${n} scale if ${u} scale is not discrete.`)}}function eh(n,r,s){const u=n===wt?"width":"height",c=r[u];return c||us(s,u)}function Sc(n,r,s,u){switch(n){case"quantile":return r.scale.quantileCount;case"quantize":return r.scale.quantizeCount;case"threshold":return s!==void 0&&pe(s)?s.length+1:(oe(uC(u)),3)}}function Dw(n,r,s){const u=()=>{const c=cr(r),d=cr(n),p=`(${c} - ${d}) / (${s} - 1)`;return`sequence(${d}, ${c} + ${p}, ${p})`};return xe(r)?new Nt(u):{signal:u()}}function Fc(n,r){switch(n){case"bar":case"tick":return r.scale.minBandSize;case"line":case"trail":case"rule":return r.scale.minStrokeWidth;case"text":return r.scale.minFontSize;case"point":case"square":case"circle":return r.scale.minSize}throw new Error(ll("size",n))}const ku=.95;function th(n,r,s,u){const c={x:wm(s,"x"),y:wm(s,"y")};switch(n){case"bar":case"tick":{if(u.scale.maxBandSize!==void 0)return u.scale.maxBandSize;const d=xx(r,c,u.view);return j(d)?d-1:new Nt(()=>`${d.signal} - 1`)}case"line":case"trail":case"rule":return u.scale.maxStrokeWidth;case"text":return u.scale.maxFontSize;case"point":case"square":case"circle":{if(u.scale.maxSize)return u.scale.maxSize;const d=xx(r,c,u.view);return j(d)?Math.pow(ku*d,2):new Nt(()=>`pow(${ku} * ${d.signal}, 2)`)}}throw new Error(ll("size",n))}function xx(n,r,s){const u=Ui(n.width)?n.width.step:Lp(s,"width"),c=Ui(n.height)?n.height.step:Lp(s,"height");return r.x||r.y?new Nt(()=>`min(${[r.x?r.x.signal:u,r.y?r.y.signal:c].join(", ")})`):Math.min(u,c)}function Dm(n,r){Bt(n)?km(n,r):Ax(n,r)}function km(n,r){const s=n.component.scales,{config:u,encoding:c,markDef:d,specifiedScales:p}=n;for(const y of te(s)){const E=p[y],A=s[y],F=n.getScaleComponent(y),$=At(c[y]),_=E[r],L=F.get("type"),T=F.get("padding"),B=F.get("paddingInner"),G=sp(L,r),H=ap(y,r);if(_!==void 0&&(G?H&&oe(H):oe(Wg(L,r,y))),G&&H===void 0)if(_!==void 0){const Z=$.timeUnit,ve=$.type;switch(r){case"domainMax":case"domainMin":fr(E[r])||ve==="temporal"||Z?A.set(r,{signal:Yf(E[r],{type:ve,timeUnit:Z})},!0):A.set(r,E[r],!0);break;default:A.copyKeyFromObject(r,E)}}else{const Z=ie(Ex,r)?Ex[r]({model:n,channel:y,fieldOrDatumDef:$,scaleType:L,scalePadding:T,scalePaddingInner:B,domain:E.domain,domainMin:E.domainMin,domainMax:E.domainMax,markDef:d,config:u,hasNestedOffsetScale:nv(c,y),hasSecondaryRangeChannel:!!c[Bn(y)]}):u.scale[r];Z!==void 0&&A.set(r,Z,!1)}}}const Ex={bins:({model:n,fieldOrDatumDef:r})=>ae(r)?kw(n,r):void 0,interpolate:({channel:n,fieldOrDatumDef:r})=>Om(n,r.type),nice:({scaleType:n,channel:r,domain:s,domainMin:u,domainMax:c,fieldOrDatumDef:d})=>$w(n,r,s,u,c,d),padding:({channel:n,scaleType:r,fieldOrDatumDef:s,markDef:u,config:c})=>Ow(n,r,c.scale,s,u,c.bar),paddingInner:({scalePadding:n,channel:r,markDef:s,scaleType:u,config:c,hasNestedOffsetScale:d})=>Cx(n,r,s.type,u,c.scale,d),paddingOuter:({scalePadding:n,channel:r,scaleType:s,scalePaddingInner:u,config:c,hasNestedOffsetScale:d})=>Tw(n,r,s,u,c.scale,d),reverse:({fieldOrDatumDef:n,scaleType:r,channel:s,config:u})=>{const c=ae(n)?n.sort:void 0;return Rw(r,c,s,u.scale)},zero:({channel:n,fieldOrDatumDef:r,domain:s,markDef:u,scaleType:c,config:d,hasSecondaryRangeChannel:p})=>Nw(n,r,s,u,c,d.scale,p)};function $m(n){Bt(n)?Fm(n):Ax(n,"range")}function Ax(n,r){const s=n.component.scales;for(const u of n.children)r==="range"?$m(u):Dm(u,r);for(const u of te(s)){let c;for(const d of n.children){const p=d.component.scales[u];if(p){const y=p.getWithExplicit(r);c=Ct(c,y,r,"scale",fu((E,A)=>{switch(r){case"range":return E.step&&A.step?E.step-A.step:0}return 0}))}}s[u].setWithExplicit(r,c)}}function kw(n,r){const s=r.bin;if(nt(s)){const u=pa(n,r.field,s);return new Nt(()=>n.getSignalName(u))}else if(mn(s)&&ho(s)&&s.step!==void 0)return{step:s.step}}function Om(n,r){if(Ue([Gt,zr,Ir],n)&&r!=="nominal")return"hcl"}function $w(n,r,s,u,c,d){if(!(Li(d)?.bin||pe(s)||c!=null||u!=null||Ue([ln.TIME,ln.UTC],n)))return Tt(r)?!0:void 0}function Ow(n,r,s,u,c,d){if(Tt(n)){if(pi(r)){if(s.continuousPadding!==void 0)return s.continuousPadding;const{type:p,orient:y}=c;if(p==="bar"&&!(ae(u)&&(u.bin||u.timeUnit))&&(y==="vertical"&&n==="x"||y==="horizontal"&&n==="y"))return d.continuousBandSize}if(r===ln.POINT)return s.pointPadding}}function Cx(n,r,s,u,c,d=!1){if(n===void 0){if(Tt(r)){const{bandPaddingInner:p,barBandPaddingInner:y,rectBandPaddingInner:E,tickBandPaddingInner:A,bandWithNestedOffsetPaddingInner:F}=c;return d?F:It(p,s==="bar"?y:s==="tick"?A:E)}else if(Gs(r)&&u===ln.BAND)return c.offsetBandPaddingInner}}function Tw(n,r,s,u,c,d=!1){if(n===void 0){if(Tt(r)){const{bandPaddingOuter:p,bandWithNestedOffsetPaddingOuter:y}=c;if(d)return y;if(s===ln.BAND)return It(p,xe(u)?{signal:`${u.signal}/2`}:u/2)}else if(Gs(r)){if(s===ln.POINT)return .5;if(s===ln.BAND)return c.offsetBandPaddingOuter}}}function Rw(n,r,s,u){if(s==="x"&&u.xReverse!==void 0)return gi(n)&&r==="descending"?xe(u.xReverse)?{signal:`!${u.xReverse.signal}`}:!u.xReverse:u.xReverse;if(gi(n)&&r==="descending")return!0}function Nw(n,r,s,u,c,d,p){if(!!s&&s!=="unaggregated"&&gi(c)){if(pe(s)){const E=s[0],A=s[s.length-1];if(j(E)&&E<=0&&j(A)&&A>=0)return!0}return!1}if(n==="size"&&r.type==="quantitative"&&!Ka(c))return!0;if(!(ae(r)&&r.bin)&&Ue([...ur,...EA],n)){const{orient:E,type:A}=u;return Ue(["bar","area","line","trail"],A)&&(E==="horizontal"&&n==="y"||E==="vertical"&&n==="x")?!1:Ue(["bar","area"],A)&&!p?!0:d?.zero}return!1}function _w(n,r,s,u,c=!1){const d=Mw(r,s,u,c),{type:p}=n;return lr(r)?p!==void 0?Ty(r,p)?ae(s)&&!NC(p,s.type)?(oe(cy(p,d)),d):p:(oe(XA(r,p,d)),d):d:null}function Mw(n,r,s,u){switch(r.type){case"nominal":case"ordinal":{if(Us(n)||uf(n)==="discrete")return n==="shape"&&r.type==="ordinal"&&oe(Cf(n,"ordinal")),"ordinal";if(of(n))return"band";if(Tt(n)||Gs(n)){if(Ue(["rect","bar","image","rule","tick"],s.type)||u)return"band"}else if(s.type==="arc"&&n in ja)return"band";const c=s[Ln(n)];return ea(c)||vo(r)&&r.axis?.tickBand?"band":"point"}case"temporal":return Us(n)?"time":uf(n)==="discrete"?(oe(Cf(n,"temporal")),"ordinal"):ae(r)&&r.timeUnit&&qt(r.timeUnit).utc?"utc":of(n)?"band":"time";case"quantitative":return Us(n)?ae(r)&&nt(r.bin)?"bin-ordinal":"linear":uf(n)==="discrete"?(oe(Cf(n,"quantitative")),"ordinal"):of(n)?"band":"linear";case"geojson":return}throw new Error(ty(r.type))}function Bw(n,{ignoreRange:r}={}){Tm(n),Un(n);for(const s of RC)Dm(n,s);r||$m(n)}function Tm(n){Bt(n)?n.component.scales=oi(n):n.component.scales=Lw(n)}function oi(n){const{encoding:r,mark:s,markDef:u}=n,c={};for(const d of af){const p=At(r[d]);if(p&&s===_y&&d===Zn&&p.type===Ks)continue;let y=p&&p.scale;if(p&&y!==null&&y!==!1){y??(y={});const E=nv(r,d),A=_w(y,d,p,u,E);c[d]=new vx(n.scaleName(`${d}`,!0),{value:A,explicit:y.type===A})}}return c}const Sx=fu((n,r)=>EC(n)-EC(r));function Lw(n){var r;const s=n.component.scales={},u={},c=n.component.resolve;for(const d of n.children){Tm(d);for(const p of te(d.component.scales))if((r=c.scale)[p]??(r[p]=tx(p,n)),c.scale[p]==="shared"){const y=u[p],E=d.component.scales[p].getWithExplicit("type");y?Rf(y.value,E.value)?u[p]=Ct(y,E,"type","scale",Sx):(c.scale[p]="independent",delete u[p]):u[p]=E}}for(const d of te(u)){const p=n.scaleName(d,!0),y=u[d];s[d]=new vx(p,y);for(const E of n.children){const A=E.component.scales[d];A&&(E.renameScale(A.get("name"),p),A.merged=!0)}}return s}class nh{constructor(){this.nameMap={}}rename(r,s){this.nameMap[r]=s}has(r){return this.nameMap[r]!==void 0}get(r){for(;this.nameMap[r]&&r!==this.nameMap[r];)r=this.nameMap[r];return r}}function Bt(n){return n?.type==="unit"}function Fi(n){return n?.type==="facet"}function wc(n){return n?.type==="concat"}function Qr(n){return n?.type==="layer"}class ih{constructor(r,s,u,c,d,p,y){this.type=s,this.parent=u,this.config=d,this.parent=u,this.config=d,this.view=Wt(y),this.name=r.name??c,this.title=Zo(r.title)?{text:r.title}:r.title?Wt(r.title):void 0,this.scaleNameMap=u?u.scaleNameMap:new nh,this.projectionNameMap=u?u.projectionNameMap:new nh,this.signalNameMap=u?u.signalNameMap:new nh,this.data=r.data,this.description=r.description,this.transforms=Pv(r.transform??[]),this.layout=s==="layer"||s==="unit"?{}:ud(r,s,d),this.component={data:{sources:u?u.component.data.sources:[],outputNodes:u?u.component.data.outputNodes:{},outputNodeRefCounts:u?u.component.data.outputNodeRefCounts:{},isFaceted:Gf(r)||u?.component.data.isFaceted&&r.data===void 0},layoutSize:new Gi,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:{scale:{},axis:{},legend:{},...p?_e(p):{}},selection:null,scales:null,projection:null,axes:{},legends:{}}}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){Bw(this)}parseProjection(){lx(this)}renameTopLevelLayoutSizeSignal(){this.getName("width")!=="width"&&this.renameSignal(this.getName("width"),"width"),this.getName("height")!=="height"&&this.renameSignal(this.getName("height"),"height")}parseLegends(){Xd(this)}assembleEncodeFromView(r){const{style:s,...u}=r,c={};for(const d of te(u)){const p=u[d];p!==void 0&&(c[d]=Et(p))}return c}assembleGroupEncodeEntry(r){let s={};return this.view&&(s=this.assembleEncodeFromView(this.view)),!r&&(this.description&&(s.description=Et(this.description)),this.type==="unit"||this.type==="layer")?{width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height"),...s}:dt(s)?void 0:s}assembleLayout(){if(!this.layout)return;const{spacing:r,...s}=this.layout,{component:u,config:c}=this,d=rm(u.layoutHeaders,c);return{padding:r,...this.assembleDefaultLayout(),...s,...d?{titleBand:d}:{}}}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:r}=this.component;let s=[];for(const u of Jn)r[u].title&&s.push(GF(this,u));for(const u of J0)s=s.concat(em(this,u));return s}assembleAxes(){return RF(this.component.axes,this.config)}assembleLegends(){return ax(this)}assembleProjections(){return ux(this)}assembleTitle(){const{encoding:r,...s}=this.title??{},u={...Ha(this.config.title).nonMarkTitleProperties,...s,...r?{encode:{update:r}}:{}};if(u.text)return Ue(["unit","layer"],this.type)?Ue(["middle",void 0],u.anchor)&&(u.frame??(u.frame="group")):u.anchor??(u.anchor="start"),dt(u)?void 0:u}assembleGroup(r=[]){const s={};r=r.concat(this.assembleSignals()),r.length>0&&(s.signals=r);const u=this.assembleLayout();u&&(s.layout=u),s.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const c=!this.parent||Fi(this.parent)?mx(this):[];c.length>0&&(s.scales=c);const d=this.assembleAxes();d.length>0&&(s.axes=d);const p=this.assembleLegends();return p.length>0&&(s.legends=p),s}getName(r){return Ft((this.name?`${this.name}_`:"")+r)}getDataName(r){return this.getName(Ge[r].toLowerCase())}requestDataName(r){const s=this.getDataName(r),u=this.component.data.outputNodeRefCounts;return u[s]=(u[s]||0)+1,s}getSizeSignalRef(r){if(Fi(this.parent)){const s=Vd(r),u=Ga(s),c=this.component.scales[u];if(c&&!c.merged){const d=c.get("type"),p=c.get("range");if(tn(d)&&Jo(p)){const y=c.get("name"),E=Jd(this,u),A=Yt(E);if(A){const F=le({aggregate:"distinct",field:A},{expr:"datum"});return{signal:Wd(y,c,F)}}else return oe(yf(u)),null}}}return{signal:this.signalNameMap.get(this.getName(r))}}lookupDataSource(r){const s=this.component.data.outputNodes[r];return s?s.getSource():r}getSignalName(r){return this.signalNameMap.get(r)}renameSignal(r,s){this.signalNameMap.rename(r,s)}renameScale(r,s){this.scaleNameMap.rename(r,s)}renameProjection(r,s){this.projectionNameMap.rename(r,s)}scaleName(r,s){if(s)return this.getName(r);if(dg(r)&&lr(r)&&this.component.scales[r]||this.scaleNameMap.has(this.getName(r)))return this.scaleNameMap.get(this.getName(r))}projectionName(r){if(r)return this.getName("projection");if(this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection")))return this.projectionNameMap.get(this.getName("projection"))}getScaleComponent(r){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const s=this.component.scales[r];return s&&!s.merged?s:this.parent?this.parent.getScaleComponent(r):void 0}getScaleType(r){const s=this.getScaleComponent(r);return s?s.get("type"):void 0}getSelectionComponent(r,s){let u=this.component.selection[r];if(!u&&this.parent&&(u=this.parent.getSelectionComponent(r,s)),!u)throw new Error(Dg(s));return u}hasAxisOrientSignalRef(){return this.component.axes.x?.some(r=>r.hasOrientSignalRef())||this.component.axes.y?.some(r=>r.hasOrientSignalRef())}}class Fx extends ih{vgField(r,s={}){const u=this.fieldDef(r);if(u)return le(u,s)}reduceFieldDef(r,s){return KC(this.getMapping(),(u,c,d)=>{const p=Li(c);return p?r(u,p,d):u},s)}forEachFieldDef(r,s){wp(this.getMapping(),(u,c)=>{const d=Li(u);d&&r(d,c)},s)}}class Dc extends qe{clone(){return new Dc(null,_e(this.transform))}constructor(r,s){super(r),this.transform=s,this.transform=_e(s);const u=this.transform.as??[void 0,void 0];this.transform.as=[u[0]??"value",u[1]??"density"];const c=this.transform.resolve??"shared";this.transform.resolve=c}dependentFields(){return new Set([this.transform.density,...this.transform.groupby??[]])}producedFields(){return new Set(this.transform.as)}hash(){return`DensityTransform ${He(this.transform)}`}assemble(){const{density:r,...s}=this.transform,u={type:"kde",field:r,...s};return u.resolve=this.transform.resolve,u}}class rh extends qe{clone(){return new rh(null,_e(this.transform))}constructor(r,s){super(r),this.transform=s,this.transform=_e(s)}dependentFields(){return new Set([this.transform.extent])}producedFields(){return new Set([])}hash(){return`ExtentTransform ${He(this.transform)}`}assemble(){const{extent:r,param:s}=this.transform;return{type:"extent",field:r,signal:s}}}class Qe extends qe{clone(){return new Qe(this.parent,_e(this.transform))}constructor(r,s){super(r),this.transform=s,this.transform=_e(s);const{flatten:u,as:c=[]}=this.transform;this.transform.as=u.map((d,p)=>c[p]??d)}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return`FlattenTransform ${He(this.transform)}`}assemble(){const{flatten:r,as:s}=this.transform;return{type:"flatten",fields:r,as:s}}}class Ca extends qe{clone(){return new Ca(null,_e(this.transform))}constructor(r,s){super(r),this.transform=s,this.transform=_e(s);const u=this.transform.as??[void 0,void 0];this.transform.as=[u[0]??"key",u[1]??"value"]}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return`FoldTransform ${He(this.transform)}`}assemble(){const{fold:r,as:s}=this.transform;return{type:"fold",fields:r,as:s}}}class Vt extends qe{clone(){return new Vt(null,_e(this.fields),this.geojson,this.signal)}static parseAll(r,s){if(s.component.projection&&!s.component.projection.isFit)return r;let u=0;for(const c of[[nr,Ri],[Ni,ir]]){const d=c.map(p=>{const y=At(s.encoding[p]);return ae(y)?y.field:yi(y)?{expr:`${y.datum}`}:vr(y)?{expr:`${y.value}`}:void 0});(d[0]||d[1])&&(r=new Vt(r,d,null,s.getName(`geojson_${u++}`)))}if(s.channelHasField(Zn)){const c=s.typedFieldDef(Zn);c.type===Ks&&(r=new Vt(r,null,c.field,s.getName(`geojson_${u++}`)))}return r}constructor(r,s,u,c){super(r),this.fields=s,this.geojson=u,this.signal=c}dependentFields(){const r=(this.fields??[]).filter(U);return new Set([...this.geojson?[this.geojson]:[],...r])}producedFields(){return new Set}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${He(this.fields)}`}assemble(){return[...this.geojson?[{type:"filter",expr:`isValid(datum["${this.geojson}"])`}]:[],{type:"geojson",...this.fields?{fields:this.fields}:{},...this.geojson?{geojson:this.geojson}:{},signal:this.signal}]}}class pt extends qe{clone(){return new pt(null,this.projection,_e(this.fields),_e(this.as))}constructor(r,s,u,c){super(r),this.projection=s,this.fields=u,this.as=c}static parseAll(r,s){if(!s.projectionName())return r;for(const u of[[nr,Ri],[Ni,ir]]){const c=u.map(p=>{const y=At(s.encoding[p]);return ae(y)?y.field:yi(y)?{expr:`${y.datum}`}:vr(y)?{expr:`${y.value}`}:void 0}),d=u[0]===Ni?"2":"";(c[0]||c[1])&&(r=new pt(r,s.projectionName(),c,[s.getName(`x${d}`),s.getName(`y${d}`)]))}return r}dependentFields(){return new Set(this.fields.filter(U))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${He(this.fields)} ${He(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class No extends qe{clone(){return new No(null,_e(this.transform))}constructor(r,s){super(r),this.transform=s}dependentFields(){return new Set([this.transform.impute,this.transform.key,...this.transform.groupby??[]])}producedFields(){return new Set([this.transform.impute])}processSequence(r){const{start:s=0,stop:u,step:c}=r;return{signal:`sequence(${[s,u,...c?[c]:[]].join(",")})`}}static makeFromTransform(r,s){return new No(r,s)}static makeFromEncoding(r,s){const u=s.encoding,c=u.x,d=u.y;if(ae(c)&&ae(d)){const p=c.impute?c:d.impute?d:void 0;if(p===void 0)return;const y=c.impute?d:d.impute?c:void 0,{method:E,value:A,frame:F,keyvals:$}=p.impute,_=Jf(s.mark,u);return new No(r,{impute:p.field,key:y.field,...E?{method:E}:{},...A!==void 0?{value:A}:{},...F?{frame:F}:{},...$!==void 0?{keyvals:$}:{},..._.length?{groupby:_}:{}})}return null}hash(){return`Impute ${He(this.transform)}`}assemble(){const{impute:r,key:s,keyvals:u,method:c,groupby:d,value:p,frame:y=[null,null]}=this.transform,E={type:"impute",field:r,key:s,...u?{keyvals:Hp(u)?this.processSequence(u):u}:{},method:"value",...d?{groupby:d}:{},value:!c||c==="value"?p:null};if(c&&c!=="value"){const A={type:"window",as:[`imputed_${r}_value`],ops:[c],fields:[r],frame:y,ignorePeers:!1,...d?{groupby:d}:{}},F={type:"formula",expr:`datum.${r} === null ? datum.imputed_${r}_value : datum.${r}`,as:r};return[E,A,F]}else return[E]}}class oh extends qe{clone(){return new oh(null,_e(this.transform))}constructor(r,s){super(r),this.transform=s,this.transform=_e(s);const u=this.transform.as??[void 0,void 0];this.transform.as=[u[0]??s.on,u[1]??s.loess]}dependentFields(){return new Set([this.transform.loess,this.transform.on,...this.transform.groupby??[]])}producedFields(){return new Set(this.transform.as)}hash(){return`LoessTransform ${He(this.transform)}`}assemble(){const{loess:r,on:s,...u}=this.transform;return{type:"loess",x:s,y:r,...u}}}class $u extends qe{clone(){return new $u(null,_e(this.transform),this.secondary)}constructor(r,s,u){super(r),this.transform=s,this.secondary=u}static make(r,s,u,c){const d=s.component.data.sources,{from:p}=u;let y=null;if(bS(p)){let E=Tx(p.data,d);E||(E=new va(p.data),d.push(E));const A=s.getName(`lookup_${c}`);y=new yt(E,A,Ge.Lookup,s.component.data.outputNodeRefCounts),s.component.data.outputNodes[A]=y}else if(_v(p)){const E=p.param;u={as:E,...u};let A;try{A=s.getSelectionComponent(Ft(E),E)}catch{throw new Error(_A(E))}if(y=A.materialized,!y)throw new Error($g(E))}return new $u(r,u,y.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?vt(this.transform.as):this.transform.from.fields)}hash(){return`Lookup ${He({transform:this.transform,secondary:this.secondary})}`}assemble(){let r;if(this.transform.from.fields)r={values:this.transform.from.fields,...this.transform.as?{as:vt(this.transform.as)}:{}};else{let s=this.transform.as;U(s)||(oe(zA),s="_lookup"),r={as:[s]}}return{type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup],...r,...this.transform.default?{default:this.transform.default}:{}}}}class sh extends qe{clone(){return new sh(null,_e(this.transform))}constructor(r,s){super(r),this.transform=s,this.transform=_e(s);const u=this.transform.as??[void 0,void 0];this.transform.as=[u[0]??"prob",u[1]??"value"]}dependentFields(){return new Set([this.transform.quantile,...this.transform.groupby??[]])}producedFields(){return new Set(this.transform.as)}hash(){return`QuantileTransform ${He(this.transform)}`}assemble(){const{quantile:r,...s}=this.transform;return{type:"quantile",field:r,...s}}}class ah extends qe{clone(){return new ah(null,_e(this.transform))}constructor(r,s){super(r),this.transform=s,this.transform=_e(s);const u=this.transform.as??[void 0,void 0];this.transform.as=[u[0]??s.on,u[1]??s.regression]}dependentFields(){return new Set([this.transform.regression,this.transform.on,...this.transform.groupby??[]])}producedFields(){return new Set(this.transform.as)}hash(){return`RegressionTransform ${He(this.transform)}`}assemble(){const{regression:r,on:s,...u}=this.transform;return{type:"regression",x:s,y:r,...u}}}class uh extends qe{clone(){return new uh(null,_e(this.transform))}constructor(r,s){super(r),this.transform=s}addDimensions(r){this.transform.groupby=_r((this.transform.groupby??[]).concat(r),s=>s)}producedFields(){}dependentFields(){return new Set([this.transform.pivot,this.transform.value,...this.transform.groupby??[]])}hash(){return`PivotTransform ${He(this.transform)}`}assemble(){const{pivot:r,value:s,groupby:u,limit:c,op:d}=this.transform;return{type:"pivot",field:r,value:s,...c!==void 0?{limit:c}:{},...d!==void 0?{op:d}:{},...u!==void 0?{groupby:u}:{}}}}class lh extends qe{clone(){return new lh(null,_e(this.transform))}constructor(r,s){super(r),this.transform=s}dependentFields(){return new Set}producedFields(){return new Set}hash(){return`SampleTransform ${He(this.transform)}`}assemble(){return{type:"sample",size:this.transform.sample}}}function wx(n){let r=0;function s(u,c){if(u instanceof va&&!u.isGenerator&&!ua(u.data)&&(n.push(c),c={name:null,source:c.name,transform:[]}),u instanceof On&&(u.parent instanceof va&&!c.source?(c.format={...c.format,parse:u.assembleFormatParse()},c.transform.push(...u.assembleTransforms(!0))):c.transform.push(...u.assembleTransforms())),u instanceof ma){c.name||(c.name=`data_${r++}`),!c.source||c.transform.length>0?(n.push(c),u.data=c.name):u.data=c.source,n.push(...u.assemble());return}switch((u instanceof bc||u instanceof xc||u instanceof wu||u instanceof xu||u instanceof Eu||u instanceof pt||u instanceof kr||u instanceof $u||u instanceof Pn||u instanceof xa||u instanceof Ca||u instanceof Qe||u instanceof Dc||u instanceof oh||u instanceof sh||u instanceof ah||u instanceof Kr||u instanceof lh||u instanceof uh||u instanceof rh)&&c.transform.push(u.assemble()),(u instanceof Yr||u instanceof Ar||u instanceof No||u instanceof $o||u instanceof Vt)&&c.transform.push(...u.assemble()),u instanceof yt&&(c.source&&c.transform.length===0?u.setSource(c.source):u.parent instanceof yt?u.setSource(c.name):(c.name||(c.name=`data_${r++}`),u.setSource(c.name),u.numChildren()===1&&(n.push(c),c={name:null,source:c.name,transform:[]}))),u.numChildren()){case 0:u instanceof yt&&(!c.source||c.transform.length>0)&&n.push(c);break;case 1:s(u.children[0],c);break;default:{c.name||(c.name=`data_${r++}`);let d=c.name;!c.source||c.transform.length>0?n.push(c):d=c.source;for(const p of u.children)s(p,{name:null,source:d,transform:[]});break}}}return s}function zw(n){const r=[],s=wx(r);for(const u of n.children)s(u,{source:n.name,name:null,transform:[]});return r}function Iw(n,r){const s=[],u=wx(s);let c=0;for(const p of n.sources){p.hasName()||(p.dataName=`source_${c++}`);const y=p.assemble();u(p,y)}for(const p of s)p.transform.length===0&&delete p.transform;let d=0;for(const[p,y]of s.entries())(y.transform??[]).length===0&&!y.source&&s.splice(d++,0,s.splice(p,1)[0]);for(const p of s)for(const y of p.transform??[])y.type==="lookup"&&(y.from=n.outputNodes[y.from].getSource());for(const p of s)p.name in r&&(p.values=r[p.name]);return s}function Pw(n){return n==="top"||n==="left"||xe(n)?"header":"footer"}function Uw(n){for(const r of Jn)jw(n,r);kc(n,"x"),kc(n,"y")}function jw(n,r){const{facet:s,config:u,child:c,component:d}=n;if(n.channelHasField(r)){const p=s[r],y=ys("title",null,u,r);let E=ss(p,u,{allowDisabling:!0,includeDefault:y===void 0||!!y});c.component.layoutHeaders[r].title&&(E=pe(E)?E.join(", "):E,E+=` / ${c.component.layoutHeaders[r].title}`,c.component.layoutHeaders[r].title=null);const A=ys("labelOrient",p.header,u,r),F=p.header!==null?It(p.header?.labels,u.header.labels,!0):!1,$=Ue(["bottom","right"],A)?"footer":"header";d.layoutHeaders[r]={title:p.header!==null?E:null,facetFieldDef:p,[$]:r==="facet"?[]:[Rm(n,r,F)]}}}function Rm(n,r,s){const u=r==="row"?"height":"width";return{labels:s,sizeSignal:n.child.component.layoutSize.get(u)?n.child.getSizeSignalRef(u):void 0,axes:[]}}function kc(n,r){const{child:s}=n;if(s.component.axes[r]){const{layoutHeaders:u,resolve:c}=n.component;if(c.axis[r]=mc(c,r),c.axis[r]==="shared"){const d=r==="x"?"column":"row",p=u[d];for(const y of s.component.axes[r]){const E=Pw(y.get("orient"));p[E]??(p[E]=[Rm(n,d,!1)]);const A=wo(y,"main",n.config,{header:!0});A&&p[E][0].axes.push(A),y.mainExtracted=!0}}}}function Dx(n){_o(n),Ou(n,"width"),Ou(n,"height")}function Gw(n){_o(n);const r=n.layout.columns===1?"width":"childWidth",s=n.layout.columns===void 0?"height":"childHeight";Ou(n,r),Ou(n,s)}function _o(n){for(const r of n.children)r.parseLayoutSize()}function Ou(n,r){const s=Vd(r),u=Ga(s),c=n.component.resolve,d=n.component.layoutSize;let p;for(const y of n.children){const E=y.component.layoutSize.getWithExplicit(s),A=c.scale[u]??tx(u,n);if(A==="independent"&&E.value==="step"){p=void 0;break}if(p){if(A==="independent"&&p.value!==E.value){p=void 0;break}p=Ct(p,E,s,"")}else p=E}if(p){for(const y of n.children)n.renameSignal(y.getName(s),n.getName(r)),y.component.layoutSize.set(s,"merged",!1);d.setWithExplicit(r,p)}else d.setWithExplicit(r,{explicit:!1,value:void 0})}function kx(n){const{size:r,component:s}=n;for(const u of ur){const c=Ln(u);if(r[c]){const d=r[c];s.layoutSize.set(c,Ui(d)?"step":d,!0)}else{const d=$x(n,c);s.layoutSize.set(c,d,!1)}}}function $x(n,r){const s=r==="width"?"x":"y",u=n.config,c=n.getScaleComponent(s);if(c){const d=c.get("type"),p=c.get("range");if(tn(d)){const y=us(u.view,r);return Jo(p)||Ui(y)?"step":y}else return Ul(u.view,r)}else{if(n.hasProjection||n.mark==="arc")return Ul(u.view,r);{const d=us(u.view,r);return Ui(d)?d.step:d}}}function ch(n,r,s){return le(r,{suffix:`by_${le(n)}`,...s})}class $c extends Fx{constructor(r,s,u,c){super(r,"facet",s,u,c,r.resolve),this.child=Nu(r.spec,this,this.getName("child"),void 0,c),this.children=[this.child],this.facet=this.initFacet(r.facet)}initFacet(r){if(!$l(r))return{facet:this.initFacetFieldDef(r,"facet")};const s=te(r),u={};for(const c of s){if(![Oi,Br].includes(c)){oe(ll(c,"facet"));break}const d=r[c];if(d.field===void 0){oe(Pg(d,c));break}u[c]=this.initFacetFieldDef(d,c)}return u}initFacetFieldDef(r,s){const u=Xf(r,s);return u.header?u.header=Wt(u.header):u.header===null&&(u.header=null),u}channelHasField(r){return ie(this.facet,r)}fieldDef(r){return this.facet[r]}parseData(){this.component.data=Oc(this),this.child.parseData()}parseLayoutSize(){_o(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection,Object.values(this.component.selection).some(r=>qr(r))&&Hg(_g)}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),Uw(this)}assembleSelectionTopLevelSignals(r){return this.child.assembleSelectionTopLevelSignals(r)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(r){return this.child.assembleSelectionData(r)}getHeaderLayoutMixins(){const r={};for(const s of Jn)for(const u of wr){const c=this.component.layoutHeaders[s],d=c[u],{facetFieldDef:p}=c;if(p){const y=ys("titleOrient",p.header,this.config,s);if(["right","bottom"].includes(y)){const E=Cu(s,y);r.titleAnchor??(r.titleAnchor={}),r.titleAnchor[E]="end"}}if(d?.[0]){const y=s==="row"?"height":"width",E=u==="header"?"headerBand":"footerBand";s!=="facet"&&!this.child.component.layoutSize.get(y)&&(r[E]??(r[E]={}),r[E][s]=.5),c.title&&(r.offset??(r.offset={}),r.offset[s==="row"?"rowTitle":"columnTitle"]=10)}}return r}assembleDefaultLayout(){const{column:r,row:s}=this.facet,u=r?this.columnDistinctSignal():s?1:void 0;let c="all";return(!s&&this.component.resolve.scale.x==="independent"||!r&&this.component.resolve.scale.y==="independent")&&(c="none"),{...this.getHeaderLayoutMixins(),...u?{columns:u}:{},bounds:"full",align:c}}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(!(this.parent&&this.parent instanceof $c))return{signal:`length(data('${this.getName("column_domain")}'))`}}assembleGroupStyle(){}assembleGroup(r){return this.parent&&this.parent instanceof $c?{...this.channelHasField("column")?{encode:{update:{columns:{field:le(this.facet.column,{prefix:"distinct"})}}}}:{},...super.assembleGroup(r)}:super.assembleGroup(r)}getCardinalityAggregateForChild(){const r=[],s=[],u=[];if(this.child instanceof $c){if(this.child.channelHasField("column")){const c=le(this.child.facet.column);r.push(c),s.push("distinct"),u.push(`distinct_${c}`)}}else for(const c of ur){const d=this.child.component.scales[c];if(d&&!d.merged){const p=d.get("type"),y=d.get("range");if(tn(p)&&Jo(y)){const E=Jd(this.child,c),A=Yt(E);A?(r.push(A),s.push("distinct"),u.push(`distinct_${A}`)):oe(yf(c))}}}return{fields:r,ops:s,as:u}}assembleFacet(){const{name:r,data:s}=this.component.data.facetRoot,{row:u,column:c}=this.facet,{fields:d,ops:p,as:y}=this.getCardinalityAggregateForChild(),E=[];for(const F of Jn){const $=this.facet[F];if($){E.push(le($));const{bin:_,sort:L}=$;if(nt(_)&&E.push(le($,{binSuffix:"end"})),yo(L)){const{field:T,op:B=jf}=L,G=ch($,L);u&&c?(d.push(G),p.push("max"),y.push(G)):(d.push(T),p.push(B),y.push(G))}else if(pe(L)){const T=Au($,F);d.push(T),p.push("max"),y.push(T)}}}const A=!!u&&!!c;return{name:r,data:s,groupby:E,...A||d.length>0?{aggregate:{...A?{cross:A}:{},...d.length?{fields:d,ops:p,as:y}:{}}}:{}}}facetSortFields(r){const{facet:s}=this,u=s[r];return u?yo(u.sort)?[ch(u,u.sort,{expr:"datum"})]:pe(u.sort)?[Au(u,r,{expr:"datum"})]:[le(u,{expr:"datum"})]:[]}facetSortOrder(r){const{facet:s}=this,u=s[r];if(u){const{sort:c}=u;return[(yo(c)?c.order:!pe(c)&&c)||"ascending"]}return[]}assembleLabelTitle(){const{facet:r,config:s}=this;if(r.facet)return hc(r.facet,"facet",s);const u={row:["top","bottom"],column:["left","right"]};for(const c of J0)if(r[c]){const d=ys("labelOrient",r[c]?.header,s,c);if(u[c].includes(d))return hc(r[c],c,s)}}assembleMarks(){const{child:r}=this,s=this.component.data.facetRoot,u=zw(s),c=r.assembleGroupEncodeEntry(!1),d=this.assembleLabelTitle()||r.assembleTitle(),p=r.assembleGroupStyle();return[{name:this.getName("cell"),type:"group",...d?{title:d}:{},...p?{style:p}:{},from:{facet:this.assembleFacet()},sort:{field:Jn.map(E=>this.facetSortFields(E)).flat(),order:Jn.map(E=>this.facetSortOrder(E)).flat()},...u.length>0?{data:u}:{},...c?{encode:{update:c}}:{},...r.assembleGroup(MS(this,[]))}]}getMapping(){return this.facet}}function Ox(n,r){const{row:s,column:u}=r;if(s&&u){let c=null;for(const d of[s,u])if(yo(d.sort)){const{field:p,op:y=jf}=d.sort;n=c=new xa(n,{joinaggregate:[{op:y,field:p,as:ch(d,d.sort,{forAs:!0})}],groupby:[le(d)]})}return c}return null}function Tx(n,r){for(const s of r){const u=s.data;if(n.name&&s.hasName()&&n.name!==s.dataName)continue;const c=n.format?.mesh,d=u.format?.feature;if(c&&d)continue;const p=n.format?.feature;if((p||d)&&p!==d)continue;const y=u.format?.mesh;if(!((c||y)&&c!==y)){if(Yl(n)&&Yl(u)){if(Kn(n.values,u.values))return s}else if(ua(n)&&ua(u)){if(n.url===u.url)return s}else if(Vv(n)&&n.name===s.dataName)return s}}return null}function Ww(n,r){if(n.data||!n.parent){if(n.data===null){const u=new va({values:[]});return r.push(u),u}const s=Tx(n.data,r);if(s)return cs(n.data)||(s.data.format=w1({},n.data.format,s.data.format)),!s.hasName()&&n.data.name&&(s.dataName=n.data.name),s;{const u=new va(n.data);return r.push(u),u}}else return n.parent.component.data.facetRoot?n.parent.component.data.facetRoot:n.parent.component.data.main}function Vw(n,r,s){let u=0;for(const c of r.transforms){let d,p;if(Lv(c))p=n=new Eu(n,c),d="derived";else if(aa(c)){const y=ya(c);p=n=On.makeWithAncestors(n,{},y,s)??n,n=new xu(n,r,c.filter)}else if(yd(c))p=n=Yr.makeFromTransform(n,c,r),d="number";else if(qp(c))d="date",s.getWithExplicit(c.field).value===void 0&&(n=new On(n,{[c.field]:d}),s.set(c.field,d,!1)),p=n=Ar.makeFromTransform(n,c);else if(Xp(c))p=n=kr.makeFromTransform(n,c),d="number",Dd(r)&&(n=new Kr(n));else if(cu(c))p=n=$u.make(n,r,c,u++),d="derived";else if(md(c))p=n=new Pn(n,c),d="number";else if(CS(c))p=n=new xa(n,c),d="number";else if(Yp(c))p=n=$o.makeFromTransform(n,c),d="derived";else if(Iv(c))p=n=new Ca(n,c),d="derived";else if(Kp(c))p=n=new rh(n,c),d="derived";else if(SS(c))p=n=new Qe(n,c),d="derived";else if(xS(c))p=n=new uh(n,c),d="derived";else if(AS(c))n=new lh(n,c);else if(zv(c))p=n=No.makeFromTransform(n,c),d="derived";else if(ql(c))p=n=new Dc(n,c),d="derived";else if(Mv(c))p=n=new sh(n,c),d="derived";else if(Bv(c))p=n=new ah(n,c),d="derived";else if(ES(c))p=n=new oh(n,c),d="derived";else{oe(J1(c));continue}if(p&&d!==void 0)for(const y of p.producedFields()??[])s.set(y,d,!1)}return n}function Oc(n){let r=Ww(n,n.component.data.sources);const{outputNodes:s,outputNodeRefCounts:u}=n.component.data,c=n.data,p=!(c&&(cs(c)||ua(c)||Yl(c)))&&n.parent?n.parent.component.data.ancestorParse.clone():new r0;cs(c)?(o0(c)?r=new xc(r,c.sequence):Er(c)&&(r=new bc(r,c.graticule)),p.parseNothing=!0):c?.format?.parse===null&&(p.parseNothing=!0),r=On.makeExplicit(r,n,p)??r,r=new Kr(r);const y=n.parent&&Qr(n.parent);(Bt(n)||Fi(n))&&y&&(r=Yr.makeFromEncoding(r,n)??r),n.transforms.length>0&&(r=Vw(r,n,p));const E=hx(n),A=aw(n);r=On.makeWithAncestors(r,{},{...E,...A},p)??r,Bt(n)&&(r=Vt.parseAll(r,n),r=pt.parseAll(r,n)),(Bt(n)||Fi(n))&&(y||(r=Yr.makeFromEncoding(r,n)??r),r=Ar.makeFromEncoding(r,n)??r,r=Eu.parseAllForSortIndex(r,n));const F=r=fh(Ge.Raw,n,r);if(Bt(n)){const G=kr.makeFromEncoding(r,n);G&&(r=G,Dd(n)&&(r=new Kr(r))),r=No.makeFromEncoding(r,n)??r,r=$o.makeFromEncoding(r,n)??r}let $,_;if(Bt(n)){const{markDef:G,mark:H,config:Z}=n,ve=ct("invalid",G,Z),{marks:De,scales:be}=_=qv({invalid:ve,isPath:es(H)});De!==be&&be==="include-invalid-values"&&($=r=fh(Ge.PreFilterInvalid,n,r)),De==="exclude-invalid-values"&&(r=wu.make(r,n,_)??r)}const L=r=fh(Ge.Main,n,r);let T;if(Bt(n)&&_){const{marks:G,scales:H}=_;G==="include-invalid-values"&&H==="exclude-invalid-values"&&(r=wu.make(r,n,_)??r,T=r=fh(Ge.PostFilterInvalid,n,r))}Bt(n)&&OF(n,L);let B=null;if(Fi(n)){const G=n.getName("facet");r=Ox(r,n.facet)??r,B=new ma(r,n,G,L.getSource()),s[G]=B}return{...n.component.data,outputNodes:s,outputNodeRefCounts:u,raw:F,main:L,facetRoot:B,ancestorParse:p,preFilterInvalid:$,postFilterInvalid:T}}function fh(n,r,s){const{outputNodes:u,outputNodeRefCounts:c}=r.component.data,d=r.getDataName(n),p=new yt(s,d,n,c);return u[d]=p,p}class Hw extends ih{constructor(r,s,u,c){super(r,"concat",s,u,c,r.resolve),(r.resolve?.axis?.x==="shared"||r.resolve?.axis?.y==="shared")&&oe(BA),this.children=this.getChildren(r).map((d,p)=>Nu(d,this,this.getName(`concat_${p}`),void 0,c))}parseData(){this.component.data=Oc(this);for(const r of this.children)r.parseData()}parseSelections(){this.component.selection={};for(const r of this.children){r.parseSelections();for(const s of te(r.component.selection))this.component.selection[s]=r.component.selection[s]}Object.values(this.component.selection).some(r=>qr(r))&&Hg(_g)}parseMarkGroup(){for(const r of this.children)r.parseMarkGroup()}parseAxesAndHeaders(){for(const r of this.children)r.parseAxesAndHeaders()}getChildren(r){return xr(r)?r.vconcat:Bp(r)?r.hconcat:r.concat}parseLayoutSize(){Gw(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(r){return this.children.reduce((s,u)=>u.assembleSelectionTopLevelSignals(s),r)}assembleSignals(){return this.children.forEach(r=>r.assembleSignals()),[]}assembleLayoutSignals(){const r=gc(this);for(const s of this.children)r.push(...s.assembleLayoutSignals());return r}assembleSelectionData(r){return this.children.reduce((s,u)=>u.assembleSelectionData(s),r)}assembleMarks(){return this.children.map(r=>{const s=r.assembleTitle(),u=r.assembleGroupStyle(),c=r.assembleGroupEncodeEntry(!1);return{type:"group",name:r.getName("group"),...s?{title:s}:{},...u?{style:u}:{},...c?{encode:{update:c}}:{},...r.assembleGroup()}})}assembleGroupStyle(){}assembleDefaultLayout(){const r=this.layout.columns;return{...r!=null?{columns:r}:{},bounds:"full",align:"each"}}}function Rx(n){return n===!1||n===null}const Nx={disable:1,gridScale:1,scale:1,...zi,labelExpr:1,encode:1},dh=te(Nx);class hh extends Gi{constructor(r={},s={},u=!1){super(),this.explicit=r,this.implicit=s,this.mainExtracted=u}clone(){return new hh(_e(this.explicit),_e(this.implicit),this.mainExtracted)}hasAxisPart(r){return r==="axis"?!0:r==="grid"||r==="title"?!!this.get(r):!Rx(this.get(r))}hasOrientSignalRef(){return xe(this.explicit.orient)}}function qw(n,r,s){const{encoding:u,config:c}=n,d=At(u[r])??At(u[Bn(r)]),p=n.axis(r)||{},{format:y,formatType:E}=p;if(na(E))return{text:mr({fieldOrDatumDef:d,field:"datum.value",format:y,formatType:E,config:c}),...s};if(y===void 0&&E===void 0&&c.customFormatTypes){if(Dt(d)==="quantitative"){if(vo(d)&&d.stack==="normalize"&&c.normalizedNumberFormatType)return{text:mr({fieldOrDatumDef:d,field:"datum.value",format:c.normalizedNumberFormat,formatType:c.normalizedNumberFormatType,config:c}),...s};if(c.numberFormatType)return{text:mr({fieldOrDatumDef:d,field:"datum.value",format:c.numberFormat,formatType:c.numberFormatType,config:c}),...s}}if(Dt(d)==="temporal"&&c.timeFormatType&&ae(d)&&!d.timeUnit)return{text:mr({fieldOrDatumDef:d,field:"datum.value",format:c.timeFormat,formatType:c.timeFormatType,config:c}),...s}}return s}function Xw(n){return ur.reduce((r,s)=>(n.component.scales[s]&&(r[s]=[Zw(s,n)]),r),{})}const _x={bottom:"top",top:"bottom",left:"right",right:"left"};function Yw(n){const{axes:r,resolve:s}=n.component,u={top:0,bottom:0,right:0,left:0};for(const c of n.children){c.parseAxesAndHeaders();for(const d of te(c.component.axes))s.axis[d]=mc(n.component.resolve,d),s.axis[d]==="shared"&&(r[d]=Zr(r[d],c.component.axes[d]),r[d]||(s.axis[d]="independent",delete r[d]))}for(const c of ur){for(const d of n.children)if(d.component.axes[c]){if(s.axis[c]==="independent"){r[c]=(r[c]??[]).concat(d.component.axes[c]);for(const p of d.component.axes[c]){const{value:y,explicit:E}=p.getWithExplicit("orient");if(!xe(y)){if(u[y]>0&&!E){const A=_x[y];u[y]>u[A]&&p.set("orient",A,!1)}u[y]++}}}delete d.component.axes[c]}if(s.axis[c]==="independent"&&r[c]&&r[c].length>1)for(const[d,p]of(r[c]||[]).entries())d>0&&p.get("grid")&&!p.explicit.grid&&(p.implicit.grid=!1)}}function Zr(n,r){if(n){if(n.length!==r.length)return;const s=n.length;for(let u=0;u<s;u++){const c=n[u],d=r[u];if(!!c!=!!d)return;if(c&&d){const p=c.getWithExplicit("orient"),y=d.getWithExplicit("orient");if(p.explicit&&y.explicit&&p.value!==y.value)return;n[u]=Tc(c,d)}}}else return r.map(s=>s.clone());return n}function Tc(n,r){for(const s of dh){const u=Ct(n.getWithExplicit(s),r.getWithExplicit(s),s,"axis",(c,d)=>{switch(s){case"title":return gf(c,d);case"gridScale":return{explicit:c.explicit,value:It(c.value,d.value)}}return Xl(c,d,s,"axis")});n.setWithExplicit(s,u)}return n}function Kw(n,r,s,u,c){if(r==="disable")return s!==void 0;switch(s=s||{},r){case"titleAngle":case"labelAngle":return n===(xe(s.labelAngle)?s.labelAngle:Qu(s.labelAngle));case"values":return!!s.values;case"encode":return!!s.encoding||!!s.labelAngle;case"title":if(n===Kb(u,c))return!0}return n===s[r]}const Qw=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function Zw(n,r){let s=r.axis(n);const u=new hh,c=At(r.encoding[n]),{mark:d,config:p}=r,y=s?.orient||p[n==="x"?"axisX":"axisY"]?.orient||p.axis?.orient||zF(n),E=r.getScaleComponent(n).get("type"),A=Y0(n,E,y,r.config),F=s!==void 0?!s:K0("disable",p.style,s?.style,A).configValue;if(u.set("disable",F,s!==void 0),F)return u;s=s||{};const $=BF(c,s,n,p.style,A),_=Wy(s.formatType,c,E),L=Gy(c,c.type,s.format,s.formatType,p,!0),T={fieldOrDatumDef:c,axis:s,channel:n,model:r,scaleType:E,orient:y,labelAngle:$,format:L,formatType:_,mark:d,config:p};for(const H of dh){const Z=H in Q0?Q0[H](T):Kf(H)?s[H]:void 0,ve=Z!==void 0,De=Kw(Z,H,s,r,n);if(ve&&De)u.set(H,Z,De);else{const{configValue:be=void 0,configFrom:$e=void 0}=Kf(H)&&H!=="values"?K0(H,p.style,s.style,A):{},Re=be!==void 0;ve&&!Re?u.set(H,Z,De):($e!=="vgAxisConfig"||Qw.has(H)&&Re||Hr(be)||xe(be))&&u.set(H,be,!1)}}const B=s.encoding??{},G=tv.reduce((H,Z)=>{if(!u.hasAxisPart(Z))return H;const ve=ex(B[Z]??{},r),De=Z==="labels"?qw(r,n,ve):ve;return De!==void 0&&!dt(De)&&(H[Z]={update:De}),H},{});return dt(G)||u.set("encode",G,!!s.encoding||s.labelAngle!==void 0),u}function Jw({encoding:n,size:r}){for(const s of ur){const u=Ln(s);Ui(r[u])&&yr(n[s])&&(delete r[u],oe(Sf(u)))}return r}const e2={vgMark:"arc",encodeEntry:n=>({...Ci(n,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"}),...yn("x",n,{defaultPos:"mid"}),...yn("y",n,{defaultPos:"mid"}),...Co(n,"radius"),...Co(n,"theta")})},t2={vgMark:"area",encodeEntry:n=>({...Ci(n,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"}),...la("x",n,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:n.markDef.orient==="horizontal"}),...la("y",n,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:n.markDef.orient==="vertical"}),...fn(n)})},n2={vgMark:"rect",encodeEntry:n=>({...Ci(n,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),...Co(n,"x"),...Co(n,"y")})},i2={vgMark:"shape",encodeEntry:n=>({...Ci(n,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})}),postEncodingTransform:n=>{const{encoding:r}=n,s=r.shape;return[{type:"geoshape",projection:n.projectionName(),...s&&ae(s)&&s.type===Ks?{field:le(s,{expr:"datum"})}:{}}]}},r2={vgMark:"image",encodeEntry:n=>({...Ci(n,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"}),...Co(n,"x"),...Co(n,"y"),...Cd(n,"url")})},o2={vgMark:"line",encodeEntry:n=>({...Ci(n,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"}),...yn("x",n,{defaultPos:"mid"}),...yn("y",n,{defaultPos:"mid"}),...cn("size",n,{vgChannel:"strokeWidth"}),...fn(n)})},s2={vgMark:"trail",encodeEntry:n=>({...Ci(n,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"}),...yn("x",n,{defaultPos:"mid"}),...yn("y",n,{defaultPos:"mid"}),...cn("size",n),...fn(n)})};function Tu(n,r){const{config:s}=n;return{...Ci(n,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"}),...yn("x",n,{defaultPos:"mid"}),...yn("y",n,{defaultPos:"mid"}),...cn("size",n),...cn("angle",n),...Mx(n,s,r)}}function Mx(n,r,s){return s?{shape:{value:s}}:cn("shape",n)}const a2={vgMark:"symbol",encodeEntry:n=>Tu(n)},Bx={vgMark:"symbol",encodeEntry:n=>Tu(n,"circle")},u2={vgMark:"symbol",encodeEntry:n=>Tu(n,"square")},l2={vgMark:"rect",encodeEntry:n=>({...Ci(n,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),...Co(n,"x"),...Co(n,"y")})},c2={vgMark:"rule",encodeEntry:n=>{const{markDef:r}=n,s=r.orient;return!n.encoding.x&&!n.encoding.y&&!n.encoding.latitude&&!n.encoding.longitude?{}:{...Ci(n,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),...la("x",n,{defaultPos:s==="horizontal"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:s!=="vertical"}),...la("y",n,{defaultPos:s==="vertical"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:s!=="horizontal"}),...cn("size",n,{vgChannel:"strokeWidth"})}}},f2={vgMark:"text",encodeEntry:n=>{const{config:r,encoding:s}=n;return{...Ci(n,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"}),...yn("x",n,{defaultPos:"mid"}),...yn("y",n,{defaultPos:"mid"}),...Cd(n),...cn("size",n,{vgChannel:"fontSize"}),...cn("angle",n),...ca("align",d2(n.markDef,s,r)),...ca("baseline",Nm(n.markDef,s,r)),...yn("radius",n,{defaultPos:null}),...yn("theta",n,{defaultPos:null})}}};function d2(n,r,s){if(ct("align",n,s)===void 0)return"center"}function Nm(n,r,s){if(ct("baseline",n,s)===void 0)return"middle"}const gh={arc:e2,area:t2,bar:n2,circle:Bx,geoshape:i2,image:r2,line:o2,point:a2,rect:l2,rule:c2,square:u2,text:f2,tick:{vgMark:"rect",encodeEntry:n=>{const{config:r,markDef:s}=n,u=s.orient,c=u==="horizontal"?"x":"y",d=u==="horizontal"?"y":"x",p=u==="horizontal"?"height":"width";return{...Ci(n,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),...Co(n,c),...yn(d,n,{defaultPos:"mid",vgChannel:d==="y"?"yc":"xc"}),[p]:Et(ct("thickness",s,r))}}},trail:s2};function _m(n){if(Ue([bl,_f,Ny],n.mark)){const r=Jf(n.mark,n.encoding);if(r.length>0)return h2(n,r)}else if(n.mark===Mf){const r=ul.some(s=>ct(s,n.markDef,n.config));if(n.stack&&!n.fieldDef("size")&&r)return g2(n)}return Bm(n)}const Mm="faceted_path_";function h2(n,r){return[{name:n.getName("pathgroup"),type:"group",from:{facet:{name:Mm+n.requestDataName(Ge.Main),data:n.requestDataName(Ge.Main),groupby:r}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:Bm(n,{fromPrefix:Mm})}]}const Lx="stack_group_";function g2(n){const[r]=Bm(n,{fromPrefix:Lx}),s=n.scaleName(n.stack.fieldChannel),u=(A={})=>n.vgField(n.stack.fieldChannel,A),c=(A,F)=>{const $=[u({prefix:"min",suffix:"start",expr:F}),u({prefix:"max",suffix:"start",expr:F}),u({prefix:"min",suffix:"end",expr:F}),u({prefix:"max",suffix:"end",expr:F})];return`${A}(${$.map(_=>`scale('${s}',${_})`).join(",")})`};let d,p;n.stack.fieldChannel==="x"?(d={...Go(r.encode.update,["y","yc","y2","height",...ul]),x:{signal:c("min","datum")},x2:{signal:c("max","datum")},clip:{value:!0}},p={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},r.encode.update={...Yn(r.encode.update,["y","yc","y2"]),height:{field:{group:"height"}}}):(d={...Go(r.encode.update,["x","xc","x2","width"]),y:{signal:c("min","datum")},y2:{signal:c("max","datum")},clip:{value:!0}},p={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},r.encode.update={...Yn(r.encode.update,["x","xc","x2"]),width:{field:{group:"width"}}});for(const A of ul){const F=Pr(A,n.markDef,n.config);r.encode.update[A]?(d[A]=r.encode.update[A],delete r.encode.update[A]):F&&(d[A]=Et(F)),F&&(r.encode.update[A]={value:0})}const y=[];if(n.stack.groupbyChannels?.length>0)for(const A of n.stack.groupbyChannels){const F=n.fieldDef(A),$=le(F);$&&y.push($),(F?.bin||F?.timeUnit)&&y.push(le(F,{binSuffix:"end"}))}return d=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"].reduce((A,F)=>{if(r.encode.update[F])return{...A,[F]:r.encode.update[F]};{const $=Pr(F,n.markDef,n.config);return $!==void 0?{...A,[F]:Et($)}:A}},d),d.stroke&&(d.strokeForeground={value:!0},d.strokeOffset={value:0}),[{type:"group",from:{facet:{data:n.requestDataName(Ge.Main),name:Lx+n.requestDataName(Ge.Main),groupby:y,aggregate:{fields:[u({suffix:"start"}),u({suffix:"start"}),u({suffix:"end"}),u({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:d},marks:[{type:"group",encode:{update:p},marks:[r]}]}]}function Rc(n){const{encoding:r,stack:s,mark:u,markDef:c,config:d}=n,p=r.order;if(!(!pe(p)&&vr(p)&&tg(p.value)||!p&&tg(ct("order",c,d)))){if((pe(p)||ae(p))&&!s)return Sg(p,{expr:"datum"});if(es(u)){const y=c.orient==="horizontal"?"y":"x",E=r[y];if(ae(E))return{field:y}}}}function Bm(n,r={fromPrefix:""}){const{mark:s,markDef:u,encoding:c,config:d}=n,p=It(u.clip,zx(n),p2(n)),y=H1(u),E=c.key,A=Rc(n),F=m2(n),$=ct("aria",u,d),_=gh[s].postEncodingTransform?gh[s].postEncodingTransform(n):null;return[{name:n.getName("marks"),type:gh[s].vgMark,...p?{clip:p}:{},...y?{style:y}:{},...E?{key:E.field}:{},...A?{sort:A}:{},...F||{},...$===!1?{aria:$}:{},from:{data:r.fromPrefix+n.requestDataName(Ge.Main)},encode:{update:gh[s].encodeEntry(n)},..._?{transform:_}:{}}]}function zx(n){const r=n.getScaleComponent("x"),s=n.getScaleComponent("y");return r?.get("selectionExtent")||s?.get("selectionExtent")?!0:void 0}function p2(n){const r=n.component.projection;return r&&!r.isFit?!0:void 0}function m2(n){if(!n.component.selection)return null;const r=te(n.component.selection).length;let s=r,u=n.parent;for(;u&&s===0;)s=te(u.component.selection).length,u=u.parent;return s?{interactive:r>0||n.mark==="geoshape"||!!n.encoding.tooltip||!!n.markDef.tooltip}:null}class Ix extends Fx{constructor(r,s,u,c={},d){super(r,"unit",s,u,d,void 0,bo(r)?r.view:void 0),this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection=[],this.children=[],this.correctDataNames=A=>(A.from?.data&&(A.from.data=this.lookupDataSource(A.from.data),"time"in this.encoding&&(A.from.data=A.from.data+l0)),A.from?.facet?.data&&(A.from.facet.data=this.lookupDataSource(A.from.facet.data)),A);const p=gr(r.mark)?{...r.mark}:{type:r.mark},y=p.type;p.filled===void 0&&(p.filled=vS(p,d,{graticule:r.data&&Er(r.data)}));const E=this.encoding=Fp(r.encoding||{},y,p.filled,d);this.markDef=Wl(p,E,d),this.size=Jw({encoding:E,size:bo(r)?{...c,...r.width?{width:r.width}:{},...r.height?{height:r.height}:{}}:c}),this.stack=Gp(this.markDef,E),this.specifiedScales=this.initScales(y,E),this.specifiedAxes=this.initAxes(E),this.specifiedLegends=this.initLegends(E),this.specifiedProjection=r.projection,this.selection=(r.params??[]).filter(A=>sd(A))}get hasProjection(){const{encoding:r}=this,s=this.mark===_y,u=r&&Ko.some(c=>Me(r[c]));return s||u}scaleDomain(r){const s=this.specifiedScales[r];return s?s.domain:void 0}axis(r){return this.specifiedAxes[r]}legend(r){return this.specifiedLegends[r]}initScales(r,s){return af.reduce((u,c)=>{const d=At(s[c]);return d&&(u[c]=this.initScale(d.scale??{})),u},{})}initScale(r){const{domain:s,range:u}=r,c=Wt(r);return pe(s)&&(c.domain=s.map(di)),pe(u)&&(c.range=u.map(di)),c}initAxes(r){return ur.reduce((s,u)=>{const c=r[u];if(Me(c)||u===wt&&Me(r.x2)||u===Ot&&Me(r.y2)){const d=Me(c)?c.axis:void 0;s[u]=d&&this.initAxis({...d})}return s},{})}initAxis(r){const s=te(r),u={};for(const c of s){const d=r[c];u[c]=Hr(d)?po(d):di(d)}return u}initLegends(r){return ol.reduce((s,u)=>{const c=At(r[u]);if(c&&mg(u)){const d=c.legend;s[u]=d&&Wt(d)}return s},{})}parseData(){this.component.data=Oc(this)}parseLayoutSize(){kx(this)}parseSelections(){this.component.selection=$F(this,this.selection)}parseMarkGroup(){this.component.mark=_m(this)}parseAxesAndHeaders(){this.component.axes=Xw(this)}assembleSelectionTopLevelSignals(r){return gu(this,r)}assembleSignals(){return[...Pd(this),..._S(this,[])]}assembleSelectionData(r){return Sr(this,r)}assembleLayout(){return null}assembleLayoutSignals(){return gc(this)}assembleMarks(){let r=this.component.mark??[];return(!this.parent||!Qr(this.parent))&&(r=Vi(this,r)),r.map(this.correctDataNames)}assembleGroupStyle(){const{style:r}=this.view||{};return r!==void 0?r:this.encoding.x||this.encoding.y?"cell":"view"}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(r){return bi(this.encoding,r)}fieldDef(r){const s=this.encoding[r];return Li(s)}typedFieldDef(r){const s=this.fieldDef(r);return Mt(s)?s:null}}class Ru extends ih{constructor(r,s,u,c,d){super(r,"layer",s,u,d,r.resolve,r.view);const p={...c,...r.width?{width:r.width}:{},...r.height?{height:r.height}:{}};this.children=r.layer.map((y,E)=>{if(Pt(y))return new Ru(y,this,this.getName(`layer_${E}`),p,d);if(vi(y))return new Ix(y,this,this.getName(`layer_${E}`),p,d);throw new Error(pf(y))})}parseData(){this.component.data=Oc(this);for(const r of this.children)r.parseData()}parseLayoutSize(){Dx(this)}parseSelections(){this.component.selection={};for(const r of this.children){r.parseSelections();for(const s of te(r.component.selection))this.component.selection[s]=r.component.selection[s]}Object.values(this.component.selection).some(r=>qr(r))&&Hg(_g)}parseMarkGroup(){for(const r of this.children)r.parseMarkGroup()}parseAxesAndHeaders(){Yw(this)}assembleSelectionTopLevelSignals(r){return this.children.reduce((s,u)=>u.assembleSelectionTopLevelSignals(s),r)}assembleSignals(){return this.children.reduce((r,s)=>r.concat(s.assembleSignals()),Pd(this))}assembleLayoutSignals(){return this.children.reduce((r,s)=>r.concat(s.assembleLayoutSignals()),gc(this))}assembleSelectionData(r){return this.children.reduce((s,u)=>u.assembleSelectionData(s),r)}assembleGroupStyle(){const r=new Set;for(const u of this.children)for(const c of vt(u.assembleGroupStyle()))r.add(c);const s=Array.from(r);return s.length>1?s:s.length===1?s[0]:void 0}assembleTitle(){let r=super.assembleTitle();if(r)return r;for(const s of this.children)if(r=s.assembleTitle(),r)return r}assembleLayout(){return null}assembleMarks(){return ds(this,this.children.flatMap(r=>r.assembleMarks()))}assembleLegends(){return this.children.reduce((r,s)=>r.concat(s.assembleLegends()),ax(this))}}function Nu(n,r,s,u,c){if(Gf(n))return new $c(n,r,s,c);if(Pt(n))return new Ru(n,r,s,u,c);if(vi(n))return new Ix(n,r,s,u,c);if(pv(n))return new Hw(n,r,s,c);throw new Error(pf(n))}function y2(n,r={}){r.logger&&fC(r.logger),r.fieldTitle&&os(r.fieldTitle);try{const s=Pp(Vc(r.config,n.config)),u=t0(n,s),c=Nu(u,null,"",void 0,s);return c.parse(),Zd(c.component.data,c),{spec:b2(c,v2(n,u.autosize,s,c),n.datasets,n.usermeta),normalized:u}}finally{r.logger&&Vg(),r.fieldTitle&&bp()}}function v2(n,r,s,u){const c=u.component.layoutSize.get("width"),d=u.component.layoutSize.get("height");if(r===void 0?(r={type:"pad"},u.hasAxisOrientSignalRef()&&(r.resize=!0)):U(r)&&(r={type:r}),c&&d&&OS(r.type)){if(c==="step"&&d==="step")oe(mf()),r.type="pad";else if(c==="step"||d==="step"){const p=c==="step"?"width":"height";oe(mf(Ga(p)));const y=p==="width"?"height":"width";r.type=n0(y)}}return{...te(r).length===1&&r.type?r.type==="pad"?{}:{autosize:r.type}:{autosize:r},...i0(s,!1),...i0(n,!0)}}function b2(n,r,s={},u){const c=n.config?Sv(n.config):void 0,d=Iw(n.component.data,s),p=n.assembleSelectionData(d),y=n.assembleProjections(),E=n.assembleTitle(),A=n.assembleGroupStyle(),F=n.assembleGroupEncodeEntry(!0);let $=n.assembleLayoutSignals();$=$.filter(T=>(T.name==="width"||T.name==="height")&&T.value!==void 0?(r[T.name]=+T.value,!1):!0);const{params:_,...L}=r;return{$schema:"https://vega.github.io/schema/vega/v5.json",...n.description?{description:n.description}:{},...L,...E?{title:E}:{},...A?{style:A}:{},...F?{encode:{update:F}}:{},data:p,...y.length>0?{projections:y}:{},...n.assembleGroup([...$,...n.assembleSelectionTopLevelSignals([]),...ad(_)]),...c?{config:c}:{},...u?{usermeta:u}:{}}}const x2=Rr.rE;function E2(n){const[r,s]=/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g.exec(n).slice(1,3);return{library:r,version:s}}const Px=E2;var Lm="vega-themes",Ux="2.15.0",zm="Themes for stylized Vega and Vega-Lite visualizations.",A2=["vega","vega-lite","themes","style"],jn="BSD-3-Clause",jx={name:"UW Interactive Data Lab",url:"https://idl.cs.washington.edu"},Jr=[{name:"Emily Gu",url:"https://github.com/emilygu"},{name:"Arvind Satyanarayan",url:"http://arvindsatya.com"},{name:"Jeffrey Heer",url:"https://idl.cs.washington.edu"},{name:"Dominik Moritz",url:"https://www.domoritz.de"}],C2="build/vega-themes.js",Im="build/vega-themes.module.js",S2="build/vega-themes.min.js",F2="build/vega-themes.min.js",w2="build/vega-themes.module.d.ts",D2={type:"git",url:"https://github.com/vega/vega-themes.git"},k2=["src","build"],Pm={prebuild:"yarn clean",build:"rollup -c",clean:"rimraf build && rimraf examples/build","copy:data":"rsync -r node_modules/vega-datasets/data/* examples/data","copy:build":"rsync -r build/* examples/build","deploy:gh":"yarn build && mkdir -p examples/build && rsync -r build/* examples/build && gh-pages -d examples",preversion:"yarn lint",serve:"browser-sync start -s -f build examples --serveStatic examples",start:"yarn build && concurrently --kill-others -n Server,Rollup 'yarn serve' 'rollup -c -w'",format:"eslint . --fix",lint:"eslint .",release:"release-it"},$2={"@babel/core":"^7.24.6","@babel/plugin-transform-runtime":"^7.24.6","@babel/preset-env":"^7.24.6","@babel/preset-typescript":"^7.24.6","@release-it/conventional-changelog":"^8.0.1","@rollup/plugin-json":"^6.1.0","@rollup/plugin-node-resolve":"^15.2.3","@rollup/plugin-terser":"^0.4.4","@typescript-eslint/eslint-plugin":"^7.11.0","@typescript-eslint/parser":"^7.11.0","browser-sync":"^3.0.2",concurrently:"^8.2.2",eslint:"^8.45.0","eslint-config-prettier":"^9.1.0","eslint-plugin-prettier":"^5.1.3","gh-pages":"^6.1.1",prettier:"^3.2.5","release-it":"^17.3.0",rollup:"^4.18.0","rollup-plugin-bundle-size":"^1.0.3","rollup-plugin-ts":"^3.4.5",typescript:"^5.4.5",vega:"^5.25.0","vega-lite":"^5.9.3"},O2={vega:"*","vega-lite":"*"},T2={},Um={name:Lm,version:Ux,description:zm,keywords:A2,license:jn,author:jx,contributors:Jr,main:C2,module:Im,unpkg:S2,jsdelivr:F2,types:w2,repository:D2,files:k2,scripts:Pm,devDependencies:$2,peerDependencies:O2,dependencies:T2};const xs="#fff",Gx="#888",R2={background:"#333",view:{stroke:Gx},title:{color:xs,subtitleColor:xs},style:{"guide-label":{fill:xs},"guide-title":{fill:xs}},axis:{domainColor:xs,gridColor:Gx,tickColor:xs}},Es="#4572a7",N2={background:"#fff",arc:{fill:Es},area:{fill:Es},line:{stroke:Es,strokeWidth:2},path:{stroke:Es},rect:{fill:Es},shape:{stroke:Es},symbol:{fill:Es,strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:!0,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:!1,tickExtra:!0},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}},As="#30a2da",ph="#cbcbcb",_2="#999",M2="#333",Wx="#f0f0f0",jm="#333",B2={arc:{fill:As},area:{fill:As},axis:{domainColor:ph,grid:!0,gridColor:ph,gridWidth:1,labelColor:_2,labelFontSize:10,titleColor:M2,tickColor:ph,tickSize:10,titleFontSize:14,titlePadding:10,labelPadding:4},axisBand:{grid:!1},background:Wx,group:{fill:Wx},legend:{labelColor:jm,labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleColor:jm,titleFontSize:14,titlePadding:10},line:{stroke:As,strokeWidth:2},path:{stroke:As,strokeWidth:.5},rect:{fill:As},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},point:{filled:!0,shape:"circle"},shape:{stroke:As},bar:{binSpacing:2,fill:As,stroke:null},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}},eo="#000",Gm={group:{fill:"#e5e5e5"},arc:{fill:eo},area:{fill:eo},line:{stroke:eo},path:{stroke:eo},rect:{fill:eo},shape:{stroke:eo},symbol:{fill:eo,size:40},axis:{domain:!1,grid:!0,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}},L2=22,z2="normal",Vx="Benton Gothic, sans-serif",Hx=11.5,I2="normal",Sa="#82c6df",Wm="Benton Gothic Bold, sans-serif",qx="normal",Xx=13,Nc={"category-6":["#ec8431","#829eb1","#c89d29","#3580b1","#adc839","#ab7fb4"],"fire-7":["#fbf2c7","#f9e39c","#f8d36e","#f4bb6a","#e68a4f","#d15a40","#ab4232"],"fireandice-6":["#e68a4f","#f4bb6a","#f9e39c","#dadfe2","#a6b7c6","#849eae"],"ice-7":["#edefee","#dadfe2","#c4ccd2","#a6b7c6","#849eae","#607785","#47525d"]},P2={background:"#ffffff",title:{anchor:"start",color:"#000000",font:Wm,fontSize:L2,fontWeight:z2},arc:{fill:Sa},area:{fill:Sa},line:{stroke:Sa,strokeWidth:2},path:{stroke:Sa},rect:{fill:Sa},shape:{stroke:Sa},symbol:{fill:Sa,size:30},axis:{labelFont:Vx,labelFontSize:Hx,labelFontWeight:I2,titleFont:Wm,titleFontSize:Xx,titleFontWeight:qx},axisX:{labelAngle:0,labelPadding:4,tickSize:3},axisY:{labelBaseline:"middle",maxExtent:45,minExtent:45,tickSize:2,titleAlign:"left",titleAngle:0,titleX:-45,titleY:-11},legend:{labelFont:Vx,labelFontSize:Hx,symbolType:"square",titleFont:Wm,titleFontSize:Xx,titleFontWeight:qx},range:{category:Nc["category-6"],diverging:Nc["fireandice-6"],heatmap:Nc["fire-7"],ordinal:Nc["fire-7"],ramp:Nc["fire-7"]}},Fa="#ab5787",mh="#979797",U2={background:"#f9f9f9",arc:{fill:Fa},area:{fill:Fa},line:{stroke:Fa},path:{stroke:Fa},rect:{fill:Fa},shape:{stroke:Fa},symbol:{fill:Fa,size:30},axis:{domainColor:mh,domainWidth:.5,gridWidth:.2,labelColor:mh,tickColor:mh,tickWidth:.2,titleColor:mh},axisBand:{grid:!1},axisX:{grid:!0,tickSize:10},axisY:{domain:!1,grid:!0,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}},wa="#3e5c69",j2={background:"#fff",arc:{fill:wa},area:{fill:wa},line:{stroke:wa},path:{stroke:wa},rect:{fill:wa},shape:{stroke:wa},symbol:{fill:wa},axis:{domainWidth:.5,grid:!0,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:!1},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}},Xi="#1696d2",Vm="#000000",Yx="#FFFFFF",yh="Lato",Hm="Lato",Kx="Lato",G2="#DEDDDD",W2=18,_c={"main-colors":["#1696d2","#d2d2d2","#000000","#fdbf11","#ec008b","#55b748","#5c5859","#db2b27"],"shades-blue":["#CFE8F3","#A2D4EC","#73BFE2","#46ABDB","#1696D2","#12719E","#0A4C6A","#062635"],"shades-gray":["#F5F5F5","#ECECEC","#E3E3E3","#DCDBDB","#D2D2D2","#9D9D9D","#696969","#353535"],"shades-yellow":["#FFF2CF","#FCE39E","#FDD870","#FCCB41","#FDBF11","#E88E2D","#CA5800","#843215"],"shades-magenta":["#F5CBDF","#EB99C2","#E46AA7","#E54096","#EC008B","#AF1F6B","#761548","#351123"],"shades-green":["#DCEDD9","#BCDEB4","#98CF90","#78C26D","#55B748","#408941","#2C5C2D","#1A2E19"],"shades-black":["#D5D5D4","#ADABAC","#848081","#5C5859","#332D2F","#262223","#1A1717","#0E0C0D"],"shades-red":["#F8D5D4","#F1AAA9","#E9807D","#E25552","#DB2B27","#A4201D","#6E1614","#370B0A"],"one-group":["#1696d2","#000000"],"two-groups-cat-1":["#1696d2","#000000"],"two-groups-cat-2":["#1696d2","#fdbf11"],"two-groups-cat-3":["#1696d2","#db2b27"],"two-groups-seq":["#a2d4ec","#1696d2"],"three-groups-cat":["#1696d2","#fdbf11","#000000"],"three-groups-seq":["#a2d4ec","#1696d2","#0a4c6a"],"four-groups-cat-1":["#000000","#d2d2d2","#fdbf11","#1696d2"],"four-groups-cat-2":["#1696d2","#ec0008b","#fdbf11","#5c5859"],"four-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a"],"five-groups-cat-1":["#1696d2","#fdbf11","#d2d2d2","#ec008b","#000000"],"five-groups-cat-2":["#1696d2","#0a4c6a","#d2d2d2","#fdbf11","#332d2f"],"five-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a","#000000"],"six-groups-cat-1":["#1696d2","#ec008b","#fdbf11","#000000","#d2d2d2","#55b748"],"six-groups-cat-2":["#1696d2","#d2d2d2","#ec008b","#fdbf11","#332d2f","#0a4c6a"],"six-groups-seq":["#cfe8f3","#a2d4ec","#73bfe2","#46abdb","#1696d2","#12719e"],"diverging-colors":["#ca5800","#fdbf11","#fdd870","#fff2cf","#cfe8f3","#73bfe2","#1696d2","#0a4c6a"]},Qx={background:Yx,title:{anchor:"start",fontSize:W2,font:yh},axisX:{domain:!0,domainColor:Vm,domainWidth:1,grid:!1,labelFontSize:12,labelFont:Hm,labelAngle:0,tickColor:Vm,tickSize:5,titleFontSize:12,titlePadding:10,titleFont:yh},axisY:{domain:!1,domainWidth:1,grid:!0,gridColor:G2,gridWidth:1,labelFontSize:12,labelFont:Hm,labelPadding:8,ticks:!1,titleFontSize:12,titlePadding:10,titleFont:yh,titleAngle:0,titleY:-10,titleX:18},legend:{labelFontSize:12,labelFont:Hm,symbolSize:100,titleFontSize:12,titlePadding:10,titleFont:yh,orient:"right",offset:10},view:{stroke:"transparent"},range:{category:_c["six-groups-cat-1"],diverging:_c["diverging-colors"],heatmap:_c["diverging-colors"],ordinal:_c["six-groups-seq"],ramp:_c["shades-blue"]},area:{fill:Xi},rect:{fill:Xi},line:{color:Xi,stroke:Xi,strokeWidth:5},trail:{color:Xi,stroke:Xi,strokeWidth:0,size:1},path:{stroke:Xi,strokeWidth:.5},point:{filled:!0},text:{font:Kx,color:Xi,fontSize:11,align:"center",fontWeight:400,size:11},style:{bar:{fill:Xi,stroke:null}},arc:{fill:Xi},shape:{stroke:Xi},symbol:{fill:Xi,size:30}},Da="#3366CC",Zx="#ccc",vh="Arial, sans-serif",V2={arc:{fill:Da},area:{fill:Da},path:{stroke:Da},rect:{fill:Da},shape:{stroke:Da},symbol:{stroke:Da},circle:{fill:Da},background:"#fff",padding:{top:10,right:10,bottom:10,left:10},style:{"guide-label":{font:vh,fontSize:12},"guide-title":{font:vh,fontSize:12},"group-title":{font:vh,fontSize:12}},title:{font:vh,fontSize:14,fontWeight:"bold",dy:-3,anchor:"start"},axis:{gridColor:Zx,tickColor:Zx,domain:!1,grid:!0},range:{category:["#4285F4","#DB4437","#F4B400","#0F9D58","#AB47BC","#00ACC1","#FF7043","#9E9D24","#5C6BC0","#F06292","#00796B","#C2185B"],heatmap:["#c6dafc","#5e97f6","#2a56c6"]}},qm=n=>n*(1/3+1),_u=qm(9),Jx=qm(10),eE=qm(12),Mu="Segoe UI",bh="wf_standard-font, helvetica, arial, sans-serif",Xm="#252423",ka="#605E5C",tE="transparent",Ht="#C8C6C4",Kt="#118DFF",H2="#12239E",q2="#E66C37",nE="#6B007B",X2="#E044A7",Ym="#744EC2",Y2="#D9B300",K2="#D64550",Bu=Kt,iE="#DEEFFF",rE=[iE,Bu],Q2={view:{stroke:tE},background:tE,font:Mu,header:{titleFont:bh,titleFontSize:eE,titleColor:Xm,labelFont:Mu,labelFontSize:Jx,labelColor:ka},axis:{ticks:!1,grid:!1,domain:!1,labelColor:ka,labelFontSize:_u,titleFont:bh,titleColor:Xm,titleFontSize:eE,titleFontWeight:"normal"},axisQuantitative:{tickCount:3,grid:!0,gridColor:Ht,gridDash:[1,5],labelFlush:!1},axisBand:{tickExtra:!0},axisX:{labelPadding:5},axisY:{labelPadding:10},bar:{fill:Kt},line:{stroke:Kt,strokeWidth:3,strokeCap:"round",strokeJoin:"round"},text:{font:Mu,fontSize:_u,fill:ka},arc:{fill:Kt},area:{fill:Kt,line:!0,opacity:.6},path:{stroke:Kt},rect:{fill:Kt},point:{fill:Kt,filled:!0,size:75},shape:{stroke:Kt},symbol:{fill:Kt,strokeWidth:1.5,size:50},legend:{titleFont:Mu,titleFontWeight:"bold",titleColor:ka,labelFont:Mu,labelFontSize:Jx,labelColor:ka,symbolType:"circle",symbolSize:75},range:{category:[Kt,H2,q2,nE,X2,Ym,Y2,K2],diverging:rE,heatmap:rE,ordinal:[iE,"#c7e4ff","#b0d9ff","#9aceff","#83c3ff","#6cb9ff","#55aeff","#3fa3ff","#2898ff",Bu]}},Km='IBM Plex Sans,system-ui,-apple-system,BlinkMacSystemFont,".sfnstext-regular",sans-serif',oE='IBM Plex Sans Condensed, system-ui, -apple-system, BlinkMacSystemFont, ".SFNSText-Regular", sans-serif',xh=400,Eh={textPrimary:{g90:"#f4f4f4",g100:"#f4f4f4",white:"#161616",g10:"#161616"},textSecondary:{g90:"#c6c6c6",g100:"#c6c6c6",white:"#525252",g10:"#525252"},layerAccent01:{white:"#e0e0e0",g10:"#e0e0e0",g90:"#525252",g100:"#393939"},gridBg:{white:"#ffffff",g10:"#ffffff",g90:"#161616",g100:"#161616"}},Z2=["#8a3ffc","#33b1ff","#007d79","#ff7eb6","#fa4d56","#fff1f1","#6fdc8c","#4589ff","#d12771","#d2a106","#08bdba","#bae6ff","#ba4e00","#d4bbff"],J2=["#6929c4","#1192e8","#005d5d","#9f1853","#fa4d56","#570408","#198038","#002d9c","#ee538b","#b28600","#009d9a","#012749","#8a3800","#a56eff"];function Ah({theme:n,background:r}){const s=["white","g10"].includes(n)?"light":"dark",u=Eh.gridBg[n],c=Eh.textPrimary[n],d=Eh.textSecondary[n],p=s==="dark"?Z2:J2,y=s==="dark"?"#d4bbff":"#6929c4";return{background:r,arc:{fill:y},area:{fill:y},path:{stroke:y},rect:{fill:y},shape:{stroke:y},symbol:{stroke:y},circle:{fill:y},view:{fill:u,stroke:u},group:{fill:u},title:{color:c,anchor:"start",dy:-15,fontSize:16,font:Km,fontWeight:600},axis:{labelColor:d,labelFontSize:12,labelFont:oE,labelFontWeight:xh,titleColor:c,titleFontWeight:600,titleFontSize:12,grid:!0,gridColor:Eh.layerAccent01[n],labelAngle:0},axisX:{titlePadding:10},axisY:{titlePadding:2.5},style:{"guide-label":{font:Km,fill:d,fontWeight:xh},"guide-title":{font:Km,fill:d,fontWeight:xh}},range:{category:p,diverging:["#750e13","#a2191f","#da1e28","#fa4d56","#ff8389","#ffb3b8","#ffd7d9","#fff1f1","#e5f6ff","#bae6ff","#82cfff","#33b1ff","#1192e8","#0072c3","#00539a","#003a6d"],heatmap:["#f6f2ff","#e8daff","#d4bbff","#be95ff","#a56eff","#8a3ffc","#6929c4","#491d8b","#31135e","#1c0f30"]}}}const eD=Ah({theme:"white",background:"#ffffff"}),tD=Ah({theme:"g10",background:"#f4f4f4"}),nD=Ah({theme:"g90",background:"#262626"}),iD=Ah({theme:"g100",background:"#161616"}),rD=Um.version;var oD="vega-tooltip",sD="0.34.0",aD="A tooltip plugin for Vega-Lite and Vega visualizations.",uD=["vega-lite","vega","tooltip"],lD={type:"git",url:"https://github.com/vega/vega-tooltip.git"},sE={name:"UW Interactive Data Lab",url:"https://idl.cs.washington.edu"},aE=["Dominik Moritz","Sira Horradarn","Zening Qu","Kanit Wongsuphasawat","Yuri Astrakhan","Jeffrey Heer"],uE="BSD-3-Clause",cD={url:"https://github.com/vega/vega-tooltip/issues"},fD="https://github.com/vega/vega-tooltip#readme",lE="build/vega-tooltip.js",dD="build/vega-tooltip.module.js",Qm="build/vega-tooltip.min.js",hD="build/vega-tooltip.min.js",Zm="build/vega-tooltip.module.d.ts",Ch=["src","build","types"],gD={prebuild:"yarn clean && yarn build:style",build:"rollup -c","build:style":"./build-style.sh",clean:"rimraf build && rimraf src/style.ts","copy:data":"rsync -r node_modules/vega-datasets/data/* examples/data","copy:build":"rsync -r build/* examples/build","deploy:gh":"yarn build && yarn copy:build && gh-pages -d examples && yarn clean",prepublishOnly:"yarn clean && yarn build",preversion:"yarn lint && yarn test",serve:"browser-sync start -s -f build examples --serveStatic examples",start:"yarn build && concurrently --kill-others -n Server,Rollup 'yarn serve' 'rollup -c -w'",pretest:"yarn build:style",test:"jest","test:inspect":"node --inspect-brk ./node_modules/.bin/jest --runInBand",prepare:"yarn copy:data",prettierbase:"prettier '*.{css,scss,html}'",format:"eslint . --fix && yarn prettierbase --write",lint:"eslint . && yarn prettierbase --check",release:"release-it"},Sh={"@babel/core":"^7.22.10","@babel/plugin-proposal-async-generator-functions":"^7.20.7","@babel/plugin-proposal-json-strings":"^7.18.6","@babel/plugin-proposal-object-rest-spread":"^7.20.7","@babel/plugin-proposal-optional-catch-binding":"^7.18.6","@babel/plugin-transform-runtime":"^7.22.10","@babel/preset-env":"^7.22.10","@babel/preset-typescript":"^7.22.5","@release-it/conventional-changelog":"^7.0.0","@rollup/plugin-json":"^6.0.0","@rollup/plugin-node-resolve":"^15.1.0","@rollup/plugin-terser":"^0.4.3","@types/jest":"^29.5.3","@typescript-eslint/eslint-plugin":"^6.3.0","@typescript-eslint/parser":"^6.3.0","browser-sync":"^2.29.3",concurrently:"^8.2.0",eslint:"^8.46.0","eslint-config-prettier":"^9.0.0","eslint-plugin-jest":"^27.2.3","eslint-plugin-prettier":"^5.0.0","gh-pages":"^6.1.0",jest:"^29.6.2","jest-environment-jsdom":"^29.6.2",path:"^0.12.7",prettier:"^3.0.1","release-it":"^16.1.3",rollup:"^4.6.1","rollup-plugin-bundle-size":"^1.0.3","rollup-plugin-ts":"^3.4.3",sass:"^1.64.2",typescript:"~5.3.2","vega-datasets":"^2.7.0","vega-typings":"^0.24.2"},pD={"vega-util":"^1.17.2"},mD={name:oD,version:sD,description:aD,keywords:uD,repository:lD,author:sE,collaborators:aE,license:uE,bugs:cD,homepage:fD,main:lE,module:dD,unpkg:Qm,jsdelivr:hD,types:Zm,files:Ch,scripts:gD,devDependencies:Sh,dependencies:pD};function cE(n,r,s,u){if((0,oc.cy)(n))return`[${n.map(c=>r((0,oc.Kg)(c)?c:Mc(c,s))).join(", ")}]`;if((0,oc.Gv)(n)){let c="";const{title:d,image:p,...y}=n;d&&(c+=`<h2>${r(d)}</h2>`),p&&(c+=`<img src="${new URL(r(p),u||location.href).href}">`);const E=Object.keys(y);if(E.length>0){c+="<table>";for(const A of E){let F=y[A];F!==void 0&&((0,oc.Gv)(F)&&(F=Mc(F,s)),c+=`<tr><td class="key">${r(A)}</td><td class="value">${r(F)}</td></tr>`)}c+="</table>"}return c||"{}"}return r(n)}function fE(n){const r=[];return function(s,u){if(typeof u!="object"||u===null)return u;const c=r.indexOf(this)+1;return r.length=c,r.length>n?"[Object]":r.indexOf(u)>=0?"[Circular]":(r.push(u),u)}}function Mc(n,r){return JSON.stringify(n,fE(r))}var yD=`#vg-tooltip-element {
  visibility: hidden;
  padding: 8px;
  position: fixed;
  z-index: 1000;
  font-family: sans-serif;
  font-size: 11px;
  border-radius: 3px;
  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
  /* The default theme is the light theme. */
  background-color: rgba(255, 255, 255, 0.95);
  border: 1px solid #d9d9d9;
  color: black;
}
#vg-tooltip-element.visible {
  visibility: visible;
}
#vg-tooltip-element h2 {
  margin-top: 0;
  margin-bottom: 10px;
  font-size: 13px;
}
#vg-tooltip-element table {
  border-spacing: 0;
}
#vg-tooltip-element table tr {
  border: none;
}
#vg-tooltip-element table tr td {
  overflow: hidden;
  text-overflow: ellipsis;
  padding-top: 2px;
  padding-bottom: 2px;
}
#vg-tooltip-element table tr td.key {
  color: #808080;
  max-width: 150px;
  text-align: right;
  padding-right: 4px;
}
#vg-tooltip-element table tr td.value {
  display: block;
  max-width: 300px;
  max-height: 7em;
  text-align: left;
}
#vg-tooltip-element.dark-theme {
  background-color: rgba(32, 32, 32, 0.9);
  border: 1px solid #f5f5f5;
  color: white;
}
#vg-tooltip-element.dark-theme td.key {
  color: #bfbfbf;
}
`;const dE="vg-tooltip-element",vD={offsetX:10,offsetY:10,id:dE,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:!1,sanitize:hE,maxDepth:2,formatTooltip:cE,baseURL:""};function hE(n){return String(n).replace(/&/g,"&amp;").replace(/</g,"&lt;")}function bD(n){if(!/^[A-Za-z]+[-:.\w]*$/.test(n))throw new Error("Invalid HTML ID");return yD.toString().replace(dE,n)}function xD(n,r,s,u){let c=n.clientX+s;c+r.width>window.innerWidth&&(c=+n.clientX-s-r.width);let d=n.clientY+u;return d+r.height>window.innerHeight&&(d=+n.clientY-u-r.height),{x:c,y:d}}class gE{constructor(r){this.options={...vD,...r};const s=this.options.id;if(this.el=null,this.call=this.tooltipHandler.bind(this),!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){const u=document.createElement("style");u.setAttribute("id",this.options.styleId),u.innerHTML=bD(s);const c=document.head;c.childNodes.length>0?c.insertBefore(u,c.childNodes[0]):c.appendChild(u)}}tooltipHandler(r,s,u,c){if(this.el=document.getElementById(this.options.id),this.el||(this.el=document.createElement("div"),this.el.setAttribute("id",this.options.id),this.el.classList.add("vg-tooltip"),(document.fullscreenElement??document.body).appendChild(this.el)),c==null||c===""){this.el.classList.remove("visible",`${this.options.theme}-theme`);return}this.el.innerHTML=this.options.formatTooltip(c,this.options.sanitize,this.options.maxDepth,this.options.baseURL),this.el.classList.add("visible",`${this.options.theme}-theme`);const{x:d,y:p}=xD(s,this.el.getBoundingClientRect(),this.options.offsetX,this.options.offsetY);this.el.style.top=`${p}px`,this.el.style.left=`${d}px`}}const p3=mD.version;function ED(n,r){const s=new gE(r);return n.tooltip(s.call).run(),s}var AD=z(19846);function Fh(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}class CD{constructor(){this.max=1e3,this.map=new Map}get(r){const s=this.map.get(r);if(s!==void 0)return this.map.delete(r),this.map.set(r,s),s}delete(r){return this.map.delete(r)}set(r,s){if(!this.delete(r)&&s!==void 0){if(this.map.size>=this.max){const c=this.map.keys().next().value;this.delete(c)}this.map.set(r,s)}return this}}var pE=CD;const mE=Object.freeze({loose:!0}),yE=Object.freeze({});var Jm=n=>n?typeof n!="object"?mE:n:yE,Gn={exports:{}};const SD="2.0.0",vE=256,FD=Number.MAX_SAFE_INTEGER||9007199254740991,wD=16,DD=vE-6;var e1={MAX_LENGTH:vE,MAX_SAFE_COMPONENT_LENGTH:wD,MAX_SAFE_BUILD_LENGTH:DD,MAX_SAFE_INTEGER:FD,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:SD,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},wh=typeof AD=="object"&&{}.NODE_DEBUG&&/\bsemver\b/i.test({}.NODE_DEBUG)?(...n)=>console.error("SEMVER",...n):()=>{};(function(n,r){const{MAX_SAFE_COMPONENT_LENGTH:s,MAX_SAFE_BUILD_LENGTH:u,MAX_LENGTH:c}=e1,d=wh;r=n.exports={};const p=r.re=[],y=r.safeRe=[],E=r.src=[],A=r.t={};let F=0;const $="[a-zA-Z0-9-]",_=[["\\s",1],["\\d",c],[$,u]],L=B=>{for(const[G,H]of _)B=B.split(`${G}*`).join(`${G}{0,${H}}`).split(`${G}+`).join(`${G}{1,${H}}`);return B},T=(B,G,H)=>{const Z=L(G),ve=F++;d(B,ve,G),A[B]=ve,E[ve]=G,p[ve]=new RegExp(G,H?"g":void 0),y[ve]=new RegExp(Z,H?"g":void 0)};T("NUMERICIDENTIFIER","0|[1-9]\\d*"),T("NUMERICIDENTIFIERLOOSE","\\d+"),T("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${$}*`),T("MAINVERSION",`(${E[A.NUMERICIDENTIFIER]})\\.(${E[A.NUMERICIDENTIFIER]})\\.(${E[A.NUMERICIDENTIFIER]})`),T("MAINVERSIONLOOSE",`(${E[A.NUMERICIDENTIFIERLOOSE]})\\.(${E[A.NUMERICIDENTIFIERLOOSE]})\\.(${E[A.NUMERICIDENTIFIERLOOSE]})`),T("PRERELEASEIDENTIFIER",`(?:${E[A.NUMERICIDENTIFIER]}|${E[A.NONNUMERICIDENTIFIER]})`),T("PRERELEASEIDENTIFIERLOOSE",`(?:${E[A.NUMERICIDENTIFIERLOOSE]}|${E[A.NONNUMERICIDENTIFIER]})`),T("PRERELEASE",`(?:-(${E[A.PRERELEASEIDENTIFIER]}(?:\\.${E[A.PRERELEASEIDENTIFIER]})*))`),T("PRERELEASELOOSE",`(?:-?(${E[A.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${E[A.PRERELEASEIDENTIFIERLOOSE]})*))`),T("BUILDIDENTIFIER",`${$}+`),T("BUILD",`(?:\\+(${E[A.BUILDIDENTIFIER]}(?:\\.${E[A.BUILDIDENTIFIER]})*))`),T("FULLPLAIN",`v?${E[A.MAINVERSION]}${E[A.PRERELEASE]}?${E[A.BUILD]}?`),T("FULL",`^${E[A.FULLPLAIN]}$`),T("LOOSEPLAIN",`[v=\\s]*${E[A.MAINVERSIONLOOSE]}${E[A.PRERELEASELOOSE]}?${E[A.BUILD]}?`),T("LOOSE",`^${E[A.LOOSEPLAIN]}$`),T("GTLT","((?:<|>)?=?)"),T("XRANGEIDENTIFIERLOOSE",`${E[A.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),T("XRANGEIDENTIFIER",`${E[A.NUMERICIDENTIFIER]}|x|X|\\*`),T("XRANGEPLAIN",`[v=\\s]*(${E[A.XRANGEIDENTIFIER]})(?:\\.(${E[A.XRANGEIDENTIFIER]})(?:\\.(${E[A.XRANGEIDENTIFIER]})(?:${E[A.PRERELEASE]})?${E[A.BUILD]}?)?)?`),T("XRANGEPLAINLOOSE",`[v=\\s]*(${E[A.XRANGEIDENTIFIERLOOSE]})(?:\\.(${E[A.XRANGEIDENTIFIERLOOSE]})(?:\\.(${E[A.XRANGEIDENTIFIERLOOSE]})(?:${E[A.PRERELEASELOOSE]})?${E[A.BUILD]}?)?)?`),T("XRANGE",`^${E[A.GTLT]}\\s*${E[A.XRANGEPLAIN]}$`),T("XRANGELOOSE",`^${E[A.GTLT]}\\s*${E[A.XRANGEPLAINLOOSE]}$`),T("COERCEPLAIN",`(^|[^\\d])(\\d{1,${s}})(?:\\.(\\d{1,${s}}))?(?:\\.(\\d{1,${s}}))?`),T("COERCE",`${E[A.COERCEPLAIN]}(?:$|[^\\d])`),T("COERCEFULL",E[A.COERCEPLAIN]+`(?:${E[A.PRERELEASE]})?(?:${E[A.BUILD]})?(?:$|[^\\d])`),T("COERCERTL",E[A.COERCE],!0),T("COERCERTLFULL",E[A.COERCEFULL],!0),T("LONETILDE","(?:~>?)"),T("TILDETRIM",`(\\s*)${E[A.LONETILDE]}\\s+`,!0),r.tildeTrimReplace="$1~",T("TILDE",`^${E[A.LONETILDE]}${E[A.XRANGEPLAIN]}$`),T("TILDELOOSE",`^${E[A.LONETILDE]}${E[A.XRANGEPLAINLOOSE]}$`),T("LONECARET","(?:\\^)"),T("CARETTRIM",`(\\s*)${E[A.LONECARET]}\\s+`,!0),r.caretTrimReplace="$1^",T("CARET",`^${E[A.LONECARET]}${E[A.XRANGEPLAIN]}$`),T("CARETLOOSE",`^${E[A.LONECARET]}${E[A.XRANGEPLAINLOOSE]}$`),T("COMPARATORLOOSE",`^${E[A.GTLT]}\\s*(${E[A.LOOSEPLAIN]})$|^$`),T("COMPARATOR",`^${E[A.GTLT]}\\s*(${E[A.FULLPLAIN]})$|^$`),T("COMPARATORTRIM",`(\\s*)${E[A.GTLT]}\\s*(${E[A.LOOSEPLAIN]}|${E[A.XRANGEPLAIN]})`,!0),r.comparatorTrimReplace="$1$2$3",T("HYPHENRANGE",`^\\s*(${E[A.XRANGEPLAIN]})\\s+-\\s+(${E[A.XRANGEPLAIN]})\\s*$`),T("HYPHENRANGELOOSE",`^\\s*(${E[A.XRANGEPLAINLOOSE]})\\s+-\\s+(${E[A.XRANGEPLAINLOOSE]})\\s*$`),T("STAR","(<|>)?=?\\s*\\*"),T("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),T("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")})(Gn,Gn.exports);var t1=Gn.exports;const bE=/^[0-9]+$/,xE=(n,r)=>{const s=bE.test(n),u=bE.test(r);return s&&u&&(n=+n,r=+r),n===r?0:s&&!u?-1:u&&!s?1:n<r?-1:1};var EE={compareIdentifiers:xE,rcompareIdentifiers:(n,r)=>xE(r,n)};const Lu=wh,{MAX_LENGTH:AE,MAX_SAFE_INTEGER:Dh}=e1,{safeRe:kh,t:zu}=t1,kD=Jm,{compareIdentifiers:$a}=EE;var i1=class Fs{constructor(r,s){if(s=kD(s),r instanceof Fs){if(r.loose===!!s.loose&&r.includePrerelease===!!s.includePrerelease)return r;r=r.version}else if(typeof r!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof r}".`);if(r.length>AE)throw new TypeError(`version is longer than ${AE} characters`);Lu("SemVer",r,s),this.options=s,this.loose=!!s.loose,this.includePrerelease=!!s.includePrerelease;const u=r.trim().match(s.loose?kh[zu.LOOSE]:kh[zu.FULL]);if(!u)throw new TypeError(`Invalid Version: ${r}`);if(this.raw=r,this.major=+u[1],this.minor=+u[2],this.patch=+u[3],this.major>Dh||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Dh||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Dh||this.patch<0)throw new TypeError("Invalid patch version");u[4]?this.prerelease=u[4].split(".").map(c=>{if(/^[0-9]+$/.test(c)){const d=+c;if(d>=0&&d<Dh)return d}return c}):this.prerelease=[],this.build=u[5]?u[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(r){if(Lu("SemVer.compare",this.version,this.options,r),!(r instanceof Fs)){if(typeof r=="string"&&r===this.version)return 0;r=new Fs(r,this.options)}return r.version===this.version?0:this.compareMain(r)||this.comparePre(r)}compareMain(r){return r instanceof Fs||(r=new Fs(r,this.options)),$a(this.major,r.major)||$a(this.minor,r.minor)||$a(this.patch,r.patch)}comparePre(r){if(r instanceof Fs||(r=new Fs(r,this.options)),this.prerelease.length&&!r.prerelease.length)return-1;if(!this.prerelease.length&&r.prerelease.length)return 1;if(!this.prerelease.length&&!r.prerelease.length)return 0;let s=0;do{const u=this.prerelease[s],c=r.prerelease[s];if(Lu("prerelease compare",s,u,c),u===void 0&&c===void 0)return 0;if(c===void 0)return 1;if(u===void 0)return-1;if(u===c)continue;return $a(u,c)}while(++s)}compareBuild(r){r instanceof Fs||(r=new Fs(r,this.options));let s=0;do{const u=this.build[s],c=r.build[s];if(Lu("build compare",s,u,c),u===void 0&&c===void 0)return 0;if(c===void 0)return 1;if(u===void 0)return-1;if(u===c)continue;return $a(u,c)}while(++s)}inc(r,s,u){switch(r){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",s,u);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",s,u);break;case"prepatch":this.prerelease.length=0,this.inc("patch",s,u),this.inc("pre",s,u);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",s,u),this.inc("pre",s,u);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const c=Number(u)?1:0;if(!s&&u===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[c];else{let d=this.prerelease.length;for(;--d>=0;)typeof this.prerelease[d]=="number"&&(this.prerelease[d]++,d=-2);if(d===-1){if(s===this.prerelease.join(".")&&u===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(c)}}if(s){let d=[s,c];u===!1&&(d=[s]),$a(this.prerelease[0],s)===0?isNaN(this.prerelease[1])&&(this.prerelease=d):this.prerelease=d}break}default:throw new Error(`invalid increment argument: ${r}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};const SE=i1;var Iu=(n,r,s)=>new SE(n,s).compare(new SE(r,s));const $D=Iu;var FE=(n,r,s)=>$D(n,r,s)===0;const wE=Iu;var kE=(n,r,s)=>wE(n,r,s)!==0;const $E=Iu;var TD=(n,r,s)=>$E(n,r,s)>0;const RD=Iu;var ND=(n,r,s)=>RD(n,r,s)>=0;const _D=Iu;var MD=(n,r,s)=>_D(n,r,s)<0;const BD=Iu;var LD=(n,r,s)=>BD(n,r,s)<=0;const OE=FE,TE=kE,zD=TD,RE=ND,$h=MD,NE=LD;var _E=(n,r,s,u)=>{switch(r){case"===":return typeof n=="object"&&(n=n.version),typeof s=="object"&&(s=s.version),n===s;case"!==":return typeof n=="object"&&(n=n.version),typeof s=="object"&&(s=s.version),n!==s;case"":case"=":case"==":return OE(n,s,u);case"!=":return TE(n,s,u);case">":return zD(n,s,u);case">=":return RE(n,s,u);case"<":return $h(n,s,u);case"<=":return NE(n,s,u);default:throw new TypeError(`Invalid operator: ${r}`)}},Oh,ME;function Bc(){if(ME)return Oh;ME=1;const n=Symbol("SemVer ANY");class r{static get ANY(){return n}constructor(F,$){if($=s($),F instanceof r){if(F.loose===!!$.loose)return F;F=F.value}F=F.trim().split(/\s+/).join(" "),p("comparator",F,$),this.options=$,this.loose=!!$.loose,this.parse(F),this.semver===n?this.value="":this.value=this.operator+this.semver.version,p("comp",this)}parse(F){const $=this.options.loose?u[c.COMPARATORLOOSE]:u[c.COMPARATOR],_=F.match($);if(!_)throw new TypeError(`Invalid comparator: ${F}`);this.operator=_[1]!==void 0?_[1]:"",this.operator==="="&&(this.operator=""),_[2]?this.semver=new y(_[2],this.options.loose):this.semver=n}toString(){return this.value}test(F){if(p("Comparator.test",F,this.options.loose),this.semver===n||F===n)return!0;if(typeof F=="string")try{F=new y(F,this.options)}catch{return!1}return d(F,this.operator,this.semver,this.options)}intersects(F,$){if(!(F instanceof r))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new E(F.value,$).test(this.value):F.operator===""?F.value===""?!0:new E(this.value,$).test(F.semver):($=s($),$.includePrerelease&&(this.value==="<0.0.0-0"||F.value==="<0.0.0-0")||!$.includePrerelease&&(this.value.startsWith("<0.0.0")||F.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&F.operator.startsWith(">")||this.operator.startsWith("<")&&F.operator.startsWith("<")||this.semver.version===F.semver.version&&this.operator.includes("=")&&F.operator.includes("=")||d(this.semver,"<",F.semver,$)&&this.operator.startsWith(">")&&F.operator.startsWith("<")||d(this.semver,">",F.semver,$)&&this.operator.startsWith("<")&&F.operator.startsWith(">")))}}Oh=r;const s=Jm,{safeRe:u,t:c}=t1,d=_E,p=wh,y=i1,E=rn();return Oh}var r1,BE;function rn(){if(BE)return r1;BE=1;class n{constructor(he,Te){if(Te=u(Te),he instanceof n)return he.loose===!!Te.loose&&he.includePrerelease===!!Te.includePrerelease?he:new n(he.raw,Te);if(he instanceof c)return this.raw=he.value,this.set=[[he]],this.format(),this;if(this.options=Te,this.loose=!!Te.loose,this.includePrerelease=!!Te.includePrerelease,this.raw=he.trim().split(/\s+/).join(" "),this.set=this.raw.split("||").map(Oe=>this.parseRange(Oe.trim())).filter(Oe=>Oe.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const Oe=this.set[0];if(this.set=this.set.filter(Ne=>!T(Ne[0])),this.set.length===0)this.set=[Oe];else if(this.set.length>1){for(const Ne of this.set)if(Ne.length===1&&B(Ne[0])){this.set=[Ne];break}}}this.format()}format(){return this.range=this.set.map(he=>he.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(he){const Oe=((this.options.includePrerelease&&_)|(this.options.loose&&L))+":"+he,Ne=s.get(Oe);if(Ne)return Ne;const Fe=this.options.loose,Ie=Fe?y[E.HYPHENRANGELOOSE]:y[E.HYPHENRANGE];he=he.replace(Ie,wi(this.options.includePrerelease)),d("hyphen replace",he),he=he.replace(y[E.COMPARATORTRIM],A),d("comparator trim",he),he=he.replace(y[E.TILDETRIM],F),d("tilde trim",he),he=he.replace(y[E.CARETTRIM],$),d("caret trim",he);let at=he.split(" ").map(Lt=>H(Lt,this.options)).join(" ").split(/\s+/).map(Lt=>dn(Lt,this.options));Fe&&(at=at.filter(Lt=>(d("loose invalid filter",Lt,this.options),!!Lt.match(y[E.COMPARATORLOOSE])))),d("range list",at);const je=new Map,St=at.map(Lt=>new c(Lt,this.options));for(const Lt of St){if(T(Lt))return[Lt];je.set(Lt.value,Lt)}je.size>1&&je.has("")&&je.delete("");const Rn=[...je.values()];return s.set(Oe,Rn),Rn}intersects(he,Te){if(!(he instanceof n))throw new TypeError("a Range is required");return this.set.some(Oe=>G(Oe,Te)&&he.set.some(Ne=>G(Ne,Te)&&Oe.every(Fe=>Ne.every(Ie=>Fe.intersects(Ie,Te)))))}test(he){if(!he)return!1;if(typeof he=="string")try{he=new p(he,this.options)}catch{return!1}for(let Te=0;Te<this.set.length;Te++)if(Qt(this.set[Te],he,this.options))return!0;return!1}}r1=n;const r=pE,s=new r,u=Jm,c=Bc(),d=wh,p=i1,{safeRe:y,t:E,comparatorTrimReplace:A,tildeTrimReplace:F,caretTrimReplace:$}=t1,{FLAG_INCLUDE_PRERELEASE:_,FLAG_LOOSE:L}=e1,T=ye=>ye.value==="<0.0.0-0",B=ye=>ye.value==="",G=(ye,he)=>{let Te=!0;const Oe=ye.slice();let Ne=Oe.pop();for(;Te&&Oe.length;)Te=Oe.every(Fe=>Ne.intersects(Fe,he)),Ne=Oe.pop();return Te},H=(ye,he)=>(d("comp",ye,he),ye=be(ye,he),d("caret",ye),ye=ve(ye,he),d("tildes",ye),ye=Re(ye,he),d("xrange",ye),ye=Ut(ye,he),d("stars",ye),ye),Z=ye=>!ye||ye.toLowerCase()==="x"||ye==="*",ve=(ye,he)=>ye.trim().split(/\s+/).map(Te=>De(Te,he)).join(" "),De=(ye,he)=>{const Te=he.loose?y[E.TILDELOOSE]:y[E.TILDE];return ye.replace(Te,(Oe,Ne,Fe,Ie,at)=>{d("tilde",ye,Oe,Ne,Fe,Ie,at);let je;return Z(Ne)?je="":Z(Fe)?je=`>=${Ne}.0.0 <${+Ne+1}.0.0-0`:Z(Ie)?je=`>=${Ne}.${Fe}.0 <${Ne}.${+Fe+1}.0-0`:at?(d("replaceTilde pr",at),je=`>=${Ne}.${Fe}.${Ie}-${at} <${Ne}.${+Fe+1}.0-0`):je=`>=${Ne}.${Fe}.${Ie} <${Ne}.${+Fe+1}.0-0`,d("tilde return",je),je})},be=(ye,he)=>ye.trim().split(/\s+/).map(Te=>$e(Te,he)).join(" "),$e=(ye,he)=>{d("caret",ye,he);const Te=he.loose?y[E.CARETLOOSE]:y[E.CARET],Oe=he.includePrerelease?"-0":"";return ye.replace(Te,(Ne,Fe,Ie,at,je)=>{d("caret",ye,Ne,Fe,Ie,at,je);let St;return Z(Fe)?St="":Z(Ie)?St=`>=${Fe}.0.0${Oe} <${+Fe+1}.0.0-0`:Z(at)?Fe==="0"?St=`>=${Fe}.${Ie}.0${Oe} <${Fe}.${+Ie+1}.0-0`:St=`>=${Fe}.${Ie}.0${Oe} <${+Fe+1}.0.0-0`:je?(d("replaceCaret pr",je),Fe==="0"?Ie==="0"?St=`>=${Fe}.${Ie}.${at}-${je} <${Fe}.${Ie}.${+at+1}-0`:St=`>=${Fe}.${Ie}.${at}-${je} <${Fe}.${+Ie+1}.0-0`:St=`>=${Fe}.${Ie}.${at}-${je} <${+Fe+1}.0.0-0`):(d("no pr"),Fe==="0"?Ie==="0"?St=`>=${Fe}.${Ie}.${at}${Oe} <${Fe}.${Ie}.${+at+1}-0`:St=`>=${Fe}.${Ie}.${at}${Oe} <${Fe}.${+Ie+1}.0-0`:St=`>=${Fe}.${Ie}.${at} <${+Fe+1}.0.0-0`),d("caret return",St),St})},Re=(ye,he)=>(d("replaceXRanges",ye,he),ye.split(/\s+/).map(Te=>me(Te,he)).join(" ")),me=(ye,he)=>{ye=ye.trim();const Te=he.loose?y[E.XRANGELOOSE]:y[E.XRANGE];return ye.replace(Te,(Oe,Ne,Fe,Ie,at,je)=>{d("xRange",ye,Oe,Ne,Fe,Ie,at,je);const St=Z(Fe),Rn=St||Z(Ie),Lt=Rn||Z(at),Cs=Lt;return Ne==="="&&Cs&&(Ne=""),je=he.includePrerelease?"-0":"",St?Ne===">"||Ne==="<"?Oe="<0.0.0-0":Oe="*":Ne&&Cs?(Rn&&(Ie=0),at=0,Ne===">"?(Ne=">=",Rn?(Fe=+Fe+1,Ie=0,at=0):(Ie=+Ie+1,at=0)):Ne==="<="&&(Ne="<",Rn?Fe=+Fe+1:Ie=+Ie+1),Ne==="<"&&(je="-0"),Oe=`${Ne+Fe}.${Ie}.${at}${je}`):Rn?Oe=`>=${Fe}.0.0${je} <${+Fe+1}.0.0-0`:Lt&&(Oe=`>=${Fe}.${Ie}.0${je} <${Fe}.${+Ie+1}.0-0`),d("xRange return",Oe),Oe})},Ut=(ye,he)=>(d("replaceStars",ye,he),ye.trim().replace(y[E.STAR],"")),dn=(ye,he)=>(d("replaceGTE0",ye,he),ye.trim().replace(y[he.includePrerelease?E.GTE0PRE:E.GTE0],"")),wi=ye=>(he,Te,Oe,Ne,Fe,Ie,at,je,St,Rn,Lt,Cs)=>(Z(Oe)?Te="":Z(Ne)?Te=`>=${Oe}.0.0${ye?"-0":""}`:Z(Fe)?Te=`>=${Oe}.${Ne}.0${ye?"-0":""}`:Ie?Te=`>=${Te}`:Te=`>=${Te}${ye?"-0":""}`,Z(St)?je="":Z(Rn)?je=`<${+St+1}.0.0-0`:Z(Lt)?je=`<${St}.${+Rn+1}.0-0`:Cs?je=`<=${St}.${Rn}.${Lt}-${Cs}`:ye?je=`<${St}.${Rn}.${+Lt+1}-0`:je=`<=${je}`,`${Te} ${je}`.trim()),Qt=(ye,he,Te)=>{for(let Oe=0;Oe<ye.length;Oe++)if(!ye[Oe].test(he))return!1;if(he.prerelease.length&&!Te.includePrerelease){for(let Oe=0;Oe<ye.length;Oe++)if(d(ye[Oe].semver),ye[Oe].semver!==c.ANY&&ye[Oe].semver.prerelease.length>0){const Ne=ye[Oe].semver;if(Ne.major===he.major&&Ne.minor===he.minor&&Ne.patch===he.patch)return!0}return!1}return!0};return r1}const LE=rn();var Pu=(n,r,s)=>{try{r=new LE(r,s)}catch{return!1}return r.test(n)},Oa=Fh(Pu);function o1(n,r,s){const u=n.open(r),c=1e4,d=250,{origin:p}=new URL(r);let y=~~(c/d);function E(F){F.source===u&&(y=0,n.removeEventListener("message",E,!1))}n.addEventListener("message",E,!1);function A(){y<=0||(u.postMessage(s,p),setTimeout(A,d),y-=1)}setTimeout(A,d)}var s1=`.vega-embed {
  position: relative;
  display: inline-block;
  box-sizing: border-box;
}
.vega-embed.has-actions {
  padding-right: 38px;
}
.vega-embed details:not([open]) > :not(summary) {
  display: none !important;
}
.vega-embed summary {
  list-style: none;
  position: absolute;
  top: 0;
  right: 0;
  padding: 6px;
  z-index: 1000;
  background: white;
  box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
  color: #1b1e23;
  border: 1px solid #aaa;
  border-radius: 999px;
  opacity: 0.2;
  transition: opacity 0.4s ease-in;
  cursor: pointer;
  line-height: 0px;
}
.vega-embed summary::-webkit-details-marker {
  display: none;
}
.vega-embed summary:active {
  box-shadow: #aaa 0px 0px 0px 1px inset;
}
.vega-embed summary svg {
  width: 14px;
  height: 14px;
}
.vega-embed details[open] summary {
  opacity: 0.7;
}
.vega-embed:hover summary, .vega-embed:focus-within summary {
  opacity: 1 !important;
  transition: opacity 0.2s ease;
}
.vega-embed .vega-actions {
  position: absolute;
  z-index: 1001;
  top: 35px;
  right: -9px;
  display: flex;
  flex-direction: column;
  padding-bottom: 8px;
  padding-top: 8px;
  border-radius: 4px;
  box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.2);
  border: 1px solid #d9d9d9;
  background: white;
  animation-duration: 0.15s;
  animation-name: scale-in;
  animation-timing-function: cubic-bezier(0.2, 0, 0.13, 1.5);
  text-align: left;
}
.vega-embed .vega-actions a {
  padding: 8px 16px;
  font-family: sans-serif;
  font-size: 14px;
  font-weight: 600;
  white-space: nowrap;
  color: #434a56;
  text-decoration: none;
}
.vega-embed .vega-actions a:hover, .vega-embed .vega-actions a:focus {
  background-color: #f7f7f9;
  color: black;
}
.vega-embed .vega-actions::before, .vega-embed .vega-actions::after {
  content: "";
  display: inline-block;
  position: absolute;
}
.vega-embed .vega-actions::before {
  left: auto;
  right: 14px;
  top: -16px;
  border: 8px solid rgba(0, 0, 0, 0);
  border-bottom-color: #d9d9d9;
}
.vega-embed .vega-actions::after {
  left: auto;
  right: 15px;
  top: -14px;
  border: 7px solid rgba(0, 0, 0, 0);
  border-bottom-color: #fff;
}
.vega-embed .chart-wrapper.fit-x {
  width: 100%;
}
.vega-embed .chart-wrapper.fit-y {
  height: 100%;
}

.vega-embed-wrapper {
  max-width: 100%;
  overflow: auto;
  padding-right: 14px;
}

@keyframes scale-in {
  from {
    opacity: 0;
    transform: scale(0.6);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}
`;function Th(n,...r){for(const s of r)PD(n,s);return n}function PD(n,r){for(const s of Object.keys(r))(0,ot.writeConfig)(n,s,r[s],!0)}var UD="vega-embed",jD="6.26.0",GD="Publish Vega visualizations as embedded web components.",WD=["vega","data","visualization","component","embed"],VD={type:"git",url:"http://github.com/vega/vega-embed.git"},HD={name:"UW Interactive Data Lab",url:"http://idl.cs.washington.edu"},qD=[{name:"Dominik Moritz",url:"https://www.domoritz.de"}],XD={url:"https://github.com/vega/vega-embed/issues"},YD="https://github.com/vega/vega-embed#readme",zE="BSD-3-Clause",KD="build/vega-embed.js",QD="build/vega-embed.module.js",ZD="build/vega-embed.min.js",JD="build/vega-embed.min.js",ek="build/vega-embed.module.d.ts",tk=["src","build"],a1={".":{import:{types:"./build/vega-embed.module.d.ts",default:"./build/vega-embed.module.js"},require:{default:"./build/vega-embed.js"}}},IE={"@babel/core":"^7.24.7","@babel/eslint-parser":"^7.24.7","@babel/plugin-transform-runtime":"^7.24.7","@babel/preset-env":"^7.24.7","@babel/preset-typescript":"^7.24.7","@release-it/conventional-changelog":"^8.0.1","@rollup/plugin-commonjs":"26.0.1","@rollup/plugin-json":"^6.1.0","@rollup/plugin-node-resolve":"^15.2.3","@rollup/plugin-terser":"^0.4.4","@types/semver":"^7.5.8","@typescript-eslint/parser":"^7.15.0","@vitest/coverage-v8":"^1.6.0","browser-sync":"^3.0.2",concurrently:"^8.2.2","del-cli":"^5.1.0",eslint:"^9.6.0","eslint-config-prettier":"^9.1.0","eslint-plugin-prettier":"^5.1.3","eslint-plugin-vitest":"^0.5.4",jsdom:"^24.1.0","postinstall-postinstall":"^2.1.0",prettier:"^3.3.2","release-it":"^17.4.1",rollup:"4.18.0","rollup-plugin-bundle-size":"^1.0.3","rollup-plugin-ts":"^3.4.5",sass:"^1.77.6",typescript:"^5.5.3","typescript-eslint":"^7.15.0",vega:"^5.30.0","vega-lite":"^5.19.0",vitest:"^1.6.0","vitest-canvas-mock":"^0.3.3"},Rh={vega:"^5.21.0","vega-lite":"*"},Nh={"fast-json-patch":"^3.1.1","json-stringify-pretty-compact":"^3.0.0",semver:"^7.6.2",tslib:"^2.6.3","vega-interpreter":"^1.0.5","vega-schema-url-parser":"^2.2.0","vega-themes":"^2.15.0","vega-tooltip":"^0.34.0"},nk={prebuild:"yarn clean && yarn build:style",build:"rollup -c","build:style":"./build-style.sh",clean:"del-cli build src/style.ts",prepublishOnly:"yarn clean && yarn build",preversion:"yarn lint && yarn test",serve:"browser-sync start --directory -s -f build *.html",start:"yarn build && concurrently --kill-others -n Server,Rollup 'yarn serve' 'rollup -c -w'",pretest:"yarn build:style",test:"vitest run",prettierbase:"prettier '*.{css,scss,html}'",format:"eslint . --fix && yarn prettierbase --write",lint:"eslint . && yarn prettierbase --check",release:"release-it"},ik={name:UD,version:jD,description:GD,keywords:WD,repository:VD,author:HD,contributors:qD,bugs:XD,homepage:YD,license:zE,main:KD,module:QD,unpkg:ZD,jsdelivr:JD,types:ek,files:tk,exports:a1,devDependencies:IE,peerDependencies:Rh,dependencies:Nh,scripts:nk};const u1=ik.version,Yi=ot;let Uu=Ve;const PE=typeof window<"u"?window:void 0;Uu===void 0&&PE?.vl?.compile&&(Uu=PE.vl);const rk={export:{svg:!0,png:!0},source:!0,compiled:!0,editor:!0},UE={CLICK_TO_VIEW_ACTIONS:"Click to view actions",COMPILED_ACTION:"View Compiled Vega",EDITOR_ACTION:"Open in Vega Editor",PNG_ACTION:"Save as PNG",SOURCE_ACTION:"View Source",SVG_ACTION:"Save as SVG"},Lc={vega:"Vega","vega-lite":"Vega-Lite"},_h={vega:Yi.version,"vega-lite":Uu?Uu.version:"not available"},ok={vega:n=>n,"vega-lite":(n,r)=>Uu.compile(n,{config:r}).spec},sk=`
<svg viewBox="0 0 16 16" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
  <circle r="2" cy="8" cx="2"></circle>
  <circle r="2" cy="8" cx="8"></circle>
  <circle r="2" cy="8" cx="14"></circle>
</svg>`,ak="chart-wrapper";function jE(n){return typeof n=="function"}function l1(n,r,s,u){const c=`<html><head>${r}</head><body><pre><code class="json">`,d=`</code></pre>${s}</body></html>`,p=window.open("");p.document.write(c+n+d),p.document.title=`${Lc[u]} JSON Source`}function c1(n,r){if(n.$schema){const s=Px(n.$schema);r&&r!==s.library&&console.warn(`The given visualization spec is written in ${Lc[s.library]}, but mode argument sets ${Lc[r]??r}.`);const u=s.library;return Oa(_h[u],`^${s.version.slice(1)}`)||console.warn(`The input spec uses ${Lc[u]} ${s.version}, but the current version of ${Lc[u]} is v${_h[u]}.`),u}return"mark"in n||"encoding"in n||"layer"in n||"hconcat"in n||"vconcat"in n||"facet"in n||"repeat"in n?"vega-lite":"marks"in n||"signals"in n||"scales"in n||"axes"in n?"vega":r??"vega"}function zc(n){return!!(n&&"load"in n)}function Ic(n){return zc(n)?n:Yi.loader(n)}function ke(n){const r=n.usermeta?.embedOptions??{};return(0,ot.isString)(r.defaultStyle)&&(r.defaultStyle=!1),r}async function Pc(n,r,s={}){let u,c;(0,ot.isString)(r)?(c=Ic(s.loader),u=JSON.parse(await c.load(r))):u=r;const d=ke(u),p=d.loader;(!c||p)&&(c=Ic(s.loader??p));const y=await Mh(d,c),E=await Mh(s,c),A={...Th(E,y),config:(0,ot.mergeConfig)(E.config??{},y.config??{})};return await uk(n,u,A,c)}async function Mh(n,r){const s=(0,ot.isString)(n.config)?JSON.parse(await r.load(n.config)):n.config??{},u=(0,ot.isString)(n.patch)?JSON.parse(await r.load(n.patch)):n.patch;return{...n,...u?{patch:u}:{},...s?{config:s}:{}}}function GE(n){const r=n.getRootNode?n.getRootNode():document;return r instanceof ShadowRoot?{root:r,rootContainer:r}:{root:document,rootContainer:document.head??document.body}}async function uk(n,r,s={},u){const c=s.theme?(0,ot.mergeConfig)(hn[s.theme],s.config??{}):s.config,d=(0,ot.isBoolean)(s.actions)?s.actions:Th({},rk,s.actions??{}),p={...UE,...s.i18n},y=s.renderer??"canvas",E=s.logLevel??Yi.Warn,A=s.downloadFileName??"visualization",F=typeof n=="string"?document.querySelector(n):n;if(!F)throw new Error(`${n} does not exist`);if(s.defaultStyle!==!1){const be="vega-embed-style",{root:$e,rootContainer:Re}=GE(F);if(!$e.getElementById(be)){const me=document.createElement("style");me.id=be,me.innerHTML=s.defaultStyle===void 0||s.defaultStyle===!0?s1.toString():s.defaultStyle,Re.appendChild(me)}}const $=c1(r,s.mode);let _=ok[$](r,c);if($==="vega-lite"&&_.$schema){const be=Px(_.$schema);Oa(_h.vega,`^${be.version.slice(1)}`)||console.warn(`The compiled spec uses Vega ${be.version}, but current version is v${_h.vega}.`)}F.classList.add("vega-embed"),d&&F.classList.add("has-actions"),F.innerHTML="";let L=F;if(d){const be=document.createElement("div");be.classList.add(ak),F.appendChild(be),L=be}const T=s.patch;if(T&&(_=T instanceof Function?T(_):(0,gn.X6)(_,T,!0,!1).newDocument),s.formatLocale&&Yi.formatLocale(s.formatLocale),s.timeFormatLocale&&Yi.timeFormatLocale(s.timeFormatLocale),s.expressionFunctions)for(const be in s.expressionFunctions){const $e=s.expressionFunctions[be];"fn"in $e?Yi.expressionFunction(be,$e.fn,$e.visitor):$e instanceof Function&&Yi.expressionFunction(be,$e)}const{ast:B}=s,G=Yi.parse(_,$==="vega-lite"?{}:c,{ast:B}),H=new(s.viewClass||Yi.View)(G,{loader:u,logLevel:E,renderer:y,...B?{expr:Yi.expressionInterpreter??s.expr??ro}:{}});if(H.addSignalListener("autosize",(be,$e)=>{const{type:Re}=$e;Re=="fit-x"?(L.classList.add("fit-x"),L.classList.remove("fit-y")):Re=="fit-y"?(L.classList.remove("fit-x"),L.classList.add("fit-y")):Re=="fit"?L.classList.add("fit-x","fit-y"):L.classList.remove("fit-x","fit-y")}),s.tooltip!==!1){const{loader:be,tooltip:$e}=s,Re=be&&!zc(be)?be?.baseURL:void 0,me=jE($e)?$e:new gE({baseURL:Re,...$e===!0?{}:$e}).call;H.tooltip(me)}let{hover:Z}=s;if(Z===void 0&&(Z=$==="vega"),Z){const{hoverSet:be,updateSet:$e}=typeof Z=="boolean"?{}:Z;H.hover(be,$e)}s&&(s.width!=null&&H.width(s.width),s.height!=null&&H.height(s.height),s.padding!=null&&H.padding(s.padding)),await H.initialize(L,s.bind).runAsync();let ve;if(d!==!1){let be=F;if(s.defaultStyle!==!1||s.forceActionsMenu){const Re=document.createElement("details");Re.title=p.CLICK_TO_VIEW_ACTIONS,F.append(Re),be=Re;const me=document.createElement("summary");me.innerHTML=sk,Re.append(me),ve=Ut=>{Re.contains(Ut.target)||Re.removeAttribute("open")},document.addEventListener("click",ve)}const $e=document.createElement("div");if(be.append($e),$e.classList.add("vega-actions"),d===!0||d.export!==!1){for(const Re of["svg","png"])if(d===!0||d.export===!0||d.export[Re]){const me=p[`${Re.toUpperCase()}_ACTION`],Ut=document.createElement("a"),dn=(0,ot.isObject)(s.scaleFactor)?s.scaleFactor[Re]:s.scaleFactor;Ut.text=me,Ut.href="#",Ut.target="_blank",Ut.download=`${A}.${Re}`,Ut.addEventListener("mousedown",async function(wi){wi.preventDefault();const Qt=await H.toImageURL(Re,dn);this.href=Qt}),$e.append(Ut)}}if(d===!0||d.source!==!1){const Re=document.createElement("a");Re.text=p.SOURCE_ACTION,Re.href="#",Re.addEventListener("click",function(me){l1(Vn()(r),s.sourceHeader??"",s.sourceFooter??"",$),me.preventDefault()}),$e.append(Re)}if($==="vega-lite"&&(d===!0||d.compiled!==!1)){const Re=document.createElement("a");Re.text=p.COMPILED_ACTION,Re.href="#",Re.addEventListener("click",function(me){l1(Vn()(_),s.sourceHeader??"",s.sourceFooter??"","vega"),me.preventDefault()}),$e.append(Re)}if(d===!0||d.editor!==!1){const Re=s.editorUrl??"https://vega.github.io/editor/",me=document.createElement("a");me.text=p.EDITOR_ACTION,me.href="#",me.addEventListener("click",function(Ut){o1(window,Re,{config:c,mode:T?"vega":$,renderer:y,spec:Vn()(T?_:r)}),Ut.preventDefault()}),$e.append(me)}}function De(){ve&&document.removeEventListener("click",ve),H.finalize()}return{view:H,spec:r,vgSpec:_,finalize:De,embedOptions:s}}},82722:(Wh,Tr,z)=>{z.d(Tr,{P:()=>ws});const Ve="view",hn="[",gn="]",Wn="{",Vn="}",ot=":",_n=",",ai="@",Hn=">",Di=/[[\]{}]/,qn={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let b,Lo;function ws(Ce,Be,Pe){return b=Be||Ve,Lo=Pe||qn,ki(Ce.trim()).map(sn)}function Ds(Ce){return Lo[Ce]}function on(Ce,Be,Pe,ut,ce){const re=Ce.length;let ne=0,fe;for(;Be<re;++Be){if(fe=Ce[Be],!ne&&fe===Pe)return Be;ce&&ce.indexOf(fe)>=0?--ne:ut&&ut.indexOf(fe)>=0&&++ne}return Be}function ki(Ce){const Be=[],Pe=Ce.length;let ut=0,ce=0;for(;ce<Pe;)ce=on(Ce,ce,_n,hn+Wn,gn+Vn),Be.push(Ce.substring(ut,ce).trim()),ut=++ce;if(Be.length===0)throw"Empty event selector: "+Ce;return Be}function sn(Ce){return Ce[0]==="["?ro(Ce):Rr(Ce)}function ro(Ce){const Be=Ce.length;let Pe=1,ut;if(Pe=on(Ce,Pe,gn,hn,gn),Pe===Be)throw"Empty between selector: "+Ce;if(ut=ki(Ce.substring(1,Pe)),ut.length!==2)throw"Between selector must have two elements: "+Ce;if(Ce=Ce.slice(Pe+1).trim(),Ce[0]!==Hn)throw"Expected '>' after between selector: "+Ce;ut=ut.map(sn);const ce=sn(Ce.slice(1).trim());return ce.between?{between:ut,stream:ce}:(ce.between=ut,ce)}function Rr(Ce){const Be={source:b},Pe=[];let ut=[0,0],ce=0,re=0,ne=Ce.length,fe=0,lt,jt;if(Ce[ne-1]===Vn){if(fe=Ce.lastIndexOf(Wn),fe>=0){try{ut=an(Ce.substring(fe+1,ne-1))}catch{throw"Invalid throttle specification: "+Ce}Ce=Ce.slice(0,fe).trim(),ne=Ce.length}else throw"Unmatched right brace: "+Ce;fe=0}if(!ne)throw Ce;if(Ce[0]===ai&&(ce=++fe),lt=on(Ce,fe,ot),lt<ne&&(Pe.push(Ce.substring(re,lt).trim()),re=fe=++lt),fe=on(Ce,fe,hn),fe===ne)Pe.push(Ce.substring(re,ne).trim());else if(Pe.push(Ce.substring(re,fe).trim()),jt=[],re=++fe,re===ne)throw"Unmatched left bracket: "+Ce;for(;fe<ne;){if(fe=on(Ce,fe,gn),fe===ne)throw"Unmatched left bracket: "+Ce;if(jt.push(Ce.substring(re,fe).trim()),fe<ne-1&&Ce[++fe]!==hn)throw"Expected left bracket: "+Ce;re=++fe}if(!(ne=Pe.length)||Di.test(Pe[ne-1]))throw"Invalid event selector: "+Ce;return ne>1?(Be.type=Pe[1],ce?Be.markname=Pe[0].slice(1):Ds(Pe[0])?Be.marktype=Pe[0]:Be.source=Pe[0]):Be.type=Pe[0],Be.type.slice(-1)==="!"&&(Be.consume=!0,Be.type=Be.type.slice(0,-1)),jt!=null&&(Be.filter=jt),ut[0]&&(Be.throttle=ut[0]),ut[1]&&(Be.debounce=ut[1]),Be}function an(Ce){const Be=Ce.split(_n);if(!Ce.length||Be.length>2)throw Ce;return Be.map(Pe=>{const ut=+Pe;if(ut!==ut)throw Ce;return ut})}},79028:(Wh,Tr,z)=>{z.d(Tr,{$D:()=>sn,$G:()=>Vc,$P:()=>Xh,AU:()=>re,B:()=>b1,B2:()=>Ta,BS:()=>oo,Cc:()=>Xc,D_:()=>qn,EV:()=>Yh,Eb:()=>Po,Et:()=>qc,G4:()=>tt,Gv:()=>Pe,KH:()=>$i,Kg:()=>Nr,Lm:()=>vt,Ln:()=>Ma,M1:()=>Kc,N6:()=>hn,NV:()=>ki,P$:()=>ro,PK:()=>qh,R2:()=>Rr,Ro:()=>lt,SW:()=>We,Tn:()=>zo,UD:()=>Wu,VC:()=>un,V_:()=>Io,X$:()=>Vu,Xx:()=>Hc,YO:()=>li,ZZ:()=>Hn,ay:()=>E1,bX:()=>v1,co:()=>Cn,cy:()=>Be,dI:()=>Zh,dY:()=>Vh,eV:()=>Qh,gd:()=>x1,h1:()=>Kh,id:()=>Di,io:()=>ce,iv:()=>ai,lL:()=>ui,mQ:()=>so,me:()=>Ds,n:()=>_a,nG:()=>Os,nS:()=>gn,oV:()=>pe,r$:()=>jo,rt:()=>Ji,sY:()=>Ve,se:()=>fe,sg:()=>Hh,ux:()=>Uo,vF:()=>Ce,vN:()=>ws,v_:()=>b,vu:()=>ks,xH:()=>Lo,xZ:()=>Ts,xv:()=>Jh,y:()=>an,z3:()=>_n,zy:()=>Mn});function Ve(N,P,j){return N.fields=P||[],N.fname=j,N}function hn(N){return N==null?null:N.fname}function gn(N){return N==null?null:N.fields}function Wn(N){return N.length===1?Vn(N[0]):ot(N)}const Vn=N=>function(P){return P[N]},ot=N=>{const P=N.length;return function(j){for(let X=0;X<P;++X)j=j[N[X]];return j}};function _n(N){throw Error(N)}function ai(N){const P=[],j=N.length;let X=null,U=0,K="",se,de,ze;N=N+"";function $t(){P.push(K+N.substring(se,de)),K="",se=de+1}for(se=de=0;de<j;++de)if(ze=N[de],ze==="\\")K+=N.substring(se,de++),se=de;else if(ze===X)$t(),X=null,U=-1;else{if(X)continue;se===U&&ze==='"'||se===U&&ze==="'"?(se=de+1,X=ze):ze==="."&&!U?de>se?$t():se=de+1:ze==="["?(de>se&&$t(),U=se=de+1):ze==="]"&&(U||_n("Access path missing open bracket: "+N),U>0&&$t(),U=0,se=de+1)}return U&&_n("Access path missing closing bracket: "+N),X&&_n("Access path missing closing quote: "+N),de>se&&(de++,$t()),P}function Hn(N,P,j){const X=ai(N);return N=X.length===1?X[0]:N,Ve((j&&j.get||Wn)(X),[N],P||N)}const Di=Hn("id"),qn=Ve(N=>N,[],"identity"),b=Ve(()=>0,[],"zero"),Lo=Ve(()=>1,[],"one"),ws=Ve(()=>!0,[],"true"),Ds=Ve(()=>!1,[],"false");function on(N,P,j){const X=[P].concat([].slice.call(j));console[N].apply(console,X)}const ki=0,sn=1,ro=2,Rr=3,an=4;function Ce(N,P){let j=arguments.length>2&&arguments[2]!==void 0?arguments[2]:on,X=N||ki;return{level(U){return arguments.length?(X=+U,this):X},error(){return X>=sn&&j(P||"error","ERROR",arguments),this},warn(){return X>=ro&&j(P||"warn","WARN",arguments),this},info(){return X>=Rr&&j(P||"log","INFO",arguments),this},debug(){return X>=an&&j(P||"log","DEBUG",arguments),this}}}var Be=Array.isArray;function Pe(N){return N===Object(N)}const ut=N=>N!=="__proto__";function ce(){for(var N=arguments.length,P=new Array(N),j=0;j<N;j++)P[j]=arguments[j];return P.reduce((X,U)=>{for(const K in U)if(K==="signals")X.signals=ne(X.signals,U.signals);else{const se=K==="legend"?{layout:1}:K==="style"?!0:null;re(X,K,U[K],se)}return X},{})}function re(N,P,j,X){if(!ut(P))return;let U,K;if(Pe(j)&&!Be(j)){K=Pe(N[P])?N[P]:N[P]={};for(U in j)X&&(X===!0||X[U])?re(K,U,j[U]):ut(U)&&(K[U]=j[U])}else N[P]=j}function ne(N,P){if(N==null)return P;const j={},X=[];function U(K){j[K.name]||(j[K.name]=1,X.push(K))}return P.forEach(U),N.forEach(U),X}function fe(N){return N[N.length-1]}function lt(N){return N==null||N===""?null:+N}const jt=N=>P=>N*Math.exp(P),mt=N=>P=>Math.log(N*P),kt=N=>P=>Math.sign(P)*Math.log1p(Math.abs(P/N)),zt=N=>P=>Math.sign(P)*Math.expm1(Math.abs(P))*N,xt=N=>P=>P<0?-Math.pow(-P,N):Math.pow(P,N);function Zt(N,P,j,X){const U=j(N[0]),K=j(fe(N)),se=(K-U)*P;return[X(U-se),X(K-se)]}function un(N,P){return Zt(N,P,lt,qn)}function $i(N,P){var j=Math.sign(N[0]);return Zt(N,P,mt(j),jt(j))}function Cn(N,P,j){return Zt(N,P,xt(j),xt(1/j))}function Mn(N,P,j){return Zt(N,P,kt(j),zt(j))}function pn(N,P,j,X,U){const K=X(N[0]),se=X(fe(N)),de=P!=null?X(P):(K+se)/2;return[U(de+(K-de)*j),U(de+(se-de)*j)]}function ui(N,P,j){return pn(N,P,j,lt,qn)}function pe(N,P,j){const X=Math.sign(N[0]);return pn(N,P,j,mt(X),jt(X))}function We(N,P,j,X){return pn(N,P,j,xt(X),xt(1/X))}function Ta(N,P,j,X){return pn(N,P,j,kt(X),zt(X))}function Vc(N){return 1+~~(new Date(N).getMonth()/3)}function ks(N){return 1+~~(new Date(N).getUTCMonth()/3)}function li(N){return N!=null?Be(N)?N:[N]:[]}function oo(N,P,j){let X=N[0],U=N[1],K;return U<X&&(K=U,U=X,X=K),K=U-X,K>=j-P?[P,j]:[X=Math.min(Math.max(X,P),j-K),X+K]}function zo(N){return typeof N=="function"}const Gu="descending";function Wu(N,P,j){j=j||{},P=li(P)||[];const X=[],U=[],K={},se=j.comparator||Ra;return li(N).forEach((de,ze)=>{de!=null&&(X.push(P[ze]===Gu?-1:1),U.push(de=zo(de)?de:Hn(de,null,j)),(gn(de)||[]).forEach($t=>K[$t]=1))}),U.length===0?null:Ve(se(U,X),Object.keys(K))}const Io=(N,P)=>(N<P||N==null)&&P!=null?-1:(N>P||P==null)&&N!=null?1:(P=P instanceof Date?+P:P,(N=N instanceof Date?+N:N)!==N&&P===P?-1:P!==P&&N===N?1:0),Ra=(N,P)=>N.length===1?Na(N[0],P[0]):$s(N,P,N.length),Na=(N,P)=>function(j,X){return Io(N(j),N(X))*P},$s=(N,P,j)=>(P.push(0),function(X,U){let K,se=0,de=-1;for(;se===0&&++de<j;)K=N[de],se=Io(K(X),K(U));return se*P[de]});function Vh(N){return zo(N)?N:()=>N}function Hh(N,P){let j;return X=>{j&&clearTimeout(j),j=setTimeout(()=>(P(X),j=null),N)}}function Vu(N){for(let P,j,X=1,U=arguments.length;X<U;++X){P=arguments[X];for(j in P)N[j]=P[j]}return N}function Hc(N,P){let j=0,X,U,K,se;if(N&&(X=N.length))if(P==null){for(U=N[j];j<X&&(U==null||U!==U);U=N[++j]);for(K=se=U;j<X;++j)U=N[j],U!=null&&(U<K&&(K=U),U>se&&(se=U))}else{for(U=P(N[j]);j<X&&(U==null||U!==U);U=P(N[++j]));for(K=se=U;j<X;++j)U=P(N[j]),U!=null&&(U<K&&(K=U),U>se&&(se=U))}return[K,se]}function _a(N,P){const j=N.length;let X=-1,U,K,se,de,ze;if(P==null){for(;++X<j;)if(K=N[X],K!=null&&K>=K){U=se=K;break}if(X===j)return[-1,-1];for(de=ze=X;++X<j;)K=N[X],K!=null&&(U>K&&(U=K,de=X),se<K&&(se=K,ze=X))}else{for(;++X<j;)if(K=P(N[X],X,N),K!=null&&K>=K){U=se=K;break}if(X===j)return[-1,-1];for(de=ze=X;++X<j;)K=P(N[X],X,N),K!=null&&(U>K&&(U=K,de=X),se<K&&(se=K,ze=X))}return[de,ze]}function so(N,P){return Object.hasOwn(N,P)}const Hu={};function Os(N){let P={},j;function X(K){return so(P,K)&&P[K]!==Hu}const U={size:0,empty:0,object:P,has:X,get(K){return X(K)?P[K]:void 0},set(K,se){return X(K)||(++U.size,P[K]===Hu&&--U.empty),P[K]=se,this},delete(K){return X(K)&&(--U.size,++U.empty,P[K]=Hu),this},clear(){U.size=U.empty=0,U.object=P={}},test(K){return arguments.length?(j=K,U):j},clean(){const K={};let se=0;for(const de in P){const ze=P[de];ze!==Hu&&(!j||!j(ze))&&(K[de]=ze,++se)}U.size=se,U.empty=0,U.object=P=K}};return N&&Object.keys(N).forEach(K=>{U.set(K,N[K])}),U}function v1(N,P,j,X,U,K){if(!j&&j!==0)return K;const se=+j;let de=N[0],ze=fe(N),$t;ze<de&&($t=de,de=ze,ze=$t),$t=Math.abs(P-de);const Xn=Math.abs(ze-P);return $t<Xn&&$t<=se?X:Xn<=se?U:K}function b1(N,P,j){const X=N.prototype=Object.create(P.prototype);return Object.defineProperty(X,"constructor",{value:N,writable:!0,enumerable:!0,configurable:!0}),Vu(X,j)}function qh(N,P,j,X){let U=P[0],K=P[P.length-1],se;return U>K&&(se=U,U=K,K=se),j=j===void 0||j,X=X===void 0||X,(j?U<=N:U<N)&&(X?N<=K:N<K)}function vt(N){return typeof N=="boolean"}function Xh(N){return Object.prototype.toString.call(N)==="[object Date]"}function Ts(N){return N&&zo(N[Symbol.iterator])}function qc(N){return typeof N=="number"}function x1(N){return Object.prototype.toString.call(N)==="[object RegExp]"}function Nr(N){return typeof N=="string"}function Po(N,P,j){N&&(N=P?li(N).map(de=>de.replace(/\\(.)/g,"$1")):li(N));const X=N&&N.length,U=j&&j.get||Wn,K=de=>U(P?[de]:ai(de));let se;if(!X)se=function(){return""};else if(X===1){const de=K(N[0]);se=function(ze){return""+de(ze)}}else{const de=N.map(K);se=function(ze){let $t=""+de[0](ze),Xn=0;for(;++Xn<X;)$t+="|"+de[Xn](ze);return $t}}return Ve(se,N,"key")}function Xc(N,P){const j=N[0],X=fe(N),U=+P;return U?U===1?X:j+U*(X-j):j}const Yc=1e4;function Yh(N){N=+N||Yc;let P,j,X;const U=()=>{P={},j={},X=0},K=(se,de)=>(++X>N&&(j=P,P={},X=1),P[se]=de);return U(),{clear:U,has:se=>so(P,se)||so(j,se),get:se=>so(P,se)?P[se]:so(j,se)?K(se,j[se]):void 0,set:(se,de)=>so(P,se)?P[se]=de:K(se,de)}}function Kh(N,P,j,X){const U=P.length,K=j.length;if(!K)return P;if(!U)return j;const se=X||new P.constructor(U+K);let de=0,ze=0,$t=0;for(;de<U&&ze<K;++$t)se[$t]=N(P[de],j[ze])>0?j[ze++]:P[de++];for(;de<U;++de,++$t)se[$t]=P[de];for(;ze<K;++ze,++$t)se[$t]=j[ze];return se}function Uo(N,P){let j="";for(;--P>=0;)j+=N;return j}function Qh(N,P,j,X){const U=j||" ",K=N+"",se=P-K.length;return se<=0?K:X==="left"?Uo(U,se)+K:X==="center"?Uo(U,~~(se/2))+K+Uo(U,Math.ceil(se/2)):K+Uo(U,se)}function Ma(N){return N&&fe(N)-N[0]||0}function jo(N){return Be(N)?"["+N.map(jo)+"]":Pe(N)||Nr(N)?JSON.stringify(N).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):N}function tt(N){return N==null||N===""?null:!N||N==="false"||N==="0"?!1:!!N}const ao=N=>qc(N)||Xh(N)?N:Date.parse(N);function E1(N,P){return P=P||ao,N==null||N===""?null:P(N)}function Zh(N){return N==null||N===""?null:N+""}function Kc(N){const P={},j=N.length;for(let X=0;X<j;++X)P[N[X]]=!0;return P}function Jh(N,P,j,X){const U=X??"\u2026",K=N+"",se=K.length,de=Math.max(0,P-U.length);return se<=P?K:j==="left"?U+K.slice(se-de):j==="center"?K.slice(0,Math.ceil(de/2))+U+K.slice(se-~~(de/2)):K.slice(0,de)+U}function Ji(N,P,j){if(N)if(P){const X=N.length;for(let U=0;U<X;++U){const K=P(N[U]);K&&j(K,U,N)}}else N.forEach(j)}},4656:(Wh,Tr,z)=>{z.r(Tr),z.d(Tr,{Bounds:()=>Dt,CanvasHandler:()=>cu,CanvasRenderer:()=>md,DATE:()=>Zt,DAY:()=>un,DAYOFYEAR:()=>$i,Dataflow:()=>js,Debug:()=>b.y,Error:()=>b.$D,EventStream:()=>rr,Gradient:()=>Ny,GroupItem:()=>yr,HOURS:()=>Cn,Handler:()=>jp,HybridHandler:()=>u0,HybridRenderer:()=>xd,Info:()=>b.R2,Item:()=>yi,MILLISECONDS:()=>ui,MINUTES:()=>Mn,MONTH:()=>zt,Marks:()=>Ei,MultiPulse:()=>Jn,None:()=>b.NV,Operator:()=>Ke,Parameters:()=>fi,Pulse:()=>Ko,QUARTER:()=>kt,RenderType:()=>Cr,Renderer:()=>Gl,ResourceLoader:()=>pp,SECONDS:()=>pn,SVGHandler:()=>Lv,SVGRenderer:()=>r0,SVGStringRenderer:()=>Ar,Scenegraph:()=>Cv,TIME_UNITS:()=>pe,Transform:()=>q,View:()=>RE,WEEK:()=>xt,Warn:()=>b.P$,YEAR:()=>mt,accessor:()=>b.sY,accessorFields:()=>b.nS,accessorName:()=>b.N6,array:()=>b.YO,ascending:()=>b.V_,bandwidthNRD:()=>M1,bin:()=>yA,bootstrapCI:()=>vA,boundClip:()=>RS,boundContext:()=>sa,boundItem:()=>zp,boundMark:()=>xv,boundStroke:()=>Mt,changeset:()=>Ot,clampRange:()=>b.BS,codegenExpression:()=>Ox,compare:()=>b.UD,constant:()=>b.dY,cumulativeLogNormal:()=>rf,cumulativeNormal:()=>Tt,cumulativeUniform:()=>P1,dayofyear:()=>zo,debounce:()=>b.sg,defaultLocale:()=>_e,definition:()=>Ln,densityLogNormal:()=>Gs,densityNormal:()=>ur,densityUniform:()=>I1,domChild:()=>Pt,domClear:()=>ji,domCreate:()=>ls,domFind:()=>Up,dotbin:()=>bA,error:()=>b.z3,expressionFunction:()=>Ht,extend:()=>b.X$,extent:()=>b.Xx,extentIndex:()=>b.n,falsy:()=>b.me,fastmap:()=>b.nG,field:()=>b.ZZ,flush:()=>b.bX,font:()=>ud,fontFamily:()=>Pl,fontSize:()=>Pi,format:()=>Mr,formatLocale:()=>eg,formats:()=>Wo,hasOwnProperty:()=>b.mQ,id:()=>b.id,identity:()=>b.D_,inferType:()=>Ft,inferTypes:()=>za,ingest:()=>Se,inherits:()=>b.B,inrange:()=>b.PK,interpolate:()=>Nf,interpolateColors:()=>Rf,interpolateRange:()=>xC,intersect:()=>c0,intersectBoxLine:()=>br,intersectPath:()=>eu,intersectPoint:()=>Ep,intersectRule:()=>Ml,isArray:()=>b.cy,isBoolean:()=>b.Lm,isDate:()=>b.$P,isFunction:()=>b.Tn,isIterable:()=>b.xZ,isNumber:()=>b.Et,isObject:()=>b.Gv,isRegExp:()=>b.gd,isString:()=>b.Kg,isTuple:()=>Bs,key:()=>b.Eb,lerp:()=>b.Cc,lineHeight:()=>xr,loader:()=>Yu,locale:()=>Ns,logger:()=>b.vF,lruCache:()=>b.EV,markup:()=>n0,merge:()=>b.h1,mergeConfig:()=>b.io,multiLineOffset:()=>Ui,one:()=>b.xH,pad:()=>b.eV,panLinear:()=>b.VC,panLog:()=>b.KH,panPow:()=>b.co,panSymlog:()=>b.zy,parse:()=>B5,parseExpression:()=>kx,parseSelector:()=>Oh.P,path:()=>Ws.Ae,pathCurves:()=>xl,pathEqual:()=>fs,pathParse:()=>Qs,pathRectangle:()=>ts,pathRender:()=>Sl,pathSymbols:()=>Ly,pathTrail:()=>Fl,peek:()=>b.se,point:()=>au,projection:()=>L0,quantileLogNormal:()=>L1,quantileNormal:()=>ja,quantileUniform:()=>U1,quantiles:()=>N1,quantizeInterpolator:()=>Sy,quarter:()=>b.$G,quartiles:()=>_1,random:()=>ar,randomInteger:()=>zk,randomKDE:()=>il,randomLCG:()=>Lk,randomLogNormal:()=>of,randomMixture:()=>AA,randomNormal:()=>Ga,randomUniform:()=>CA,read:()=>It,regressionConstant:()=>j1,regressionExp:()=>af,regressionLinear:()=>mg,regressionLoess:()=>W1,regressionLog:()=>yg,regressionPoly:()=>bg,regressionPow:()=>lr,regressionQuad:()=>vg,renderModule:()=>hu,repeat:()=>b.ux,resetDefaultLocale:()=>F1,resetSVGClipId:()=>Ky,resetSVGDefIds:()=>MS,responseType:()=>Ms,runtimeContext:()=>sE,sampleCurve:()=>lf,sampleLogNormal:()=>B1,sampleNormal:()=>Ua,sampleUniform:()=>z1,scale:()=>it,sceneEqual:()=>Ad,sceneFromJSON:()=>Ev,scenePickVisit:()=>Bl,sceneToJSON:()=>Pp,sceneVisit:()=>zi,sceneZOrder:()=>Cp,scheme:()=>gi,serializeXML:()=>Wv,setHybridRendererOptions:()=>Xv,setRandom:()=>Mk,span:()=>b.Ln,splitAccessPath:()=>b.iv,stringValue:()=>b.r$,textMetrics:()=>xi,timeBin:()=>de,timeFloor:()=>qh,timeFormatLocale:()=>Rs,timeInterval:()=>Nr,timeOffset:()=>Yc,timeSequence:()=>Uo,timeUnitSpecifier:()=>ks,timeUnits:()=>Ta,toBoolean:()=>b.G4,toDate:()=>b.ay,toNumber:()=>b.Ro,toSet:()=>b.M1,toString:()=>b.dI,transform:()=>hg,transforms:()=>Bn,truncate:()=>b.xv,truthy:()=>b.vN,tupleid:()=>we,typeParsers:()=>Jt,utcFloor:()=>Ts,utcInterval:()=>Po,utcOffset:()=>Yh,utcSequence:()=>Qh,utcdayofyear:()=>$s,utcquarter:()=>b.vu,utcweek:()=>Vh,version:()=>L5,visitArray:()=>b.rt,week:()=>Gu,writeConfig:()=>b.AU,zero:()=>b.v_,zoomLinear:()=>b.lL,zoomLog:()=>b.oV,zoomPow:()=>b.SW,zoomSymlog:()=>b.B2});var Ve={};z.r(Ve),z.d(Ve,{aggregate:()=>po,bin:()=>df,collect:()=>Eg,compare:()=>Ag,countpattern:()=>Cg,cross:()=>ct,density:()=>gf,dotbin:()=>vf,expression:()=>K1,extent:()=>Dg,facet:()=>bf,field:()=>Z1,filter:()=>$g,flatten:()=>Og,fold:()=>Tg,formula:()=>Rg,generate:()=>Ng,impute:()=>Mg,joinaggregate:()=>Ef,kde:()=>Bg,key:()=>J1,load:()=>Lg,lookup:()=>Ig,multiextent:()=>ey,multivalues:()=>ny,params:()=>UA,pivot:()=>Af,prefacet:()=>ll,project:()=>iy,proxy:()=>ry,quantile:()=>Ug,relay:()=>Cf,sample:()=>jg,sequence:()=>Gg,sieve:()=>oy,subflow:()=>kg,timeunit:()=>sy,tupleindex:()=>uy,values:()=>ly,window:()=>Sf});var hn={};z.r(hn),z.d(hn,{bound:()=>x0,identifier:()=>A0,mark:()=>ic,overlap:()=>nb,render:()=>sb,viewlayout:()=>O0});var gn={};z.r(gn),z.d(gn,{axisticks:()=>oc,datajoin:()=>vb,encode:()=>bb,legendentries:()=>xb,linkpath:()=>T0,pie:()=>mu,scale:()=>Ab,sortitems:()=>Fb,stack:()=>ac});var Wn={};z.r(Wn),z.d(Wn,{contour:()=>P0,geojson:()=>G0,geopath:()=>W0,geopoint:()=>V0,geoshape:()=>_d,graticule:()=>Bd,heatmap:()=>H0,isocontour:()=>Nd,kde2d:()=>I0,projection:()=>jb});var Vn={};z.r(Vn),z.d(Vn,{force:()=>Y0});var ot={};z.r(ot),z.d(ot,{nest:()=>ys,pack:()=>tm,partition:()=>nm,stratify:()=>im,tree:()=>jd,treelinks:()=>gc,treemap:()=>Wd});var _n={};z.r(_n),z.d(_n,{label:()=>fm});var ai={};z.r(ai),z.d(ai,{loess:()=>hm,regression:()=>gm});var Hn={};z.r(Hn),z.d(Hn,{voronoi:()=>pm});var Di={};z.r(Di),z.d(Di,{wordcloud:()=>Kr});var qn={};z.r(qn),z.d(qn,{crossfilter:()=>vm,resolvefilter:()=>bm});var b=z(79028),Lo=z(7684),ws=z(98989),Ds=z(86617),on=z(5034),ki=z(14438),sn=z(8891),ro=z(9159),Rr=z(55413),an=z(39888),Ce=z(23958),Be=z(28605),Pe=z(37147),ut=z(79386),ce=z(10913),re=z(45105),ne=z(31999),fe=z(27123),lt=z(98298),jt=z(53911);const mt="year",kt="quarter",zt="month",xt="week",Zt="date",un="day",$i="dayofyear",Cn="hours",Mn="minutes",pn="seconds",ui="milliseconds",pe=[mt,kt,zt,xt,Zt,un,$i,Cn,Mn,pn,ui],We=pe.reduce((e,t,i)=>(e[t]=1+i,e),{});function Ta(e){const t=(0,b.YO)(e).slice(),i={};return t.length||(0,b.z3)("Missing time unit."),t.forEach(a=>{(0,b.mQ)(We,a)?i[a]=1:(0,b.z3)(`Invalid time unit: ${a}.`)}),(i[xt]||i[un]?1:0)+(i[kt]||i[zt]||i[Zt]?1:0)+(i[$i]?1:0)>1&&(0,b.z3)(`Incompatible time units: ${e}`),t.sort((a,l)=>We[a]-We[l]),t}const Vc={[mt]:"%Y ",[kt]:"Q%q ",[zt]:"%b ",[Zt]:"%d ",[xt]:"W%U ",[un]:"%a ",[$i]:"%j ",[Cn]:"%H:00",[Mn]:"00:%M",[pn]:":%S",[ui]:".%L",[`${mt}-${zt}`]:"%Y-%m ",[`${mt}-${zt}-${Zt}`]:"%Y-%m-%d ",[`${Cn}-${Mn}`]:"%H:%M"};function ks(e,t){const i=(0,b.X$)({},Vc,t),o=Ta(e),a=o.length;let l="",f=0,h,g;for(f=0;f<a;)for(h=o.length;h>f;--h)if(g=o.slice(f,h).join("-"),i[g]!=null){l+=i[g],f=h;break}return l.trim()}const li=new Date;function oo(e){return li.setFullYear(e),li.setMonth(0),li.setDate(1),li.setHours(0,0,0,0),li}function zo(e){return Wu(new Date(e))}function Gu(e){return Io(new Date(e))}function Wu(e){return Be.UA.count(oo(e.getFullYear())-1,e)}function Io(e){return Pe.YP.count(oo(e.getFullYear())-1,e)}function Ra(e){return oo(e).getDay()}function Na(e,t,i,o,a,l,f){if(0<=e&&e<100){const h=new Date(-1,t,i,o,a,l,f);return h.setFullYear(e),h}return new Date(e,t,i,o,a,l,f)}function $s(e){return Hh(new Date(e))}function Vh(e){return Vu(new Date(e))}function Hh(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return Be.dA.count(t-1,e)}function Vu(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return Pe.Hl.count(t-1,e)}function Hc(e){return li.setTime(Date.UTC(e,0,1)),li.getUTCDay()}function _a(e,t,i,o,a,l,f){if(0<=e&&e<100){const h=new Date(Date.UTC(-1,t,i,o,a,l,f));return h.setUTCFullYear(i.y),h}return new Date(Date.UTC(e,t,i,o,a,l,f))}function so(e,t,i,o,a){const l=t||1,f=(0,b.se)(e),h=(O,R,I)=>(I=I||O,Hu(i[I],o[I],O===f&&l,R)),g=new Date,m=(0,b.M1)(e),v=m[mt]?h(mt):(0,b.dY)(2012),x=m[zt]?h(zt):m[kt]?h(kt):b.v_,C=m[xt]&&m[un]?h(un,1,xt+un):m[xt]?h(xt,1):m[un]?h(un,1):m[Zt]?h(Zt,1):m[$i]?h($i,1):b.xH,w=m[Cn]?h(Cn):b.v_,S=m[Mn]?h(Mn):b.v_,D=m[pn]?h(pn):b.v_,k=m[ui]?h(ui):b.v_;return function(O){g.setTime(+O);const R=v(g);return a(R,x(g),C(g,R),w(g),S(g),D(g),k(g))}}function Hu(e,t,i,o){const a=i<=1?e:o?(l,f)=>o+i*Math.floor((e(l,f)-o)/i):(l,f)=>i*Math.floor(e(l,f)/i);return t?(l,f)=>t(a(l,f),f):a}function Os(e,t,i){return t+e*7-(i+6)%7}const v1={[mt]:e=>e.getFullYear(),[kt]:e=>Math.floor(e.getMonth()/3),[zt]:e=>e.getMonth(),[Zt]:e=>e.getDate(),[Cn]:e=>e.getHours(),[Mn]:e=>e.getMinutes(),[pn]:e=>e.getSeconds(),[ui]:e=>e.getMilliseconds(),[$i]:e=>Wu(e),[xt]:e=>Io(e),[xt+un]:(e,t)=>Os(Io(e),e.getDay(),Ra(t)),[un]:(e,t)=>Os(1,e.getDay(),Ra(t))},b1={[kt]:e=>3*e,[xt]:(e,t)=>Os(e,0,Ra(t))};function qh(e,t){return so(e,t||1,v1,b1,Na)}const vt={[mt]:e=>e.getUTCFullYear(),[kt]:e=>Math.floor(e.getUTCMonth()/3),[zt]:e=>e.getUTCMonth(),[Zt]:e=>e.getUTCDate(),[Cn]:e=>e.getUTCHours(),[Mn]:e=>e.getUTCMinutes(),[pn]:e=>e.getUTCSeconds(),[ui]:e=>e.getUTCMilliseconds(),[$i]:e=>Hh(e),[xt]:e=>Vu(e),[un]:(e,t)=>Os(1,e.getUTCDay(),Hc(t)),[xt+un]:(e,t)=>Os(Vu(e),e.getUTCDay(),Hc(t))},Xh={[kt]:e=>3*e,[xt]:(e,t)=>Os(e,0,Hc(t))};function Ts(e,t){return so(e,t||1,vt,Xh,_a)}const qc={[mt]:ut.he,[kt]:ce.Ui.every(3),[zt]:ce.Ui,[xt]:Pe.YP,[Zt]:Be.UA,[un]:Be.UA,[$i]:Be.UA,[Cn]:re.Ag,[Mn]:ne.wX,[pn]:fe.R,[ui]:lt.y},x1={[mt]:ut.Mb,[kt]:ce.R6.every(3),[zt]:ce.R6,[xt]:Pe.Hl,[Zt]:Be.dA,[un]:Be.dA,[$i]:Be.dA,[Cn]:re.pz,[Mn]:ne.vD,[pn]:fe.R,[ui]:lt.y};function Nr(e){return qc[e]}function Po(e){return x1[e]}function Xc(e,t,i){return e?e.offset(t,i):void 0}function Yc(e,t,i){return Xc(Nr(e),t,i)}function Yh(e,t,i){return Xc(Po(e),t,i)}function Kh(e,t,i,o){return e?e.range(t,i,o):void 0}function Uo(e,t,i,o){return Kh(Nr(e),t,i,o)}function Qh(e,t,i,o){return Kh(Po(e),t,i,o)}const Ma=1e3,jo=Ma*60,tt=jo*60,ao=tt*24,E1=ao*7,Zh=ao*30,Kc=ao*365,Jh=[mt,zt,Zt,Cn,Mn,pn,ui],Ji=Jh.slice(0,-1),N=Ji.slice(0,-1),P=N.slice(0,-1),j=P.slice(0,-1),X=[mt,xt],U=[mt,zt],K=[mt],se=[[Ji,1,Ma],[Ji,5,5*Ma],[Ji,15,15*Ma],[Ji,30,30*Ma],[N,1,jo],[N,5,5*jo],[N,15,15*jo],[N,30,30*jo],[P,1,tt],[P,3,3*tt],[P,6,6*tt],[P,12,12*tt],[j,1,ao],[X,1,E1],[U,1,Zh],[U,3,3*Zh],[K,1,Kc]];function de(e){const t=e.extent,i=e.maxbins||40,o=Math.abs((0,b.Ln)(t))/i;let a=(0,jt.A)(h=>h[2]).right(se,o),l,f;return a===se.length?(l=K,f=(0,on.sG)(t[0]/Kc,t[1]/Kc,i)):a?(a=se[o/se[a-1][2]<se[a][2]/o?a-1:a],l=a[0],f=a[1]):(l=Jh,f=Math.max((0,on.sG)(t[0],t[1],i),1)),{units:l,step:f}}var ze=z(49739),$t=z(75696);function Xn(e){const t={};return i=>t[i]||(t[i]=e(i))}function Dk(e,t){return i=>{const o=e(i),a=o.indexOf(t);if(a<0)return o;let l=kk(o,a);const f=l<o.length?o.slice(l):"";for(;--l>a;)if(o[l]!=="0"){++l;break}return o.slice(0,l)+f}}function kk(e,t){let i=e.lastIndexOf("e"),o;if(i>0)return i;for(i=e.length;--i>t;)if(o=e.charCodeAt(i),o>=48&&o<=57)return i+1}function Ze(e){const t=Xn(e.format),i=e.formatPrefix;return{format:t,formatPrefix:i,formatFloat(o){const a=(0,ki.A)(o||",");if(a.precision==null){switch(a.precision=12,a.type){case"%":a.precision-=2;break;case"e":a.precision-=1;break}return Dk(t(a),t(".1f")(1)[1])}else return t(a)},formatSpan(o,a,l,f){f=(0,ki.A)(f??",f");const h=(0,on.sG)(o,a,l),g=Math.max(Math.abs(o),Math.abs(a));let m;if(f.precision==null)switch(f.type){case"s":return isNaN(m=(0,sn.A)(h,g))||(f.precision=m),i(f,g);case"":case"e":case"g":case"p":case"r":{isNaN(m=(0,ro.A)(h,g))||(f.precision=m-(f.type==="e"));break}case"f":case"%":{isNaN(m=(0,Rr.A)(h))||(f.precision=m-(f.type==="%")*2);break}}return t(f)}}}let A1;C1();function C1(){return A1=Ze({format:an.GP,formatPrefix:an.s})}function rA(e){return Ze((0,Ce.A)(e))}function eg(e){return arguments.length?A1=rA(e):A1}function oA(e,t,i){i=i||{},(0,b.Gv)(i)||(0,b.z3)(`Invalid time multi-format specifier: ${i}`);const o=t(pn),a=t(Mn),l=t(Cn),f=t(Zt),h=t(xt),g=t(zt),m=t(kt),v=t(mt),x=e(i[ui]||".%L"),C=e(i[pn]||":%S"),w=e(i[Mn]||"%I:%M"),S=e(i[Cn]||"%I %p"),D=e(i[Zt]||i[un]||"%a %d"),k=e(i[xt]||"%b %d"),O=e(i[zt]||"%B"),R=e(i[kt]||"%B"),I=e(i[mt]||"%Y");return V=>(o(V)<V?x:a(V)<V?C:l(V)<V?w:f(V)<V?S:g(V)<V?h(V)<V?D:k:v(V)<V?m(V)<V?O:R:I)(V)}function sA(e){const t=Xn(e.format),i=Xn(e.utcFormat);return{timeFormat:o=>(0,b.Kg)(o)?t(o):oA(t,Nr,o),utcFormat:o=>(0,b.Kg)(o)?i(o):oA(i,Po,o),timeParse:Xn(e.parse),utcParse:Xn(e.utcParse)}}let S1;Qc();function Qc(){return S1=sA({format:ze.DC,parse:ze.T6,utcFormat:ze.aL,utcParse:ze.GY})}function Zc(e){return sA((0,$t.A)(e))}function Rs(e){return arguments.length?S1=Zc(e):S1}const Ba=(e,t)=>(0,b.X$)({},e,t);function Ns(e,t){const i=e?rA(e):eg(),o=t?Zc(t):Rs();return Ba(i,o)}function _e(e,t){const i=arguments.length;return i&&i!==2&&(0,b.z3)("defaultLocale expects either zero or two arguments."),i?Ba(eg(e),Rs(t)):Ba(eg(),Rs())}function F1(){return C1(),Qc(),_e()}var Go=z(53350).hp;const Yn=/^(data:|([A-Za-z]+:)?\/\/)/,He=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,tg=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,Ue="file://";function La(e,t){return i=>({options:i||{},sanitize:w1,load:ng,fileAccess:!1,file:aA(t),http:uA(e)})}async function ng(e,t){const i=await this.sanitize(e,t),o=i.href;return i.localFile?this.file(o):this.http(o,t)}async function w1(e,t){t=(0,b.X$)({},this.options,t);const i=this.fileAccess,o={href:null};let a,l,f;const h=He.test(e.replace(tg,""));(e==null||typeof e!="string"||!h)&&(0,b.z3)("Sanitize failure, invalid URI: "+(0,b.r$)(e));const g=Yn.test(e);return(f=t.baseURL)&&!g&&(!e.startsWith("/")&&!f.endsWith("/")&&(e="/"+e),e=f+e),l=(a=e.startsWith(Ue))||t.mode==="file"||t.mode!=="http"&&!g&&i,a?e=e.slice(Ue.length):e.startsWith("//")&&(t.defaultProtocol==="file"?(e=e.slice(2),l=!0):e=(t.defaultProtocol||"http")+":"+e),Object.defineProperty(o,"localFile",{value:!!l}),o.href=e,t.target&&(o.target=t.target+""),t.rel&&(o.rel=t.rel+""),t.context==="image"&&t.crossOrigin&&(o.crossOrigin=t.crossOrigin+""),o}function aA(e){return e?t=>new Promise((i,o)=>{e.readFile(t,(a,l)=>{a?o(a):i(l)})}):_r}async function _r(){(0,b.z3)("No file system access.")}function uA(e){return e?async function(t,i){const o=(0,b.X$)({},this.options.http,i),a=i&&i.response,l=await e(t,o);return l.ok?(0,b.Tn)(l[a])?l[a]():l.text():(0,b.z3)(l.status+""+l.statusText)}:D1}async function D1(){(0,b.z3)("No HTTP fetch method available.")}const ig=e=>e!=null&&e===e,rg=e=>e==="true"||e==="false"||e===!0||e===!1,og=e=>!Number.isNaN(Date.parse(e)),dt=e=>!Number.isNaN(+e)&&!(e instanceof Date),te=e=>dt(e)&&Number.isInteger(+e),Jt={boolean:b.G4,integer:b.Ro,number:b.Ro,date:b.ay,string:b.dI,unknown:b.D_},er=[rg,te,dt,og],qu=["boolean","integer","number","date"];function Ft(e,t){if(!e||!e.length)return"unknown";const i=e.length,o=er.length,a=er.map((l,f)=>f+1);for(let l=0,f=0,h,g;l<i;++l)for(g=t?e[l][t]:e[l],h=0;h<o;++h)if(a[h]&&ig(g)&&!er[h](g)&&(a[h]=0,++f,f===er.length))return"string";return qu[a.reduce((l,f)=>l===0?f:l,0)-1]}function za(e,t){return t.reduce((i,o)=>(i[o]=Ft(e,o),i),{})}function Xu(e){const t=function(i,o){const a={delimiter:e};return _s(i,o?(0,b.X$)(o,a):a)};return t.responseType="text",t}function _s(e,t){return t.header&&(e=t.header.map(b.r$).join(t.delimiter)+`
`+e),(0,Lo.A)(t.delimiter).parse(e+"")}_s.responseType="text";function sg(e){return typeof Go=="function"&&(0,b.Tn)(Go.isBuffer)?Go.isBuffer(e):!1}function Jc(e,t){const i=t&&t.property?(0,b.ZZ)(t.property):b.D_;return(0,b.Gv)(e)&&!sg(e)?ht(i(e),t):i(JSON.parse(e))}Jc.responseType="json";function ht(e,t){return!(0,b.cy)(e)&&(0,b.xZ)(e)&&(e=[...e]),t&&t.copy?JSON.parse(JSON.stringify(e)):e}const lA={interior:(e,t)=>e!==t,exterior:(e,t)=>e===t};function ci(e,t){let i,o,a,l;return e=Jc(e,t),t&&t.feature?(i=ws.A,a=t.feature):t&&t.mesh?(i=Ds.A,a=t.mesh,l=lA[t.filter]):(0,b.z3)("Missing TopoJSON feature or mesh parameter."),o=(o=e.objects[a])?i(e,o,l):(0,b.z3)("Invalid TopoJSON object: "+a),o&&o.features||[o]}ci.responseType="json";const Mr={dsv:_s,csv:Xu(","),tsv:Xu("	"),json:Jc,topojson:ci};function Wo(e,t){return arguments.length>1?(Mr[e]=t,this):(0,b.mQ)(Mr,e)?Mr[e]:null}function Ms(e){const t=Wo(e);return t&&t.responseType||"text"}function It(e,t,i,o){t=t||{};const a=Wo(t.type||"json");return a||(0,b.z3)("Unknown data format type: "+t.type),e=a(e,t),t.parse&&k1(e,t.parse,i,o),(0,b.mQ)(e,"columns")&&delete e.columns,e}function k1(e,t,i,o){if(!e.length)return;const a=Rs();i=i||a.timeParse,o=o||a.utcParse;let l=e.columns||Object.keys(e[0]),f,h,g,m,v,x;t==="auto"&&(t=za(e,l)),l=Object.keys(t);const C=l.map(w=>{const S=t[w];let D,k;if(S&&(S.startsWith("date:")||S.startsWith("utc:")))return D=S.split(/:(.+)?/,2),k=D[1],(k[0]==="'"&&k[k.length-1]==="'"||k[0]==='"'&&k[k.length-1]==='"')&&(k=k.slice(1,-1)),(D[0]==="utc"?o:i)(k);if(!Jt[S])throw Error("Illegal format pattern: "+w+":"+S);return Jt[S]});for(g=0,v=e.length,x=l.length;g<v;++g)for(f=e[g],m=0;m<x;++m)h=l[m],f[h]=C[m](f[h])}const Yu=La(typeof fetch<"u"&&fetch,null);function ef(e){const t=e||b.D_,i=[],o={};return i.add=a=>{const l=t(a);return o[l]||(o[l]=1,i.push(a)),i},i.remove=a=>{const l=t(a);if(o[l]){o[l]=0;const f=i.indexOf(a);f>=0&&i.splice(f,1)}return i},i}async function Ku(e,t){try{await t(e)}catch(i){e.error(i)}}const ag=Symbol("vega_id");let Qu=1;function Bs(e){return!!(e&&we(e))}function we(e){return e[ag]}function Kn(e,t){return e[ag]=t,e}function Se(e){const t=e===Object(e)?e:{data:e};return we(t)?t:Kn(t,Qu++)}function ie(e){return Oi(e,Se({}))}function Oi(e,t){for(const i in e)t[i]=e[i];return t}function Br(e,t){return Kn(t,we(e))}function Lr(e,t){return e?t?(i,o)=>e(i,o)||we(t(i))-we(t(o)):(i,o)=>e(i,o)||we(i)-we(o):null}function wt(e){return e&&e.constructor===Ot}function Ot(){const e=[],t=[],i=[],o=[],a=[];let l=null,f=!1;return{constructor:Ot,insert(h){const g=(0,b.YO)(h),m=g.length;for(let v=0;v<m;++v)e.push(g[v]);return this},remove(h){const g=(0,b.Tn)(h)?o:t,m=(0,b.YO)(h),v=m.length;for(let x=0;x<v;++x)g.push(m[x]);return this},modify(h,g,m){const v={field:g,value:(0,b.dY)(m)};return(0,b.Tn)(h)?(v.filter=h,a.push(v)):(v.tuple=h,i.push(v)),this},encode(h,g){return(0,b.Tn)(h)?a.push({filter:h,field:g}):i.push({tuple:h,field:g}),this},clean(h){return l=h,this},reflow(){return f=!0,this},pulse(h,g){const m={},v={};let x,C,w,S,D,k;for(x=0,C=g.length;x<C;++x)m[we(g[x])]=1;for(x=0,C=t.length;x<C;++x)D=t[x],m[we(D)]=-1;for(x=0,C=o.length;x<C;++x)S=o[x],g.forEach(R=>{S(R)&&(m[we(R)]=-1)});for(x=0,C=e.length;x<C;++x)D=e[x],k=we(D),m[k]?m[k]=1:h.add.push(Se(e[x]));for(x=0,C=g.length;x<C;++x)D=g[x],m[we(D)]<0&&h.rem.push(D);function O(R,I,V){V?R[I]=V(R):h.encode=I,f||(v[we(R)]=R)}for(x=0,C=i.length;x<C;++x)w=i[x],D=w.tuple,S=w.field,k=m[we(D)],k>0&&(O(D,S,w.value),h.modifies(S));for(x=0,C=a.length;x<C;++x)w=a[x],S=w.filter,g.forEach(R=>{S(R)&&m[we(R)]>0&&O(R,w.field,w.value)}),h.modifies(w.field);if(f)h.mod=t.length||o.length?g.filter(R=>m[we(R)]>0):g.slice();else for(k in v)h.mod.push(v[k]);return(l||l==null&&(t.length||o.length))&&h.clean(!0),h}}}const Qn="_:mod:_";function fi(){Object.defineProperty(this,Qn,{writable:!0,value:{}})}fi.prototype={set(e,t,i,o){const a=this,l=a[e],f=a[Qn];return t!=null&&t>=0?(l[t]!==i||o)&&(l[t]=i,f[t+":"+e]=-1,f[e]=-1):(l!==i||o)&&(a[e]=i,f[e]=(0,b.cy)(i)?1+i.length:-1),a},modified(e,t){const i=this[Qn];if(arguments.length){if((0,b.cy)(e)){for(let o=0;o<e.length;++o)if(i[e[o]])return!0;return!1}}else{for(const o in i)if(i[o])return!0;return!1}return t!=null&&t>=0?t+1<i[e]||!!i[t+":"+e]:!!i[e]},clear(){return this[Qn]={},this}};let Vo=0;const Ia="pulse",tr=new fi,uo=1,Ti=2;function Ke(e,t,i,o){this.id=++Vo,this.value=e,this.stamp=-1,this.rank=-1,this.qrank=-1,this.flags=0,t&&(this._update=t),i&&this.parameters(i,o)}function Ri(e){return function(t){const i=this.flags;return arguments.length===0?!!(i&e):(this.flags=t?i|e:i&~e,this)}}Ke.prototype={targets(){return this._targets||(this._targets=ef(b.id))},set(e){return this.value!==e?(this.value=e,1):0},skip:Ri(uo),modified:Ri(Ti),parameters(e,t,i){t=t!==!1;const o=this._argval=this._argval||new fi,a=this._argops=this._argops||[],l=[];let f,h,g,m;const v=(x,C,w)=>{w instanceof Ke?(w!==this&&(t&&w.targets().add(this),l.push(w)),a.push({op:w,name:x,index:C})):o.set(x,C,w)};for(f in e)if(h=e[f],f===Ia)(0,b.YO)(h).forEach(x=>{x instanceof Ke?x!==this&&(x.targets().add(this),l.push(x)):(0,b.z3)("Pulse parameters must be operator instances.")}),this.source=h;else if((0,b.cy)(h))for(o.set(f,-1,Array(g=h.length)),m=0;m<g;++m)v(f,m,h[m]);else v(f,-1,h);return this.marshall().clear(),i&&(a.initonly=!0),l},marshall(e){const t=this._argval||tr,i=this._argops;let o,a,l,f;if(i){const h=i.length;for(a=0;a<h;++a)o=i[a],l=o.op,f=l.modified()&&l.stamp===e,t.set(o.name,o.index,l.value,f);if(i.initonly){for(a=0;a<h;++a)o=i[a],o.op.targets().remove(this);this._argops=null,this._update=null}}return t},detach(){const e=this._argops;let t,i,o,a;if(e)for(t=0,i=e.length;t<i;++t)o=e[t],a=o.op,a._targets&&a._targets.remove(this);this.pulse=null,this.source=null},evaluate(e){const t=this._update;if(t){const i=this.marshall(e.stamp),o=t.call(this,i,e);if(i.clear(),o!==this.value)this.value=o;else if(!this.modified())return e.StopPropagation}},run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?(this.skip(!1),t=0):t=this.evaluate(e),this.pulse=t||e}};function nr(e,t,i,o){let a=1,l;return e instanceof Ke?l=e:e&&e.prototype instanceof Ke?l=new e:(0,b.Tn)(e)?l=new Ke(null,e):(a=0,l=new Ke(e,t)),this.rank(l),a&&(o=i,i=t),i&&this.connect(l,l.parameters(i,o)),this.touch(l),l}function ir(e,t){const i=e.rank,o=t.length;for(let a=0;a<o;++a)if(i<t[a].rank){this.rerank(e);return}}let Ni=0;function rr(e,t,i){this.id=++Ni,this.value=null,i&&(this.receive=i),e&&(this._filter=e),t&&(this._apply=t)}function Gt(e,t,i){return new rr(e,t,i)}rr.prototype={_filter:b.vN,_apply:b.D_,targets(){return this._targets||(this._targets=ef(b.id))},consume(e){return arguments.length?(this._consume=!!e,this):!!this._consume},receive(e){if(this._filter(e)){const t=this.value=this._apply(e),i=this._targets,o=i?i.length:0;for(let a=0;a<o;++a)i[a].receive(t);this._consume&&(e.preventDefault(),e.stopPropagation())}},filter(e){const t=Gt(e);return this.targets().add(t),t},apply(e){const t=Gt(null,e);return this.targets().add(t),t},merge(){const e=Gt();this.targets().add(e);for(let t=0,i=arguments.length;t<i;++t)arguments[t].targets().add(e);return e},throttle(e){let t=-1;return this.filter(()=>{const i=Date.now();return i-t>e?(t=i,1):0})},debounce(e){const t=Gt();return this.targets().add(Gt(null,null,(0,b.sg)(e,i=>{const o=i.dataflow;t.receive(i),o&&o.run&&o.run()}))),t},between(e,t){let i=!1;return e.targets().add(Gt(null,null,()=>i=!0)),t.targets().add(Gt(null,null,()=>i=!1)),this.filter(()=>i)},detach(){this._filter=b.vN,this._targets=null}};function zr(e,t,i,o){const a=this,l=Gt(i,o),f=function(m){m.dataflow=a;try{l.receive(m)}catch(v){a.error(v)}finally{a.run()}};let h;typeof e=="string"&&typeof document<"u"?h=document.querySelectorAll(e):h=(0,b.YO)(e);const g=h.length;for(let m=0;m<g;++m)h[m].addEventListener(t,f);return l}function Ir(e,t){const i=this.locale();return It(e,t,i.timeParse,i.utcParse)}function Zn(e,t,i){return t=this.parse(t,i),this.pulse(e,this.changeset().insert(t))}async function lo(e,t){const i=this;let o=0,a;try{a=await i.loader().load(e,{context:"dataflow",response:Ms(t&&t.type)});try{a=i.parse(a,t)}catch(l){o=-2,i.warn("Data ingestion failed",e,l)}}catch(l){o=-1,i.warn("Loading failed",e,l)}return{data:a,status:o}}async function Ls(e,t,i){const o=this,a=o._pending||co(o);a.requests+=1;const l=await o.request(t,i);return o.pulse(e,o.changeset().remove(b.vN).insert(l.data||[])),a.done(),l}function co(e){let t;const i=new Promise(o=>t=o);return i.requests=0,i.done=()=>{--i.requests===0&&(e._pending=null,t(e))},e._pending=i}const Ho={skip:!0};function qo(e,t,i,o,a){return(e instanceof Ke?Yo:Xo)(this,e,t,i,o,a),this}function Xo(e,t,i,o,a,l){const f=(0,b.X$)({},l,Ho);let h,g;(0,b.Tn)(i)||(i=(0,b.dY)(i)),o===void 0?h=m=>e.touch(i(m)):(0,b.Tn)(o)?(g=new Ke(null,o,a,!1),h=m=>{g.evaluate(m);const v=i(m),x=g.value;wt(x)?e.pulse(v,x,l):e.update(v,x,f)}):h=m=>e.update(i(m),o,f),t.apply(h)}function Yo(e,t,i,o,a,l){if(o===void 0)t.targets().add(i);else{const f=l||{},h=new Ke(null,Zu(i,o),a,!1);h.modified(f.force),h.rank=t.rank,t.targets().add(h),i&&(h.skip(!0),h.value=i.value,h.targets().add(i),e.connect(i,[h]))}}function Zu(e,t){return t=(0,b.Tn)(t)?t:(0,b.dY)(t),e?function(i,o){const a=t(i,o);return e.skip()||(e.skip(a!==this.value).value=a),a}:t}function Pa(e){e.rank=++this._rank}function Ju(e){const t=[e];let i,o,a;for(;t.length;)if(this.rank(i=t.pop()),o=i._targets)for(a=o.length;--a>=0;)t.push(i=o[a]),i===e&&(0,b.z3)("Cycle detected in dataflow graph.")}const zs={},Sn=1,or=2,_i=4,tf=Sn|or,$1=Sn|_i,Is=Sn|or|_i,ug=8,Ps=16,lg=32,cg=64;function Ko(e,t,i){this.dataflow=e,this.stamp=t??-1,this.add=[],this.rem=[],this.mod=[],this.fields=null,this.encode=i||null}function el(e,t){const i=[];return(0,b.rt)(e,t,o=>i.push(o)),i}function Us(e,t){const i={};return e.visit(t,o=>{i[we(o)]=1}),o=>i[we(o)]?null:o}function tl(e,t){return e?(i,o)=>e(i,o)&&t(i,o):t}Ko.prototype={StopPropagation:zs,ADD:Sn,REM:or,MOD:_i,ADD_REM:tf,ADD_MOD:$1,ALL:Is,REFLOW:ug,SOURCE:Ps,NO_SOURCE:lg,NO_FIELDS:cg,fork(e){return new Ko(this.dataflow).init(this,e)},clone(){const e=this.fork(Is);return e.add=e.add.slice(),e.rem=e.rem.slice(),e.mod=e.mod.slice(),e.source&&(e.source=e.source.slice()),e.materialize(Is|Ps)},addAll(){let e=this;return!e.source||e.add===e.rem||!e.rem.length&&e.source.length===e.add.length||(e=new Ko(this.dataflow).init(this),e.add=e.source,e.rem=[]),e},init(e,t){const i=this;return i.stamp=e.stamp,i.encode=e.encode,e.fields&&!(t&cg)&&(i.fields=e.fields),t&Sn?(i.addF=e.addF,i.add=e.add):(i.addF=null,i.add=[]),t&or?(i.remF=e.remF,i.rem=e.rem):(i.remF=null,i.rem=[]),t&_i?(i.modF=e.modF,i.mod=e.mod):(i.modF=null,i.mod=[]),t&lg?(i.srcF=null,i.source=null):(i.srcF=e.srcF,i.source=e.source,e.cleans&&(i.cleans=e.cleans)),i},runAfter(e){this.dataflow.runAfter(e)},changed(e){const t=e||Is;return t&Sn&&this.add.length||t&or&&this.rem.length||t&_i&&this.mod.length},reflow(e){if(e)return this.fork(Is).reflow();const t=this.add.length,i=this.source&&this.source.length;return i&&i!==t&&(this.mod=this.source,t&&this.filter(_i,Us(this,Sn))),this},clean(e){return arguments.length?(this.cleans=!!e,this):this.cleans},modifies(e){const t=this.fields||(this.fields={});return(0,b.cy)(e)?e.forEach(i=>t[i]=!0):t[e]=!0,this},modified(e,t){const i=this.fields;return(t||this.mod.length)&&i?arguments.length?(0,b.cy)(e)?e.some(o=>i[o]):i[e]:!!i:!1},filter(e,t){const i=this;return e&Sn&&(i.addF=tl(i.addF,t)),e&or&&(i.remF=tl(i.remF,t)),e&_i&&(i.modF=tl(i.modF,t)),e&Ps&&(i.srcF=tl(i.srcF,t)),i},materialize(e){e=e||Is;const t=this;return e&Sn&&t.addF&&(t.add=el(t.add,t.addF),t.addF=null),e&or&&t.remF&&(t.rem=el(t.rem,t.remF),t.remF=null),e&_i&&t.modF&&(t.mod=el(t.mod,t.modF),t.modF=null),e&Ps&&t.srcF&&(t.source=t.source.filter(t.srcF),t.srcF=null),t},visit(e,t){const i=this,o=t;if(e&Ps)return(0,b.rt)(i.source,i.srcF,o),i;e&Sn&&(0,b.rt)(i.add,i.addF,o),e&or&&(0,b.rt)(i.rem,i.remF,o),e&_i&&(0,b.rt)(i.mod,i.modF,o);const a=i.source;if(e&ug&&a){const l=i.add.length+i.mod.length;l===a.length||(l?(0,b.rt)(a,Us(i,$1),o):(0,b.rt)(a,i.srcF,o))}return i}};function Jn(e,t,i,o){const a=this;let l=0;this.dataflow=e,this.stamp=t,this.fields=null,this.encode=o||null,this.pulses=i;for(const f of i)if(f.stamp===t){if(f.fields){const h=a.fields||(a.fields={});for(const g in f.fields)h[g]=1}f.changed(a.ADD)&&(l|=a.ADD),f.changed(a.REM)&&(l|=a.REM),f.changed(a.MOD)&&(l|=a.MOD)}this.changes=l}(0,b.B)(Jn,Ko,{fork(e){const t=new Ko(this.dataflow).init(this,e&this.NO_FIELDS);return e!==void 0&&(e&t.ADD&&this.visit(t.ADD,i=>t.add.push(i)),e&t.REM&&this.visit(t.REM,i=>t.rem.push(i)),e&t.MOD&&this.visit(t.MOD,i=>t.mod.push(i))),t},changed(e){return this.changes&e},modified(e){const t=this,i=t.fields;return i&&t.changes&t.MOD?(0,b.cy)(e)?e.some(o=>i[o]):i[e]:0},filter(){(0,b.z3)("MultiPulse does not support filtering.")},materialize(){(0,b.z3)("MultiPulse does not support materialization.")},visit(e,t){const i=this,o=i.pulses,a=o.length;let l=0;if(e&i.SOURCE)for(;l<a;++l)o[l].visit(e,t);else for(;l<a;++l)o[l].stamp===i.stamp&&o[l].visit(e,t);return i}});async function fg(e,t,i){const o=this,a=[];if(o._pulse)return fA(o);if(o._pending&&await o._pending,t&&await Ku(o,t),!o._touched.length)return o.debug("Dataflow invoked, but nothing to do."),o;const l=++o._clock;o._pulse=new Ko(o,l,e),o._touched.forEach(v=>o._enqueue(v,!0)),o._touched=ef(b.id);let f=0,h,g,m;try{for(;o._heap.size()>0;){if(h=o._heap.pop(),h.rank!==h.qrank){o._enqueue(h,!0);continue}g=h.run(o._getPulse(h,e)),g.then?g=await g:g.async&&(a.push(g.async),g=zs),g!==zs&&h._targets&&h._targets.forEach(v=>o._enqueue(v)),++f}}catch(v){o._heap.clear(),m=v}if(o._input={},o._pulse=null,o.debug(`Pulse ${l}: ${f} operators`),m&&(o._postrun=[],o.error(m)),o._postrun.length){const v=o._postrun.sort((x,C)=>C.priority-x.priority);o._postrun=[];for(let x=0;x<v.length;++x)await Ku(o,v[x].callback)}return i&&await Ku(o,i),a.length&&Promise.all(a).then(v=>o.runAsync(null,()=>{v.forEach(x=>{try{x(o)}catch(C){o.error(C)}})})),o}async function cA(e,t,i){for(;this._running;)await this._running;const o=()=>this._running=null;return(this._running=this.evaluate(e,t,i)).then(o,o),this._running}function $k(e,t,i){return this._pulse?fA(this):(this.evaluate(e,t,i),this)}function Ok(e,t,i){if(this._pulse||t)this._postrun.push({priority:i||0,callback:e});else try{e(this)}catch(o){this.error(o)}}function fA(e){return e.error("Dataflow already running. Use runAsync() to chain invocations."),e}function O1(e,t){const i=e.stamp<this._clock;i&&(e.stamp=this._clock),(i||t)&&(e.qrank=e.rank,this._heap.push(e))}function Tk(e,t){const i=e.source,o=this._clock;return i&&(0,b.cy)(i)?new Jn(this,o,i.map(a=>a.pulse),t):this._input[e.id]||Rk(this._pulse,i&&i.pulse)}function Rk(e,t){return t&&t.stamp===e.stamp?t:(e=e.fork(),t&&t!==zs&&(e.source=t.source),e)}const T1={skip:!1,force:!1};function R1(e,t){const i=t||T1;return this._pulse?this._enqueue(e):this._touched.add(e),i.skip&&e.skip(!0),this}function Nk(e,t,i){const o=i||T1;return(e.set(t)||o.force)&&this.touch(e,o),this}function _k(e,t,i){this.touch(e,i||T1);const o=new Ko(this,this._clock+(this._pulse?0:1)),a=e.pulse&&e.pulse.source||[];return o.target=e,this._input[e.id]=t.pulse(o,a),this}function dA(e){let t=[];return{clear:()=>t=[],size:()=>t.length,peek:()=>t[0],push:i=>(t.push(i),dg(t,0,t.length-1,e)),pop:()=>{const i=t.pop();let o;return t.length?(o=t[0],t[0]=i,hA(t,0,e)):o=i,o}}}function dg(e,t,i,o){let a,l;const f=e[i];for(;i>t;){if(l=i-1>>1,a=e[l],o(f,a)<0){e[i]=a,i=l;continue}break}return e[i]=f}function hA(e,t,i){const o=t,a=e.length,l=e[t];let f=(t<<1)+1,h;for(;f<a;)h=f+1,h<a&&i(e[f],e[h])>=0&&(f=h),e[t]=e[f],t=f,f=(t<<1)+1;return e[t]=l,dg(e,o,t,i)}function js(){this.logger((0,b.vF)()),this.logLevel(b.$D),this._clock=0,this._rank=0,this._locale=_e();try{this._loader=Yu()}catch{}this._touched=ef(b.id),this._input={},this._pulse=null,this._heap=dA((e,t)=>e.qrank-t.qrank),this._postrun=[]}function sr(e){return function(){return this._log[e].apply(this,arguments)}}js.prototype={stamp(){return this._clock},loader(e){return arguments.length?(this._loader=e,this):this._loader},locale(e){return arguments.length?(this._locale=e,this):this._locale},logger(e){return arguments.length?(this._log=e,this):this._log},error:sr("error"),warn:sr("warn"),info:sr("info"),debug:sr("debug"),logLevel:sr("level"),cleanThreshold:1e4,add:nr,connect:ir,rank:Pa,rerank:Ju,pulse:_k,touch:R1,update:Nk,changeset:Ot,ingest:Zn,parse:Ir,preload:Ls,request:lo,events:zr,on:qo,evaluate:fg,run:$k,runAsync:cA,runAfter:Ok,_enqueue:O1,_getPulse:Tk};function q(e,t){Ke.call(this,e,null,t)}(0,b.B)(q,Ke,{run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?this.skip(!1):t=this.evaluate(e),t=t||e,t.then?t=t.then(i=>this.pulse=i):t!==e.StopPropagation&&(this.pulse=t),t},evaluate(e){const t=this.marshall(e.stamp),i=this.transform(t,e);return t.clear(),i},transform(){}});const Bn={};function Ln(e){const t=hg(e);return t&&t.Definition||null}function hg(e){return e=e&&e.toLowerCase(),(0,b.mQ)(Bn,e)?Bn[e]:null}var nf=z(26942),gg=z(65728),gA=z(55453),pA=z(74312);function*mA(e,t){if(t==null)for(let i of e)i!=null&&i!==""&&(i=+i)>=i&&(yield i);else{let i=-1;for(let o of e)o=t(o,++i,e),o!=null&&o!==""&&(o=+o)>=o&&(yield o)}}function N1(e,t,i){const o=Float64Array.from(mA(e,i));return o.sort(nf.A),t.map(a=>(0,gg.Z4)(o,a))}function _1(e,t){return N1(e,[.25,.5,.75],t)}function M1(e,t){const i=e.length,o=(0,gA.A)(e,t),a=_1(e,t),l=(a[2]-a[0])/1.34;return 1.06*(Math.min(o,l)||o||Math.abs(a[0])||1)*Math.pow(i,-.2)}function yA(e){const t=e.maxbins||20,i=e.base||10,o=Math.log(i),a=e.divide||[5,2];let l=e.extent[0],f=e.extent[1],h,g,m,v,x,C;const w=e.span||f-l||Math.abs(l)||1;if(e.step)h=e.step;else if(e.steps){for(v=w/t,x=0,C=e.steps.length;x<C&&e.steps[x]<v;++x);h=e.steps[Math.max(0,x-1)]}else{for(g=Math.ceil(Math.log(t)/o),m=e.minstep||0,h=Math.max(m,Math.pow(i,Math.round(Math.log(w)/o)-g));Math.ceil(w/h)>t;)h*=i;for(x=0,C=a.length;x<C;++x)v=h/a[x],v>=m&&w/v<=t&&(h=v)}v=Math.log(h);const S=v>=0?0:~~(-v/o)+1,D=Math.pow(i,-S-1);return(e.nice||e.nice===void 0)&&(v=Math.floor(l/h+D)*h,l=l<v?v-h:v,f=Math.ceil(f/h)*h),{start:l,stop:f===l?l+h:f,step:h}}var ar=Math.random;function Mk(e){ar=e}function vA(e,t,i,o){if(!e.length)return[void 0,void 0];const a=Float64Array.from(mA(e,o)),l=a.length,f=t;let h,g,m,v;for(m=0,v=Array(f);m<f;++m){for(h=0,g=0;g<l;++g)h+=a[~~(ar()*l)];v[m]=h/l}return v.sort(nf.A),[(0,gg.Ay)(v,i/2),(0,gg.Ay)(v,1-i/2)]}function bA(e,t,i,o){o=o||(C=>C);const a=e.length,l=new Float64Array(a);let f=0,h=1,g=o(e[0]),m=g,v=g+t,x;for(;h<a;++h){if(x=o(e[h]),x>=v){for(m=(g+m)/2;f<h;++f)l[f]=m;v=x+t,g=x}m=x}for(m=(g+m)/2;f<h;++f)l[f]=m;return i?Bk(l,t+t/4):l}function Bk(e,t){const i=e.length;let o=0,a=1,l,f;for(;e[o]===e[a];)++a;for(;a<i;){for(l=a+1;e[a]===e[l];)++l;if(e[a]-e[a-1]<t){for(f=a+(o+l-a-a>>1);f<a;)e[f++]=e[a];for(;f>a;)e[f--]=e[o]}o=a,a=l}return e}function Lk(e){return function(){return e=(1103515245*e+12345)%2147483647,e/2147483647}}function zk(e,t){t==null&&(t=e,e=0);let i,o,a;const l={min(f){return arguments.length?(i=f||0,a=o-i,l):i},max(f){return arguments.length?(o=f||0,a=o-i,l):o},sample(){return i+Math.floor(a*ar())},pdf(f){return f===Math.floor(f)&&f>=i&&f<o?1/a:0},cdf(f){const h=Math.floor(f);return h<i?0:h>=o?1:(h-i+1)/a},icdf(f){return f>=0&&f<=1?i-1+Math.floor(f*a):NaN}};return l.min(e).max(t)}const xA=Math.sqrt(2*Math.PI),pg=Math.SQRT2;let nl=NaN;function Ua(e,t){e=e||0,t=t??1;let i=0,o=0,a,l;if(nl===nl)i=nl,nl=NaN;else{do i=ar()*2-1,o=ar()*2-1,a=i*i+o*o;while(a===0||a>1);l=Math.sqrt(-2*Math.log(a)/a),i*=l,nl=o*l}return e+i*t}function ur(e,t,i){i=i??1;const o=(e-(t||0))/i;return Math.exp(-.5*o*o)/(i*xA)}function Tt(e,t,i){t=t||0,i=i??1;const o=(e-t)/i,a=Math.abs(o);let l;if(a>37)l=0;else{const f=Math.exp(-a*a/2);let h;a<7.07106781186547?(h=.0352624965998911*a+.700383064443688,h=h*a+6.37396220353165,h=h*a+33.912866078383,h=h*a+112.079291497871,h=h*a+221.213596169931,h=h*a+220.206867912376,l=f*h,h=.0883883476483184*a+1.75566716318264,h=h*a+16.064177579207,h=h*a+86.7807322029461,h=h*a+296.564248779674,h=h*a+637.333633378831,h=h*a+793.826512519948,h=h*a+440.413735824752,l=l/h):(h=a+.65,h=a+4/h,h=a+3/h,h=a+2/h,h=a+1/h,l=f/h/2.506628274631)}return o>0?1-l:l}function ja(e,t,i){return e<0||e>1?NaN:(t||0)+(i??1)*pg*EA(2*e-1)}function EA(e){let t=-Math.log((1-e)*(1+e)),i;return t<6.25?(t-=3.125,i=-364441206401782e-35,i=-16850591381820166e-35+i*t,i=128584807152564e-32+i*t,i=11157877678025181e-33+i*t,i=-1333171662854621e-31+i*t,i=20972767875968562e-33+i*t,i=6637638134358324e-30+i*t,i=-4054566272975207e-29+i*t,i=-8151934197605472e-29+i*t,i=26335093153082323e-28+i*t,i=-12975133253453532e-27+i*t,i=-5415412054294628e-26+i*t,i=10512122733215323e-25+i*t,i=-4112633980346984e-24+i*t,i=-29070369957882005e-24+i*t,i=42347877827932404e-23+i*t,i=-13654692000834679e-22+i*t,i=-13882523362786469e-21+i*t,i=.00018673420803405714+i*t,i=-.000740702534166267+i*t,i=-.006033670871430149+i*t,i=.24015818242558962+i*t,i=1.6536545626831027+i*t):t<16?(t=Math.sqrt(t)-3.25,i=22137376921775787e-25,i=9075656193888539e-23+i*t,i=-27517406297064545e-23+i*t,i=18239629214389228e-24+i*t,i=15027403968909828e-22+i*t,i=-4013867526981546e-21+i*t,i=29234449089955446e-22+i*t,i=12475304481671779e-21+i*t,i=-47318229009055734e-21+i*t,i=6828485145957318e-20+i*t,i=24031110387097894e-21+i*t,i=-.0003550375203628475+i*t,i=.0009532893797373805+i*t,i=-.0016882755560235047+i*t,i=.002491442096107851+i*t,i=-.003751208507569241+i*t,i=.005370914553590064+i*t,i=1.0052589676941592+i*t,i=3.0838856104922208+i*t):Number.isFinite(t)?(t=Math.sqrt(t)-5,i=-27109920616438573e-27,i=-2555641816996525e-25+i*t,i=15076572693500548e-25+i*t,i=-3789465440126737e-24+i*t,i=761570120807834e-23+i*t,i=-1496002662714924e-23+i*t,i=2914795345090108e-23+i*t,i=-6771199775845234e-23+i*t,i=22900482228026655e-23+i*t,i=-99298272942317e-20+i*t,i=4526062597223154e-21+i*t,i=-1968177810553167e-20+i*t,i=7599527703001776e-20+i*t,i=-.00021503011930044477+i*t,i=-.00013871931833623122+i*t,i=1.0103004648645344+i*t,i=4.849906401408584+i*t):i=1/0,i*e}function Ga(e,t){let i,o;const a={mean(l){return arguments.length?(i=l||0,a):i},stdev(l){return arguments.length?(o=l??1,a):o},sample:()=>Ua(i,o),pdf:l=>ur(l,i,o),cdf:l=>Tt(l,i,o),icdf:l=>ja(l,i,o)};return a.mean(e).stdev(t)}function il(e,t){const i=Ga();let o=0;const a={data(l){return arguments.length?(e=l,o=l?l.length:0,a.bandwidth(t)):e},bandwidth(l){return arguments.length?(t=l,!t&&e&&(t=M1(e)),a):t},sample(){return e[~~(ar()*o)]+t*i.sample()},pdf(l){let f=0,h=0;for(;h<o;++h)f+=i.pdf((l-e[h])/t);return f/t/o},cdf(l){let f=0,h=0;for(;h<o;++h)f+=i.cdf((l-e[h])/t);return f/o},icdf(){throw Error("KDE icdf not supported.")}};return a.data(e)}function B1(e,t){return e=e||0,t=t??1,Math.exp(e+Ua()*t)}function Gs(e,t,i){if(e<=0)return 0;t=t||0,i=i??1;const o=(Math.log(e)-t)/i;return Math.exp(-.5*o*o)/(i*xA*e)}function rf(e,t,i){return Tt(Math.log(e),t,i)}function L1(e,t,i){return Math.exp(ja(e,t,i))}function of(e,t){let i,o;const a={mean(l){return arguments.length?(i=l||0,a):i},stdev(l){return arguments.length?(o=l??1,a):o},sample:()=>B1(i,o),pdf:l=>Gs(l,i,o),cdf:l=>rf(l,i,o),icdf:l=>L1(l,i,o)};return a.mean(e).stdev(t)}function AA(e,t){let i=0,o;function a(f){const h=[];let g=0,m;for(m=0;m<i;++m)g+=h[m]=f[m]==null?1:+f[m];for(m=0;m<i;++m)h[m]/=g;return h}const l={weights(f){return arguments.length?(o=a(t=f||[]),l):t},distributions(f){return arguments.length?(f?(i=f.length,e=f):(i=0,e=[]),l.weights(t)):e},sample(){const f=ar();let h=e[i-1],g=o[0],m=0;for(;m<i-1;g+=o[++m])if(f<g){h=e[m];break}return h.sample()},pdf(f){let h=0,g=0;for(;g<i;++g)h+=o[g]*e[g].pdf(f);return h},cdf(f){let h=0,g=0;for(;g<i;++g)h+=o[g]*e[g].cdf(f);return h},icdf(){throw Error("Mixture icdf not supported.")}};return l.distributions(e).weights(t)}function z1(e,t){return t==null&&(t=e??1,e=0),e+(t-e)*ar()}function I1(e,t,i){return i==null&&(i=t??1,t=0),e>=t&&e<=i?1/(i-t):0}function P1(e,t,i){return i==null&&(i=t??1,t=0),e<t?0:e>i?1:(e-t)/(i-t)}function U1(e,t,i){return i==null&&(i=t??1,t=0),e>=0&&e<=1?t+e*(i-t):NaN}function CA(e,t){let i,o;const a={min(l){return arguments.length?(i=l||0,a):i},max(l){return arguments.length?(o=l??1,a):o},sample:()=>z1(i,o),pdf:l=>I1(l,i,o),cdf:l=>P1(l,i,o),icdf:l=>U1(l,i,o)};return t==null&&(t=e??1,e=0),a.min(e).max(t)}function j1(e,t,i){let o=0,a=0;for(const l of e){const f=i(l);t(l)==null||f==null||isNaN(f)||(o+=(f-o)/++a)}return{coef:[o],predict:()=>o,rSquared:0}}function sf(e,t,i,o){const a=o-e*e,l=Math.abs(a)<1e-24?0:(i-e*t)/a;return[t-l*e,l]}function rl(e,t,i,o){e=e.filter(w=>{let S=t(w),D=i(w);return S!=null&&(S=+S)>=S&&D!=null&&(D=+D)>=D}),o&&e.sort((w,S)=>t(w)-t(S));const a=e.length,l=new Float64Array(a),f=new Float64Array(a);let h=0,g=0,m=0,v,x,C;for(C of e)l[h]=v=+t(C),f[h]=x=+i(C),++h,g+=(v-g)/h,m+=(x-m)/h;for(h=0;h<a;++h)l[h]-=g,f[h]-=m;return[l,f,g,m]}function ol(e,t,i,o){let a=-1,l,f;for(const h of e)l=t(h),f=i(h),l!=null&&(l=+l)>=l&&f!=null&&(f=+f)>=f&&o(l,f,++a)}function Wa(e,t,i,o,a){let l=0,f=0;return ol(e,t,i,(h,g)=>{const m=g-a(h),v=g-o;l+=m*m,f+=v*v}),1-l/f}function mg(e,t,i){let o=0,a=0,l=0,f=0,h=0;ol(e,t,i,(v,x)=>{++h,o+=(v-o)/h,a+=(x-a)/h,l+=(v*x-l)/h,f+=(v*v-f)/h});const g=sf(o,a,l,f),m=v=>g[0]+g[1]*v;return{coef:g,predict:m,rSquared:Wa(e,t,i,a,m)}}function yg(e,t,i){let o=0,a=0,l=0,f=0,h=0;ol(e,t,i,(v,x)=>{++h,v=Math.log(v),o+=(v-o)/h,a+=(x-a)/h,l+=(v*x-l)/h,f+=(v*v-f)/h});const g=sf(o,a,l,f),m=v=>g[0]+g[1]*Math.log(v);return{coef:g,predict:m,rSquared:Wa(e,t,i,a,m)}}function af(e,t,i){const[o,a,l,f]=rl(e,t,i);let h=0,g=0,m=0,v=0,x=0,C,w,S;ol(e,t,i,(R,I)=>{C=o[x++],w=Math.log(I),S=C*I,h+=(I*w-h)/x,g+=(S-g)/x,m+=(S*w-m)/x,v+=(C*S-v)/x});const[D,k]=sf(g/f,h/f,m/f,v/f),O=R=>Math.exp(D+k*(R-l));return{coef:[Math.exp(D-k*l),k],predict:O,rSquared:Wa(e,t,i,f,O)}}function lr(e,t,i){let o=0,a=0,l=0,f=0,h=0,g=0;ol(e,t,i,(x,C)=>{const w=Math.log(x),S=Math.log(C);++g,o+=(w-o)/g,a+=(S-a)/g,l+=(w*S-l)/g,f+=(w*w-f)/g,h+=(C-h)/g});const m=sf(o,a,l,f),v=x=>m[0]*Math.pow(x,m[1]);return m[0]=Math.exp(m[0]),{coef:m,predict:v,rSquared:Wa(e,t,i,h,v)}}function vg(e,t,i){const[o,a,l,f]=rl(e,t,i),h=o.length;let g=0,m=0,v=0,x=0,C=0,w,S,D,k;for(w=0;w<h;)S=o[w],D=a[w++],k=S*S,g+=(k-g)/w,m+=(k*S-m)/w,v+=(k*k-v)/w,x+=(S*D-x)/w,C+=(k*D-C)/w;const O=v-g*g,R=g*O-m*m,I=(C*g-x*m)/R,V=(x*O-C*m)/R,W=-I*g,ee=M=>(M=M-l,I*M*M+V*M+W+f);return{coef:[W-V*l+I*l*l+f,V-2*I*l,I],predict:ee,rSquared:Wa(e,t,i,f,ee)}}function bg(e,t,i,o){if(o===0)return j1(e,t,i);if(o===1)return mg(e,t,i);if(o===2)return vg(e,t,i);const[a,l,f,h]=rl(e,t,i),g=a.length,m=[],v=[],x=o+1;let C,w,S,D,k;for(C=0;C<x;++C){for(S=0,D=0;S<g;++S)D+=Math.pow(a[S],C)*l[S];for(m.push(D),k=new Float64Array(x),w=0;w<x;++w){for(S=0,D=0;S<g;++S)D+=Math.pow(a[S],C+w);k[w]=D}v.push(k)}v.push(m);const O=SA(v),R=I=>{I-=f;let V=h+O[0]+O[1]*I+O[2]*I*I;for(C=3;C<x;++C)V+=O[C]*Math.pow(I,C);return V};return{coef:Ik(x,O,-f,h),predict:R,rSquared:Wa(e,t,i,h,R)}}function Ik(e,t,i,o){const a=Array(e);let l,f,h,g;for(l=0;l<e;++l)a[l]=0;for(l=e-1;l>=0;--l)for(h=t[l],g=1,a[l]+=h,f=1;f<=l;++f)g*=(l+1-f)/f,a[l-f]+=h*Math.pow(i,f)*g;return a[0]+=o,a}function SA(e){const t=e.length-1,i=[];let o,a,l,f,h;for(o=0;o<t;++o){for(f=o,a=o+1;a<t;++a)Math.abs(e[o][a])>Math.abs(e[o][f])&&(f=a);for(l=o;l<t+1;++l)h=e[l][o],e[l][o]=e[l][f],e[l][f]=h;for(a=o+1;a<t;++a)for(l=t;l>=o;l--)e[l][a]-=e[l][o]*e[o][a]/e[o][o]}for(a=t-1;a>=0;--a){for(h=0,l=a+1;l<t;++l)h+=e[l][a]*i[l];i[a]=(e[t][a]-h)/e[a][a]}return i}const G1=2,uf=1e-12;function W1(e,t,i,o){const[a,l,f,h]=rl(e,t,i,!0),g=a.length,m=Math.max(2,~~(o*g)),v=new Float64Array(g),x=new Float64Array(g),C=new Float64Array(g).fill(1);for(let w=-1;++w<=G1;){const S=[0,m-1];for(let k=0;k<g;++k){const O=a[k],R=S[0],I=S[1],V=O-a[R]>a[I]-O?R:I;let W=0,ee=0,M=0,J=0,ue=0;const ge=1/Math.abs(a[V]-O||1);for(let _t=R;_t<=I;++_t){const bt=a[_t],Ye=l[_t],et=FA(Math.abs(O-bt)*ge)*C[_t],si=bt*et;W+=et,ee+=si,M+=Ye*et,J+=Ye*si,ue+=bt*si}const[Le,Xe]=sf(ee/W,M/W,J/W,ue/W);v[k]=Le+Xe*O,x[k]=Math.abs(l[k]-v[k]),fo(a,k+1,S)}if(w===G1)break;const D=(0,pA.A)(x);if(Math.abs(D)<uf)break;for(let k=0,O,R;k<g;++k)O=x[k]/(6*D),C[k]=O>=1?uf:(R=1-O*O)*R}return Qo(a,v,f,h)}function FA(e){return(e=1-e*e*e)*e*e}function fo(e,t,i){const o=e[t];let a=i[0],l=i[1]+1;if(!(l>=e.length))for(;t>a&&e[l]-o<=o-e[a];)i[0]=++a,i[1]=l,++l}function Qo(e,t,i,o){const a=e.length,l=[];let f=0,h=0,g=[],m;for(;f<a;++f)m=e[f]+i,g[0]===m?g[1]+=(t[f]-g[1])/++h:(h=0,g[1]+=o,g=[m,t[f]],l.push(g));return g[1]+=o,l}const xg=.5*Math.PI/180;function lf(e,t,i,o){i=i||25,o=Math.max(i,o||200);const a=D=>[D,e(D)],l=t[0],f=t[1],h=f-l,g=h/o,m=[a(l)],v=[];if(i===o){for(let D=1;D<o;++D)m.push(a(l+D/i*h));return m.push(a(f)),m}else{v.push(a(f));for(let D=i;--D>0;)v.push(a(l+D/i*h))}let x=m[0],C=v[v.length-1];const w=1/h,S=cf(x[1],v);for(;C;){const D=a((x[0]+C[0])/2);D[0]-x[0]>=g&&wA(x,D,C,w,S)>xg?v.push(D):(x=C,m.push(C),v.pop()),C=v[v.length-1]}return m}function cf(e,t){let i=e,o=e;const a=t.length;for(let l=0;l<a;++l){const f=t[l][1];f<i&&(i=f),f>o&&(o=f)}return 1/(o-i)}function wA(e,t,i,o,a){const l=Math.atan2(a*(i[1]-e[1]),o*(i[0]-e[0])),f=Math.atan2(a*(t[1]-e[1]),o*(t[0]-e[0]));return Math.abs(l-f)}var DA=z(5631),kA=z(97816),Va=z(8390),nt=z(48633);function mn(e){return t=>{const i=e.length;let o=1,a=String(e[0](t));for(;o<i;++o)a+="|"+e[o](t);return a}}function ho(e){return!e||!e.length?function(){return""}:e.length===1?e[0]:mn(e)}function sl(e,t,i){return i||e+(t?"_"+t:"")}const ff=()=>{},al={init:ff,add:ff,rem:ff,idx:0},Wt={values:{init:e=>e.cell.store=!0,value:e=>e.cell.data.values(),idx:-1},count:{value:e=>e.cell.num},__count__:{value:e=>e.missing+e.valid},missing:{value:e=>e.missing},valid:{value:e=>e.valid},sum:{init:e=>e.sum=0,value:e=>e.valid?e.sum:void 0,add:(e,t)=>e.sum+=+t,rem:(e,t)=>e.sum-=t},product:{init:e=>e.product=1,value:e=>e.valid?e.product:void 0,add:(e,t)=>e.product*=t,rem:(e,t)=>e.product/=t},mean:{init:e=>e.mean=0,value:e=>e.valid?e.mean:void 0,add:(e,t)=>(e.mean_d=t-e.mean,e.mean+=e.mean_d/e.valid),rem:(e,t)=>(e.mean_d=t-e.mean,e.mean-=e.valid?e.mean_d/e.valid:e.mean)},average:{value:e=>e.valid?e.mean:void 0,req:["mean"],idx:1},variance:{init:e=>e.dev=0,value:e=>e.valid>1?e.dev/(e.valid-1):void 0,add:(e,t)=>e.dev+=e.mean_d*(t-e.mean),rem:(e,t)=>e.dev-=e.mean_d*(t-e.mean),req:["mean"],idx:1},variancep:{value:e=>e.valid>1?e.dev/e.valid:void 0,req:["variance"],idx:2},stdev:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid-1)):void 0,req:["variance"],idx:2},stdevp:{value:e=>e.valid>1?Math.sqrt(e.dev/e.valid):void 0,req:["variance"],idx:2},stderr:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid*(e.valid-1))):void 0,req:["variance"],idx:2},distinct:{value:e=>e.cell.data.distinct(e.get),req:["values"],idx:3},ci0:{value:e=>e.cell.data.ci0(e.get),req:["values"],idx:3},ci1:{value:e=>e.cell.data.ci1(e.get),req:["values"],idx:3},median:{value:e=>e.cell.data.q2(e.get),req:["values"],idx:3},q1:{value:e=>e.cell.data.q1(e.get),req:["values"],idx:3},q3:{value:e=>e.cell.data.q3(e.get),req:["values"],idx:3},min:{init:e=>e.min=void 0,value:e=>e.min=Number.isNaN(e.min)?e.cell.data.min(e.get):e.min,add:(e,t)=>{(t<e.min||e.min===void 0)&&(e.min=t)},rem:(e,t)=>{t<=e.min&&(e.min=NaN)},req:["values"],idx:4},max:{init:e=>e.max=void 0,value:e=>e.max=Number.isNaN(e.max)?e.cell.data.max(e.get):e.max,add:(e,t)=>{(t>e.max||e.max===void 0)&&(e.max=t)},rem:(e,t)=>{t>=e.max&&(e.max=NaN)},req:["values"],idx:4},argmin:{init:e=>e.argmin=void 0,value:e=>e.argmin||e.cell.data.argmin(e.get),add:(e,t,i)=>{t<e.min&&(e.argmin=i)},rem:(e,t)=>{t<=e.min&&(e.argmin=void 0)},req:["min","values"],idx:3},argmax:{init:e=>e.argmax=void 0,value:e=>e.argmax||e.cell.data.argmax(e.get),add:(e,t,i)=>{t>e.max&&(e.argmax=i)},rem:(e,t)=>{t>=e.max&&(e.argmax=void 0)},req:["max","values"],idx:3},exponential:{init:(e,t)=>{e.exp=0,e.exp_r=t},value:e=>e.valid?e.exp*(1-e.exp_r)/(1-e.exp_r**e.valid):void 0,add:(e,t)=>e.exp=e.exp_r*e.exp+t,rem:(e,t)=>e.exp=(e.exp-t/e.exp_r**(e.valid-1))/e.exp_r},exponentialb:{value:e=>e.valid?e.exp*(1-e.exp_r):void 0,req:["exponential"],idx:1}},Ha=Object.keys(Wt).filter(e=>e!=="__count__");function Zo(e,t){return(i,o)=>(0,b.X$)({name:e,aggregate_param:o,out:i||e},al,t)}[...Ha,"__count__"].forEach(e=>{Wt[e]=Zo(e,Wt[e])});function xe(e,t,i){return Wt[e](i,t)}function Jo(e,t){return e.idx-t.idx}function $A(e){const t={};e.forEach(o=>t[o.name]=o);const i=o=>{o.req&&o.req.forEach(a=>{t[a]||i(t[a]=Wt[a]())})};return e.forEach(i),Object.values(t).sort(Jo)}function OA(){this.valid=0,this.missing=0,this._ops.forEach(e=>e.aggregate_param==null?e.init(this):e.init(this,e.aggregate_param))}function go(e,t){if(e==null||e===""){++this.missing;return}e===e&&(++this.valid,this._ops.forEach(i=>i.add(this,e,t)))}function Pk(e,t){if(e==null||e===""){--this.missing;return}e===e&&(--this.valid,this._ops.forEach(i=>i.rem(this,e,t)))}function TA(e){return this._out.forEach(t=>e[t.out]=t.value(this)),e}function V1(e,t){const i=t||b.D_,o=$A(e),a=e.slice().sort(Jo);function l(f){this._ops=o,this._out=a,this.cell=f,this.init()}return l.prototype.init=OA,l.prototype.add=go,l.prototype.rem=Pk,l.prototype.set=TA,l.prototype.get=i,l.fields=e.map(f=>f.out),l}function ul(e){this._key=e?(0,b.ZZ)(e):we,this.reset()}const Fn=ul.prototype;Fn.reset=function(){this._add=[],this._rem=[],this._ext=null,this._get=null,this._q=null},Fn.add=function(e){this._add.push(e)},Fn.rem=function(e){this._rem.push(e)},Fn.values=function(){if(this._get=null,this._rem.length===0)return this._add;const e=this._add,t=this._rem,i=this._key,o=e.length,a=t.length,l=Array(o-a),f={};let h,g,m;for(h=0;h<a;++h)f[i(t[h])]=1;for(h=0,g=0;h<o;++h)f[i(m=e[h])]?f[i(m)]=0:l[g++]=m;return this._rem=[],this._add=l},Fn.distinct=function(e){const t=this.values(),i={};let o=t.length,a=0,l;for(;--o>=0;)l=e(t[o])+"",(0,b.mQ)(i,l)||(i[l]=1,++a);return a},Fn.extent=function(e){if(this._get!==e||!this._ext){const t=this.values(),i=(0,b.n)(t,e);this._ext=[t[i[0]],t[i[1]]],this._get=e}return this._ext},Fn.argmin=function(e){return this.extent(e)[0]||{}},Fn.argmax=function(e){return this.extent(e)[1]||{}},Fn.min=function(e){const t=this.extent(e)[0];return t!=null?e(t):void 0},Fn.max=function(e){const t=this.extent(e)[1];return t!=null?e(t):void 0},Fn.quartile=function(e){return(this._get!==e||!this._q)&&(this._q=_1(this.values(),e),this._get=e),this._q},Fn.q1=function(e){return this.quartile(e)[0]},Fn.q2=function(e){return this.quartile(e)[1]},Fn.q3=function(e){return this.quartile(e)[2]},Fn.ci=function(e){return(this._get!==e||!this._ci)&&(this._ci=vA(this.values(),1e3,.05,e),this._get=e),this._ci},Fn.ci0=function(e){return this.ci(e)[0]},Fn.ci1=function(e){return this.ci(e)[1]};function po(e){q.call(this,null,e),this._adds=[],this._mods=[],this._alen=0,this._mlen=0,this._drop=!0,this._cross=!1,this._dims=[],this._dnames=[],this._measures=[],this._countOnly=!1,this._counts=null,this._prev=null,this._inputs=null,this._outputs=null}po.Definition={type:"Aggregate",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:Ha},{name:"aggregate_params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"drop",type:"boolean",default:!0},{name:"cross",type:"boolean",default:!1},{name:"key",type:"field"}]},(0,b.B)(po,q,{transform(e,t){const i=this,o=t.fork(t.NO_SOURCE|t.NO_FIELDS),a=e.modified();return i.stamp=o.stamp,i.value&&(a||t.modified(i._inputs,!0))?(i._prev=i.value,i.value=a?i.init(e):Object.create(null),t.visit(t.SOURCE,l=>i.add(l))):(i.value=i.value||i.init(e),t.visit(t.REM,l=>i.rem(l)),t.visit(t.ADD,l=>i.add(l))),o.modifies(i._outputs),i._drop=e.drop!==!1,e.cross&&i._dims.length>1&&(i._drop=!1,i.cross()),t.clean()&&i._drop&&o.clean(!0).runAfter(()=>this.clean()),i.changes(o)},cross(){const e=this,t=e.value,i=e._dnames,o=i.map(()=>({})),a=i.length;function l(h){let g,m,v,x;for(g in h)for(v=h[g].tuple,m=0;m<a;++m)o[m][x=v[i[m]]]=x}l(e._prev),l(t);function f(h,g,m){const v=i[m],x=o[m++];for(const C in x){const w=h?h+"|"+C:C;g[v]=x[C],m<a?f(w,g,m):t[w]||e.cell(w,g)}}f("",{},0)},init(e){const t=this._inputs=[],i=this._outputs=[],o={};function a(R){const I=(0,b.YO)((0,b.nS)(R)),V=I.length;let W=0,ee;for(;W<V;++W)o[ee=I[W]]||(o[ee]=1,t.push(ee))}this._dims=(0,b.YO)(e.groupby),this._dnames=this._dims.map(R=>{const I=(0,b.N6)(R);return a(R),i.push(I),I}),this.cellkey=e.key?e.key:ho(this._dims),this._countOnly=!0,this._counts=[],this._measures=[];const l=e.fields||[null],f=e.ops||["count"],h=e.aggregate_params||[null],g=e.as||[],m=l.length,v={};let x,C,w,S,D,k,O;for(m!==f.length&&(0,b.z3)("Unmatched number of fields and aggregate ops."),O=0;O<m;++O){if(x=l[O],C=f[O],w=h[O]||null,x==null&&C!=="count"&&(0,b.z3)("Null aggregate field specified."),D=(0,b.N6)(x),k=sl(C,D,g[O]),i.push(k),C==="count"){this._counts.push(k);continue}S=v[D],S||(a(x),S=v[D]=[],S.field=x,this._measures.push(S)),C!=="count"&&(this._countOnly=!1),S.push(xe(C,w,k))}return this._measures=this._measures.map(R=>V1(R,R.field)),Object.create(null)},cellkey:ho(),cell(e,t){let i=this.value[e];return i?i.num===0&&this._drop&&i.stamp<this.stamp?(i.stamp=this.stamp,this._adds[this._alen++]=i):i.stamp<this.stamp&&(i.stamp=this.stamp,this._mods[this._mlen++]=i):(i=this.value[e]=this.newcell(e,t),this._adds[this._alen++]=i),i},newcell(e,t){const i={key:e,num:0,agg:null,tuple:this.newtuple(t,this._prev&&this._prev[e]),stamp:this.stamp,store:!1};if(!this._countOnly){const o=this._measures,a=o.length;i.agg=Array(a);for(let l=0;l<a;++l)i.agg[l]=new o[l](i)}return i.store&&(i.data=new ul),i},newtuple(e,t){const i=this._dnames,o=this._dims,a=o.length,l={};for(let f=0;f<a;++f)l[i[f]]=o[f](e);return t?Br(t.tuple,l):Se(l)},clean(){const e=this.value;for(const t in e)e[t].num===0&&delete e[t]},add(e){const t=this.cellkey(e),i=this.cell(t,e);if(i.num+=1,this._countOnly)return;i.store&&i.data.add(e);const o=i.agg;for(let a=0,l=o.length;a<l;++a)o[a].add(o[a].get(e),e)},rem(e){const t=this.cellkey(e),i=this.cell(t,e);if(i.num-=1,this._countOnly)return;i.store&&i.data.rem(e);const o=i.agg;for(let a=0,l=o.length;a<l;++a)o[a].rem(o[a].get(e),e)},celltuple(e){const t=e.tuple,i=this._counts;e.store&&e.data.values();for(let o=0,a=i.length;o<a;++o)t[i[o]]=e.num;if(!this._countOnly){const o=e.agg;for(let a=0,l=o.length;a<l;++a)o[a].set(t)}return t},changes(e){const t=this._adds,i=this._mods,o=this._prev,a=this._drop,l=e.add,f=e.rem,h=e.mod;let g,m,v,x;if(o)for(m in o)g=o[m],(!a||g.num)&&f.push(g.tuple);for(v=0,x=this._alen;v<x;++v)l.push(this.celltuple(t[v])),t[v]=null;for(v=0,x=this._mlen;v<x;++v)g=i[v],(g.num===0&&a?f:h).push(this.celltuple(g)),i[v]=null;return this._alen=this._mlen=0,this._prev=null,e}});const di=1e-14;function df(e){q.call(this,null,e)}df.Definition={type:"Bin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:!0,default:[5,2]},{name:"extent",type:"number",array:!0,length:2,required:!0},{name:"span",type:"number"},{name:"step",type:"number"},{name:"steps",type:"number",array:!0},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:!0},{name:"name",type:"string"},{name:"as",type:"string",array:!0,length:2,default:["bin0","bin1"]}]},(0,b.B)(df,q,{transform(e,t){const i=e.interval!==!1,o=this._bins(e),a=o.start,l=o.step,f=e.as||["bin0","bin1"],h=f[0],g=f[1];let m;return e.modified()?(t=t.reflow(!0),m=t.SOURCE):m=t.modified((0,b.nS)(e.field))?t.ADD_MOD:t.ADD,t.visit(m,i?v=>{const x=o(v);v[h]=x,v[g]=x==null?null:a+l*(1+(x-a)/l)}:v=>v[h]=o(v)),t.modifies(i?f:h)},_bins(e){if(this.value&&!e.modified())return this.value;const t=e.field,i=yA(e),o=i.step;let a=i.start,l=a+Math.ceil((i.stop-a)/o)*o,f,h;(f=e.anchor)!=null&&(h=f-(a+o*Math.floor((f-a)/o)),a+=h,l+=h);const g=function(m){let v=(0,b.Ro)(t(m));return v==null?null:v<a?-1/0:v>l?1/0:(v=Math.max(a,Math.min(v,l-o)),a+o*Math.floor(di+(v-a)/o))};return g.start=a,g.stop=i.stop,g.step=o,this.value=(0,b.sY)(g,(0,b.nS)(t),e.name||"bin_"+(0,b.N6)(t))}});function Et(e,t,i){const o=e;let a=t||[],l=i||[],f={},h=0;return{add:g=>l.push(g),remove:g=>f[o(g)]=++h,size:()=>a.length,data:(g,m)=>(h&&(a=a.filter(v=>!f[o(v)]),f={},h=0),m&&g&&a.sort(g),l.length&&(a=g?(0,b.h1)(g,a,l.sort(g)):a.concat(l),l=[]),a)}}function Eg(e){q.call(this,[],e)}Eg.Definition={type:"Collect",metadata:{source:!0},params:[{name:"sort",type:"compare"}]},(0,b.B)(Eg,q,{transform(e,t){const i=t.fork(t.ALL),o=Et(we,this.value,i.materialize(i.ADD).add),a=e.sort,l=t.changed()||a&&(e.modified("sort")||t.modified(a.fields));return i.visit(i.REM,o.remove),this.modified(l),this.value=i.source=o.data(Lr(a),l),t.source&&t.source.root&&(this.value.root=t.source.root),i}});function Ag(e){Ke.call(this,null,cr,e)}(0,b.B)(Ag,Ke);function cr(e){return this.value&&!e.modified()?this.value:(0,b.UD)(e.fields,e.orders)}function Cg(e){q.call(this,null,e)}Cg.Definition={type:"CountPattern",metadata:{generates:!0,changes:!0},params:[{name:"field",type:"field",required:!0},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:!0,length:2,default:["text","count"]}]};function H1(e,t,i){switch(t){case"upper":e=e.toUpperCase();break;case"lower":e=e.toLowerCase();break}return e.match(i)}(0,b.B)(Cg,q,{transform(e,t){const i=x=>C=>{for(var w=H1(h(C),e.case,l)||[],S,D=0,k=w.length;D<k;++D)f.test(S=w[D])||x(S)},o=this._parameterCheck(e,t),a=this._counts,l=this._match,f=this._stop,h=e.field,g=e.as||["text","count"],m=i(x=>a[x]=1+(a[x]||0)),v=i(x=>a[x]-=1);return o?t.visit(t.SOURCE,m):(t.visit(t.ADD,m),t.visit(t.REM,v)),this._finish(t,g)},_parameterCheck(e,t){let i=!1;return(e.modified("stopwords")||!this._stop)&&(this._stop=new RegExp("^"+(e.stopwords||"")+"$","i"),i=!0),(e.modified("pattern")||!this._match)&&(this._match=new RegExp(e.pattern||"[\\w']+","g"),i=!0),(e.modified("field")||t.modified(e.field.fields))&&(i=!0),i&&(this._counts={}),i},_finish(e,t){const i=this._counts,o=this._tuples||(this._tuples={}),a=t[0],l=t[1],f=e.fork(e.NO_SOURCE|e.NO_FIELDS);let h,g,m;for(h in i)g=o[h],m=i[h]||0,!g&&m?(o[h]=g=Se({}),g[a]=h,g[l]=m,f.add.push(g)):m===0?(g&&f.rem.push(g),i[h]=null,o[h]=null):g[l]!==m&&(g[l]=m,f.mod.push(g));return f.modifies(t)}});function ct(e){q.call(this,null,e)}ct.Definition={type:"Cross",metadata:{generates:!0},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:!0,length:2,default:["a","b"]}]},(0,b.B)(ct,q,{transform(e,t){const i=t.fork(t.NO_SOURCE),o=e.as||["a","b"],a=o[0],l=o[1],f=!this.value||t.changed(t.ADD_REM)||e.modified("as")||e.modified("filter");let h=this.value;return f?(h&&(i.rem=h),h=t.materialize(t.SOURCE).source,i.add=this.value=Pr(h,a,l,e.filter||b.vN)):i.mod=h,i.source=this.value,i.modifies(o)}});function Pr(e,t,i,o){for(var a=[],l={},f=e.length,h=0,g,m;h<f;++h)for(l[t]=m=e[h],g=0;g<f;++g)l[i]=e[g],o(l)&&(a.push(Se(l)),l={},l[t]=m);return a}const hf={kde:il,mixture:AA,normal:Ga,lognormal:of,uniform:CA},q1="distributions",Sg="function",X1="field";function Fg(e,t){const i=e[Sg];(0,b.mQ)(hf,i)||(0,b.z3)("Unknown distribution function: "+i);const o=hf[i]();for(const a in e)a===X1?o.data((e.from||t()).map(e[a])):a===q1?o[a](e[a].map(l=>Fg(l,t))):typeof o[a]===Sg&&o[a](e[a]);return o}function gf(e){q.call(this,null,e)}const pf=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"lognormal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:!0},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}],RA={key:{function:"mixture"},params:[{name:"distributions",type:"param",array:!0,params:pf},{name:"weights",type:"number",array:!0}]};gf.Definition={type:"Density",metadata:{generates:!0},params:[{name:"extent",type:"number",array:!0,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:pf.concat(RA)},{name:"as",type:"string",array:!0,default:["value","density"]}]},(0,b.B)(gf,q,{transform(e,t){const i=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const o=Fg(e.distribution,Y1(t)),a=e.steps||e.minsteps||25,l=e.steps||e.maxsteps||200;let f=e.method||"pdf";f!=="pdf"&&f!=="cdf"&&(0,b.z3)("Invalid density method: "+f),!e.extent&&!o.data&&(0,b.z3)("Missing density extent parameter."),f=o[f];const h=e.as||["value","density"],g=e.extent||(0,b.Xx)(o.data()),m=lf(f,g,a,l).map(v=>{const x={};return x[h[0]]=v[0],x[h[1]]=v[1],Se(x)});this.value&&(i.rem=this.value),this.value=i.add=i.source=m}return i}});function Y1(e){return()=>e.materialize(e.SOURCE).source}function wg(e,t){return e?e.map((i,o)=>t[o]||(0,b.N6)(i)):null}function mf(e,t,i){const o=[],a=x=>x(g);let l,f,h,g,m,v;if(t==null)o.push(e.map(i));else for(l={},f=0,h=e.length;f<h;++f)g=e[f],m=t.map(a),v=l[m],v||(l[m]=v=[],v.dims=m,o.push(v)),v.push(i(g));return o}const yf="bin";function vf(e){q.call(this,null,e)}vf.Definition={type:"DotBin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"step",type:"number"},{name:"smooth",type:"boolean",default:!1},{name:"as",type:"string",default:yf}]};const NA=(e,t)=>(0,b.Ln)((0,b.Xx)(e,t))/30;(0,b.B)(vf,q,{transform(e,t){if(this.value&&!(e.modified()||t.changed()))return t;const i=t.materialize(t.SOURCE).source,o=mf(t.source,e.groupby,b.D_),a=e.smooth||!1,l=e.field,f=e.step||NA(i,l),h=Lr((S,D)=>l(S)-l(D)),g=e.as||yf,m=o.length;let v=1/0,x=-1/0,C=0,w;for(;C<m;++C){const S=o[C].sort(h);w=-1;for(const D of bA(S,f,a,l))D<v&&(v=D),D>x&&(x=D),S[++w][g]=D}return this.value={start:v,stop:x,step:f},t.reflow(!0).modifies(g)}});function K1(e){Ke.call(this,null,Q1,e),this.modified(!0)}(0,b.B)(K1,Ke);function Q1(e){const t=e.expr;return this.value&&!e.modified("expr")?this.value:(0,b.sY)(i=>t(i,e),(0,b.nS)(t),(0,b.N6)(t))}function Dg(e){q.call(this,[void 0,void 0],e)}Dg.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:!0}]},(0,b.B)(Dg,q,{transform(e,t){const i=this.value,o=e.field,a=t.changed()||t.modified(o.fields)||e.modified("field");let l=i[0],f=i[1];if((a||l==null)&&(l=1/0,f=-1/0),t.visit(a?t.SOURCE:t.ADD,h=>{const g=(0,b.Ro)(o(h));g!=null&&(g<l&&(l=g),g>f&&(f=g))}),!Number.isFinite(l)||!Number.isFinite(f)){let h=(0,b.N6)(o);h&&(h=` for field "${h}"`),t.dataflow.warn(`Infinite extent${h}: [${l}, ${f}]`),l=f=void 0}this.value=[l,f]}});function kg(e,t){Ke.call(this,e),this.parent=t,this.count=0}(0,b.B)(kg,Ke,{connect(e){return this.detachSubflow=e.detachSubflow,this.targets().add(e),e.source=this},add(e){this.count+=1,this.value.add.push(e)},rem(e){this.count-=1,this.value.rem.push(e)},mod(e){this.value.mod.push(e)},init(e){this.value.init(e,e.NO_SOURCE)},evaluate(){return this.value}});function bf(e){q.call(this,{},e),this._keys=(0,b.nG)();const t=this._targets=[];t.active=0,t.forEach=i=>{for(let o=0,a=t.active;o<a;++o)i(t[o],o,t)}}(0,b.B)(bf,q,{activate(e){this._targets[this._targets.active++]=e},subflow(e,t,i,o){const a=this.value;let l=(0,b.mQ)(a,e)&&a[e],f,h;return l?l.value.stamp<i.stamp&&(l.init(i),this.activate(l)):(h=o||(h=this._group[e])&&h.tuple,f=i.dataflow,l=new kg(i.fork(i.NO_SOURCE),this),f.add(l).connect(t(f,e,h)),a[e]=l,this.activate(l)),l},clean(){const e=this.value;let t=0;for(const i in e)if(e[i].count===0){const o=e[i].detachSubflow;o&&o(),delete e[i],++t}if(t){const i=this._targets.filter(o=>o&&o.count>0);this.initTargets(i)}},initTargets(e){const t=this._targets,i=t.length,o=e?e.length:0;let a=0;for(;a<o;++a)t[a]=e[a];for(;a<i&&t[a]!=null;++a)t[a]=null;t.active=o},transform(e,t){const i=t.dataflow,o=e.key,a=e.subflow,l=this._keys,f=e.modified("key"),h=g=>this.subflow(g,a,t);return this._group=e.group||{},this.initTargets(),t.visit(t.REM,g=>{const m=we(g),v=l.get(m);v!==void 0&&(l.delete(m),h(v).rem(g))}),t.visit(t.ADD,g=>{const m=o(g);l.set(we(g),m),h(m).add(g)}),f||t.modified(o.fields)?t.visit(t.MOD,g=>{const m=we(g),v=l.get(m),x=o(g);v===x?h(x).mod(g):(l.set(m,x),h(v).rem(g),h(x).add(g))}):t.changed(t.MOD)&&t.visit(t.MOD,g=>{h(l.get(we(g))).mod(g)}),f&&t.visit(t.REFLOW,g=>{const m=we(g),v=l.get(m),x=o(g);v!==x&&(l.set(m,x),h(v).rem(g),h(x).add(g))}),t.clean()?i.runAfter(()=>{this.clean(),l.clean()}):l.empty>i.cleanThreshold&&i.runAfter(l.clean),t}});function Z1(e){Ke.call(this,null,_A,e)}(0,b.B)(Z1,Ke);function _A(e){return this.value&&!e.modified()?this.value:(0,b.cy)(e.name)?(0,b.YO)(e.name).map(t=>(0,b.ZZ)(t)):(0,b.ZZ)(e.name,e.as)}function $g(e){q.call(this,(0,b.nG)(),e)}$g.Definition={type:"Filter",metadata:{changes:!0},params:[{name:"expr",type:"expr",required:!0}]},(0,b.B)($g,q,{transform(e,t){const i=t.dataflow,o=this.value,a=t.fork(),l=a.add,f=a.rem,h=a.mod,g=e.expr;let m=!0;t.visit(t.REM,x=>{const C=we(x);o.has(C)?o.delete(C):f.push(x)}),t.visit(t.ADD,x=>{g(x,e)?l.push(x):o.set(we(x),1)});function v(x){const C=we(x),w=g(x,e),S=o.get(C);w&&S?(o.delete(C),l.push(x)):!w&&!S?(o.set(C,1),f.push(x)):m&&w&&!S&&h.push(x)}return t.visit(t.MOD,v),e.modified()&&(m=!1,t.visit(t.REFLOW,v)),o.empty>i.cleanThreshold&&i.runAfter(o.clean),a}});function Og(e){q.call(this,[],e)}Og.Definition={type:"Flatten",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"index",type:"string"},{name:"as",type:"string",array:!0}]},(0,b.B)(Og,q,{transform(e,t){const i=t.fork(t.NO_SOURCE),o=e.fields,a=wg(o,e.as||[]),l=e.index||null,f=a.length;return i.rem=this.value,t.visit(t.SOURCE,h=>{const g=o.map(S=>S(h)),m=g.reduce((S,D)=>Math.max(S,D.length),0);let v=0,x,C,w;for(;v<m;++v){for(C=ie(h),x=0;x<f;++x)C[a[x]]=(w=g[x][v])==null?null:w;l&&(C[l]=v),i.add.push(C)}}),this.value=i.source=i.add,l&&i.modifies(l),i.modifies(a)}});function Tg(e){q.call(this,[],e)}Tg.Definition={type:"Fold",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0,length:2,default:["key","value"]}]},(0,b.B)(Tg,q,{transform(e,t){const i=t.fork(t.NO_SOURCE),o=e.fields,a=o.map(b.N6),l=e.as||["key","value"],f=l[0],h=l[1],g=o.length;return i.rem=this.value,t.visit(t.SOURCE,m=>{for(let v=0,x;v<g;++v)x=ie(m),x[f]=a[v],x[h]=o[v](m),i.add.push(x)}),this.value=i.source=i.add,i.modifies(l)}});function Rg(e){q.call(this,null,e)}Rg.Definition={type:"Formula",metadata:{modifies:!0},params:[{name:"expr",type:"expr",required:!0},{name:"as",type:"string",required:!0},{name:"initonly",type:"boolean"}]},(0,b.B)(Rg,q,{transform(e,t){const i=e.expr,o=e.as,a=e.modified(),l=e.initonly?t.ADD:a?t.SOURCE:t.modified(i.fields)||t.modified(o)?t.ADD_MOD:t.ADD;return a&&(t=t.materialize().reflow(!0)),e.initonly||t.modifies(o),t.visit(l,f=>f[o]=i(f,e))}});function Ng(e){q.call(this,[],e)}(0,b.B)(Ng,q,{transform(e,t){const i=t.fork(t.ALL),o=e.generator;let a=this.value,l=e.size-a.length,f,h,g;if(l>0){for(f=[];--l>=0;)f.push(g=Se(o(e))),a.push(g);i.add=i.add.length?i.materialize(i.ADD).add.concat(f):f}else h=a.slice(0,-l),i.rem=i.rem.length?i.materialize(i.REM).rem.concat(h):h,a=a.slice(-l);return i.source=this.value=a,i}});const xf={value:"value",median:pA.A,mean:DA.A,min:kA.A,max:Va.A},_g=[];function Mg(e){q.call(this,[],e)}Mg.Definition={type:"Impute",metadata:{changes:!0},params:[{name:"field",type:"field",required:!0},{name:"key",type:"field",required:!0},{name:"keyvals",array:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]};function MA(e){var t=e.method||xf.value,i;if(xf[t]==null)(0,b.z3)("Unrecognized imputation method: "+t);else return t===xf.value?(i=e.value!==void 0?e.value:0,()=>i):xf[t]}function BA(e){const t=e.field;return i=>i?t(i):NaN}(0,b.B)(Mg,q,{transform(e,t){var i=t.fork(t.ALL),o=MA(e),a=BA(e),l=(0,b.N6)(e.field),f=(0,b.N6)(e.key),h=(e.groupby||[]).map(b.N6),g=LA(t.source,e.groupby,e.key,e.keyvals),m=[],v=this.value,x=g.domain.length,C,w,S,D,k,O,R,I,V,W;for(k=0,I=g.length;k<I;++k)for(C=g[k],S=C.values,w=NaN,R=0;R<x;++R)if(C[R]==null){for(D=g.domain[R],W={_impute:!0},O=0,V=S.length;O<V;++O)W[h[O]]=S[O];W[f]=D,W[l]=Number.isNaN(w)?w=o(C,a):w,m.push(Se(W))}return m.length&&(i.add=i.materialize(i.ADD).add.concat(m)),v.length&&(i.rem=i.materialize(i.REM).rem.concat(v)),this.value=m,i}});function LA(e,t,i,o){var a=O=>O(k),l=[],f=o?o.slice():[],h={},g={},m,v,x,C,w,S,D,k;for(f.forEach((O,R)=>h[O]=R+1),C=0,D=e.length;C<D;++C)k=e[C],S=i(k),w=h[S]||(h[S]=f.push(S)),v=(m=t?t.map(a):_g)+"",(x=g[v])||(x=g[v]=[],l.push(x),x.values=m),x[w-1]=k;return l.domain=f,l}function Ef(e){po.call(this,e)}Ef.Definition={type:"JoinAggregate",metadata:{modifies:!0},params:[{name:"groupby",type:"field",array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"ops",type:"enum",array:!0,values:Ha},{name:"as",type:"string",null:!0,array:!0},{name:"key",type:"field"}]},(0,b.B)(Ef,po,{transform(e,t){const i=this,o=e.modified();let a;return i.value&&(o||t.modified(i._inputs,!0))?(a=i.value=o?i.init(e):{},t.visit(t.SOURCE,l=>i.add(l))):(a=i.value=i.value||this.init(e),t.visit(t.REM,l=>i.rem(l)),t.visit(t.ADD,l=>i.add(l))),i.changes(),t.visit(t.SOURCE,l=>{(0,b.X$)(l,a[i.cellkey(l)].tuple)}),t.reflow(o).modifies(this._outputs)},changes(){const e=this._adds,t=this._mods;let i,o;for(i=0,o=this._alen;i<o;++i)this.celltuple(e[i]),e[i]=null;for(i=0,o=this._mlen;i<o;++i)this.celltuple(t[i]),t[i]=null;this._alen=this._mlen=0}});function Bg(e){q.call(this,null,e)}Bg.Definition={type:"KDE",metadata:{generates:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"cumulative",type:"boolean",default:!1},{name:"counts",type:"boolean",default:!1},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:!0,length:2},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:!0,default:["value","density"]}]},(0,b.B)(Bg,q,{transform(e,t){const i=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const o=t.materialize(t.SOURCE).source,a=mf(o,e.groupby,e.field),l=(e.groupby||[]).map(b.N6),f=e.bandwidth,h=e.cumulative?"cdf":"pdf",g=e.as||["value","density"],m=[];let v=e.extent,x=e.steps||e.minsteps||25,C=e.steps||e.maxsteps||200;h!=="pdf"&&h!=="cdf"&&(0,b.z3)("Invalid density method: "+h),e.resolve==="shared"&&(v||(v=(0,b.Xx)(o,e.field)),x=C=e.steps||C),a.forEach(w=>{const S=il(w,f)[h],D=e.counts?w.length:1,k=v||(0,b.Xx)(w);lf(S,k,x,C).forEach(O=>{const R={};for(let I=0;I<l.length;++I)R[l[I]]=w.dims[I];R[g[0]]=O[0],R[g[1]]=O[1]*D,m.push(Se(R))})}),this.value&&(i.rem=this.value),this.value=i.add=i.source=m}return i}});function J1(e){Ke.call(this,null,zA,e)}(0,b.B)(J1,Ke);function zA(e){return this.value&&!e.modified()?this.value:(0,b.Eb)(e.fields,e.flat)}function Lg(e){q.call(this,[],e),this._pending=null}(0,b.B)(Lg,q,{transform(e,t){const i=t.dataflow;return this._pending?zg(this,t,this._pending):IA(e)?t.StopPropagation:e.values?zg(this,t,i.parse(e.values,e.format)):e.async?{async:i.request(e.url,e.format).then(a=>(this._pending=(0,b.YO)(a.data),l=>l.touch(this)))}:i.request(e.url,e.format).then(o=>zg(this,t,(0,b.YO)(o.data)))}});function IA(e){return e.modified("async")&&!(e.modified("values")||e.modified("url")||e.modified("format"))}function zg(e,t,i){i.forEach(Se);const o=t.fork(t.NO_FIELDS&t.NO_SOURCE);return o.rem=e.value,e.value=o.source=o.add=i,e._pending=null,o.rem.length&&o.clean(!0),o}function Ig(e){q.call(this,{},e)}Ig.Definition={type:"Lookup",metadata:{modifies:!0},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:!0},{name:"key",type:"field",required:!0}]},{name:"values",type:"field",array:!0},{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0},{name:"default",default:null}]},(0,b.B)(Ig,q,{transform(e,t){const i=e.fields,o=e.index,a=e.values,l=e.default==null?null:e.default,f=e.modified(),h=i.length;let g=f?t.SOURCE:t.ADD,m=t,v=e.as,x,C,w;return a?(C=a.length,h>1&&!v&&(0,b.z3)('Multi-field lookup requires explicit "as" parameter.'),v&&v.length!==h*C&&(0,b.z3)('The "as" parameter has too few output field names.'),v=v||a.map(b.N6),x=function(S){for(var D=0,k=0,O,R;D<h;++D)if(R=o.get(i[D](S)),R==null)for(O=0;O<C;++O,++k)S[v[k]]=l;else for(O=0;O<C;++O,++k)S[v[k]]=a[O](R)}):(v||(0,b.z3)("Missing output field names."),x=function(S){for(var D=0,k;D<h;++D)k=o.get(i[D](S)),S[v[D]]=k??l}),f?m=t.reflow(!0):(w=i.some(S=>t.modified(S.fields)),g|=w?t.MOD:0),t.visit(g,x),m.modifies(v)}});function ey(e){Ke.call(this,null,ty,e)}(0,b.B)(ey,Ke);function ty(e){if(this.value&&!e.modified())return this.value;const t=e.extents,i=t.length;let o=1/0,a=-1/0,l,f;for(l=0;l<i;++l)f=t[l],f[0]<o&&(o=f[0]),f[1]>a&&(a=f[1]);return[o,a]}function ny(e){Ke.call(this,null,PA,e)}(0,b.B)(ny,Ke);function PA(e){return this.value&&!e.modified()?this.value:e.values.reduce((t,i)=>t.concat(i),[])}function UA(e){q.call(this,null,e)}(0,b.B)(UA,q,{transform(e,t){return this.modified(e.modified()),this.value=e,t.fork(t.NO_SOURCE|t.NO_FIELDS)}});function Af(e){po.call(this,e)}Af.Definition={type:"Pivot",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"value",type:"field",required:!0},{name:"op",type:"enum",values:Ha,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]},(0,b.B)(Af,po,{_transform:po.prototype.transform,transform(e,t){return this._transform(jA(e,t),t)}});function jA(e,t){const i=e.field,o=e.value,a=(e.op==="count"?"__count__":e.op)||"sum",l=(0,b.nS)(i).concat((0,b.nS)(o)),f=GA(i,e.limit||0,t);return t.changed()&&e.set("__pivot__",null,null,!0),{key:e.key,groupby:e.groupby,ops:f.map(()=>a),fields:f.map(h=>Pg(h,i,o,l)),as:f.map(h=>h+""),modified:e.modified.bind(e)}}function Pg(e,t,i,o){return(0,b.sY)(a=>t(a)===e?i(a):NaN,o,e+"")}function GA(e,t,i){const o={},a=[];return i.visit(i.SOURCE,l=>{const f=e(l);o[f]||(o[f]=1,a.push(f))}),a.sort(b.V_),t?a.slice(0,t):a}function ll(e){bf.call(this,e)}(0,b.B)(ll,bf,{transform(e,t){const i=e.subflow,o=e.field,a=l=>this.subflow(we(l),i,t,l);return(e.modified("field")||o&&t.modified((0,b.nS)(o)))&&(0,b.z3)("PreFacet does not support field modification."),this.initTargets(),o?(t.visit(t.MOD,l=>{const f=a(l);o(l).forEach(h=>f.mod(h))}),t.visit(t.ADD,l=>{const f=a(l);o(l).forEach(h=>f.add(Se(h)))}),t.visit(t.REM,l=>{const f=a(l);o(l).forEach(h=>f.rem(h))})):(t.visit(t.MOD,l=>a(l).mod(l)),t.visit(t.ADD,l=>a(l).add(l)),t.visit(t.REM,l=>a(l).rem(l))),t.clean()&&t.runAfter(()=>this.clean()),t}});function iy(e){q.call(this,null,e)}iy.Definition={type:"Project",metadata:{generates:!0,changes:!0},params:[{name:"fields",type:"field",array:!0},{name:"as",type:"string",null:!0,array:!0}]},(0,b.B)(iy,q,{transform(e,t){const i=t.fork(t.NO_SOURCE),o=e.fields,a=wg(e.fields,e.as||[]),l=o?(h,g)=>WA(h,g,o,a):Oi;let f;return this.value?f=this.value:(t=t.addAll(),f=this.value={}),t.visit(t.REM,h=>{const g=we(h);i.rem.push(f[g]),f[g]=null}),t.visit(t.ADD,h=>{const g=l(h,Se({}));f[we(h)]=g,i.add.push(g)}),t.visit(t.MOD,h=>{i.mod.push(l(h,f[we(h)]))}),i}});function WA(e,t,i,o){for(let a=0,l=i.length;a<l;++a)t[o[a]]=i[a](e);return t}function ry(e){q.call(this,null,e)}(0,b.B)(ry,q,{transform(e,t){return this.value=e.value,e.modified("value")?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}});function Ug(e){q.call(this,null,e)}Ug.Definition={type:"Quantile",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"probs",type:"number",array:!0},{name:"step",type:"number",default:.01},{name:"as",type:"string",array:!0,default:["prob","value"]}]};const VA=1e-14;(0,b.B)(Ug,q,{transform(e,t){const i=t.fork(t.NO_SOURCE|t.NO_FIELDS),o=e.as||["prob","value"];if(this.value&&!e.modified()&&!t.changed())return i.source=this.value,i;const a=t.materialize(t.SOURCE).source,l=mf(a,e.groupby,e.field),f=(e.groupby||[]).map(b.N6),h=[],g=e.step||.01,m=e.probs||(0,nt.A)(g/2,1-VA,g),v=m.length;return l.forEach(x=>{const C=N1(x,m);for(let w=0;w<v;++w){const S={};for(let D=0;D<f.length;++D)S[f[D]]=x.dims[D];S[o[0]]=m[w],S[o[1]]=C[w],h.push(Se(S))}}),this.value&&(i.rem=this.value),this.value=i.add=i.source=h,i}});function Cf(e){q.call(this,null,e)}(0,b.B)(Cf,q,{transform(e,t){let i,o;return this.value?o=this.value:(i=t=t.addAll(),o=this.value={}),e.derive&&(i=t.fork(t.NO_SOURCE),t.visit(t.REM,a=>{const l=we(a);i.rem.push(o[l]),o[l]=null}),t.visit(t.ADD,a=>{const l=ie(a);o[we(a)]=l,i.add.push(l)}),t.visit(t.MOD,a=>{const l=o[we(a)];for(const f in a)l[f]=a[f],i.modifies(f);i.mod.push(l)})),i}});function jg(e){q.call(this,[],e),this.count=0}jg.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]},(0,b.B)(jg,q,{transform(e,t){const i=t.fork(t.NO_SOURCE),o=e.modified("size"),a=e.size,l=this.value.reduce((v,x)=>(v[we(x)]=1,v),{});let f=this.value,h=this.count,g=0;function m(v){let x,C;f.length<a?f.push(v):(C=~~((h+1)*ar()),C<f.length&&C>=g&&(x=f[C],l[we(x)]&&i.rem.push(x),f[C]=v)),++h}if(t.rem.length&&(t.visit(t.REM,v=>{const x=we(v);l[x]&&(l[x]=-1,i.rem.push(v)),--h}),f=f.filter(v=>l[we(v)]!==-1)),(t.rem.length||o)&&f.length<a&&t.source&&(g=h=f.length,t.visit(t.SOURCE,v=>{l[we(v)]||m(v)}),g=-1),o&&f.length>a){const v=f.length-a;for(let x=0;x<v;++x)l[we(f[x])]=-1,i.rem.push(f[x]);f=f.slice(v)}return t.mod.length&&t.visit(t.MOD,v=>{l[we(v)]&&i.mod.push(v)}),t.add.length&&t.visit(t.ADD,m),(t.add.length||g<0)&&(i.add=f.filter(v=>!l[we(v)])),this.count=h,this.value=i.source=f,i}});function Gg(e){q.call(this,null,e)}Gg.Definition={type:"Sequence",metadata:{generates:!0,changes:!0},params:[{name:"start",type:"number",required:!0},{name:"stop",type:"number",required:!0},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]},(0,b.B)(Gg,q,{transform(e,t){if(this.value&&!e.modified())return;const i=t.materialize().fork(t.MOD),o=e.as||"data";return i.rem=this.value?t.rem.concat(this.value):t.rem,this.value=(0,nt.A)(e.start,e.stop,e.step||1).map(a=>{const l={};return l[o]=a,Se(l)}),i.add=t.add.concat(this.value),i}});function oy(e){q.call(this,null,e),this.modified(!0)}(0,b.B)(oy,q,{transform(e,t){return this.value=t.source,t.changed()?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}});function sy(e){q.call(this,null,e)}const ay=["unit0","unit1"];sy.Definition={type:"TimeUnit",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"units",type:"enum",values:pe,array:!0},{name:"step",type:"number",default:1},{name:"maxbins",type:"number",default:40},{name:"extent",type:"date",array:!0},{name:"timezone",type:"enum",default:"local",values:["local","utc"]},{name:"as",type:"string",array:!0,length:2,default:ay}]},(0,b.B)(sy,q,{transform(e,t){const i=e.field,o=e.interval!==!1,a=e.timezone==="utc",l=this._floor(e,t),f=(a?Po:Nr)(l.unit).offset,h=e.as||ay,g=h[0],m=h[1],v=l.step;let x=l.start||1/0,C=l.stop||-1/0,w=t.ADD;return(e.modified()||t.changed(t.REM)||t.modified((0,b.nS)(i)))&&(t=t.reflow(!0),w=t.SOURCE,x=1/0,C=-1/0),t.visit(w,S=>{const D=i(S);let k,O;D==null?(S[g]=null,o&&(S[m]=null)):(S[g]=k=O=l(D),o&&(S[m]=O=f(k,v)),k<x&&(x=k),O>C&&(C=O))}),l.start=x,l.stop=C,t.modifies(o?h:g)},_floor(e,t){const i=e.timezone==="utc",{units:o,step:a}=e.units?{units:e.units,step:e.step||1}:de({extent:e.extent||(0,b.Xx)(t.materialize(t.SOURCE).source,e.field),maxbins:e.maxbins}),l=Ta(o),f=this.value||{},h=(i?Ts:qh)(l,a);return h.unit=(0,b.se)(l),h.units=l,h.step=a,h.start=f.start,h.stop=f.stop,this.value=h}});function uy(e){q.call(this,(0,b.nG)(),e)}(0,b.B)(uy,q,{transform(e,t){const i=t.dataflow,o=e.field,a=this.value,l=h=>a.set(o(h),h);let f=!0;return e.modified("field")||t.modified(o.fields)?(a.clear(),t.visit(t.SOURCE,l)):t.changed()?(t.visit(t.REM,h=>a.delete(o(h))),t.visit(t.ADD,l)):f=!1,this.modified(f),a.empty>i.cleanThreshold&&i.runAfter(a.clean),t.fork()}});function ly(e){q.call(this,null,e)}(0,b.B)(ly,q,{transform(e,t){(!this.value||e.modified("field")||e.modified("sort")||t.changed()||e.sort&&t.modified(e.sort.fields))&&(this.value=(e.sort?t.source.slice().sort(Lr(e.sort)):t.source).map(e.field))}});function HA(e,t,i,o){const a=cl[e](t,i);return{init:a.init||b.v_,update:function(l,f){f[o]=a.next(l)}}}const cl={row_number:function(){return{next:e=>e.index+1}},rank:function(){let e;return{init:()=>e=1,next:t=>{const i=t.index,o=t.data;return i&&t.compare(o[i-1],o[i])?e=i+1:e}}},dense_rank:function(){let e;return{init:()=>e=1,next:t=>{const i=t.index,o=t.data;return i&&t.compare(o[i-1],o[i])?++e:e}}},percent_rank:function(){const e=cl.rank(),t=e.next;return{init:e.init,next:i=>(t(i)-1)/(i.data.length-1)}},cume_dist:function(){let e;return{init:()=>e=0,next:t=>{const i=t.data,o=t.compare;let a=t.index;if(e<a){for(;a+1<i.length&&!o(i[a],i[a+1]);)++a;e=a}return(1+e)/i.length}}},ntile:function(e,t){t=+t,t>0||(0,b.z3)("ntile num must be greater than zero.");const i=cl.cume_dist(),o=i.next;return{init:i.init,next:a=>Math.ceil(t*o(a))}},lag:function(e,t){return t=+t||1,{next:i=>{const o=i.index-t;return o>=0?e(i.data[o]):null}}},lead:function(e,t){return t=+t||1,{next:i=>{const o=i.index+t,a=i.data;return o<a.length?e(a[o]):null}}},first_value:function(e){return{next:t=>e(t.data[t.i0])}},last_value:function(e){return{next:t=>e(t.data[t.i1-1])}},nth_value:function(e,t){return t=+t,t>0||(0,b.z3)("nth_value nth must be greater than zero."),{next:i=>{const o=i.i0+(t-1);return o<i.i1?e(i.data[o]):null}}},prev_value:function(e){let t;return{init:()=>t=null,next:i=>{const o=e(i.data[i.index]);return o!=null?t=o:t}}},next_value:function(e){let t,i;return{init:()=>(t=null,i=-1),next:o=>{const a=o.data;return o.index<=i?t:(i=qA(e,a,o.index))<0?(i=a.length,t=null):t=e(a[i])}}}};function qA(e,t,i){for(let o=t.length;i<o;++i)if(e(t[i])!=null)return i;return-1}const XA=Object.keys(cl);function cy(e){const t=(0,b.YO)(e.ops),i=(0,b.YO)(e.fields),o=(0,b.YO)(e.params),a=(0,b.YO)(e.aggregate_params),l=(0,b.YO)(e.as),f=this.outputs=[],h=this.windows=[],g={},m={},v=[],x=[];let C=!0;function w(S){(0,b.YO)((0,b.nS)(S)).forEach(D=>g[D]=1)}w(e.sort),t.forEach((S,D)=>{const k=i[D],O=o[D],R=a[D]||null,I=(0,b.N6)(k),V=sl(S,I,l[D]);if(w(k),f.push(V),(0,b.mQ)(cl,S))h.push(HA(S,k,O,V));else{if(k==null&&S!=="count"&&(0,b.z3)("Null aggregate field specified."),S==="count"){v.push(V);return}C=!1;let W=m[I];W||(W=m[I]=[],W.field=k,x.push(W)),W.push(xe(S,R,V))}}),(v.length||x.length)&&(this.cell=Uk(x,v,C)),this.inputs=Object.keys(g)}const Wg=cy.prototype;Wg.init=function(){this.windows.forEach(e=>e.init()),this.cell&&this.cell.init()},Wg.update=function(e,t){const i=this.cell,o=this.windows,a=e.data,l=o&&o.length;let f;if(i){for(f=e.p0;f<e.i0;++f)i.rem(a[f]);for(f=e.p1;f<e.i1;++f)i.add(a[f]);i.set(t)}for(f=0;f<l;++f)o[f].update(e,t)};function Uk(e,t,i){e=e.map(g=>V1(g,g.field));const o={num:0,agg:null,store:!1,count:t};if(!i)for(var a=e.length,l=o.agg=Array(a),f=0;f<a;++f)l[f]=new e[f](o);if(o.store)var h=o.data=new ul;return o.add=function(g){if(o.num+=1,!i){h&&h.add(g);for(let m=0;m<a;++m)l[m].add(l[m].get(g),g)}},o.rem=function(g){if(o.num-=1,!i){h&&h.rem(g);for(let m=0;m<a;++m)l[m].rem(l[m].get(g),g)}},o.set=function(g){let m,v;for(h&&h.values(),m=0,v=t.length;m<v;++m)g[t[m]]=o.num;if(!i)for(m=0,v=l.length;m<v;++m)l[m].set(g)},o.init=function(){o.num=0,h&&h.reset();for(let g=0;g<a;++g)l[g].init()},o}function Sf(e){q.call(this,{},e),this._mlen=0,this._mods=[]}Sf.Definition={type:"Window",metadata:{modifies:!0},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:XA.concat(Ha)},{name:"params",type:"number",null:!0,array:!0},{name:"aggregate_params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"frame",type:"number",null:!0,array:!0,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:!1}]},(0,b.B)(Sf,q,{transform(e,t){this.stamp=t.stamp;const i=e.modified(),o=Lr(e.sort),a=ho(e.groupby),l=h=>this.group(a(h));let f=this.state;(!f||i)&&(f=this.state=new cy(e)),i||t.modified(f.inputs)?(this.value={},t.visit(t.SOURCE,h=>l(h).add(h))):(t.visit(t.REM,h=>l(h).remove(h)),t.visit(t.ADD,h=>l(h).add(h)));for(let h=0,g=this._mlen;h<g;++h)YA(this._mods[h],f,o,e);return this._mlen=0,this._mods=[],t.reflow(i).modifies(f.outputs)},group(e){let t=this.value[e];return t||(t=this.value[e]=Et(we),t.stamp=-1),t.stamp<this.stamp&&(t.stamp=this.stamp,this._mods[this._mlen++]=t),t}});function YA(e,t,i,o){const a=o.sort,l=a&&!o.ignorePeers,f=o.frame||[null,0],h=e.data(i),g=h.length,m=l?(0,jt.A)(a):null,v={i0:0,i1:0,p0:0,p1:0,index:0,data:h,compare:a||(0,b.dY)(-1)};t.init();for(let x=0;x<g;++x)KA(v,f,x,g),l&&QA(v,m),t.update(v,h[x])}function KA(e,t,i,o){e.p0=e.i0,e.p1=e.i1,e.i0=t[0]==null?0:Math.max(0,i-Math.abs(t[0])),e.i1=t[1]==null?o:Math.min(o,i+Math.abs(t[1])+1),e.index=i}function QA(e,t){const i=e.i0,o=e.i1-1,a=e.compare,l=e.data,f=l.length-1;i>0&&!a(l[i],l[i-1])&&(e.i0=t.left(l,l[i])),o<f&&!a(l[o],l[o+1])&&(e.i1=t.right(l,l[o]))}var ZA=z(24574),fy=z(80718),JA=z(40370),eC=z(75398),tC=z(27138),jk=z(76094),nC=z(4130),iC=z(49230),rC=z(68062),Ff=z(66210),oC=z(40479),sC=z(33487),dy=z(8157),aC=z(61729),wf=z(74420),hy=z(2372),gy=z(98639),uC=z(84536),lC=z(3939),Ws=z(14804);function zn(e,t){if(typeof document<"u"&&document.createElement){const i=document.createElement("canvas");if(i&&i.getContext)return i.width=e,i.height=t,i}return null}const py=()=>typeof Image<"u"?Image:null;var ei=z(9400),cC=z(62703),Gk=z(53392),fC=z(7751),Vg=z(9427),Hg=z(91478),oe=z(59328),Wk=z(24962),qa=z(18606),fr=z(96222),my=z(13948),dC=z(98654),yy=z(20430),qg=z(98644),hC=z(40636),gC=z(32007),pC=z(24366),Xg=z(44698),Vs=z(1505),mC=z(81352),yC=z(53492),vy=z(71573),Yg=z(36486),vC=z(6659),Vk=z(45439),Hk=z(44530),qk=z(64257);function by(e,t,i){const o=e-t+i*2;return e?o>0?o:1:0}const Xk="identity",Mi="linear",Ur="log",Df="pow",Hs="sqrt",kf="symlog",qs="time",jr="utc",dr="sequential",Xs="diverging",Xa="quantile",fl="quantize",$f="threshold",qt="ordinal",Kg="point",Qg="band",Zg="bin-ordinal",en="continuous",Ya="discrete",dl="discretizing",ti="interpolating",hl="temporal";function Jg(e){return function(t){let i=t[0],o=t[1],a;return o<i&&(a=i,i=o,o=a),[e.invert(i),e.invert(o)]}}function ep(e){return function(t){const i=e.range();let o=t[0],a=t[1],l=-1,f,h,g,m;for(a<o&&(h=o,o=a,a=h),g=0,m=i.length;g<m;++g)i[g]>=o&&i[g]<=a&&(l<0&&(l=g),f=g);if(!(l<0))return o=e.invertExtent(i[l]),a=e.invertExtent(i[f]),[o[0]===void 0?o[1]:o[0],a[1]===void 0?a[0]:a[1]]}}function gl(){const e=(0,qg.A)().unknown(void 0),t=e.domain,i=e.range;let o=[0,1],a,l,f=!1,h=0,g=0,m=.5;delete e.unknown;function v(){const x=t().length,C=o[1]<o[0],w=o[1-C],S=by(x,h,g);let D=o[C-0];a=(w-D)/(S||1),f&&(a=Math.floor(a)),D+=(w-D-a*(x-h))*m,l=a*(1-h),f&&(D=Math.round(D),l=Math.round(l));const k=(0,nt.A)(x).map(O=>D+a*O);return i(C?k.reverse():k)}return e.domain=function(x){return arguments.length?(t(x),v()):t()},e.range=function(x){return arguments.length?(o=[+x[0],+x[1]],v()):o.slice()},e.rangeRound=function(x){return o=[+x[0],+x[1]],f=!0,v()},e.bandwidth=function(){return l},e.step=function(){return a},e.round=function(x){return arguments.length?(f=!!x,v()):f},e.padding=function(x){return arguments.length?(g=Math.max(0,Math.min(1,x)),h=g,v()):h},e.paddingInner=function(x){return arguments.length?(h=Math.max(0,Math.min(1,x)),v()):h},e.paddingOuter=function(x){return arguments.length?(g=Math.max(0,Math.min(1,x)),v()):g},e.align=function(x){return arguments.length?(m=Math.max(0,Math.min(1,x)),v()):m},e.invertRange=function(x){if(x[0]==null||x[1]==null)return;const C=o[1]<o[0],w=C?i().reverse():i(),S=w.length-1;let D=+x[0],k=+x[1],O,R,I;if(!(D!==D||k!==k)&&(k<D&&(I=D,D=k,k=I),!(k<w[0]||D>o[1-C])))return O=Math.max(0,(0,ei.Jj)(w,D)-1),R=D===k?O:(0,ei.Jj)(w,k)-1,D-w[O]>l+1e-10&&++O,C&&(I=O,O=S-R,R=S-I),O>R?void 0:t().slice(O,R+1)},e.invert=function(x){const C=e.invertRange([x,x]);return C&&C[0]},e.copy=function(){return gl().domain(t()).range(o).round(f).paddingInner(h).paddingOuter(g).align(m)},v()}function Of(e){const t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,e.copy=function(){return Of(t())},e}function tp(){return Of(gl().paddingInner(1))}var bC=Array.prototype.map;function xy(e){return bC.call(e,b.Ro)}const Gr=Array.prototype.slice;function Ey(){let e=[],t=[];function i(o){return o==null||o!==o?void 0:t[((0,ei.Ay)(e,o)-1)%t.length]}return i.domain=function(o){return arguments.length?(e=xy(o),i):e.slice()},i.range=function(o){return arguments.length?(t=Gr.call(o),i):t.slice()},i.tickFormat=function(o,a){return(0,hC.A)(e[0],(0,b.se)(e),o??10,a)},i.copy=function(){return Ey().domain(i.domain()).range(i.range())},i}const pl=new Map,ml=Symbol("vega_scale");function Ay(e){return e[ml]=!0,e}function Ys(e){return e&&e[ml]===!0}function Yk(e,t,i){const o=function(){const l=t();return l.invertRange||(l.invertRange=l.invert?Jg(l):l.invertExtent?ep(l):void 0),l.type=e,Ay(l)};return o.metadata=(0,b.M1)((0,b.YO)(i)),o}function it(e,t,i){return arguments.length>1?(pl.set(e,Yk(e,t,i)),this):np(e)?pl.get(e):void 0}it(Xk,cC.A),it(Mi,Gk.A,en),it(Ur,fC.A,[en,Ur]),it(Df,Vg.Ay,en),it(Hs,Vg.RZ,en),it(kf,Hg.A,en),it(qs,oe.A,[en,hl]),it(jr,Wk.A,[en,hl]),it(dr,qa.Ay,[en,ti]),it(`${dr}-${Mi}`,qa.Ay,[en,ti]),it(`${dr}-${Ur}`,qa.a6,[en,ti,Ur]),it(`${dr}-${Df}`,qa.iG,[en,ti]),it(`${dr}-${Hs}`,qa.ao,[en,ti]),it(`${dr}-${kf}`,qa.bZ,[en,ti]),it(`${Xs}-${Mi}`,fr.Ay,[en,ti]),it(`${Xs}-${Ur}`,fr.Ee,[en,ti,Ur]),it(`${Xs}-${Df}`,fr.Iu,[en,ti]),it(`${Xs}-${Hs}`,fr.QO,[en,ti]),it(`${Xs}-${kf}`,fr.fy,[en,ti]),it(Xa,my.A,[dl,Xa]),it(fl,dC.A,dl),it($f,yy.A,dl),it(Zg,Ey,[Ya,dl]),it(qt,qg.A,Ya),it(Qg,gl,Ya),it(Kg,tp,Ya);function np(e){return pl.has(e)}function hi(e,t){const i=pl.get(e);return i&&i.metadata[t]}function yl(e){return hi(e,en)}function hr(e){return hi(e,Ya)}function vl(e){return hi(e,dl)}function Ks(e){return hi(e,Ur)}function Kk(e){return hi(e,hl)}function Cy(e){return hi(e,ti)}function ln(e){return hi(e,Xa)}const Tf=["clamp","base","constant","exponent"];function xC(e,t){const i=t[0],o=(0,b.se)(t)-i;return function(a){return e(i+a*o)}}function Rf(e,t,i){return gC.A(Nf(t||"rgb",i),e)}function Sy(e,t){const i=new Array(t),o=t+1;for(let a=0;a<t;)i[a]=e(++a/o);return i}function EC(e){const t=e.type,i=e.copy();return i.type=t,i}function ip(e,t,i){const o=i-t;let a,l,f;return!o||!Number.isFinite(o)?(0,b.dY)(.5):(a=(l=e.type).indexOf("-"),l=a<0?l:l.slice(a+1),f=it(l)().domain([t,i]).range([0,1]),Tf.forEach(h=>e[h]?f[h](e[h]()):0),f)}function Nf(e,t){const i=pC[Fy(e)];return t!=null&&i&&i.gamma?i.gamma(t):i}function Fy(e){return"interpolate"+e.toLowerCase().split("-").map(t=>t[0].toUpperCase()+t.slice(1)).join("")}const wy={blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",cividis:"00205100235800265d002961012b65042e670831690d346b11366c16396d1c3c6e213f6e26426e2c456e31476e374a6e3c4d6e42506e47536d4c566d51586e555b6e5a5e6e5e616e62646f66676f6a6a706e6d717270717573727976737c79747f7c75827f758682768985778c8877908b78938e789691789a94789e9778a19b78a59e77a9a177aea575b2a874b6ab73bbaf71c0b26fc5b66dc9b96acebd68d3c065d8c462ddc85fe2cb5ce7cf58ebd355f0d652f3da4ff7de4cfae249fce647",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",turbo:"23171b32204a3e2a71453493493eae4b49c54a53d7485ee44569ee4074f53c7ff8378af93295f72e9ff42ba9ef28b3e926bce125c5d925cdcf27d5c629dcbc2de3b232e9a738ee9d3ff39347f68950f9805afc7765fd6e70fe667cfd5e88fc5795fb51a1f84badf545b9f140c5ec3cd0e637dae034e4d931ecd12ef4c92bfac029ffb626ffad24ffa223ff9821ff8d1fff821dff771cfd6c1af76118f05616e84b14df4111d5380fcb2f0dc0260ab61f07ac1805a313029b0f00950c00910b00",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},AC={accent:Xg.A,category10:Vs.A,category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",dark2:mC.A,observable10:yC.A,paired:vy.A,pastel1:Yg.A,pastel2:vC.A,set1:Vk.A,set2:Hk.A,set3:qk.A,tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5"};function Dy(e){if((0,b.cy)(e))return e;const t=e.length/6|0,i=new Array(t);for(let o=0;o<t;)i[o]="#"+e.slice(o*6,++o*6);return i}function CC(e,t){for(const i in e)gi(i,t(e[i]))}const tn={};CC(AC,Dy),CC(wy,e=>Rf(Dy(e)));function gi(e,t){return e=e&&e.toLowerCase(),arguments.length>1?(tn[e]=t,this):tn[e]}const pi="symbol",Ka="discrete",SC="gradient",FC=e=>(0,b.cy)(e)?e.map(t=>String(t)):String(e),ky=(e,t)=>e[1]-t[1],wC=(e,t)=>t[1]-e[1];function rp(e,t,i){let o;return(0,b.Et)(t)&&(e.bins&&(t=Math.max(t,e.bins.length)),i!=null&&(t=Math.min(t,Math.floor((0,b.Ln)(e.domain())/i||1)+1))),(0,b.Gv)(t)&&(o=t.step,t=t.interval),(0,b.Kg)(t)&&(t=e.type===qs?Nr(t):e.type==jr?Po(t):(0,b.z3)("Only time and utc scales accept interval strings."),o&&(t=t.every(o))),t}function op(e,t,i){let o=e.range(),a=o[0],l=(0,b.se)(o),f=ky;if(a>l&&(o=l,l=a,a=o,f=wC),a=Math.floor(a),l=Math.ceil(l),t=t.map(h=>[h,e(h)]).filter(h=>a<=h[1]&&h[1]<=l).sort(f).map(h=>h[0]),i>0&&t.length>1){const h=[t[0],(0,b.se)(t)];for(;t.length>i&&t.length>=3;)t=t.filter((g,m)=>!(m%2));t.length<3&&(t=h)}return t}function $y(e,t){return e.bins?op(e,e.bins,t):e.ticks?e.ticks(t):e.domain()}function DC(e,t,i,o,a,l){const f=t.type;let h=FC;if(f===qs||a===qs)h=e.timeFormat(o);else if(f===jr||a===jr)h=e.utcFormat(o);else if(Ks(f)){const g=e.formatFloat(o);if(l||t.bins)h=g;else{const m=kC(t,i,!1);h=v=>m(v)?g(v):""}}else if(t.tickFormat){const g=t.domain();h=e.formatSpan(g[0],g[g.length-1],i,o)}else o&&(h=e.format(o));return h}function kC(e,t,i){const o=$y(e,t),a=e.base(),l=Math.log(a),f=Math.max(1,a*t/o.length),h=g=>{let m=g/Math.pow(a,Math.round(Math.log(g)/l));return m*a<a-.5&&(m*=a),m<=f};return i?o.filter(h):h}const Oy={[Xa]:"quantiles",[fl]:"thresholds",[$f]:"domain"},$C={[Xa]:"quantiles",[fl]:"domain"};function OC(e,t){return e.bins?RC(e.bins):e.type===Ur?kC(e,t,!0):Oy[e.type]?TC(e[Oy[e.type]]()):$y(e,t)}function Qk(e,t,i){const o=t[$C[t.type]](),a=o.length;let l=a>1?o[1]-o[0]:o[0],f;for(f=1;f<a;++f)l=Math.min(l,o[f]-o[f-1]);return e.formatSpan(0,l,3*10,i)}function TC(e){const t=[-1/0].concat(e);return t.max=1/0,t}function RC(e){const t=e.slice(0,-1);return t.max=(0,b.se)(e),t}const sp=e=>Oy[e.type]||e.bins;function ap(e,t,i,o,a,l,f){const h=$C[t.type]&&l!==qs&&l!==jr?Qk(e,t,a):DC(e,t,i,a,l,f);return o===pi&&sp(t)?NC(h):o===Ka?_C(h):wn(h)}const NC=e=>(t,i,o)=>{const a=Ty(o[i+1],Ty(o.max,1/0)),l=up(t,e),f=up(a,e);return l&&f?l+" \u2013 "+f:f?"< "+f:"\u2265 "+l},Ty=(e,t)=>e??t,_C=e=>(t,i)=>i?e(t):null,wn=e=>t=>e(t),up=(e,t)=>Number.isFinite(e)?t(e):null;function _f(e){const t=e.domain(),i=t.length-1;let o=+t[0],a=+(0,b.se)(t),l=a-o;if(e.type===$f){const f=i?l/i:.1;o-=f,a+=f,l=a-o}return f=>(f-o)/l}function Mf(e,t,i,o){const a=o||t.type;return(0,b.Kg)(i)&&Kk(a)&&(i=i.replace(/%a/g,"%A").replace(/%b/g,"%B")),!i&&a===qs?e.timeFormat("%A, %d %B %Y, %X"):!i&&a===jr?e.utcFormat("%A, %d %B %Y, %X UTC"):ap(e,t,5,null,i,o,!0)}function Ry(e,t,i){i=i||{};const o=Math.max(3,i.maxlen||7),a=Mf(e,t,i.format,i.formatType);if(vl(t.type)){const l=OC(t).slice(1).map(a),f=l.length;return`${f} boundar${f===1?"y":"ies"}: ${l.join(", ")}`}else if(hr(t.type)){const l=t.domain(),f=l.length,h=f>o?l.slice(0,o-2).map(a).join(", ")+", ending with "+l.slice(-1).map(a):l.map(a).join(", ");return`${f} value${f===1?"":"s"}: ${h}`}else{const l=t.domain();return`values from ${a(l[0])} to ${a((0,b.se)(l))}`}}let bl=0;function Bf(){bl=0}const Lf="p_";function Qa(e){return e&&e.gradient}function lp(e,t,i){const o=e.gradient;let a=e.id,l=o==="radial"?Lf:"";return a||(a=e.id="gradient_"+bl++,o==="radial"?(e.x1=Bi(e.x1,.5),e.y1=Bi(e.y1,.5),e.r1=Bi(e.r1,0),e.x2=Bi(e.x2,.5),e.y2=Bi(e.y2,.5),e.r2=Bi(e.r2,.5),l=Lf):(e.x1=Bi(e.x1,0),e.y1=Bi(e.y1,0),e.x2=Bi(e.x2,1),e.y2=Bi(e.y2,0))),t[a]=e,"url("+(i||"")+"#"+l+a+")"}function Bi(e,t){return e??t}function Ny(e,t){var i=[],o;return o={gradient:"linear",x1:e?e[0]:0,y1:e?e[1]:0,x2:t?t[0]:1,y2:t?t[1]:0,stops:i,stop:function(a,l){return i.push({offset:a,color:l}),o}}}const zf={basis:{curve:ZA.Ay},"basis-closed":{curve:fy.A},"basis-open":{curve:JA.A},bundle:{curve:eC.A,tension:"beta",value:.85},cardinal:{curve:tC.Ay,tension:"tension",value:0},"cardinal-open":{curve:jk.A,tension:"tension",value:0},"cardinal-closed":{curve:nC.A,tension:"tension",value:0},"catmull-rom":{curve:iC.A,tension:"alpha",value:.5},"catmull-rom-closed":{curve:rC.A,tension:"alpha",value:.5},"catmull-rom-open":{curve:Ff.A,tension:"alpha",value:.5},linear:{curve:oC.A},"linear-closed":{curve:sC.A},monotone:{horizontal:dy.N,vertical:dy.G},natural:{curve:aC.A},step:{curve:wf.Ay},"step-after":{curve:wf.Ps},"step-before":{curve:wf.Ko}};function xl(e,t,i){var o=(0,b.mQ)(zf,e)&&zf[e],a=null;return o&&(a=o.curve||o[t||"vertical"],o.tension&&i!=null&&(a=a[o.tension](i))),a}const _y={m:2,l:2,h:1,v:1,z:0,c:6,s:4,q:4,t:2,a:7},Zk=/[mlhvzcsqta]([^mlhvzcsqta]+|$)/gi,Jk=/^[+-]?(([0-9]*\.[0-9]+)|([0-9]+\.)|([0-9]+))([eE][+-]?[0-9]+)?/,es=/^((\s+,?\s*)|(,\s*))/,El=/^[01]/;function Qs(e){const t=[];return(e.match(Zk)||[]).forEach(o=>{let a=o[0];const l=a.toLowerCase(),f=_y[l],h=gr(l,f,o.slice(1).trim()),g=h.length;if(g<f||g&&g%f!==0)throw Error("Invalid SVG path, incorrect parameter count");if(t.push([a,...h.slice(0,f)]),g!==f){l==="m"&&(a=a==="M"?"L":"l");for(let m=f;m<g;m+=f)t.push([a,...h.slice(m,m+f)])}}),t}function gr(e,t,i){const o=[];for(let a=0;t&&a<i.length;)for(let l=0;l<t;++l){const f=e==="a"&&(l===3||l===4)?El:Jk,h=i.slice(a).match(f);if(h===null)throw Error("Invalid SVG path, incorrect parameter type");a+=h[0].length,o.push(+h[0]);const g=i.slice(a).match(es);g!==null&&(a+=g[0].length)}return o}const Zs=Math.PI/180,MC=1e-14,Js=Math.PI/2,Wr=Math.PI*2,Al=Math.sqrt(3)/2;var If={},Cl={},My=[].join;function BC(e,t,i,o,a,l,f,h,g){const m=My.call(arguments);if(If[m])return If[m];const v=f*Zs,x=Math.sin(v),C=Math.cos(v);i=Math.abs(i),o=Math.abs(o);const w=C*(h-e)*.5+x*(g-t)*.5,S=C*(g-t)*.5-x*(h-e)*.5;let D=w*w/(i*i)+S*S/(o*o);D>1&&(D=Math.sqrt(D),i*=D,o*=D);const k=C/i,O=x/i,R=-x/o,I=C/o,V=k*h+O*g,W=R*h+I*g,ee=k*e+O*t,M=R*e+I*t;let ue=1/((ee-V)*(ee-V)+(M-W)*(M-W))-.25;ue<0&&(ue=0);let ge=Math.sqrt(ue);l==a&&(ge=-ge);const Le=.5*(V+ee)-ge*(M-W),Xe=.5*(W+M)+ge*(ee-V),_t=Math.atan2(W-Xe,V-Le);let Ye=Math.atan2(M-Xe,ee-Le)-_t;Ye<0&&l===1?Ye+=Wr:Ye>0&&l===0&&(Ye-=Wr);const et=Math.ceil(Math.abs(Ye/(Js+.001))),si=[];for(let Qi=0;Qi<et;++Qi){const Zi=_t+Qi*Ye/et,Wc=_t+(Qi+1)*Ye/et;si[Qi]=[Le,Xe,Zi,Wc,i,o,x,C]}return If[m]=si}function e3(e){const t=My.call(e);if(Cl[t])return Cl[t];var i=e[0],o=e[1],a=e[2],l=e[3],f=e[4],h=e[5],g=e[6],m=e[7];const v=m*f,x=-g*h,C=g*f,w=m*h,S=Math.cos(a),D=Math.sin(a),k=Math.cos(l),O=Math.sin(l),R=.5*(l-a),I=Math.sin(R*.5),V=8/3*I*I/Math.sin(R),W=i+S-V*D,ee=o+D+V*S,M=i+k,J=o+O,ue=M+V*O,ge=J-V*k;return Cl[t]=[v*W+x*ee,C*W+w*ee,v*ue+x*ge,C*ue+w*ge,v*M+x*J,C*M+w*J]}const mi=["l",0,0,0,0,0,0,0];function ea(e,t,i){const o=mi[0]=e[0];if(o==="a"||o==="A")mi[1]=t*e[1],mi[2]=i*e[2],mi[3]=e[3],mi[4]=e[4],mi[5]=e[5],mi[6]=t*e[6],mi[7]=i*e[7];else if(o==="h"||o==="H")mi[1]=t*e[1];else if(o==="v"||o==="V")mi[1]=i*e[1];else for(var a=1,l=e.length;a<l;++a)mi[a]=(a%2==1?t:i)*e[a];return mi}function Sl(e,t,i,o,a,l){var f,h=null,g=0,m=0,v=0,x=0,C,w,S,D,k=0,O=0;i==null&&(i=0),o==null&&(o=0),a==null&&(a=1),l==null&&(l=a),e.beginPath&&e.beginPath();for(var R=0,I=t.length;R<I;++R){switch(f=t[R],(a!==1||l!==1)&&(f=ea(f,a,l)),f[0]){case"l":g+=f[1],m+=f[2],e.lineTo(g+i,m+o);break;case"L":g=f[1],m=f[2],e.lineTo(g+i,m+o);break;case"h":g+=f[1],e.lineTo(g+i,m+o);break;case"H":g=f[1],e.lineTo(g+i,m+o);break;case"v":m+=f[1],e.lineTo(g+i,m+o);break;case"V":m=f[1],e.lineTo(g+i,m+o);break;case"m":g+=f[1],m+=f[2],k=g,O=m,e.moveTo(g+i,m+o);break;case"M":g=f[1],m=f[2],k=g,O=m,e.moveTo(g+i,m+o);break;case"c":C=g+f[5],w=m+f[6],v=g+f[3],x=m+f[4],e.bezierCurveTo(g+f[1]+i,m+f[2]+o,v+i,x+o,C+i,w+o),g=C,m=w;break;case"C":g=f[5],m=f[6],v=f[3],x=f[4],e.bezierCurveTo(f[1]+i,f[2]+o,v+i,x+o,g+i,m+o);break;case"s":C=g+f[3],w=m+f[4],v=2*g-v,x=2*m-x,e.bezierCurveTo(v+i,x+o,g+f[1]+i,m+f[2]+o,C+i,w+o),v=g+f[1],x=m+f[2],g=C,m=w;break;case"S":C=f[3],w=f[4],v=2*g-v,x=2*m-x,e.bezierCurveTo(v+i,x+o,f[1]+i,f[2]+o,C+i,w+o),g=C,m=w,v=f[1],x=f[2];break;case"q":C=g+f[3],w=m+f[4],v=g+f[1],x=m+f[2],e.quadraticCurveTo(v+i,x+o,C+i,w+o),g=C,m=w;break;case"Q":C=f[3],w=f[4],e.quadraticCurveTo(f[1]+i,f[2]+o,C+i,w+o),g=C,m=w,v=f[1],x=f[2];break;case"t":C=g+f[1],w=m+f[2],h[0].match(/[QqTt]/)===null?(v=g,x=m):h[0]==="t"?(v=2*g-S,x=2*m-D):h[0]==="q"&&(v=2*g-v,x=2*m-x),S=v,D=x,e.quadraticCurveTo(v+i,x+o,C+i,w+o),g=C,m=w,v=g+f[1],x=m+f[2];break;case"T":C=f[1],w=f[2],v=2*g-v,x=2*m-x,e.quadraticCurveTo(v+i,x+o,C+i,w+o),g=C,m=w;break;case"a":LC(e,g+i,m+o,[f[1],f[2],f[3],f[4],f[5],f[6]+g+i,f[7]+m+o]),g+=f[6],m+=f[7];break;case"A":LC(e,g+i,m+o,[f[1],f[2],f[3],f[4],f[5],f[6]+i,f[7]+o]),g=f[6],m=f[7];break;case"z":case"Z":g=k,m=O,e.closePath();break}h=f}}function LC(e,t,i,o){const a=BC(o[5],o[6],o[0],o[1],o[3],o[4],o[2],t,i);for(let l=0;l<a.length;++l){const f=e3(a[l]);e.bezierCurveTo(f[0],f[1],f[2],f[3],f[4],f[5])}}const Pf=.5773502691896257,By={circle:{draw:function(e,t){const i=Math.sqrt(t)/2;e.moveTo(i,0),e.arc(0,0,i,0,Wr)}},cross:{draw:function(e,t){var i=Math.sqrt(t)/2,o=i/2.5;e.moveTo(-i,-o),e.lineTo(-i,o),e.lineTo(-o,o),e.lineTo(-o,i),e.lineTo(o,i),e.lineTo(o,o),e.lineTo(i,o),e.lineTo(i,-o),e.lineTo(o,-o),e.lineTo(o,-i),e.lineTo(-o,-i),e.lineTo(-o,-o),e.closePath()}},diamond:{draw:function(e,t){const i=Math.sqrt(t)/2;e.moveTo(-i,0),e.lineTo(0,-i),e.lineTo(i,0),e.lineTo(0,i),e.closePath()}},square:{draw:function(e,t){var i=Math.sqrt(t),o=-i/2;e.rect(o,o,i,i)}},arrow:{draw:function(e,t){var i=Math.sqrt(t)/2,o=i/7,a=i/2.5,l=i/8;e.moveTo(-o,i),e.lineTo(o,i),e.lineTo(o,-l),e.lineTo(a,-l),e.lineTo(0,-i),e.lineTo(-a,-l),e.lineTo(-o,-l),e.closePath()}},wedge:{draw:function(e,t){var i=Math.sqrt(t)/2,o=Al*i,a=o-i*Pf,l=i/4;e.moveTo(0,-o-a),e.lineTo(-l,o-a),e.lineTo(l,o-a),e.closePath()}},triangle:{draw:function(e,t){var i=Math.sqrt(t)/2,o=Al*i,a=o-i*Pf;e.moveTo(0,-o-a),e.lineTo(-i,o-a),e.lineTo(i,o-a),e.closePath()}},"triangle-up":{draw:function(e,t){var i=Math.sqrt(t)/2,o=Al*i;e.moveTo(0,-o),e.lineTo(-i,o),e.lineTo(i,o),e.closePath()}},"triangle-down":{draw:function(e,t){var i=Math.sqrt(t)/2,o=Al*i;e.moveTo(0,o),e.lineTo(-i,-o),e.lineTo(i,-o),e.closePath()}},"triangle-right":{draw:function(e,t){var i=Math.sqrt(t)/2,o=Al*i;e.moveTo(o,0),e.lineTo(-o,-i),e.lineTo(-o,i),e.closePath()}},"triangle-left":{draw:function(e,t){var i=Math.sqrt(t)/2,o=Al*i;e.moveTo(-o,0),e.lineTo(o,-i),e.lineTo(o,i),e.closePath()}},stroke:{draw:function(e,t){const i=Math.sqrt(t)/2;e.moveTo(-i,0),e.lineTo(i,0)}}};function Ly(e){return(0,b.mQ)(By,e)?By[e]:zy(e)}var cp={};function zy(e){if(!(0,b.mQ)(cp,e)){const t=Qs(e);cp[e]={draw:function(i,o){Sl(i,t,0,0,Math.sqrt(o)/2)}}}return cp[e]}const Vr=.448084975506;function zC(e){return e.x}function Iy(e){return e.y}function Py(e){return e.width}function IC(e){return e.height}function pr(e){return typeof e=="function"?e:()=>+e}function Uf(e,t,i){return Math.max(t,Math.min(e,i))}function ts(){var e=zC,t=Iy,i=Py,o=IC,a=pr(0),l=a,f=a,h=a,g=null;function m(v,x,C){var w,S=x??+e.call(this,v),D=C??+t.call(this,v),k=+i.call(this,v),O=+o.call(this,v),R=Math.min(k,O)/2,I=Uf(+a.call(this,v),0,R),V=Uf(+l.call(this,v),0,R),W=Uf(+f.call(this,v),0,R),ee=Uf(+h.call(this,v),0,R);if(g||(g=w=(0,Ws.Ae)()),I<=0&&V<=0&&W<=0&&ee<=0)g.rect(S,D,k,O);else{var M=S+k,J=D+O;g.moveTo(S+I,D),g.lineTo(M-V,D),g.bezierCurveTo(M-Vr*V,D,M,D+Vr*V,M,D+V),g.lineTo(M,J-ee),g.bezierCurveTo(M,J-Vr*ee,M-Vr*ee,J,M-ee,J),g.lineTo(S+W,J),g.bezierCurveTo(S+Vr*W,J,S,J-Vr*W,S,J-W),g.lineTo(S,D+I),g.bezierCurveTo(S,D+Vr*I,S+Vr*I,D,S+I,D),g.closePath()}if(w)return g=null,w+""||null}return m.x=function(v){return arguments.length?(e=pr(v),m):e},m.y=function(v){return arguments.length?(t=pr(v),m):t},m.width=function(v){return arguments.length?(i=pr(v),m):i},m.height=function(v){return arguments.length?(o=pr(v),m):o},m.cornerRadius=function(v,x,C,w){return arguments.length?(a=pr(v),l=x!=null?pr(x):a,h=C!=null?pr(C):a,f=w!=null?pr(w):l,m):a},m.context=function(v){return arguments.length?(g=v??null,m):g},m}function Fl(){var e,t,i,o,a=null,l,f,h,g;function m(x,C,w){const S=w/2;if(l){var D=h-C,k=x-f;if(D||k){var O=Math.hypot(D,k),R=(D/=O)*g,I=(k/=O)*g,V=Math.atan2(k,D);a.moveTo(f-R,h-I),a.lineTo(x-D*S,C-k*S),a.arc(x,C,S,V-Math.PI,V),a.lineTo(f+R,h+I),a.arc(f,h,g,V,V+Math.PI)}else a.arc(x,C,S,0,Wr);a.closePath()}else l=1;f=x,h=C,g=S}function v(x){var C,w=x.length,S,D=!1,k;for(a==null&&(a=k=(0,Ws.Ae)()),C=0;C<=w;++C)!(C<w&&o(S=x[C],C,x))===D&&(D=!D)&&(l=0),D&&m(+e(S,C,x),+t(S,C,x),+i(S,C,x));if(k)return a=null,k+""||null}return v.x=function(x){return arguments.length?(e=x,v):e},v.y=function(x){return arguments.length?(t=x,v):t},v.size=function(x){return arguments.length?(i=x,v):i},v.defined=function(x){return arguments.length?(o=x,v):o},v.context=function(x){return arguments.length?(x==null?a=null:a=x,v):a},v}function wl(e,t){return e??t}const ta=e=>e.x||0,mo=e=>e.y||0,na=e=>e.width||0,Uy=e=>e.height||0,PC=e=>(e.x||0)+(e.width||0),fp=e=>(e.y||0)+(e.height||0),jy=e=>e.startAngle||0,mr=e=>e.endAngle||0,Gy=e=>e.padAngle||0,Wy=e=>e.innerRadius||0,dp=e=>e.outerRadius||0,UC=e=>e.cornerRadius||0,Vy=e=>wl(e.cornerRadiusTopLeft,e.cornerRadius)||0,Hy=e=>wl(e.cornerRadiusTopRight,e.cornerRadius)||0,Dl=e=>wl(e.cornerRadiusBottomRight,e.cornerRadius)||0,jC=e=>wl(e.cornerRadiusBottomLeft,e.cornerRadius)||0,jf=e=>wl(e.size,64),GC=e=>e.size||1,kl=e=>e.defined!==!1,WC=e=>Ly(e.shape||"circle"),yo=(0,hy.A)().startAngle(jy).endAngle(mr).padAngle(Gy).innerRadius(Wy).outerRadius(dp).cornerRadius(UC),qy=(0,gy.A)().x(ta).y1(mo).y0(fp).defined(kl),$l=(0,gy.A)().y(mo).x1(ta).x0(PC).defined(kl),hp=(0,uC.A)().x(ta).y(mo).defined(kl),Gf=ts().x(ta).y(mo).width(na).height(Uy).cornerRadius(Vy,Hy,Dl,jC),VC=(0,lC.Ay)().type(WC).size(jf),HC=Fl().x(ta).y(mo).defined(kl).size(GC);function Wf(e){return e.cornerRadius||e.cornerRadiusTopLeft||e.cornerRadiusTopRight||e.cornerRadiusBottomRight||e.cornerRadiusBottomLeft}function gp(e,t){return yo.context(e)(t)}function ns(e,t){const i=t[0],o=i.interpolate||"linear";return(i.orient==="horizontal"?$l:qy).curve(xl(o,i.orient,i.tension)).context(e)(t)}function Xy(e,t){const i=t[0],o=i.interpolate||"linear";return hp.curve(xl(o,i.orient,i.tension)).context(e)(t)}function ia(e,t,i,o){return Gf.context(e)(t,i,o)}function Yy(e,t){return(t.mark.shape||t.shape).context(e)(t)}function Ol(e,t){return VC.context(e)(t)}function Vf(e,t){return HC.context(e)(t)}var Za=1;function Ky(){Za=1}function ae(e,t,i){var o=t.clip,a=e._defs,l=t.clip_id||(t.clip_id="clip"+Za++),f=a.clipping[l]||(a.clipping[l]={id:l});return(0,b.Tn)(o)?f.path=o(null):Wf(i)?f.path=ia(null,i,0,0):(f.width=i.width||0,f.height=i.height||0),"url(#"+l+")"}function Dt(e){this.clear(),e&&this.union(e)}Dt.prototype={clone(){return new Dt(this)},clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},equals(e){return this.x1===e.x1&&this.y1===e.y1&&this.x2===e.x2&&this.y2===e.y2},set(e,t,i,o){return i<e?(this.x2=e,this.x1=i):(this.x1=e,this.x2=i),o<t?(this.y2=t,this.y1=o):(this.y1=t,this.y2=o),this},add(e,t){return e<this.x1&&(this.x1=e),t<this.y1&&(this.y1=t),e>this.x2&&(this.x2=e),t>this.y2&&(this.y2=t),this},expand(e){return this.x1-=e,this.y1-=e,this.x2+=e,this.y2+=e,this},round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},scale(e){return this.x1*=e,this.y1*=e,this.x2*=e,this.y2*=e,this},translate(e,t){return this.x1+=e,this.x2+=e,this.y1+=t,this.y2+=t,this},rotate(e,t,i){const o=this.rotatedPoints(e,t,i);return this.clear().add(o[0],o[1]).add(o[2],o[3]).add(o[4],o[5]).add(o[6],o[7])},rotatedPoints(e,t,i){var{x1:o,y1:a,x2:l,y2:f}=this,h=Math.cos(e),g=Math.sin(e),m=t-t*h+i*g,v=i-t*g-i*h;return[h*o-g*a+m,g*o+h*a+v,h*o-g*f+m,g*o+h*f+v,h*l-g*a+m,g*l+h*a+v,h*l-g*f+m,g*l+h*f+v]},union(e){return e.x1<this.x1&&(this.x1=e.x1),e.y1<this.y1&&(this.y1=e.y1),e.x2>this.x2&&(this.x2=e.x2),e.y2>this.y2&&(this.y2=e.y2),this},intersect(e){return e.x1>this.x1&&(this.x1=e.x1),e.y1>this.y1&&(this.y1=e.y1),e.x2<this.x2&&(this.x2=e.x2),e.y2<this.y2&&(this.y2=e.y2),this},encloses(e){return e&&this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1&&this.y2>=e.y2},alignsWith(e){return e&&(this.x1==e.x1||this.x2==e.x2||this.y1==e.y1||this.y2==e.y2)},intersects(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)},contains(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)},width(){return this.x2-this.x1},height(){return this.y2-this.y1}};function yi(e){this.mark=e,this.bounds=this.bounds||new Dt}function yr(e){yi.call(this,e),this.items=this.items||[]}(0,b.B)(yr,yi);class pp{constructor(t){this._pending=0,this._loader=t||Yu()}pending(){return this._pending}sanitizeURL(t){const i=this;return Tl(i),i._loader.sanitize(t,{context:"href"}).then(o=>(Me(i),o)).catch(()=>(Me(i),null))}loadImage(t){const i=this,o=py();return Tl(i),i._loader.sanitize(t,{context:"image"}).then(a=>{const l=a.href;if(!l||!o)throw{url:l};const f=new o,h=(0,b.mQ)(a,"crossOrigin")?a.crossOrigin:"anonymous";return h!=null&&(f.crossOrigin=h),f.onload=()=>Me(i),f.onerror=()=>Me(i),f.src=l,f}).catch(a=>(Me(i),{complete:!1,width:0,height:0,src:a&&a.url||""}))}ready(){const t=this;return new Promise(i=>{function o(a){t.pending()?setTimeout(()=>{o(!0)},10):i(a)}o(!1)})}}function Tl(e){e._pending+=1}function Me(e){e._pending-=1}function Mt(e,t,i){if(t.stroke&&t.opacity!==0&&t.strokeOpacity!==0){const o=t.strokeWidth!=null?+t.strokeWidth:1;e.expand(o+(i?vr(t,o):0))}return e}function vr(e,t){return e.strokeJoin&&e.strokeJoin!=="miter"?0:t}const ra=Wr-1e-8;let vo,Rl,Nl,oa,mp,le,Ja,yp;const is=(e,t)=>vo.add(e,t),Hf=(e,t)=>is(Rl=e,Nl=t),Qy=e=>is(e,vo.y1),vp=e=>is(vo.x1,e),rs=(e,t)=>mp*e+Ja*t,os=(e,t)=>le*e+yp*t,bp=(e,t)=>is(rs(e,t),os(e,t)),ss=(e,t)=>Hf(rs(e,t),os(e,t));function sa(e,t){return vo=e,t?(oa=t*Zs,mp=yp=Math.cos(oa),le=Math.sin(oa),Ja=-le):(mp=yp=1,oa=le=Ja=0),xp}const xp={beginPath(){},closePath(){},moveTo:ss,lineTo:ss,rect(e,t,i,o){oa?(bp(e+i,t),bp(e+i,t+o),bp(e,t+o),ss(e,t)):(is(e+i,t+o),Hf(e,t))},quadraticCurveTo(e,t,i,o){const a=rs(e,t),l=os(e,t),f=rs(i,o),h=os(i,o);_l(Rl,a,f,Qy),_l(Nl,l,h,vp),Hf(f,h)},bezierCurveTo(e,t,i,o,a,l){const f=rs(e,t),h=os(e,t),g=rs(i,o),m=os(i,o),v=rs(a,l),x=os(a,l);Zy(Rl,f,g,v,Qy),Zy(Nl,h,m,x,vp),Hf(v,x)},arc(e,t,i,o,a,l){if(o+=oa,a+=oa,Rl=i*Math.cos(a)+e,Nl=i*Math.sin(a)+t,Math.abs(a-o)>ra)is(e-i,t-i),is(e+i,t+i);else{const f=m=>is(i*Math.cos(m)+e,i*Math.sin(m)+t);let h,g;if(f(o),f(a),a!==o)if(o=o%Wr,o<0&&(o+=Wr),a=a%Wr,a<0&&(a+=Wr),a<o&&(l=!l,h=o,o=a,a=h),l)for(a-=Wr,h=o-o%Js,g=0;g<4&&h>a;++g,h-=Js)f(h);else for(h=o-o%Js+Js,g=0;g<4&&h<a;++g,h=h+Js)f(h)}}};function _l(e,t,i,o){const a=(e-t)/(e+i-2*t);0<a&&a<1&&o(e+(t-e)*a)}function Zy(e,t,i,o,a){const l=o-e+3*t-3*i,f=e+i-2*t,h=e-t;let g=0,m=0,v;Math.abs(l)>MC?(v=f*f+h*l,v>=0&&(v=Math.sqrt(v),g=(-f+v)/l,m=(-f-v)/l)):g=.5*h/f,0<g&&g<1&&a(Li(g,e,t,i,o)),0<m&&m<1&&a(Li(m,e,t,i,o))}function Li(e,t,i,o,a){const l=1-e,f=l*l,h=e*e;return f*l*t+3*f*e*i+3*l*h*o+h*e*a}var At=(At=zn(1,1))?At.getContext("2d"):null;const qf=new Dt;function eu(e){return function(t,i){if(!At)return!0;e(At,t),qf.clear().union(t.bounds).intersect(i).round();const{x1:o,y1:a,x2:l,y2:f}=qf;for(let h=a;h<=f;++h)for(let g=o;g<=l;++g)if(At.isPointInPath(g,h))return!0;return!1}}function Ep(e,t){return t.contains(e.x||0,e.y||0)}function Xf(e,t){const i=e.x||0,o=e.y||0,a=e.width||0,l=e.height||0;return t.intersects(qf.set(i,o,i+a,o+l))}function Ml(e,t){const i=e.x||0,o=e.y||0,a=e.x2!=null?e.x2:i,l=e.y2!=null?e.y2:o;return br(t,i,o,a,l)}function br(e,t,i,o,a){const{x1:l,y1:f,x2:h,y2:g}=e,m=o-t,v=a-i;let x=0,C=1,w,S,D,k;for(k=0;k<4;++k){if(k===0&&(w=-m,S=-(l-t)),k===1&&(w=m,S=h-t),k===2&&(w=-v,S=-(f-i)),k===3&&(w=v,S=g-i),Math.abs(w)<1e-10&&S<0)return!1;if(D=S/w,w<0){if(D>C)return!1;D>x&&(x=D)}else if(w>0){if(D<x)return!1;D<C&&(C=D)}}return!0}function tu(e,t){e.globalCompositeOperation=t.blend||"source-over"}function Dn(e,t){return e??t}function Jy(e,t){const i=t.length;for(let o=0;o<i;++o)e.addColorStop(t[o].offset,t[o].color);return e}function Yf(e,t,i){const o=i.width(),a=i.height();let l;if(t.gradient==="radial")l=e.createRadialGradient(i.x1+Dn(t.x1,.5)*o,i.y1+Dn(t.y1,.5)*a,Math.max(o,a)*Dn(t.r1,0),i.x1+Dn(t.x2,.5)*o,i.y1+Dn(t.y2,.5)*a,Math.max(o,a)*Dn(t.r2,.5));else{const f=Dn(t.x1,0),h=Dn(t.y1,0),g=Dn(t.x2,1),m=Dn(t.y2,0);if(f===g||h===m||o===a)l=e.createLinearGradient(i.x1+f*o,i.y1+h*a,i.x1+g*o,i.y1+m*a);else{const v=zn(Math.ceil(o),Math.ceil(a)),x=v.getContext("2d");return x.scale(o,a),x.fillStyle=Jy(x.createLinearGradient(f,h,g,m),t.stops),x.fillRect(0,0,o,a),e.createPattern(v,"no-repeat")}}return Jy(l,t.stops)}function Ap(e,t,i){return Qa(i)?Yf(e,i,t.bounds):i}function as(e,t,i){return i*=t.fillOpacity==null?1:t.fillOpacity,i>0?(e.globalAlpha=i,e.fillStyle=Ap(e,t,t.fill),!0):!1}var ev=[];function Hr(e,t,i){var o=(o=t.strokeWidth)!=null?o:1;return o<=0?!1:(i*=t.strokeOpacity==null?1:t.strokeOpacity,i>0?(e.globalAlpha=i,e.strokeStyle=Ap(e,t,t.stroke),e.lineWidth=o,e.lineCap=t.strokeCap||"butt",e.lineJoin=t.strokeJoin||"miter",e.miterLimit=t.strokeMiterLimit||10,e.setLineDash&&(e.setLineDash(t.strokeDash||ev),e.lineDashOffset=t.strokeDashOffset||0),!0):!1)}function tv(e,t){return e.zindex-t.zindex||e.index-t.index}function Cp(e){if(!e.zdirty)return e.zitems;var t=e.items,i=[],o,a,l;for(a=0,l=t.length;a<l;++a)o=t[a],o.index=a,o.zindex&&i.push(o);return e.zdirty=!1,e.zitems=i.sort(tv)}function zi(e,t){var i=e.items,o,a;if(!i||!i.length)return;const l=Cp(e);if(l&&l.length){for(o=0,a=i.length;o<a;++o)i[o].zindex||t(i[o]);i=l}for(o=0,a=i.length;o<a;++o)t(i[o])}function Bl(e,t){var i=e.items,o,a;if(!i||!i.length)return null;const l=Cp(e);for(l&&l.length&&(i=l),a=i.length;--a>=0;)if(o=t(i[a]))return o;if(i===l){for(i=e.items,a=i.length;--a>=0;)if(!i[a].zindex&&(o=t(i[a])))return o}return null}function Kf(e){return function(t,i,o){zi(i,a=>{(!o||o.intersects(a.bounds))&&qC(e,t,a,a)})}}function t3(e){return function(t,i,o){i.items.length&&(!o||o.intersects(i.bounds))&&qC(e,t,i.items[0],i.items)}}function qC(e,t,i,o){var a=i.opacity==null?1:i.opacity;a!==0&&(e(t,o)||(tu(t,i),i.fill&&as(t,i,a)&&t.fill(),i.stroke&&Hr(t,i,a)&&t.stroke()))}function Ll(e){return e=e||b.vN,function(t,i,o,a,l,f){return o*=t.pixelRatio,a*=t.pixelRatio,Bl(i,h=>{const g=h.bounds;if(!(g&&!g.contains(l,f)||!g)&&e(t,h,o,a,l,f))return h})}}function vi(e,t){return function(i,o,a,l){var f=Array.isArray(o)?o[0]:o,h=t??f.fill,g=f.stroke&&i.isPointInStroke,m,v;return g&&(m=f.strokeWidth,v=f.strokeCap,i.lineWidth=m??1,i.lineCap=v??"butt"),e(i,o)?!1:h&&i.isPointInPath(a,l)||g&&i.isPointInStroke(a,l)}}function nu(e){return Ll(vi(e))}function bi(e,t){return"translate("+e+","+t+")"}function Qf(e){return"rotate("+e+")"}function nv(e,t){return"scale("+e+","+t+")"}function Sp(e){return bi(e.x||0,e.y||0)}function iv(e){return bi(e.x||0,e.y||0)+(e.angle?" "+Qf(e.angle):"")}function XC(e){return bi(e.x||0,e.y||0)+(e.angle?" "+Qf(e.angle):"")+(e.scaleX||e.scaleY?" "+nv(e.scaleX||1,e.scaleY||1):"")}function Fp(e,t,i){function o(f,h){f("transform",iv(h)),f("d",t(null,h))}function a(f,h){return t(sa(f,h.angle),h),Mt(f,h).translate(h.x||0,h.y||0)}function l(f,h){var g=h.x||0,m=h.y||0,v=h.angle||0;f.translate(g,m),v&&f.rotate(v*=Zs),f.beginPath(),t(f,h),v&&f.rotate(-v),f.translate(-g,-m)}return{type:e,tag:"path",nested:!1,attr:o,bound:a,draw:Kf(l),pick:nu(l),isect:i||eu(l)}}var Zf=Fp("arc",gp);function YC(e,t){for(var i=e[0].orient==="horizontal"?t[1]:t[0],o=e[0].orient==="horizontal"?"y":"x",a=e.length,l=1/0,f,h;--a>=0;)e[a].defined!==!1&&(h=Math.abs(e[a][o]-i),h<l&&(l=h,f=e[a]));return f}function wp(e,t){for(var i=Math.pow(e[0].strokeWidth||1,2),o=e.length,a,l,f;--o>=0;)if(e[o].defined!==!1&&(a=e[o].x-t[0],l=e[o].y-t[1],f=a*a+l*l,f<i))return e[o];return null}function KC(e,t){for(var i=e.length,o,a,l;--i>=0;)if(e[i].defined!==!1&&(o=e[i].x-t[0],a=e[i].y-t[1],l=o*o+a*a,o=e[i].size||1,l<o*o))return e[i];return null}function Jf(e,t,i){function o(g,m){var v=m.mark.items;v.length&&g("d",t(null,v))}function a(g,m){var v=m.items;return v.length===0?g:(t(sa(g),v),Mt(g,v[0]))}function l(g,m){g.beginPath(),t(g,m)}const f=vi(l);function h(g,m,v,x,C,w){var S=m.items,D=m.bounds;return!S||!S.length||D&&!D.contains(C,w)?null:(v*=g.pixelRatio,x*=g.pixelRatio,f(g,S,v,x)?S[0]:null)}return{type:e,tag:"path",nested:!0,attr:o,bound:a,draw:t3(l),pick:h,isect:Ep,tip:i}}var QC=Jf("area",ns,YC);function Dp(e,t){var i=t.clip;e.save(),(0,b.Tn)(i)?(e.beginPath(),i(e),e.clip()):ed(e,t.group)}function ed(e,t){e.beginPath(),Wf(t)?ia(e,t,0,0):e.rect(0,0,t.width||0,t.height||0),e.clip()}function td(e){const t=Dn(e.strokeWidth,1);return e.strokeOffset!=null?e.strokeOffset:e.stroke&&t>.5&&t<1.5?.5-Math.abs(t-1):0}function rv(e,t){e("transform",Sp(t))}function kp(e,t){const i=td(t);e("d",ia(null,t,i,i))}function nd(e,t){e("class","background"),e("aria-hidden",!0),kp(e,t)}function ov(e,t){e("class","foreground"),e("aria-hidden",!0),t.strokeForeground?kp(e,t):e("d","")}function id(e,t,i){const o=t.clip?ae(i,t,t):null;e("clip-path",o)}function ZC(e,t){if(!t.clip&&t.items){const i=t.items,o=i.length;for(let a=0;a<o;++a)e.union(i[a].bounds)}return(t.clip||t.width||t.height)&&!t.noBound&&e.add(0,0).add(t.width||0,t.height||0),Mt(e,t),e.translate(t.x||0,t.y||0)}function zl(e,t,i,o){const a=td(t);e.beginPath(),ia(e,t,(i||0)+a,(o||0)+a)}const sv=vi(zl),av=vi(zl,!1),uv=vi(zl,!0);function JC(e,t,i,o){zi(t,a=>{const l=a.x||0,f=a.y||0,h=a.strokeForeground,g=a.opacity==null?1:a.opacity;(a.stroke||a.fill)&&g&&(zl(e,a,l,f),tu(e,a),a.fill&&as(e,a,g)&&e.fill(),a.stroke&&!h&&Hr(e,a,g)&&e.stroke()),e.save(),e.translate(l,f),a.clip&&ed(e,a),i&&i.translate(-l,-f),zi(a,m=>{(m.marktype==="group"||o==null||o.includes(m.marktype))&&this.draw(e,m,i,o)}),i&&i.translate(l,f),e.restore(),h&&a.stroke&&g&&(zl(e,a,l,f),tu(e,a),Hr(e,a,g)&&e.stroke())})}function $p(e,t,i,o,a,l){if(t.bounds&&!t.bounds.contains(a,l)||!t.items)return null;const f=i*e.pixelRatio,h=o*e.pixelRatio;return Bl(t,g=>{let m,v,x;const C=g.bounds;if(C&&!C.contains(a,l))return;v=g.x||0,x=g.y||0;const w=v+(g.width||0),S=x+(g.height||0),D=g.clip;if(D&&(a<v||a>w||l<x||l>S))return;if(e.save(),e.translate(v,x),v=a-v,x=l-x,D&&Wf(g)&&!uv(e,g,f,h))return e.restore(),null;const k=g.strokeForeground,O=t.interactive!==!1;return O&&k&&g.stroke&&av(e,g,f,h)?(e.restore(),g):(m=Bl(g,R=>eS(R,v,x)?this.pick(R,i,o,v,x):null),!m&&O&&(g.fill||!k&&g.stroke)&&sv(e,g,f,h)&&(m=g),e.restore(),m||null)})}function eS(e,t,i){return(e.interactive!==!1||e.marktype==="group")&&e.bounds&&e.bounds.contains(t,i)}var tS={type:"group",tag:"g",nested:!1,attr:rv,bound:ZC,draw:JC,pick:$p,isect:Xf,content:id,background:nd,foreground:ov},iu={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"};function Op(e,t){var i=e.image;return(!i||e.url&&e.url!==i.url)&&(i={complete:!1,width:0,height:0},t.loadImage(e.url).then(o=>{e.image=o,e.image.url=e.url})),i}function Tp(e,t){return e.width!=null?e.width:!t||!t.width?0:e.aspect!==!1&&e.height?e.height*t.width/t.height:t.width}function Rp(e,t){return e.height!=null?e.height:!t||!t.height?0:e.aspect!==!1&&e.width?e.width*t.height/t.width:t.height}function rd(e,t){return e==="center"?t/2:e==="right"?t:0}function Il(e,t){return e==="middle"?t/2:e==="bottom"?t:0}function nS(e,t,i){const o=Op(t,i),a=Tp(t,o),l=Rp(t,o),f=(t.x||0)-rd(t.align,a),h=(t.y||0)-Il(t.baseline,l),g=!o.src&&o.toDataURL?o.toDataURL():o.src||"";e("href",g,iu["xmlns:xlink"],"xlink:href"),e("transform",bi(f,h)),e("width",a),e("height",l),e("preserveAspectRatio",t.aspect===!1?"none":"xMidYMid")}function lv(e,t){const i=t.image,o=Tp(t,i),a=Rp(t,i),l=(t.x||0)-rd(t.align,o),f=(t.y||0)-Il(t.baseline,a);return e.set(l,f,l+o,f+a)}function Np(e,t,i){zi(t,o=>{if(i&&!i.intersects(o.bounds))return;const a=Op(o,this);let l=Tp(o,a),f=Rp(o,a);if(l===0||f===0)return;let h=(o.x||0)-rd(o.align,l),g=(o.y||0)-Il(o.baseline,f),m,v,x,C;o.aspect!==!1&&(v=a.width/a.height,x=o.width/o.height,v===v&&x===x&&v!==x&&(x<v?(C=l/v,g+=(f-C)/2,f=C):(C=f*v,h+=(l-C)/2,l=C))),(a.complete||a.toDataURL)&&(tu(e,o),e.globalAlpha=(m=o.opacity)!=null?m:1,e.imageSmoothingEnabled=o.smooth!==!1,e.drawImage(a,h,g,l,f))})}var iS={type:"image",tag:"image",nested:!1,attr:nS,bound:lv,draw:Np,pick:Ll(),isect:b.vN,get:Op,xOffset:rd,yOffset:Il},rS=Jf("line",Xy,wp);function cv(e,t){var i=t.scaleX||1,o=t.scaleY||1;(i!==1||o!==1)&&e("vector-effect","non-scaling-stroke"),e("transform",XC(t)),e("d",t.path)}function ru(e,t){var i=t.path;if(i==null)return!0;var o=t.x||0,a=t.y||0,l=t.scaleX||1,f=t.scaleY||1,h=(t.angle||0)*Zs,g=t.pathCache;(!g||g.path!==i)&&((t.pathCache=g=Qs(i)).path=i),h&&e.rotate&&e.translate?(e.translate(o,a),e.rotate(h),Sl(e,g,0,0,l,f),e.rotate(-h),e.translate(-o,-a)):Sl(e,g,o,a,l,f)}function _p(e,t){return ru(sa(e,t.angle),t)?e.set(0,0,0,0):Mt(e,t,!0)}var n3={type:"path",tag:"path",nested:!1,attr:cv,bound:_p,draw:Kf(ru),pick:nu(ru),isect:eu(ru)};function oS(e,t){e("d",ia(null,t))}function sS(e,t){var i,o;return Mt(e.set(i=t.x||0,o=t.y||0,i+t.width||0,o+t.height||0),t)}function Mp(e,t){e.beginPath(),ia(e,t)}var fv={type:"rect",tag:"path",nested:!1,attr:oS,bound:sS,draw:Kf(Mp),pick:nu(Mp),isect:Xf};function aS(e,t){e("transform",Sp(t)),e("x2",t.x2!=null?t.x2-(t.x||0):0),e("y2",t.y2!=null?t.y2-(t.y||0):0)}function uS(e,t){var i,o;return Mt(e.set(i=t.x||0,o=t.y||0,t.x2!=null?t.x2:i,t.y2!=null?t.y2:o),t)}function lS(e,t,i){var o,a,l,f;return t.stroke&&Hr(e,t,i)?(o=t.x||0,a=t.y||0,l=t.x2!=null?t.x2:o,f=t.y2!=null?t.y2:a,e.beginPath(),e.moveTo(o,a),e.lineTo(l,f),!0):!1}function dv(e,t,i){zi(t,o=>{if(!(i&&!i.intersects(o.bounds))){var a=o.opacity==null?1:o.opacity;a&&lS(e,o,a)&&(tu(e,o),e.stroke())}})}function hv(e,t,i,o){return e.isPointInStroke?lS(e,t,1)&&e.isPointInStroke(i,o):!1}var cS={type:"rule",tag:"line",nested:!1,attr:aS,bound:uS,draw:dv,pick:Ll(hv),isect:Ml},gv=Fp("shape",Yy),i3=Fp("symbol",Ol,Ep);const Ii=(0,b.EV)();var xi={height:Pi,measureWidth:ad,estimateWidth:ou,width:ou,canvas:od};od(!0);function od(e){xi.width=e&&At?ad:ou}function ou(e,t){return sd(bo(e,t),Pi(e))}function sd(e,t){return~~(.8*e.length*t)}function ad(e,t){return Pi(e)<=0||!(t=bo(e,t))?0:pv(t,ud(e))}function pv(e,t){const i=`(${t}) ${e}`;let o=Ii.get(i);return o===void 0&&(At.font=t,o=At.measureText(e).width,Ii.set(i,o)),o}function Pi(e){return e.fontSize!=null?+e.fontSize||0:11}function xr(e){return e.lineHeight!=null?e.lineHeight:Pi(e)+2}function Bp(e){return(0,b.cy)(e)?e.length>1?e:e[0]:e}function su(e){return Bp(e.lineBreak&&e.text&&!(0,b.cy)(e.text)?e.text.split(e.lineBreak):e.text)}function Ui(e){const t=su(e);return((0,b.cy)(t)?t.length-1:0)*xr(e)}function bo(e,t){const i=t==null?"":(t+"").trim();return e.limit>0&&i.length?r3(e,i):i}function mv(e){if(xi.width===ad){const t=ud(e);return i=>pv(i,t)}else if(xi.width===ou){const t=Pi(e);return i=>sd(i,t)}else return t=>xi.width(e,t)}function r3(e,t){var i=+e.limit,o=mv(e);if(o(t)<i)return t;var a=e.ellipsis||"\u2026",l=e.dir==="rtl",f=0,h=t.length,g;if(i-=o(a),l){for(;f<h;)g=f+h>>>1,o(t.slice(g))>i?f=g+1:h=g;return a+t.slice(f)}else{for(;f<h;)g=1+(f+h>>>1),o(t.slice(0,g))<i?f=g:h=g-1;return t.slice(0,f)+a}}function Pl(e,t){var i=e.font;return(t&&i?String(i).replace(/"/g,"'"):i)||"sans-serif"}function ud(e,t){return(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+Pi(e)+"px "+Pl(e,t)}function Ul(e){var t=e.baseline,i=Pi(e);return Math.round(t==="top"?.79*i:t==="middle"?.3*i:t==="bottom"?-.21*i:t==="line-top"?.29*i+.5*xr(e):t==="line-bottom"?.29*i-.5*xr(e):0)}const Lp={left:"start",center:"middle",right:"end"},us=new Dt;function jl(e){var t=e.x||0,i=e.y||0,o=e.radius||0,a;return o&&(a=(e.theta||0)-Js,t+=o*Math.cos(a),i+=o*Math.sin(a)),us.x1=t,us.y1=i,us}function fS(e,t){var i=t.dx||0,o=(t.dy||0)+Ul(t),a=jl(t),l=a.x1,f=a.y1,h=t.angle||0,g;e("text-anchor",Lp[t.align]||"start"),h?(g=bi(l,f)+" "+Qf(h),(i||o)&&(g+=" "+bi(i,o))):g=bi(l+i,f+o),e("transform",g)}function yv(e,t,i){var o=xi.height(t),a=t.align,l=jl(t),f=l.x1,h=l.y1,g=t.dx||0,m=(t.dy||0)+Ul(t)-Math.round(.8*o),v=su(t),x;if((0,b.cy)(v)?(o+=xr(t)*(v.length-1),x=v.reduce((C,w)=>Math.max(C,xi.width(t,w)),0)):x=xi.width(t,v),a==="center"?g-=x/2:a==="right"&&(g-=x),e.set(g+=f,m+=h,g+x,m+o),t.angle&&!i)e.rotate(t.angle*Zs,f,h);else if(i===2)return e.rotatedPoints(t.angle*Zs,f,h);return e}function dS(e,t,i){zi(t,o=>{var a=o.opacity==null?1:o.opacity,l,f,h,g,m,v,x;if(!(i&&!i.intersects(o.bounds)||a===0||o.fontSize<=0||o.text==null||o.text.length===0)){if(e.font=ud(o),e.textAlign=o.align||"left",l=jl(o),f=l.x1,h=l.y1,o.angle&&(e.save(),e.translate(f,h),e.rotate(o.angle*Zs),f=h=0),f+=o.dx||0,h+=(o.dy||0)+Ul(o),v=su(o),tu(e,o),(0,b.cy)(v))for(m=xr(o),g=0;g<v.length;++g)x=bo(o,v[g]),o.fill&&as(e,o,a)&&e.fillText(x,f,h),o.stroke&&Hr(e,o,a)&&e.strokeText(x,f,h),h+=m;else x=bo(o,v),o.fill&&as(e,o,a)&&e.fillText(x,f,h),o.stroke&&Hr(e,o,a)&&e.strokeText(x,f,h);o.angle&&e.restore()}})}function xo(e,t,i,o,a,l){if(t.fontSize<=0)return!1;if(!t.angle)return!0;var f=jl(t),h=f.x1,g=f.y1,m=yv(us,t,1),v=-t.angle*Zs,x=Math.cos(v),C=Math.sin(v),w=x*a-C*l+(h-x*h+C*g),S=C*a+x*l+(g-C*h-x*g);return m.contains(w,S)}function vv(e,t){const i=yv(us,e,2);return br(t,i[0],i[1],i[2],i[3])||br(t,i[0],i[1],i[4],i[5])||br(t,i[4],i[5],i[6],i[7])||br(t,i[2],i[3],i[6],i[7])}var bv={type:"text",tag:"text",nested:!1,attr:fS,bound:yv,draw:dS,pick:Ll(xo),isect:vv},hS=Jf("trail",Vf,KC),Ei={arc:Zf,area:QC,group:tS,image:iS,line:rS,path:n3,rect:fv,rule:cS,shape:gv,symbol:i3,text:bv,trail:hS};function zp(e,t,i){var o=Ei[e.mark.marktype],a=t||o.bound;return o.nested&&(e=e.mark),a(e.bounds||(e.bounds=new Dt),e,i)}var Ip={mark:null};function xv(e,t,i){var o=Ei[e.marktype],a=o.bound,l=e.items,f=l&&l.length,h,g,m,v;if(o.nested)return f?m=l[0]:(Ip.mark=e,m=Ip),v=zp(m,a,i),t=t&&t.union(v)||v,t;if(t=t||e.bounds&&e.bounds.clear()||new Dt,f)for(h=0,g=l.length;h<g;++h)t.union(zp(l[h],a,i));return e.bounds=t}const gS=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function Pp(e,t){return JSON.stringify(e,gS,t)}function Ev(e){const t=typeof e=="string"?JSON.parse(e):e;return Av(t)}function Av(e){var t=e.marktype,i=e.items,o,a,l;if(i)for(a=0,l=i.length;a<l;++a)o=t?"mark":"group",i[a][o]=e,i[a].zindex&&(i[a][o].zdirty=!0),(t||o)==="group"&&Av(i[a]);return t&&xv(e),e}class Cv{constructor(t){arguments.length?this.root=Ev(t):(this.root=Sv({marktype:"group",name:"root",role:"frame"}),this.root.items=[new yr(this.root)])}toJSON(t){return Pp(this.root,t||0)}mark(t,i,o){i=i||this.root.items[0];const a=Sv(t,i);return i.items[o]=a,a.zindex&&(a.group.zdirty=!0),a}}function Sv(e,t){const i={bounds:new Dt,clip:!!e.clip,group:t,interactive:e.interactive!==!1,items:[],marktype:e.marktype,name:e.name||void 0,role:e.role||void 0,zindex:e.zindex||0};return e.aria!=null&&(i.aria=e.aria),e.description&&(i.description=e.description),i}function ls(e,t,i){return!e&&typeof document<"u"&&document.createElement&&(e=document),e?i?e.createElementNS(i,t):e.createElement(t):null}function Up(e,t){t=t.toLowerCase();for(var i=e.childNodes,o=0,a=i.length;o<a;++o)if(i[o].tagName.toLowerCase()===t)return i[o]}function Pt(e,t,i,o){var a=e.childNodes[t],l;return(!a||a.tagName.toLowerCase()!==i.toLowerCase())&&(l=a||null,a=ls(e.ownerDocument,i,o),e.insertBefore(a,l)),a}function ji(e,t){for(var i=e.childNodes,o=i.length;o>t;)e.removeChild(i[--o]);return e}function Fv(e){return"mark-"+e.marktype+(e.role?" role-"+e.role:"")+(e.name?" "+e.name:"")}function au(e,t){const i=t.getBoundingClientRect();return[e.clientX-i.left-(t.clientLeft||0),e.clientY-i.top-(t.clientTop||0)]}function pS(e,t,i,o){var a=e&&e.mark,l,f;if(a&&(l=Ei[a.marktype]).tip){for(f=au(t,i),f[0]-=o[0],f[1]-=o[1];e=e.mark.group;)f[0]-=e.x||0,f[1]-=e.y||0;e=l.tip(a.items,f)}return e}class jp{constructor(t,i){this._active=null,this._handlers={},this._loader=t||Yu(),this._tooltip=i||mS}initialize(t,i,o){return this._el=t,this._obj=o||null,this.origin(i)}element(){return this._el}canvas(){return this._el&&this._el.firstChild}origin(t){return arguments.length?(this._origin=t||[0,0],this):this._origin.slice()}scene(t){return arguments.length?(this._scene=t,this):this._scene}on(){}off(){}_handlerIndex(t,i,o){for(let a=t?t.length:0;--a>=0;)if(t[a].type===i&&(!o||t[a].handler===o))return a;return-1}handlers(t){const i=this._handlers,o=[];if(t)o.push(...i[this.eventName(t)]);else for(const a in i)o.push(...i[a]);return o}eventName(t){const i=t.indexOf(".");return i<0?t:t.slice(0,i)}handleHref(t,i,o){this._loader.sanitize(o,{context:"href"}).then(a=>{const l=new MouseEvent(t.type,t),f=ls(null,"a");for(const h in a)f.setAttribute(h,a[h]);f.dispatchEvent(l)}).catch(()=>{})}handleTooltip(t,i,o){if(i&&i.tooltip!=null){i=pS(i,t,this.canvas(),this._origin);const a=o&&i&&i.tooltip||null;this._tooltip.call(this._obj,this,t,i,a)}}getItemBoundingClientRect(t){const i=this.canvas();if(!i)return;const o=i.getBoundingClientRect(),a=this._origin,l=t.bounds,f=l.width(),h=l.height();let g=l.x1+a[0]+o.left,m=l.y1+a[1]+o.top;for(;t.mark&&(t=t.mark.group);)g+=t.x||0,m+=t.y||0;return{x:g,y:m,width:f,height:h,left:g,top:m,right:g+f,bottom:m+h}}}function mS(e,t,i,o){e.element().setAttribute("title",o||"")}class Gl{constructor(t){this._el=null,this._bgcolor=null,this._loader=new pp(t)}initialize(t,i,o,a,l){return this._el=t,this.resize(i,o,a,l)}element(){return this._el}canvas(){return this._el&&this._el.firstChild}background(t){return arguments.length===0?this._bgcolor:(this._bgcolor=t,this)}resize(t,i,o,a){return this._width=t,this._height=i,this._origin=o||[0,0],this._scale=a||1,this}dirty(){}render(t,i){const o=this;return o._call=function(){o._render(t,i)},o._call(),o._call=null,o}_render(){}renderAsync(t,i){const o=this.render(t,i);return this._ready?this._ready.then(()=>o):Promise.resolve(o)}_load(t,i){var o=this,a=o._loader[t](i);if(!o._ready){const l=o._call;o._ready=o._loader.ready().then(f=>{f&&l(),o._ready=null})}return a}sanitizeURL(t){return this._load("sanitizeURL",t)}loadImage(t){return this._load("loadImage",t)}}const uu="keydown",wv="keypress",yS="keyup",Gp="dragenter",Wl="dragleave",Dv="dragover",Wp="pointerdown",vS="pointerup",ld="pointermove",cd="pointerout",kv="pointerover",Vl="mousedown",$v="mouseup",Ov="mousemove",fd="mouseout",dd="mouseover",lu="click",Tv="dblclick",Rv="wheel",Vp="mousewheel",Hl="touchstart",hd="touchmove",gd="touchend",Nv=[uu,wv,yS,Gp,Wl,Dv,Wp,vS,ld,cd,kv,Vl,$v,Ov,fd,dd,lu,Tv,Rv,Vp,Hl,hd,gd],pd=ld,aa=fd,Hp=lu;class cu extends jp{constructor(t,i){super(t,i),this._down=null,this._touch=null,this._first=!0,this._events={},this.events=Nv,this.pointermove=Mv([ld,Ov],[kv,dd],[cd,fd]),this.dragover=Mv([Dv],[Gp],[Wl]),this.pointerout=Bv([cd,fd]),this.dragleave=Bv([Wl])}initialize(t,i,o){return this._canvas=t&&Up(t,"canvas"),[lu,Vl,Wp,ld,cd,Wl].forEach(a=>_v(this,a)),super.initialize(t,i,o)}canvas(){return this._canvas}context(){return this._canvas.getContext("2d")}DOMMouseScroll(t){this.fire(Vp,t)}pointerdown(t){this._down=this._active,this.fire(Wp,t)}mousedown(t){this._down=this._active,this.fire(Vl,t)}click(t){this._down===this._active&&(this.fire(lu,t),this._down=null)}touchstart(t){this._touch=this.pickEvent(t.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire(Hl,t,!0)}touchmove(t){this.fire(hd,t,!0)}touchend(t){this.fire(gd,t,!0),this._touch=null}fire(t,i,o){const a=o?this._touch:this._active,l=this._handlers[t];if(i.vegaType=t,t===Hp&&a&&a.href?this.handleHref(i,a,a.href):(t===pd||t===aa)&&this.handleTooltip(i,a,t!==aa),l)for(let f=0,h=l.length;f<h;++f)l[f].handler.call(this._obj,i,a)}on(t,i){const o=this.eventName(t),a=this._handlers;return this._handlerIndex(a[o],t,i)<0&&(_v(this,t),(a[o]||(a[o]=[])).push({type:t,handler:i})),this}off(t,i){const o=this.eventName(t),a=this._handlers[o],l=this._handlerIndex(a,t,i);return l>=0&&a.splice(l,1),this}pickEvent(t){const i=au(t,this._canvas),o=this._origin;return this.pick(this._scene,i[0],i[1],i[0]-o[0],i[1]-o[1])}pick(t,i,o,a,l){const f=this.context();return Ei[t.marktype].pick.call(this,f,t,i,o,a,l)}}const bS=e=>e===Hl||e===hd||e===gd?[Hl,hd,gd]:[e];function _v(e,t){bS(t).forEach(i=>xS(e,i))}function xS(e,t){const i=e.canvas();i&&!e._events[t]&&(e._events[t]=1,i.addEventListener(t,e[t]?o=>e[t](o):o=>e.fire(t,o)))}function ql(e,t,i){t.forEach(o=>e.fire(o,i))}function Mv(e,t,i){return function(o){const a=this._active,l=this.pickEvent(o);l===a?ql(this,e,o):((!a||!a.exit)&&ql(this,i,o),this._active=l,ql(this,t,o),ql(this,e,o))}}function Bv(e){return function(t){ql(this,e,t),this._active=null}}function ES(){return typeof window<"u"&&window.devicePixelRatio||1}function AS(e,t,i,o,a,l){const f=typeof HTMLElement<"u"&&e instanceof HTMLElement&&e.parentNode!=null,h=e.getContext("2d"),g=f?ES():a;e.width=t*g,e.height=i*g;for(const m in l)h[m]=l[m];return f&&g!==1&&(e.style.width=t+"px",e.style.height=i+"px"),h.pixelRatio=g,h.setTransform(g,0,0,g,g*o[0],g*o[1]),e}class md extends Gl{constructor(t){super(t),this._options={},this._redraw=!1,this._dirty=new Dt,this._tempb=new Dt}initialize(t,i,o,a,l,f){return this._options=f||{},this._canvas=this._options.externalContext?null:zn(1,1,this._options.type),t&&this._canvas&&(ji(t,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),super.initialize(t,i,o,a,l)}resize(t,i,o,a){if(super.resize(t,i,o,a),this._canvas)AS(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context);else{const l=this._options.externalContext;l||(0,b.z3)("CanvasRenderer is missing a valid canvas or context"),l.scale(this._scale,this._scale),l.translate(this._origin[0],this._origin[1])}return this._redraw=!0,this}canvas(){return this._canvas}context(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)}dirty(t){const i=this._tempb.clear().union(t.bounds);let o=t.mark.group;for(;o;)i.translate(o.x||0,o.y||0),o=o.mark.group;this._dirty.union(i)}_render(t,i){const o=this.context(),a=this._origin,l=this._width,f=this._height,h=this._dirty,g=CS(a,l,f);o.save();const m=this._redraw||h.empty()?(this._redraw=!1,g.expand(1)):SS(o,g.intersect(h),a);return this.clear(-a[0],-a[1],l,f),this.draw(o,t,m,i),o.restore(),h.clear(),this}draw(t,i,o,a){if(i.marktype!=="group"&&a!=null&&!a.includes(i.marktype))return;const l=Ei[i.marktype];i.clip&&Dp(t,i),l.draw.call(this,t,i,o,a),i.clip&&t.restore()}clear(t,i,o,a){const l=this._options,f=this.context();l.type!=="pdf"&&!l.externalContext&&f.clearRect(t,i,o,a),this._bgcolor!=null&&(f.fillStyle=this._bgcolor,f.fillRect(t,i,o,a))}}const CS=(e,t,i)=>new Dt().set(0,0,t,i).translate(-e[0],-e[1]);function SS(e,t,i){return t.expand(1).round(),e.pixelRatio%1&&t.scale(e.pixelRatio).round().scale(1/e.pixelRatio),t.translate(-(i[0]%1),-(i[1]%1)),e.beginPath(),e.rect(t.x1,t.y1,t.width(),t.height()),e.clip(),t}class Lv extends jp{constructor(t,i){super(t,i);const o=this;o._hrefHandler=yd(o,(a,l)=>{l&&l.href&&o.handleHref(a,l,l.href)}),o._tooltipHandler=yd(o,(a,l)=>{o.handleTooltip(a,l,a.type!==aa)})}initialize(t,i,o){let a=this._svg;return a&&(a.removeEventListener(Hp,this._hrefHandler),a.removeEventListener(pd,this._tooltipHandler),a.removeEventListener(aa,this._tooltipHandler)),this._svg=a=t&&Up(t,"svg"),a&&(a.addEventListener(Hp,this._hrefHandler),a.addEventListener(pd,this._tooltipHandler),a.addEventListener(aa,this._tooltipHandler)),super.initialize(t,i,o)}canvas(){return this._svg}on(t,i){const o=this.eventName(t),a=this._handlers;if(this._handlerIndex(a[o],t,i)<0){const f={type:t,handler:i,listener:yd(this,i)};(a[o]||(a[o]=[])).push(f),this._svg&&this._svg.addEventListener(o,f.listener)}return this}off(t,i){const o=this.eventName(t),a=this._handlers[o],l=this._handlerIndex(a,t,i);return l>=0&&(this._svg&&this._svg.removeEventListener(o,a[l].listener),a.splice(l,1)),this}}const yd=(e,t)=>i=>{let o=i.target.__data__;o=Array.isArray(o)?o[0]:o,i.vegaType=i.type,t.call(e._obj,i,o)},zv="aria-hidden",qp="aria-label",Xp="role",Yp="aria-roledescription",Iv="graphics-object",Kp="graphics-symbol",Pv=(e,t,i)=>({[Xp]:e,[Yp]:t,[qp]:i||void 0}),FS=(0,b.M1)(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),Qp={axis:{desc:"axis",caption:DS},legend:{desc:"legend",caption:kS},"title-text":{desc:"title",caption:e=>`Title text '${t0(e)}'`},"title-subtitle":{desc:"subtitle",caption:e=>`Subtitle text '${t0(e)}'`}},Zp={ariaRole:Xp,ariaRoleDescription:Yp,description:qp};function Jp(e,t){const i=t.aria===!1;if(e(zv,i||void 0),i||t.description==null)for(const o in Zp)e(Zp[o],void 0);else{const o=t.mark.marktype;e(qp,t.description),e(Xp,t.ariaRole||(o==="group"?Iv:Kp)),e(Yp,t.ariaRoleDescription||`${o} mark`)}}function vd(e){return e.aria===!1?{[zv]:!0}:FS[e.role]?null:Qp[e.role]?wS(e,Qp[e.role]):e0(e)}function e0(e){const t=e.marktype,i=t==="group"||t==="text"||e.items.some(o=>o.description!=null&&o.aria!==!1);return Pv(i?Iv:Kp,`${t} mark container`,e.description)}function wS(e,t){try{const i=e.items[0],o=t.caption||(()=>"");return Pv(t.role||Kp,t.desc,i.description||o(i))}catch{return null}}function t0(e){return(0,b.YO)(e.text).join(" ")}function DS(e){const t=e.datum,i=e.orient,o=t.title?Uv(e):null,a=e.context,l=a.scales[t.scale].value,f=a.dataflow.locale(),h=l.type;return`${i==="left"||i==="right"?"Y":"X"}-axis`+(o?` titled '${o}'`:"")+` for a ${hr(h)?"discrete":h} scale with ${Ry(f,l,e)}`}function kS(e){const t=e.datum,i=t.title?Uv(e):null,o=`${t.type||""} legend`.trim(),a=t.scales,l=Object.keys(a),f=e.context,h=f.scales[a[l[0]]].value,g=f.dataflow.locale();return jv(o)+(i?` titled '${i}'`:"")+` for ${$S(l)} with ${Ry(g,h,e)}`}function Uv(e){try{return(0,b.YO)((0,b.se)(e.items).items[0].text).join(" ")}catch{return null}}function $S(e){return e=e.map(t=>t+(t==="fill"||t==="stroke"?" color":"")),e.length<2?e[0]:e.slice(0,-1).join(", ")+" and "+(0,b.se)(e)}function jv(e){return e.length?e[0].toUpperCase()+e.slice(1):e}const Gv=e=>(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),OS=e=>Gv(e).replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;");function n0(){let e="",t="",i="";const o=[],a=()=>t=i="",l=g=>{t&&(e+=`${t}>${i}`,a()),o.push(g)},f=(g,m)=>(m!=null&&(t+=` ${g}="${OS(m)}"`),h),h={open(g){l(g),t="<"+g;for(var m=arguments.length,v=new Array(m>1?m-1:0),x=1;x<m;x++)v[x-1]=arguments[x];for(const C of v)for(const w in C)f(w,C[w]);return h},close(){const g=o.pop();return t?e+=t+(i?`>${i}</${g}>`:"/>"):e+=`</${g}>`,a(),h},attr:f,text:g=>(i+=Gv(g),h),toString:()=>e};return h}const Wv=e=>i0(n0(),e)+"";function i0(e,t){if(e.open(t.tagName),t.hasAttributes()){const i=t.attributes,o=i.length;for(let a=0;a<o;++a)e.attr(i[a].name,i[a].value)}if(t.hasChildNodes()){const i=t.childNodes;for(const o of i)o.nodeType===3?e.text(o.nodeValue):i0(e,o)}return e.close()}const Gi={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity"},Ai={blend:"mix-blend-mode"},ni={fill:"none","stroke-miterlimit":10},fu=0,Xl="http://www.w3.org/2000/xmlns/",Ct=iu.xmlns;class r0 extends Gl{constructor(t){super(t),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}initialize(t,i,o,a,l){return this._defs={},this._clearDefs(),t&&(this._svg=Pt(t,0,"svg",Ct),this._svg.setAttributeNS(Xl,"xmlns",Ct),this._svg.setAttributeNS(Xl,"xmlns:xlink",iu["xmlns:xlink"]),this._svg.setAttribute("version",iu.version),this._svg.setAttribute("class","marks"),ji(t,1),this._root=Pt(this._svg,fu,"g",Ct),qe(this._root,ni),ji(this._svg,fu+1)),this.background(this._bgcolor),super.initialize(t,i,o,a,l)}background(t){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",t),super.background(...arguments)}resize(t,i,o,a){return super.resize(t,i,o,a),this._svg&&(qe(this._svg,{width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}),this._root.setAttribute("transform",`translate(${this._origin})`)),this._dirty=[],this}canvas(){return this._svg}svg(){const t=this._svg,i=this._bgcolor;if(!t)return null;let o;i&&(t.removeAttribute("style"),o=Pt(t,fu,"rect",Ct),qe(o,{width:this._width,height:this._height,fill:i}));const a=Wv(t);return i&&(t.removeChild(o),this._svg.style.setProperty("background-color",i)),a}_render(t,i){return this._dirtyCheck()&&(this._dirtyAll&&this._clearDefs(),this.mark(this._root,t,void 0,i),ji(this._root,1)),this.defs(),this._dirty=[],++this._dirtyID,this}dirty(t){t.dirty!==this._dirtyID&&(t.dirty=this._dirtyID,this._dirty.push(t))}isDirty(t){return this._dirtyAll||!t._svg||!t._svg.ownerSVGElement||t.dirty===this._dirtyID}_dirtyCheck(){this._dirtyAll=!0;const t=this._dirty;if(!t.length||!this._dirtyID)return!0;const i=++this._dirtyID;let o,a,l,f,h,g,m;for(h=0,g=t.length;h<g;++h)if(o=t[h],a=o.mark,a.marktype!==l&&(l=a.marktype,f=Ei[l]),a.zdirty&&a.dirty!==i&&(this._dirtyAll=!1,ua(o,i),a.items.forEach(v=>{v.dirty=i})),!a.zdirty){if(o.exit){f.nested&&a.items.length?(m=a.items[0],m._svg&&this._update(f,m._svg,m)):o._svg&&(m=o._svg.parentNode,m&&m.removeChild(o._svg)),o._svg=null;continue}o=f.nested?a.items[0]:o,o._update!==i&&(!o._svg||!o._svg.ownerSVGElement?(this._dirtyAll=!1,ua(o,i)):this._update(f,o._svg,o),o._update=i)}return!this._dirtyAll}mark(t,i,o,a){if(!this.isDirty(i))return i._svg;const l=this._svg,f=i.marktype,h=Ei[f],g=i.interactive===!1?"none":null,m=h.tag==="g",v=o0(i,t,o,"g",l);if(f!=="group"&&a!=null&&!a.includes(f))return ji(v,0),i._svg;v.setAttribute("class",Fv(i));const x=vd(i);for(const D in x)yt(v,D,x[D]);m||yt(v,"pointer-events",g),yt(v,"clip-path",i.clip?ae(this,i,i.group):null);let C=null,w=0;const S=D=>{const k=this.isDirty(D),O=o0(D,v,C,h.tag,l);k&&(this._update(h,O,D),m&&cs(this,O,D,a)),C=O,++w};return h.nested?i.items.length&&S(i.items[0]):zi(i,S),ji(v,w),v}_update(t,i,o){Er=i,Ge=i.__values__,Jp(Kl,o),t.attr(Kl,o,this);const a=qv[t.type];a&&a.call(this,t,i,o),Er&&this.style(Er,o)}style(t,i){if(i!=null){for(const o in Gi){let a=o==="font"?Pl(i):i[o];if(a===Ge[o])continue;const l=Gi[o];a==null?t.removeAttribute(l):(Qa(a)&&(a=lp(a,this._defs.gradient,a0())),t.setAttribute(l,a+"")),Ge[o]=a}for(const o in Ai)Eo(t,Ai[o],i[o])}}defs(){const t=this._svg,i=this._defs;let o=i.el,a=0;for(const l in i.gradient)o||(i.el=o=Pt(t,fu+1,"defs",Ct)),a=Yl(o,i.gradient[l],a);for(const l in i.clipping)o||(i.el=o=Pt(t,fu+1,"defs",Ct)),a=Vv(o,i.clipping[l],a);o&&(a===0?(t.removeChild(o),i.el=null):ji(o,a))}_clearDefs(){const t=this._defs;t.gradient={},t.clipping={}}}function ua(e,t){for(;e&&e.dirty!==t;e=e.mark.group)if(e.dirty=t,e.mark&&e.mark.dirty!==t)e.mark.dirty=t;else return}function Yl(e,t,i){let o,a,l;if(t.gradient==="radial"){let f=Pt(e,i++,"pattern",Ct);qe(f,{id:Lf+t.id,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),f=Pt(f,0,"rect",Ct),qe(f,{width:1,height:1,fill:`url(${a0()}#${t.id})`}),e=Pt(e,i++,"radialGradient",Ct),qe(e,{id:t.id,fx:t.x1,fy:t.y1,fr:t.r1,cx:t.x2,cy:t.y2,r:t.r2})}else e=Pt(e,i++,"linearGradient",Ct),qe(e,{id:t.id,x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2});for(o=0,a=t.stops.length;o<a;++o)l=Pt(e,o,"stop",Ct),l.setAttribute("offset",t.stops[o].offset),l.setAttribute("stop-color",t.stops[o].color);return ji(e,o),i}function Vv(e,t,i){let o;return e=Pt(e,i,"clipPath",Ct),e.setAttribute("id",t.id),t.path?(o=Pt(e,0,"path",Ct),o.setAttribute("d",t.path)):(o=Pt(e,0,"rect",Ct),qe(o,{x:0,y:0,width:t.width,height:t.height})),ji(e,1),i+1}function cs(e,t,i,o){t=t.lastChild.previousSibling;let a,l=0;zi(i,f=>{a=e.mark(t,f,a,o),++l}),ji(t,1+l)}function o0(e,t,i,o,a){let l=e._svg,f;if(!l&&(f=t.ownerDocument,l=ls(f,o,Ct),e._svg=l,e.mark&&(l.__data__=e,l.__values__={fill:"default"},o==="g"))){const h=ls(f,"path",Ct);l.appendChild(h),h.__data__=e;const g=ls(f,"g",Ct);l.appendChild(g),g.__data__=e;const m=ls(f,"path",Ct);l.appendChild(m),m.__data__=e,m.__values__={fill:"default"}}return(l.ownerSVGElement!==a||Hv(l,i))&&t.insertBefore(l,i?i.nextSibling:t.firstChild),l}function Hv(e,t){return e.parentNode&&e.parentNode.childNodes.length>1&&e.previousSibling!=t}let Er=null,Ge=null;const qv={group(e,t,i){const o=Er=t.childNodes[2];Ge=o.__values__,e.foreground(Kl,i,this),Ge=t.__values__,Er=t.childNodes[1],e.content(Kl,i,this);const a=Er=t.childNodes[0];e.background(Kl,i,this);const l=i.mark.interactive===!1?"none":null;if(l!==Ge.events&&(yt(o,"pointer-events",l),yt(a,"pointer-events",l),Ge.events=l),i.strokeForeground&&i.stroke){const f=i.fill;yt(o,"display",null),this.style(a,i),yt(a,"stroke",null),f&&(i.fill=null),Ge=o.__values__,this.style(o,i),f&&(i.fill=f),Er=null}else yt(o,"display","none")},image(e,t,i){i.smooth===!1?(Eo(t,"image-rendering","optimizeSpeed"),Eo(t,"image-rendering","pixelated")):Eo(t,"image-rendering",null)},text(e,t,i){const o=su(i);let a,l,f,h;(0,b.cy)(o)?(l=o.map(g=>bo(i,g)),a=l.join(`
`),a!==Ge.text&&(ji(t,0),f=t.ownerDocument,h=xr(i),l.forEach((g,m)=>{const v=ls(f,"tspan",Ct);v.__data__=i,v.textContent=g,m&&(v.setAttribute("x",0),v.setAttribute("dy",h)),t.appendChild(v)}),Ge.text=a)):(l=bo(i,o),l!==Ge.text&&(t.textContent=l,Ge.text=l)),yt(t,"font-family",Pl(i)),yt(t,"font-size",Pi(i)+"px"),yt(t,"font-style",i.fontStyle),yt(t,"font-variant",i.fontVariant),yt(t,"font-weight",i.fontWeight)}};function Kl(e,t,i){t!==Ge[e]&&(i?s0(Er,e,t,i):yt(Er,e,t),Ge[e]=t)}function Eo(e,t,i){i!==Ge[t]&&(i==null?e.style.removeProperty(t):e.style.setProperty(t,i+""),Ge[t]=i)}function qe(e,t){for(const i in t)yt(e,i,t[i])}function yt(e,t,i){i!=null?e.setAttribute(t,i):e.removeAttribute(t)}function s0(e,t,i,o){i!=null?e.setAttributeNS(o,t,i):e.removeAttributeNS(o,t)}function a0(){let e;return typeof window>"u"?"":(e=window.location).hash?e.href.slice(0,-e.hash.length):e.href}class Ar extends Gl{constructor(t){super(t),this._text=null,this._defs={gradient:{},clipping:{}}}svg(){return this._text}_render(t){const i=n0();i.open("svg",(0,b.X$)({},iu,{class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}));const o=this._bgcolor;return o&&o!=="transparent"&&o!=="none"&&i.open("rect",{width:this._width,height:this._height,fill:o}).close(),i.open("g",ni,{transform:"translate("+this._origin+")"}),this.mark(i,t),i.close(),this.defs(i),this._text=i.close()+"",this}mark(t,i){const o=Ei[i.marktype],a=o.tag,l=[Jp,o.attr];t.open("g",{class:Fv(i),"clip-path":i.clip?ae(this,i,i.group):null},vd(i),{"pointer-events":a!=="g"&&i.interactive===!1?"none":null});const f=h=>{const g=this.href(h);if(g&&t.open("a",g),t.open(a,this.attr(i,h,l,a!=="g"?a:null)),a==="text"){const m=su(h);if((0,b.cy)(m)){const v={x:0,dy:xr(h)};for(let x=0;x<m.length;++x)t.open("tspan",x?v:null).text(bo(h,m[x])).close()}else t.text(bo(h,m))}else if(a==="g"){const m=h.strokeForeground,v=h.fill,x=h.stroke;m&&x&&(h.stroke=null),t.open("path",this.attr(i,h,o.background,"bgrect")).close(),t.open("g",this.attr(i,h,o.content)),zi(h,C=>this.mark(t,C)),t.close(),m&&x?(v&&(h.fill=null),h.stroke=x,t.open("path",this.attr(i,h,o.foreground,"bgrect")).close(),v&&(h.fill=v)):t.open("path",this.attr(i,h,o.foreground,"bgfore")).close()}t.close(),g&&t.close()};return o.nested?i.items&&i.items.length&&f(i.items[0]):zi(i,f),t.close()}href(t){const i=t.href;let o;if(i){if(o=this._hrefs&&this._hrefs[i])return o;this.sanitizeURL(i).then(a=>{a["xlink:href"]=a.href,a.href=null,(this._hrefs||(this._hrefs={}))[i]=a})}return null}attr(t,i,o,a){const l={},f=(h,g,m,v)=>{l[v||h]=g};return Array.isArray(o)?o.forEach(h=>h(f,i,this)):o(f,i,this),a&&bd(l,i,t,a,this._defs),l}defs(t){const i=this._defs.gradient,o=this._defs.clipping;if(Object.keys(i).length+Object.keys(o).length!==0){t.open("defs");for(const l in i){const f=i[l],h=f.stops;f.gradient==="radial"?(t.open("pattern",{id:Lf+l,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),t.open("rect",{width:"1",height:"1",fill:"url(#"+l+")"}).close(),t.close(),t.open("radialGradient",{id:l,fx:f.x1,fy:f.y1,fr:f.r1,cx:f.x2,cy:f.y2,r:f.r2})):t.open("linearGradient",{id:l,x1:f.x1,x2:f.x2,y1:f.y1,y2:f.y2});for(let g=0;g<h.length;++g)t.open("stop",{offset:h[g].offset,"stop-color":h[g].color}).close();t.close()}for(const l in o){const f=o[l];t.open("clipPath",{id:l}),f.path?t.open("path",{d:f.path}).close():t.open("rect",{x:0,y:0,width:f.width,height:f.height}).close(),t.close()}t.close()}}}function bd(e,t,i,o,a){let l;if(t==null||(o==="bgrect"&&i.interactive===!1&&(e["pointer-events"]="none"),o==="bgfore"&&(i.interactive===!1&&(e["pointer-events"]="none"),e.display="none",t.fill!==null)))return e;o==="image"&&t.smooth===!1&&(l=["image-rendering: optimizeSpeed;","image-rendering: pixelated;"]),o==="text"&&(e["font-family"]=Pl(t),e["font-size"]=Pi(t)+"px",e["font-style"]=t.fontStyle,e["font-variant"]=t.fontVariant,e["font-weight"]=t.fontWeight);for(const f in Gi){let h=t[f];const g=Gi[f];h==="transparent"&&(g==="fill"||g==="stroke")||h!=null&&(Qa(h)&&(h=lp(h,a.gradient,"")),e[g]=h)}for(const f in Ai){const h=t[f];h!=null&&(l=l||[],l.push(`${Ai[f]}: ${h};`))}return l&&(e.style=l.join(" ")),e}const ii={svgMarkTypes:["text"],svgOnTop:!0,debug:!1};function Xv(e){ii.svgMarkTypes=e.svgMarkTypes??["text"],ii.svgOnTop=e.svgOnTop??!0,ii.debug=e.debug??!1}class xd extends Gl{constructor(t){super(t),this._svgRenderer=new r0(t),this._canvasRenderer=new md(t)}initialize(t,i,o,a,l){this._root_el=Pt(t,0,"div");const f=Pt(this._root_el,0,"div"),h=Pt(this._root_el,1,"div");return this._root_el.style.position="relative",ii.debug||(f.style.height="100%",h.style.position="absolute",h.style.top="0",h.style.left="0",h.style.height="100%",h.style.width="100%"),this._svgEl=ii.svgOnTop?h:f,this._canvasEl=ii.svgOnTop?f:h,this._svgEl.style.pointerEvents="none",this._canvasRenderer.initialize(this._canvasEl,i,o,a,l),this._svgRenderer.initialize(this._svgEl,i,o,a,l),super.initialize(t,i,o,a,l)}dirty(t){return ii.svgMarkTypes.includes(t.mark.marktype)?this._svgRenderer.dirty(t):this._canvasRenderer.dirty(t),this}_render(t,i){const a=(i??["arc","area","image","line","path","rect","rule","shape","symbol","text","trail"]).filter(l=>!ii.svgMarkTypes.includes(l));this._svgRenderer.render(t,ii.svgMarkTypes),this._canvasRenderer.render(t,a)}resize(t,i,o,a){return super.resize(t,i,o,a),this._svgRenderer.resize(t,i,o,a),this._canvasRenderer.resize(t,i,o,a),this}background(t){return ii.svgOnTop?this._canvasRenderer.background(t):this._svgRenderer.background(t),this}}class u0 extends cu{constructor(t,i){super(t,i)}initialize(t,i,o){const a=Pt(Pt(t,0,"div"),ii.svgOnTop?0:1,"div");return super.initialize(a,i,o)}}const du="canvas",Yv="hybrid",TS="png",Kv="svg",l0="none",Cr={Canvas:du,PNG:TS,SVG:Kv,Hybrid:Yv,None:l0},Wi={};Wi[du]=Wi[TS]={renderer:md,headless:md,handler:cu},Wi[Kv]={renderer:r0,headless:Ar,handler:Lv},Wi[Yv]={renderer:xd,headless:xd,handler:u0},Wi[l0]={};function hu(e,t){return e=String(e||"").toLowerCase(),arguments.length>1?(Wi[e]=t,this):Wi[e]}function c0(e,t,i){const o=[],a=new Dt().union(t),l=e.marktype;return l?f0(e,a,i,o):l==="group"?Ed(e,a,i,o):(0,b.z3)("Intersect scene must be mark node or group item.")}function f0(e,t,i,o){if(d0(e,t,i)){const a=e.items,l=e.marktype,f=a.length;let h=0;if(l==="group")for(;h<f;++h)Ed(a[h],t,i,o);else for(const g=Ei[l].isect;h<f;++h){const m=a[h];Qv(m,t,g)&&o.push(m)}}return o}function d0(e,t,i){return e.bounds&&t.intersects(e.bounds)&&(e.marktype==="group"||e.interactive!==!1&&(!i||i(e)))}function Ed(e,t,i,o){i&&i(e.mark)&&Qv(e,t,Ei.group.isect)&&o.push(e);const a=e.items,l=a&&a.length;if(l){const f=e.x||0,h=e.y||0;t.translate(-f,-h);for(let g=0;g<l;++g)f0(a[g],t,i,o);t.translate(f,h)}return o}function Qv(e,t,i){const o=e.bounds;return t.encloses(o)||t.intersects(o)&&i(e,t)}const h0=new Dt;function RS(e){const t=e.clip;if((0,b.Tn)(t))t(sa(h0.clear()));else if(t)h0.set(0,0,e.group.width,e.group.height);else return;e.bounds.intersect(h0)}const NS=1e-9;function Ad(e,t,i){return e===t?!0:i==="path"?fs(e,t):e instanceof Date&&t instanceof Date?+e==+t:(0,b.Et)(e)&&(0,b.Et)(t)?Math.abs(e-t)<=NS:!e||!t||!(0,b.Gv)(e)&&!(0,b.Gv)(t)?e==t:_S(e,t)}function fs(e,t){return Ad(Qs(e),Qs(t))}function _S(e,t){var i=Object.keys(e),o=Object.keys(t),a,l;if(i.length!==o.length)return!1;for(i.sort(),o.sort(),l=i.length-1;l>=0;l--)if(i[l]!=o[l])return!1;for(l=i.length-1;l>=0;l--)if(a=i[l],!Ad(e[a],t[a],a))return!1;return typeof e==typeof t}function MS(){Ky(),Bf()}const gu="top",Sr="left",Vi="right",ds="bottom",BS="top-left",g0="top-right",o3="bottom-left",Ao="bottom-right",Ql="start",Zl="middle",Xt="end",Zv="x",Jl="y",ec="group",p0="axis",Jv="title",LS="frame",zS="scope",hs="legend",Cd="row-header",tc="row-footer",m0="row-title",y0="column-header",v0="column-footer",eb="column-title",IS="padding",PS="symbol",cn="fit",b0="fit-x",tb="fit-y",pu="pad",yn="none",Sd="all",nc="each",Fd="flush",gs="column",ps="row";function x0(e){q.call(this,null,e)}(0,b.B)(x0,q,{transform(e,t){const i=t.dataflow,o=e.mark,a=o.marktype,l=Ei[a],f=l.bound;let h=o.bounds,g;if(l.nested)o.items.length&&i.dirty(o.items[0]),h=la(o,f),o.items.forEach(m=>{m.bounds.clear().union(h)});else if(a===ec||e.modified())switch(t.visit(t.MOD,m=>i.dirty(m)),h.clear(),o.items.forEach(m=>h.union(la(m,f))),o.role){case p0:case hs:case Jv:t.reflow()}else g=t.changed(t.REM),t.visit(t.ADD,m=>{h.union(la(m,f))}),t.visit(t.MOD,m=>{g=g||h.alignsWith(m.bounds),i.dirty(m),h.union(la(m,f))}),g&&(h.clear(),o.items.forEach(m=>h.union(m.bounds)));return RS(o),t.modifies("bounds")}});function la(e,t,i){return t(e.bounds.clear(),e,i)}const E0=":vega_identifier:";function A0(e){q.call(this,0,e)}A0.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]},(0,b.B)(A0,q,{transform(e,t){const i=US(t.dataflow),o=e.as;let a=i.value;return t.visit(t.ADD,l=>l[o]=l[o]||++a),i.set(this.value=a),t}});function US(e){return e._signals[E0]||(e._signals[E0]=e.add(0))}function ic(e){q.call(this,null,e)}(0,b.B)(ic,q,{transform(e,t){let i=this.value;i||(i=t.dataflow.scenegraph().mark(e.markdef,Co(e),e.index),i.group.context=e.context,e.context.group||(e.context.group=i.group),i.source=this.source,i.clip=e.clip,i.interactive=e.interactive,this.value=i);const o=i.marktype===ec?yr:yi;return t.visit(t.ADD,a=>o.call(a,i)),(e.modified("clip")||e.modified("interactive"))&&(i.clip=e.clip,i.interactive=!!e.interactive,i.zdirty=!0,t.reflow()),i.items=t.source,t}});function Co(e){const t=e.groups,i=e.parent;return t&&t.size===1?t.get(Object.keys(t.object)[0]):t&&i?t.lookup(i):null}function nb(e){q.call(this,null,e)}const ib={parity:e=>e.filter((t,i)=>i%2?t.opacity=0:1),greedy:(e,t)=>{let i;return e.filter((o,a)=>!a||!C0(i.bounds,o.bounds,t)?(i=o,1):o.opacity=0)}},C0=(e,t,i)=>i>Math.max(t.x1-e.x2,e.x1-t.x2,t.y1-e.y2,e.y1-t.y2),rb=(e,t)=>{for(var i=1,o=e.length,a=e[0].bounds,l;i<o;a=l,++i)if(C0(a,l=e[i].bounds,t))return!0},ob=e=>{const t=e.bounds;return t.width()>1&&t.height()>1},jS=(e,t,i)=>{var o=e.range(),a=new Dt;return t===gu||t===ds?a.set(o[0],-1/0,o[1],1/0):a.set(-1/0,o[0],1/0,o[1]),a.expand(i||1),l=>a.encloses(l.bounds)},Ci=e=>(e.forEach(t=>t.opacity=1),e),S0=(e,t)=>e.reflow(t.modified()).modifies("opacity");(0,b.B)(nb,q,{transform(e,t){const i=ib[e.method]||ib.parity,o=e.separation||0;let a=t.materialize(t.SOURCE).source,l,f;if(!a||!a.length)return;if(!e.method)return e.modified("method")&&(Ci(a),t=S0(t,e)),t;if(a=a.filter(ob),!a.length)return;if(e.sort&&(a=a.slice().sort(e.sort)),l=Ci(a),t=S0(t,e),l.length>=3&&rb(l,o)){do l=i(l,o);while(l.length>=3&&rb(l,o));l.length<3&&!(0,b.se)(a).opacity&&(l.length>1&&((0,b.se)(l).opacity=0),(0,b.se)(a).opacity=1)}e.boundScale&&e.boundTolerance>=0&&(f=jS(e.boundScale,e.boundOrient,+e.boundTolerance),a.forEach(g=>{f(g)||(g.opacity=0)}));const h=l[0].mark.bounds.clear();return a.forEach(g=>{g.opacity&&h.union(g.bounds)}),t}});function sb(e){q.call(this,null,e)}(0,b.B)(sb,q,{transform(e,t){const i=t.dataflow;if(t.visit(t.ALL,o=>i.dirty(o)),t.fields&&t.fields.zindex){const o=t.source&&t.source[0];o&&(o.mark.zdirty=!0)}}});const fn=new Dt;function ca(e,t,i){return e[t]===i?0:(e[t]=i,1)}function F0(e){var t=e.items[0].orient;return t===Sr||t===Vi}function s3(e){let t=+e.grid;return[e.ticks?t++:-1,e.labels?t++:-1,t+ +e.domain]}function ab(e,t,i,o){var a=t.items[0],l=a.datum,f=a.translate!=null?a.translate:.5,h=a.orient,g=s3(l),m=a.range,v=a.offset,x=a.position,C=a.minExtent,w=a.maxExtent,S=l.title&&a.items[g[2]].items[0],D=a.titlePadding,k=a.bounds,O=S&&Ui(S),R=0,I=0,V,W;switch(fn.clear().union(k),k.clear(),(V=g[0])>-1&&k.union(a.items[V].bounds),(V=g[1])>-1&&k.union(a.items[V].bounds),h){case gu:R=x||0,I=-v,W=Math.max(C,Math.min(w,-k.y1)),k.add(0,-W).add(m,0),S&&w0(e,S,W,D,O,0,-1,k);break;case Sr:R=-v,I=x||0,W=Math.max(C,Math.min(w,-k.x1)),k.add(-W,0).add(0,m),S&&w0(e,S,W,D,O,1,-1,k);break;case Vi:R=i+v,I=x||0,W=Math.max(C,Math.min(w,k.x2)),k.add(0,0).add(W,m),S&&w0(e,S,W,D,O,1,1,k);break;case ds:R=x||0,I=o+v,W=Math.max(C,Math.min(w,k.y2)),k.add(0,0).add(m,W),S&&w0(e,S,W,D,0,0,1,k);break;default:R=a.x,I=a.y}return Mt(k.translate(R,I),a),ca(a,"x",R+f)|ca(a,"y",I+f)&&(a.bounds=fn,e.dirty(a),a.bounds=k,e.dirty(a)),a.mark.bounds.clear().union(k)}function w0(e,t,i,o,a,l,f,h){const g=t.bounds;if(t.auto){const m=f*(i+a+o);let v=0,x=0;e.dirty(t),l?v=(t.x||0)-(t.x=m):x=(t.y||0)-(t.y=m),t.mark.bounds.clear().union(g.translate(-v,-x)),e.dirty(t)}h.union(g)}const D0=(e,t)=>Math.floor(Math.min(e,t)),rc=(e,t)=>Math.ceil(Math.max(e,t));function a3(e){var t=e.items,i=t.length,o=0,a,l;const f={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};for(;o<i;++o)if(a=t[o],l=a.items,a.marktype===ec)switch(a.role){case p0:case hs:case Jv:break;case Cd:f.rowheaders.push(...l);break;case tc:f.rowfooters.push(...l);break;case y0:f.colheaders.push(...l);break;case v0:f.colfooters.push(...l);break;case m0:f.rowtitle=l[0];break;case eb:f.coltitle=l[0];break;default:f.marks.push(...l)}return f}function ub(e){return new Dt().set(0,0,e.width||0,e.height||0)}function u3(e){const t=e.bounds.clone();return t.empty()?t.set(0,0,0,0):t.translate(-(e.x||0),-(e.y||0))}function Rt(e,t,i){const o=(0,b.Gv)(e)?e[t]:e;return o??(i!==void 0?i:0)}function k0(e){return e<0?Math.ceil(-e):0}function lb(e,t,i){var o=!i.nodirty,a=i.bounds===Fd?ub:u3,l=fn.set(0,0,0,0),f=Rt(i.align,gs),h=Rt(i.align,ps),g=Rt(i.padding,gs),m=Rt(i.padding,ps),v=i.columns||t.length,x=v<=0?1:Math.ceil(t.length/v),C=t.length,w=Array(C),S=Array(v),D=0,k=Array(C),O=Array(x),R=0,I=Array(C),V=Array(C),W=Array(C),ee,M,J,ue,ge,Le,Xe,_t,bt,Ye,et;for(M=0;M<v;++M)S[M]=0;for(M=0;M<x;++M)O[M]=0;for(M=0;M<C;++M)Le=t[M],ge=W[M]=a(Le),Le.x=Le.x||0,I[M]=0,Le.y=Le.y||0,V[M]=0,J=M%v,ue=~~(M/v),D=Math.max(D,Xe=Math.ceil(ge.x2)),R=Math.max(R,_t=Math.ceil(ge.y2)),S[J]=Math.max(S[J],Xe),O[ue]=Math.max(O[ue],_t),w[M]=g+k0(ge.x1),k[M]=m+k0(ge.y1),o&&e.dirty(t[M]);for(M=0;M<C;++M)M%v===0&&(w[M]=0),M<v&&(k[M]=0);if(f===nc)for(J=1;J<v;++J){for(et=0,M=J;M<C;M+=v)et<w[M]&&(et=w[M]);for(M=J;M<C;M+=v)w[M]=et+S[J-1]}else if(f===Sd){for(et=0,M=0;M<C;++M)M%v&&et<w[M]&&(et=w[M]);for(M=0;M<C;++M)M%v&&(w[M]=et+D)}else for(f=!1,J=1;J<v;++J)for(M=J;M<C;M+=v)w[M]+=S[J-1];if(h===nc)for(ue=1;ue<x;++ue){for(et=0,M=ue*v,ee=M+v;M<ee;++M)et<k[M]&&(et=k[M]);for(M=ue*v;M<ee;++M)k[M]=et+O[ue-1]}else if(h===Sd){for(et=0,M=v;M<C;++M)et<k[M]&&(et=k[M]);for(M=v;M<C;++M)k[M]=et+R}else for(h=!1,ue=1;ue<x;++ue)for(M=ue*v,ee=M+v;M<ee;++M)k[M]+=O[ue-1];for(bt=0,M=0;M<C;++M)bt=w[M]+(M%v?bt:0),I[M]+=bt-t[M].x;for(J=0;J<v;++J)for(Ye=0,M=J;M<C;M+=v)Ye+=k[M],V[M]+=Ye-t[M].y;if(f&&Rt(i.center,gs)&&x>1)for(M=0;M<C;++M)ge=f===Sd?D:S[M%v],bt=ge-W[M].x2-t[M].x-I[M],bt>0&&(I[M]+=bt/2);if(h&&Rt(i.center,ps)&&v!==1)for(M=0;M<C;++M)ge=h===Sd?R:O[~~(M/v)],Ye=ge-W[M].y2-t[M].y-V[M],Ye>0&&(V[M]+=Ye/2);for(M=0;M<C;++M)l.union(W[M].translate(I[M],V[M]));switch(bt=Rt(i.anchor,Zv),Ye=Rt(i.anchor,Jl),Rt(i.anchor,gs)){case Xt:bt-=l.width();break;case Zl:bt-=l.width()/2}switch(Rt(i.anchor,ps)){case Xt:Ye-=l.height();break;case Zl:Ye-=l.height()/2}for(bt=Math.round(bt),Ye=Math.round(Ye),l.clear(),M=0;M<C;++M)t[M].mark.bounds.clear();for(M=0;M<C;++M)Le=t[M],Le.x+=I[M]+=bt,Le.y+=V[M]+=Ye,l.union(Le.mark.bounds.union(Le.bounds.translate(I[M],V[M]))),o&&e.dirty(Le);return l}function GS(e,t,i){var o=a3(t),a=o.marks,l=i.bounds===Fd?cb:fb,f=i.offset,h=i.columns||a.length,g=h<=0?1:Math.ceil(a.length/h),m=g*h,v,x,C,w,S,D,k;const O=lb(e,a,i);O.empty()&&O.set(0,0,0,0),o.rowheaders&&(D=Rt(i.headerBand,ps,null),v=$0(e,o.rowheaders,a,h,g,-Rt(f,"rowHeader"),D0,0,l,"x1",0,h,1,D)),o.colheaders&&(D=Rt(i.headerBand,gs,null),x=$0(e,o.colheaders,a,h,h,-Rt(f,"columnHeader"),D0,1,l,"y1",0,1,h,D)),o.rowfooters&&(D=Rt(i.footerBand,ps,null),C=$0(e,o.rowfooters,a,h,g,Rt(f,"rowFooter"),rc,0,l,"x2",h-1,h,1,D)),o.colfooters&&(D=Rt(i.footerBand,gs,null),w=$0(e,o.colfooters,a,h,h,Rt(f,"columnFooter"),rc,1,l,"y2",m-h,1,h,D)),o.rowtitle&&(S=Rt(i.titleAnchor,ps),k=Rt(f,"rowTitle"),k=S===Xt?C+k:v-k,D=Rt(i.titleBand,ps,.5),db(e,o.rowtitle,k,0,O,D)),o.coltitle&&(S=Rt(i.titleAnchor,gs),k=Rt(f,"columnTitle"),k=S===Xt?w+k:x-k,D=Rt(i.titleBand,gs,.5),db(e,o.coltitle,k,1,O,D))}function cb(e,t){return t==="x1"?e.x||0:t==="y1"?e.y||0:t==="x2"?(e.x||0)+(e.width||0):t==="y2"?(e.y||0)+(e.height||0):void 0}function fb(e,t){return e.bounds[t]}function $0(e,t,i,o,a,l,f,h,g,m,v,x,C,w){var S=i.length,D=0,k=0,O,R,I,V,W,ee,M,J,ue;if(!S)return D;for(O=v;O<S;O+=x)i[O]&&(D=f(D,g(i[O],m)));if(!t.length)return D;for(t.length>a&&(e.warn("Grid headers exceed limit: "+a),t=t.slice(0,a)),D+=l,R=0,V=t.length;R<V;++R)e.dirty(t[R]),t[R].mark.bounds.clear();for(O=v,R=0,V=t.length;R<V;++R,O+=x){for(ee=t[R],W=ee.mark.bounds,I=O;I>=0&&(M=i[I])==null;I-=C);h?(J=w==null?M.x:Math.round(M.bounds.x1+w*M.bounds.width()),ue=D):(J=D,ue=w==null?M.y:Math.round(M.bounds.y1+w*M.bounds.height())),W.union(ee.bounds.translate(J-(ee.x||0),ue-(ee.y||0))),ee.x=J,ee.y=ue,e.dirty(ee),k=f(k,W[m])}return k}function db(e,t,i,o,a,l){if(t){e.dirty(t);var f=i,h=i;o?f=Math.round(a.x1+l*a.width()):h=Math.round(a.y1+l*a.height()),t.bounds.translate(f-(t.x||0),h-(t.y||0)),t.mark.bounds.clear().union(t.bounds),t.x=f,t.y=h,e.dirty(t)}}function hb(e,t){const i=e[t]||{};return(o,a)=>i[o]!=null?i[o]:e[o]!=null?e[o]:a}function gb(e,t){let i=-1/0;return e.forEach(o=>{o.offset!=null&&(i=Math.max(i,o.offset))}),i>-1/0?i:t}function pb(e,t,i,o,a,l,f){const h=hb(i,t),g=gb(e,h("offset",0)),m=h("anchor",Ql),v=m===Xt?1:m===Zl?.5:0,x={align:nc,bounds:h("bounds",Fd),columns:h("direction")==="vertical"?1:e.length,padding:h("margin",8),center:h("center"),nodirty:!0};switch(t){case Sr:x.anchor={x:Math.floor(o.x1)-g,column:Xt,y:v*(f||o.height()+2*o.y1),row:m};break;case Vi:x.anchor={x:Math.ceil(o.x2)+g,y:v*(f||o.height()+2*o.y1),row:m};break;case gu:x.anchor={y:Math.floor(a.y1)-g,row:Xt,x:v*(l||a.width()+2*a.x1),column:m};break;case ds:x.anchor={y:Math.ceil(a.y2)+g,x:v*(l||a.width()+2*a.x1),column:m};break;case BS:x.anchor={x:g,y:g};break;case g0:x.anchor={x:l-g,y:g,column:Xt};break;case o3:x.anchor={x:g,y:f-g,row:Xt};break;case Ao:x.anchor={x:l-g,y:f-g,column:Xt,row:Xt};break}return x}function l3(e,t){var i=t.items[0],o=i.datum,a=i.orient,l=i.bounds,f=i.x,h=i.y,g,m;return i._bounds?i._bounds.clear().union(l):i._bounds=l.clone(),l.clear(),mb(e,i,i.items[0].items[0]),l=WS(i,l),g=2*i.padding,m=2*i.padding,l.empty()||(g=Math.ceil(l.width()+g),m=Math.ceil(l.height()+m)),o.type===PS&&VS(i.items[0].items[0].items[0].items),a!==yn&&(i.x=f=0,i.y=h=0),i.width=g,i.height=m,Mt(l.set(f,h,f+g,h+m),i),i.mark.bounds.clear().union(l),i}function WS(e,t){return e.items.forEach(i=>t.union(i.bounds)),t.x1=e.padding,t.y1=e.padding,t}function mb(e,t,i){var o=t.padding,a=o-i.x,l=o-i.y;if(!t.datum.title)(a||l)&&Si(e,i,a,l);else{var f=t.items[1].items[0],h=f.anchor,g=t.titlePadding||0,m=o-f.x,v=o-f.y;switch(f.orient){case Sr:a+=Math.ceil(f.bounds.width())+g;break;case Vi:case ds:break;default:l+=f.bounds.height()+g}switch((a||l)&&Si(e,i,a,l),f.orient){case Sr:v+=Hi(t,i,f,h,1,1);break;case Vi:m+=Hi(t,i,f,Xt,0,0)+g,v+=Hi(t,i,f,h,1,1);break;case ds:m+=Hi(t,i,f,h,0,0),v+=Hi(t,i,f,Xt,-1,0,1)+g;break;default:m+=Hi(t,i,f,h,0,0)}(m||v)&&Si(e,f,m,v),(m=Math.round(f.bounds.x1-o))<0&&(Si(e,i,-m,0),Si(e,f,-m,0))}}function Hi(e,t,i,o,a,l,f){const h=e.datum.type!=="symbol",g=i.datum.vgrad,m=h&&(l||!g)&&!f?t.items[0]:t,v=m.bounds[a?"y2":"x2"]-e.padding,x=g&&l?v:0,C=g&&l?0:v,w=a<=0?0:Ui(i);return Math.round(o===Ql?x:o===Xt?C-w:.5*(v-w))}function Si(e,t,i,o){t.x+=i,t.y+=o,t.bounds.translate(i,o),t.mark.bounds.translate(i,o),e.dirty(t)}function VS(e){const t=e.reduce((i,o)=>(i[o.column]=Math.max(o.bounds.x2-o.x,i[o.column]||0),i),{});e.forEach(i=>{i.width=t[i.column],i.height=i.bounds.y2-i.y})}function c3(e,t,i,o,a){var l=t.items[0],f=l.frame,h=l.orient,g=l.anchor,m=l.offset,v=l.padding,x=l.items[0].items[0],C=l.items[1]&&l.items[1].items[0],w=h===Sr||h===Vi?o:i,S=0,D=0,k=0,O=0,R=0,I;if(f!==ec?h===Sr?(S=a.y2,w=a.y1):h===Vi?(S=a.y1,w=a.y2):(S=a.x1,w=a.x2):h===Sr&&(S=o,w=0),I=g===Ql?S:g===Xt?w:(S+w)/2,C&&C.text){switch(h){case gu:case ds:R=x.bounds.height()+v;break;case Sr:O=x.bounds.width()+v;break;case Vi:O=-x.bounds.width()-v;break}fn.clear().union(C.bounds),fn.translate(O-(C.x||0),R-(C.y||0)),ca(C,"x",O)|ca(C,"y",R)&&(e.dirty(C),C.bounds.clear().union(fn),C.mark.bounds.clear().union(fn),e.dirty(C)),fn.clear().union(C.bounds)}else fn.clear();switch(fn.union(x.bounds),h){case gu:D=I,k=a.y1-fn.height()-m;break;case Sr:D=a.x1-fn.width()-m,k=I;break;case Vi:D=a.x2+fn.width()+m,k=I;break;case ds:D=I,k=a.y2+m;break;default:D=l.x,k=l.y}return ca(l,"x",D)|ca(l,"y",k)&&(fn.translate(D,k),e.dirty(l),l.bounds.clear().union(fn),t.bounds.clear().union(fn),e.dirty(l)),l.bounds}function O0(e){q.call(this,null,e)}(0,b.B)(O0,q,{transform(e,t){const i=t.dataflow;return e.mark.items.forEach(o=>{e.layout&&GS(i,o,e.layout),HS(i,o,e)}),wd(e.mark.group)?t.reflow():t}});function wd(e){return e&&e.mark.role!=="legend-entry"}function HS(e,t,i){var o=t.items,a=Math.max(0,t.width||0),l=Math.max(0,t.height||0),f=new Dt().set(0,0,a,l),h=f.clone(),g=f.clone(),m=[],v,x,C,w,S,D;for(S=0,D=o.length;S<D;++S)switch(x=o[S],x.role){case p0:w=F0(x)?h:g,w.union(ab(e,x,a,l));break;case Jv:v=x;break;case hs:m.push(l3(e,x));break;case LS:case zS:case Cd:case tc:case m0:case y0:case v0:case eb:h.union(x.bounds),g.union(x.bounds);break;default:f.union(x.bounds)}if(m.length){const k={};m.forEach(O=>{C=O.orient||Vi,C!==yn&&(k[C]||(k[C]=[])).push(O)});for(const O in k){const R=k[O];lb(e,R,pb(R,O,i.legends,h,g,a,l))}m.forEach(O=>{const R=O.bounds;if(R.equals(O._bounds)||(O.bounds=O._bounds,e.dirty(O),O.bounds=R,e.dirty(O)),i.autosize&&(i.autosize.type===cn||i.autosize.type===b0||i.autosize.type===tb))switch(O.orient){case Sr:case Vi:f.add(R.x1,0).add(R.x2,0);break;case gu:case ds:f.add(0,R.y1).add(0,R.y2)}else f.union(R)})}f.union(h).union(g),v&&f.union(c3(e,v,a,l,f)),t.clip&&f.set(0,0,t.width||0,t.height||0),fa(e,t,f,i)}function fa(e,t,i,o){const a=o.autosize||{},l=a.type;if(e._autosize<1||!l)return;let f=e._width,h=e._height,g=Math.max(0,t.width||0),m=Math.max(0,Math.ceil(-i.x1)),v=Math.max(0,t.height||0),x=Math.max(0,Math.ceil(-i.y1));const C=Math.max(0,Math.ceil(i.x2-g)),w=Math.max(0,Math.ceil(i.y2-v));if(a.contains===IS){const S=e.padding();f-=S.left+S.right,h-=S.top+S.bottom}l===yn?(m=0,x=0,g=f,v=h):l===cn?(g=Math.max(0,f-m-C),v=Math.max(0,h-x-w)):l===b0?(g=Math.max(0,f-m-C),h=v+x+w):l===tb?(f=g+m+C,v=Math.max(0,h-x-w)):l===pu&&(f=g+m+C,h=v+x+w),e._resizeView(f,h,g,v,[m,x],a.resize)}var Dd=z(42843),yb=z(64361),qr=z(21844);function oc(e){q.call(this,null,e)}(0,b.B)(oc,q,{transform(e,t){if(this.value&&!e.modified())return t.StopPropagation;var i=t.dataflow.locale(),o=t.fork(t.NO_SOURCE|t.NO_FIELDS),a=this.value,l=e.scale,f=e.count==null?e.values?e.values.length:10:e.count,h=rp(l,f,e.minstep),g=e.format||DC(i,l,h,e.formatSpecifier,e.formatType,!!e.values),m=e.values?op(l,e.values,h):$y(l,h);return a&&(o.rem=a),a=m.map((v,x)=>Se({index:x/(m.length-1||1),value:v,label:g(v)})),e.extra&&a.length&&a.push(Se({index:-1,extra:{value:a[0].value},label:""})),o.source=a,o.add=a,this.value=a,o}});function vb(e){q.call(this,null,e)}function qS(){return Se({})}function XS(e){const t=(0,b.nG)().test(i=>i.exit);return t.lookup=i=>t.get(e(i)),t}(0,b.B)(vb,q,{transform(e,t){var i=t.dataflow,o=t.fork(t.NO_SOURCE|t.NO_FIELDS),a=e.item||qS,l=e.key||we,f=this.value;return(0,b.cy)(o.encode)&&(o.encode=null),f&&(e.modified("key")||t.modified(l))&&(0,b.z3)("DataJoin does not support modified key function or fields."),f||(t=t.addAll(),this.value=f=XS(l)),t.visit(t.ADD,h=>{const g=l(h);let m=f.get(g);m?m.exit?(f.empty--,o.add.push(m)):o.mod.push(m):(m=a(h),f.set(g,m),o.add.push(m)),m.datum=h,m.exit=!1}),t.visit(t.MOD,h=>{const g=l(h),m=f.get(g);m&&(m.datum=h,o.mod.push(m))}),t.visit(t.REM,h=>{const g=l(h),m=f.get(g);h===m.datum&&!m.exit&&(o.rem.push(m),m.exit=!0,++f.empty)}),t.changed(t.ADD_MOD)&&o.modifies("datum"),(t.clean()||e.clean&&f.empty>i.cleanThreshold)&&i.runAfter(f.clean),o}});function bb(e){q.call(this,null,e)}(0,b.B)(bb,q,{transform(e,t){var i=t.fork(t.ADD_REM),o=e.mod||!1,a=e.encoders,l=t.encode;if((0,b.cy)(l))if(i.changed()||l.every(x=>a[x]))l=l[0],i.encode=null;else return t.StopPropagation;var f=l==="enter",h=a.update||b.me,g=a.enter||b.me,m=a.exit||b.me,v=(l&&!f?a[l]:h)||b.me;if(t.changed(t.ADD)&&(t.visit(t.ADD,x=>{g(x,e),h(x,e)}),i.modifies(g.output),i.modifies(h.output),v!==b.me&&v!==h&&(t.visit(t.ADD,x=>{v(x,e)}),i.modifies(v.output))),t.changed(t.REM)&&m!==b.me&&(t.visit(t.REM,x=>{m(x,e)}),i.modifies(m.output)),f||v!==b.me){const x=t.MOD|(e.modified()?t.REFLOW:0);f?(t.visit(x,C=>{const w=g(C,e)||o;(v(C,e)||w)&&i.mod.push(C)}),i.mod.length&&i.modifies(g.output)):t.visit(x,C=>{(v(C,e)||o)&&i.mod.push(C)}),i.mod.length&&i.modifies(v.output)}return i.changed()?i:t.StopPropagation}});function xb(e){q.call(this,[],e)}(0,b.B)(xb,q,{transform(e,t){if(this.value!=null&&!e.modified())return t.StopPropagation;var i=t.dataflow.locale(),o=t.fork(t.NO_SOURCE|t.NO_FIELDS),a=this.value,l=e.type||pi,f=e.scale,h=+e.limit,g=rp(f,e.count==null?5:e.count,e.minstep),m=!!e.values||l===pi,v=e.format||ap(i,f,g,l,e.formatSpecifier,e.formatType,m),x=e.values||OC(f,g),C,w,S,D,k;return a&&(o.rem=a),l===pi?(h&&x.length>h?(t.dataflow.warn("Symbol legend count exceeds limit, filtering items."),a=x.slice(0,h-1),k=!0):a=x,(0,b.Tn)(S=e.size)?(!e.values&&f(a[0])===0&&(a=a.slice(1)),D=a.reduce((O,R)=>Math.max(O,S(R,e)),0)):S=(0,b.dY)(D=S||8),a=a.map((O,R)=>Se({index:R,label:v(O,R,a),value:O,offset:D,size:S(O,e)})),k&&(k=x[a.length],a.push(Se({index:a.length,label:`\u2026${x.length-a.length} entries`,value:k,offset:D,size:S(k,e)})))):l===SC?(C=f.domain(),w=ip(f,C[0],(0,b.se)(C)),x.length<3&&!e.values&&C[0]!==(0,b.se)(C)&&(x=[C[0],(0,b.se)(C)]),a=x.map((O,R)=>Se({index:R,label:v(O,R,x),value:O,perc:w(O)}))):(S=x.length-1,w=_f(f),a=x.map((O,R)=>Se({index:R,label:v(O,R,x),value:O,perc:R?w(O):0,perc2:R===S?1:w(x[R+1])}))),o.source=a,o.add=a,this.value=a,o}});const YS=e=>e.source.x,KS=e=>e.source.y,QS=e=>e.target.x,ZS=e=>e.target.y;function T0(e){q.call(this,{},e)}T0.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]},(0,b.B)(T0,q,{transform(e,t){var i=e.sourceX||YS,o=e.sourceY||KS,a=e.targetX||QS,l=e.targetY||ZS,f=e.as||"path",h=e.orient||"vertical",g=e.shape||"line",m=So.get(g+"-"+h)||So.get(g);return m||(0,b.z3)("LinkPath unsupported type: "+e.shape+(e.orient?"-"+e.orient:"")),t.visit(t.SOURCE,v=>{v[f]=m(i(v),o(v),a(v),l(v))}),t.reflow(e.modified()).modifies(f)}});const Eb=(e,t,i,o)=>"M"+e+","+t+"L"+i+","+o,JS=(e,t,i,o)=>Eb(t*Math.cos(e),t*Math.sin(e),o*Math.cos(i),o*Math.sin(i)),qi=(e,t,i,o)=>{var a=i-e,l=o-t,f=Math.hypot(a,l)/2,h=180*Math.atan2(l,a)/Math.PI;return"M"+e+","+t+"A"+f+","+f+" "+h+" 0 1 "+i+","+o},eF=(e,t,i,o)=>qi(t*Math.cos(e),t*Math.sin(e),o*Math.cos(i),o*Math.sin(i)),Fr=(e,t,i,o)=>{const a=i-e,l=o-t,f=.2*(a+l),h=.2*(l-a);return"M"+e+","+t+"C"+(e+f)+","+(t+h)+" "+(i+h)+","+(o-f)+" "+i+","+o},Ee=(e,t,i,o)=>Fr(t*Math.cos(e),t*Math.sin(e),o*Math.cos(i),o*Math.sin(i)),Q=(e,t,i,o)=>"M"+e+","+t+"V"+o+"H"+i,kn=(e,t,i,o)=>"M"+e+","+t+"H"+i+"V"+o,gt=(e,t,i,o)=>{const a=Math.cos(e),l=Math.sin(e),f=Math.cos(i),h=Math.sin(i),g=Math.abs(i-e)>Math.PI?i<=e:i>e;return"M"+t*a+","+t*l+"A"+t+","+t+" 0 0,"+(g?1:0)+" "+t*f+","+t*h+"L"+o*f+","+o*h},kd=(e,t,i,o)=>{const a=(e+i)/2;return"M"+e+","+t+"C"+a+","+t+" "+a+","+o+" "+i+","+o},sc=(e,t,i,o)=>{const a=(t+o)/2;return"M"+e+","+t+"C"+e+","+a+" "+i+","+a+" "+i+","+o},da=(e,t,i,o)=>{const a=Math.cos(e),l=Math.sin(e),f=Math.cos(i),h=Math.sin(i),g=(t+o)/2;return"M"+t*a+","+t*l+"C"+g*a+","+g*l+" "+g*f+","+g*h+" "+o*f+","+o*h},So=(0,b.nG)({line:Eb,"line-radial":JS,arc:qi,"arc-radial":eF,curve:Fr,"curve-radial":Ee,"orthogonal-horizontal":Q,"orthogonal-vertical":kn,"orthogonal-radial":gt,"diagonal-horizontal":kd,"diagonal-vertical":sc,"diagonal-radial":da});function mu(e){q.call(this,null,e)}mu.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]},(0,b.B)(mu,q,{transform(e,t){var i=e.as||["startAngle","endAngle"],o=i[0],a=i[1],l=e.field||b.xH,f=e.startAngle||0,h=e.endAngle!=null?e.endAngle:2*Math.PI,g=t.source,m=g.map(l),v=m.length,x=f,C=(h-f)/(0,Dd.A)(m),w=(0,nt.A)(v),S,D,k;for(e.sort&&w.sort((O,R)=>m[O]-m[R]),S=0;S<v;++S)k=m[w[S]],D=g[w[S]],D[o]=x,D[a]=x+=k*C;return this.value=m,t.reflow(e.modified()).modifies(i)}});const ha=5;function ri(e){const t=e.type;return!e.bins&&(t===Mi||t===Df||t===Hs)}function yu(e){return yl(e)&&e!==dr}const tF=(0,b.M1)(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function Ab(e){q.call(this,null,e),this.modified(!0)}(0,b.B)(Ab,q,{transform(e,t){var i=t.dataflow,o=this.value,a=nF(e);(!o||a!==o.type)&&(this.value=o=it(a)());for(a in e)if(!tF[a]){if(a==="padding"&&yu(o.type))continue;(0,b.Tn)(o[a])?o[a](e[a]):i.warn("Unsupported scale property: "+a)}return aF(o,e,sF(o,e,rF(o,e,i))),t.fork(t.NO_SOURCE|t.NO_FIELDS)}});function nF(e){var t=e.type,i="",o;return t===dr?dr+"-"+Mi:(iF(e)&&(o=e.rawDomain?e.rawDomain.length:e.domain?e.domain.length+ +(e.domainMid!=null):0,i=o===2?dr+"-":o===3?Xs+"-":""),(i+t||Mi).toLowerCase())}function iF(e){const t=e.type;return yl(t)&&t!==qs&&t!==jr&&(e.scheme||e.range&&e.range.length&&e.range.every(b.Kg))}function rF(e,t,i){const o=Cb(e,t.domainRaw,i);if(o>-1)return o;var a=t.domain,l=e.type,f=t.zero||t.zero===void 0&&ri(e),h,g;if(!a)return 0;if((f||t.domainMin!=null||t.domainMax!=null||t.domainMid!=null)&&(h=(a=a.slice()).length-1||1,f&&(a[0]>0&&(a[0]=0),a[h]<0&&(a[h]=0)),t.domainMin!=null&&(a[0]=t.domainMin),t.domainMax!=null&&(a[h]=t.domainMax),t.domainMid!=null)){g=t.domainMid;const m=g>a[h]?h+1:g<a[0]?0:h;m!==h&&i.warn("Scale domainMid exceeds domain min or max.",g),a.splice(m,0,g)}return yu(l)&&t.padding&&a[0]!==(0,b.se)(a)&&(a=oF(l,a,t.range,t.padding,t.exponent,t.constant)),e.domain(Sb(l,a,i)),l===qt&&e.unknown(t.domainImplicit?qg.h:void 0),t.nice&&e.nice&&e.nice(t.nice!==!0&&rp(e,t.nice)||null),a.length}function Cb(e,t,i){return t?(e.domain(Sb(e.type,t,i)),t.length):-1}function oF(e,t,i,o,a,l){var f=Math.abs((0,b.se)(i)-i[0]),h=f/(f-2*o),g=e===Ur?(0,b.oV)(t,null,h):e===Hs?(0,b.SW)(t,null,h,.5):e===Df?(0,b.SW)(t,null,h,a||1):e===kf?(0,b.B2)(t,null,h,l||1):(0,b.lL)(t,null,h);return t=t.slice(),t[0]=g[0],t[t.length-1]=g[1],t}function Sb(e,t,i){if(Ks(e)){var o=Math.abs(t.reduce((a,l)=>a+(l<0?-1:l>0?1:0),0));o!==t.length&&i.warn("Log scale domain includes zero: "+(0,b.r$)(t))}return t}function sF(e,t,i){let o=t.bins;if(o&&!(0,b.cy)(o)){const a=e.domain(),l=a[0],f=(0,b.se)(a),h=o.step;let g=o.start==null?l:o.start,m=o.stop==null?f:o.stop;h||(0,b.z3)("Scale bins parameter missing step property."),g<l&&(g=h*Math.ceil(l/h)),m>f&&(m=h*Math.floor(f/h)),o=(0,nt.A)(g,m+h/2,h)}return o?e.bins=o:e.bins&&delete e.bins,e.type===Zg&&(o?!t.domain&&!t.domainRaw&&(e.domain(o),i=o.length):e.bins=e.domain()),i}function aF(e,t,i){var o=e.type,a=t.round||!1,l=t.range;if(t.rangeStep!=null)l=uF(o,t,i);else if(t.scheme&&(l=lF(o,t,i),(0,b.Tn)(l))){if(e.interpolator)return e.interpolator(l);(0,b.z3)(`Scale type ${o} does not support interpolating color schemes.`)}if(l&&Cy(o))return e.interpolator(Rf(R0(l,t.reverse),t.interpolate,t.interpolateGamma));l&&t.interpolate&&e.interpolate?e.interpolate(Nf(t.interpolate,t.interpolateGamma)):(0,b.Tn)(e.round)?e.round(a):(0,b.Tn)(e.rangeRound)&&e.interpolate(a?yb.A:qr.A),l&&e.range(R0(l,t.reverse))}function uF(e,t,i){e!==Qg&&e!==Kg&&(0,b.z3)("Only band and point scales support rangeStep.");var o=(t.paddingOuter!=null?t.paddingOuter:t.padding)||0,a=e===Kg?1:(t.paddingInner!=null?t.paddingInner:t.padding)||0;return[0,t.rangeStep*by(i,a,o)]}function lF(e,t,i){var o=t.schemeExtent,a,l;return(0,b.cy)(t.scheme)?l=Rf(t.scheme,t.interpolate,t.interpolateGamma):(a=t.scheme.toLowerCase(),l=gi(a),l||(0,b.z3)(`Unrecognized scheme name: ${t.scheme}`)),i=e===$f?i+1:e===Zg?i-1:e===Xa||e===fl?+t.schemeCount||ha:i,Cy(e)?nn(l,o,t.reverse):(0,b.Tn)(l)?Sy(nn(l,o),i):e===qt?l:l.slice(0,i)}function nn(e,t,i){return(0,b.Tn)(e)&&(t||i)?xC(e,R0(t||[0,1],i)):e}function R0(e,t){return t?e.slice().reverse():e}function Fb(e){q.call(this,null,e)}(0,b.B)(Fb,q,{transform(e,t){const i=e.modified("sort")||t.changed(t.ADD)||t.modified(e.sort.fields)||t.modified("datum");return i&&t.source.sort(Lr(e.sort)),this.modified(i),t}});const wb="zero",Db="center",kb="normalize",$d=["y0","y1"];function ac(e){q.call(this,null,e)}ac.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:wb,values:[wb,Db,kb]},{name:"as",type:"string",array:!0,length:2,default:$d}]},(0,b.B)(ac,q,{transform(e,t){var i=e.as||$d,o=i[0],a=i[1],l=Lr(e.sort),f=e.field||b.xH,h=e.offset===Db?$b:e.offset===kb?cF:vn,g,m,v,x;for(g=uc(t.source,e.groupby,l,f),m=0,v=g.length,x=g.max;m<v;++m)h(g[m],x,f,o,a);return t.reflow(e.modified()).modifies(i)}});function $b(e,t,i,o,a){for(var l=(t-e.sum)/2,f=e.length,h=0,g;h<f;++h)g=e[h],g[o]=l,g[a]=l+=Math.abs(i(g))}function cF(e,t,i,o,a){for(var l=1/e.sum,f=0,h=e.length,g=0,m=0,v;g<h;++g)v=e[g],v[o]=f,v[a]=f=l*(m+=Math.abs(i(v)))}function vn(e,t,i,o,a){for(var l=0,f=0,h=e.length,g=0,m,v;g<h;++g)v=e[g],m=+i(v),m<0?(v[o]=f,v[a]=f+=m):(v[o]=l,v[a]=l+=m)}function uc(e,t,i,o){var a=[],l=D=>D(v),f,h,g,m,v,x,C,w,S;if(t==null)a.push(e.slice());else for(f={},h=0,g=e.length;h<g;++h)v=e[h],x=t.map(l),C=f[x],C||(f[x]=C=[],a.push(C)),C.push(v);for(x=0,S=0,m=a.length;x<m;++x){for(C=a[x],h=0,w=0,g=C.length;h<g;++h)w+=Math.abs(o(C[h]));C.sum=w,w>S&&(S=w),i&&C.sort(i)}return a.max=S,a}var Ob=z(4149),fF=z(53876),Od=z(7981),Fo=z(55917),N0=z(73529),lc=z(1832),dF=z(54823),cc=z(38714),fc=z(66043),Td=z(84631),hF=z(15927),Tb=z(6909),_0=z(41406),gF=z(31689),Rb=z(28121),pF=z(34231),mF=z(51645),M0=z(410);const yF=(0,Ob.A)(),B0=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function Nb(e,t){return function i(){const o=t();return o.type=e,o.path=(0,Ob.A)().projection(o),o.copy=o.copy||function(){const a=i();return B0.forEach(l=>{o[l]&&a[l](o[l]())}),a.path.pointRadius(o.path.pointRadius()),a},Ay(o)}}function L0(e,t){if(!e||typeof e!="string")throw new Error("Projection type must be a name string.");return e=e.toLowerCase(),arguments.length>1?(Rd[e]=Nb(e,t),this):Rd[e]||null}function _b(e){return e&&e.path||yF}const Rd={albers:fF.A,albersusa:Od.A,azimuthalequalarea:Fo.A,azimuthalequidistant:N0.A,conicconformal:lc.A,conicequalarea:dF.A,conicequidistant:cc.A,equalEarth:fc.A,equirectangular:Td.A,gnomonic:hF.A,identity:Tb.A,mercator:_0.Ay,mollweide:M0.Ay,naturalEarth1:gF.A,orthographic:Rb.A,stereographic:pF.A,transversemercator:mF.A};for(const e in Rd)L0(e,Rd[e]);var vF=z(41817),dc=z(33898);function bF(){}const Xr=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function In(){var e=1,t=1,i=h;function o(g,m){return m.map(v=>a(g,v))}function a(g,m){var v=[],x=[];return l(g,m,C=>{i(C,g,m),Mb(C)>0?v.push([C]):x.push(C)}),x.forEach(C=>{for(var w=0,S=v.length,D;w<S;++w)if(xF((D=v[w])[0],C)!==-1){D.push(C);return}}),{type:"MultiPolygon",value:m,coordinates:v}}function l(g,m,v){var x=[],C=[],w,S,D,k,O,R;for(w=S=-1,k=g[0]>=m,Xr[k<<1].forEach(I);++w<e-1;)D=k,k=g[w+1]>=m,Xr[D|k<<1].forEach(I);for(Xr[k<<0].forEach(I);++S<t-1;){for(w=-1,k=g[S*e+e]>=m,O=g[S*e]>=m,Xr[k<<1|O<<2].forEach(I);++w<e-1;)D=k,k=g[S*e+e+w+1]>=m,R=O,O=g[S*e+w+1]>=m,Xr[D|k<<1|O<<2|R<<3].forEach(I);Xr[k|O<<3].forEach(I)}for(w=-1,O=g[S*e]>=m,Xr[O<<2].forEach(I);++w<e-1;)R=O,O=g[S*e+w+1]>=m,Xr[O<<2|R<<3].forEach(I);Xr[O<<3].forEach(I);function I(V){var W=[V[0][0]+w,V[0][1]+S],ee=[V[1][0]+w,V[1][1]+S],M=f(W),J=f(ee),ue,ge;(ue=C[M])?(ge=x[J])?(delete C[ue.end],delete x[ge.start],ue===ge?(ue.ring.push(ee),v(ue.ring)):x[ue.start]=C[ge.end]={start:ue.start,end:ge.end,ring:ue.ring.concat(ge.ring)}):(delete C[ue.end],ue.ring.push(ee),C[ue.end=J]=ue):(ue=x[J])?(ge=C[M])?(delete x[ue.start],delete C[ge.end],ue===ge?(ue.ring.push(ee),v(ue.ring)):x[ge.start]=C[ue.end]={start:ge.start,end:ue.end,ring:ge.ring.concat(ue.ring)}):(delete x[ue.start],ue.ring.unshift(W),x[ue.start=M]=ue):x[M]=C[J]={start:M,end:J,ring:[W,ee]}}}function f(g){return g[0]*2+g[1]*(e+1)*4}function h(g,m,v){g.forEach(x=>{var C=x[0],w=x[1],S=C|0,D=w|0,k,O=m[D*e+S];C>0&&C<e&&S===C&&(k=m[D*e+S-1],x[0]=C+(v-k)/(O-k)-.5),w>0&&w<t&&D===w&&(k=m[(D-1)*e+S],x[1]=w+(v-k)/(O-k)-.5)})}return o.contour=a,o.size=function(g){if(!arguments.length)return[e,t];var m=Math.floor(g[0]),v=Math.floor(g[1]);return m>=0&&v>=0||(0,b.z3)("invalid size"),e=m,t=v,o},o.smooth=function(g){return arguments.length?(i=g?h:bF,o):i===h},o}function Mb(e){for(var t=0,i=e.length,o=e[i-1][1]*e[0][0]-e[i-1][0]*e[0][1];++t<i;)o+=e[t-1][1]*e[t][0]-e[t-1][0]*e[t][1];return o}function xF(e,t){for(var i=-1,o=t.length,a;++i<o;)if(a=Bb(e,t[i]))return a;return 0}function Bb(e,t){for(var i=t[0],o=t[1],a=-1,l=0,f=e.length,h=f-1;l<f;h=l++){var g=e[l],m=g[0],v=g[1],x=e[h],C=x[0],w=x[1];if(EF(g,x,t))return 0;v>o!=w>o&&i<(C-m)*(o-v)/(w-v)+m&&(a=-a)}return a}function EF(e,t,i){var o;return AF(e,t,i)&&z0(e[o=+(e[0]===t[0])],i[o],t[o])}function AF(e,t,i){return(t[0]-e[0])*(i[1]-e[1])===(i[0]-e[0])*(t[1]-e[1])}function z0(e,t,i){return e<=t&&t<=i||i<=t&&t<=e}function vu(e,t,i){return function(o){var a=(0,b.Xx)(o),l=i?Math.min(a[0],0):a[0],f=a[1],h=f-l,g=t?(0,on.sG)(l,f,e):h/(e+1);return(0,nt.A)(l+g,f,g)}}function Nd(e){q.call(this,null,e)}Nd.Definition={type:"Isocontour",metadata:{generates:!0},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:!0},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:!0},{name:"smooth",type:"boolean",default:!0},{name:"scale",type:"number",expr:!0},{name:"translate",type:"number",array:!0,expr:!0},{name:"as",type:"string",null:!0,default:"contour"}]},(0,b.B)(Nd,q,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var i=t.fork(t.NO_SOURCE|t.NO_FIELDS),o=t.materialize(t.SOURCE).source,a=e.field||b.D_,l=In().smooth(e.smooth!==!1),f=e.thresholds||CF(o,a,e),h=e.as===null?null:e.as||"contour",g=[];return o.forEach(m=>{const v=a(m),x=l.size([v.width,v.height])(v.values,(0,b.cy)(f)?f:f(v.values));Lb(x,v,m,e),x.forEach(C=>{g.push(Oi(m,Se(h!=null?{[h]:C}:C)))})}),this.value&&(i.rem=this.value),this.value=i.source=i.add=g,i}});function CF(e,t,i){const o=vu(i.levels||10,i.nice,i.zero!==!1);return i.resolve!=="shared"?o:o(e.map(a=>(0,Va.A)(t(a).values)))}function Lb(e,t,i,o){let a=o.scale||t.scale,l=o.translate||t.translate;if((0,b.Tn)(a)&&(a=a(i,o)),(0,b.Tn)(l)&&(l=l(i,o)),(a===1||a==null)&&!l)return;const f=((0,b.Et)(a)?a:a[0])||1,h=((0,b.Et)(a)?a:a[1])||1,g=l&&l[0]||0,m=l&&l[1]||0;e.forEach(zb(t,f,h,g,m))}function zb(e,t,i,o,a){const l=e.x1||0,f=e.y1||0,h=t*i<0;function g(x){x.forEach(m)}function m(x){h&&x.reverse(),x.forEach(v)}function v(x){x[0]=(x[0]-l)*t+o,x[1]=(x[1]-f)*i+a}return function(x){return x.coordinates.forEach(g),x}}function Je(e,t,i){const o=e>=0?e:M1(t,i);return Math.round((Math.sqrt(4*o*o+1)-1)/2)}function bu(e){return(0,b.Tn)(e)?e:(0,b.dY)(+e)}function bn(){var e=g=>g[0],t=g=>g[1],i=b.xH,o=[-1,-1],a=960,l=500,f=2;function h(g,m){const v=Je(o[0],g,e)>>f,x=Je(o[1],g,t)>>f,C=v?v+2:0,w=x?x+2:0,S=2*C+(a>>f),D=2*w+(l>>f),k=new Float32Array(S*D),O=new Float32Array(S*D);let R=k;g.forEach(V=>{const W=C+(+e(V)>>f),ee=w+(+t(V)>>f);W>=0&&W<S&&ee>=0&&ee<D&&(k[W+ee*S]+=+i(V))}),v>0&&x>0?(ft(S,D,k,O,v),ms(S,D,O,k,x),ft(S,D,k,O,v),ms(S,D,O,k,x),ft(S,D,k,O,v),ms(S,D,O,k,x)):v>0?(ft(S,D,k,O,v),ft(S,D,O,k,v),ft(S,D,k,O,v),R=O):x>0&&(ms(S,D,k,O,x),ms(S,D,O,k,x),ms(S,D,k,O,x),R=O);const I=m?Math.pow(2,-2*f):1/(0,Dd.A)(R);for(let V=0,W=S*D;V<W;++V)R[V]*=I;return{values:R,scale:1<<f,width:S,height:D,x1:C,y1:w,x2:C+(a>>f),y2:w+(l>>f)}}return h.x=function(g){return arguments.length?(e=bu(g),h):e},h.y=function(g){return arguments.length?(t=bu(g),h):t},h.weight=function(g){return arguments.length?(i=bu(g),h):i},h.size=function(g){if(!arguments.length)return[a,l];var m=+g[0],v=+g[1];return m>=0&&v>=0||(0,b.z3)("invalid size"),a=m,l=v,h},h.cellSize=function(g){return arguments.length?((g=+g)>=1||(0,b.z3)("invalid cell size"),f=Math.floor(Math.log(g)/Math.LN2),h):1<<f},h.bandwidth=function(g){return arguments.length?(g=(0,b.YO)(g),g.length===1&&(g=[+g[0],+g[0]]),g.length!==2&&(0,b.z3)("invalid bandwidth"),o=g,h):o},h}function ft(e,t,i,o,a){const l=(a<<1)+1;for(let f=0;f<t;++f)for(let h=0,g=0;h<e+a;++h)h<e&&(g+=i[h+f*e]),h>=a&&(h>=l&&(g-=i[h-l+f*e]),o[h-a+f*e]=g/Math.min(h+1,e-1+l-h,l))}function ms(e,t,i,o,a){const l=(a<<1)+1;for(let f=0;f<e;++f)for(let h=0,g=0;h<t+a;++h)h<t&&(g+=i[f+h*e]),h>=a&&(h>=l&&(g-=i[f+(h-l)*e]),o[f+(h-a)*e]=g/Math.min(h+1,t-1+l-h,l))}function I0(e){q.call(this,null,e)}I0.Definition={type:"KDE2D",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"weight",type:"field"},{name:"groupby",type:"field",array:!0},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:!0,length:2},{name:"counts",type:"boolean",default:!1},{name:"as",type:"string",default:"grid"}]};const Ib=["x","y","weight","size","cellSize","bandwidth"];function Pb(e,t){return Ib.forEach(i=>t[i]!=null?e[i](t[i]):0),e}(0,b.B)(I0,q,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var i=t.fork(t.NO_SOURCE|t.NO_FIELDS),o=t.materialize(t.SOURCE).source,a=SF(o,e.groupby),l=(e.groupby||[]).map(b.N6),f=Pb(bn(),e),h=e.as||"grid",g=[];function m(v,x){for(let C=0;C<l.length;++C)v[l[C]]=x[C];return v}return g=a.map(v=>Se(m({[h]:f(v,e.counts)},v.dims))),this.value&&(i.rem=this.value),this.value=i.source=i.add=g,i}});function SF(e,t){var i=[],o=v=>v(h),a,l,f,h,g,m;if(t==null)i.push(e);else for(a={},l=0,f=e.length;l<f;++l)h=e[l],g=t.map(o),m=a[g],m||(a[g]=m=[],m.dims=g,i.push(m)),m.push(h);return i}function P0(e){q.call(this,null,e)}P0.Definition={type:"Contour",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"values",type:"number",array:!0},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"thresholds",type:"number",array:!0},{name:"smooth",type:"boolean",default:!0}]},(0,b.B)(P0,q,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var i=t.fork(t.NO_SOURCE|t.NO_FIELDS),o=In().smooth(e.smooth!==!1),a=e.values,l=e.thresholds||vu(e.count||10,e.nice,!!a),f=e.size,h,g;return a||(a=t.materialize(t.SOURCE).source,h=Pb(bn(),e)(a,!0),g=zb(h,h.scale||1,h.scale||1,0,0),f=[h.width,h.height],a=h.values),l=(0,b.cy)(l)?l:l(a),a=o.size(f)(a,l),g&&a.forEach(g),this.value&&(i.rem=this.value),this.value=i.source=i.add=(a||[]).map(Se),i}});const U0="Feature",j0="FeatureCollection",FF="MultiPoint";function G0(e){q.call(this,null,e)}G0.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:!0,length:2},{name:"geojson",type:"field"}]},(0,b.B)(G0,q,{transform(e,t){var i=this._features,o=this._points,a=e.fields,l=a&&a[0],f=a&&a[1],h=e.geojson||!a&&b.D_,g=t.ADD,m;m=e.modified()||t.changed(t.REM)||t.modified((0,b.nS)(h))||l&&t.modified((0,b.nS)(l))||f&&t.modified((0,b.nS)(f)),(!this.value||m)&&(g=t.SOURCE,this._features=i=[],this._points=o=[]),h&&t.visit(g,v=>i.push(h(v))),l&&f&&(t.visit(g,v=>{var x=l(v),C=f(v);x!=null&&C!=null&&(x=+x)===x&&(C=+C)===C&&o.push([x,C])}),i=i.concat({type:U0,geometry:{type:FF,coordinates:o}})),this.value={type:j0,features:i}}});function W0(e){q.call(this,null,e)}W0.Definition={type:"GeoPath",metadata:{modifies:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"path"}]},(0,b.B)(W0,q,{transform(e,t){var i=t.fork(t.ALL),o=this.value,a=e.field||b.D_,l=e.as||"path",f=i.SOURCE;!o||e.modified()?(this.value=o=_b(e.projection),i.materialize().reflow()):f=a===b.D_||t.modified(a.fields)?i.ADD_MOD:i.ADD;const h=wF(o,e.pointRadius);return i.visit(f,g=>g[l]=o(a(g))),o.pointRadius(h),i.modifies(l)}});function wF(e,t){const i=e.pointRadius();return e.context(null),t!=null&&e.pointRadius(t),i}function V0(e){q.call(this,null,e)}V0.Definition={type:"GeoPoint",metadata:{modifies:!0},params:[{name:"projection",type:"projection",required:!0},{name:"fields",type:"field",array:!0,required:!0,length:2},{name:"as",type:"string",array:!0,length:2,default:["x","y"]}]},(0,b.B)(V0,q,{transform(e,t){var i=e.projection,o=e.fields[0],a=e.fields[1],l=e.as||["x","y"],f=l[0],h=l[1],g;function m(v){const x=i([o(v),a(v)]);x?(v[f]=x[0],v[h]=x[1]):(v[f]=void 0,v[h]=void 0)}return e.modified()?t=t.materialize().reflow(!0).visit(t.SOURCE,m):(g=t.modified(o.fields)||t.modified(a.fields),t.visit(g?t.ADD_MOD:t.ADD,m)),t.modifies(l)}});function _d(e){q.call(this,null,e)}_d.Definition={type:"GeoShape",metadata:{modifies:!0,nomod:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"shape"}]},(0,b.B)(_d,q,{transform(e,t){var i=t.fork(t.ALL),o=this.value,a=e.as||"shape",l=i.ADD;return(!o||e.modified())&&(this.value=o=Md(_b(e.projection),e.field||(0,b.ZZ)("datum"),e.pointRadius),i.materialize().reflow(),l=i.SOURCE),i.visit(l,f=>f[a]=o),i.modifies(a)}});function Md(e,t,i){const o=i==null?a=>e(t(a)):a=>{var l=e.pointRadius(),f=e.pointRadius(i)(t(a));return e.pointRadius(l),f};return o.context=a=>(e.context(a),o),o}function Bd(e){q.call(this,[],e),this.generator=(0,vF.A)()}Bd.Definition={type:"Graticule",metadata:{changes:!0,generates:!0},params:[{name:"extent",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMajor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMinor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"step",type:"number",array:!0,length:2},{name:"stepMajor",type:"number",array:!0,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:!0,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]},(0,b.B)(Bd,q,{transform(e,t){var i=this.value,o=this.generator,a;if(!i.length||e.modified())for(const l in e)(0,b.Tn)(o[l])&&o[l](e[l]);return a=o(),i.length?t.mod.push(Br(i[0],a)):t.add.push(Se(a)),i[0]=a,t}});function H0(e){q.call(this,null,e)}H0.Definition={type:"heatmap",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:!0},{name:"opacity",type:"number",expr:!0},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]},(0,b.B)(H0,q,{transform(e,t){if(!t.changed()&&!e.modified())return t.StopPropagation;var i=t.materialize(t.SOURCE).source,o=e.resolve==="shared",a=e.field||b.D_,l=q0(e.opacity,e),f=ga(e.color,e),h=e.as||"image",g={$x:0,$y:0,$value:0,$max:o?(0,Va.A)(i.map(m=>(0,Va.A)(a(m).values))):0};return i.forEach(m=>{const v=a(m),x=(0,b.X$)({},m,g);o||(x.$max=(0,Va.A)(v.values||[])),m[h]=DF(v,x,f.dep?f:(0,b.dY)(f(x)),l.dep?l:(0,b.dY)(l(x)))}),t.reflow(!0).modifies(h)}});function ga(e,t){let i;return(0,b.Tn)(e)?(i=o=>(0,dc.Qh)(e(o,t)),i.dep=Ub(e)):i=(0,b.dY)((0,dc.Qh)(e||"#888")),i}function q0(e,t){let i;return(0,b.Tn)(e)?(i=o=>e(o,t),i.dep=Ub(e)):e?i=(0,b.dY)(e):(i=o=>o.$value/o.$max||0,i.dep=!0),i}function Ub(e){if(!(0,b.Tn)(e))return!1;const t=(0,b.M1)((0,b.nS)(e));return t.$x||t.$y||t.$value||t.$max}function DF(e,t,i,o){const a=e.width,l=e.height,f=e.x1||0,h=e.y1||0,g=e.x2||a,m=e.y2||l,v=e.values,x=v?k=>v[k]:b.v_,C=zn(g-f,m-h),w=C.getContext("2d"),S=w.getImageData(0,0,g-f,m-h),D=S.data;for(let k=h,O=0;k<m;++k){t.$y=k-h;for(let R=f,I=k*a;R<g;++R,O+=4){t.$x=R-f,t.$value=x(R+I);const V=i(t);D[O+0]=V.r,D[O+1]=V.g,D[O+2]=V.b,D[O+3]=~~(255*o(t))}}return w.putImageData(S,0,0),C}function jb(e){q.call(this,null,e),this.modified(!0)}(0,b.B)(jb,q,{transform(e,t){let i=this.value;return!i||e.modified("type")?(this.value=i=f3(e.type),B0.forEach(o=>{e[o]!=null&&Ld(i,o,e[o])})):B0.forEach(o=>{e.modified(o)&&Ld(i,o,e[o])}),e.pointRadius!=null&&i.path.pointRadius(e.pointRadius),e.fit&&kF(i,e),t.fork(t.NO_SOURCE|t.NO_FIELDS)}});function kF(e,t){const i=Gb(t.fit);t.extent?e.fitExtent(t.extent,i):t.size&&e.fitSize(t.size,i)}function f3(e){const t=L0((e||"mercator").toLowerCase());return t||(0,b.z3)("Unrecognized projection type: "+e),t()}function Ld(e,t,i){(0,b.Tn)(e[t])&&e[t](i)}function Gb(e){return e=(0,b.YO)(e),e.length===1?e[0]:{type:j0,features:e.reduce((t,i)=>t.concat(Wb(i)),[])}}function Wb(e){return e.type===j0?e.features:(0,b.YO)(e).filter(t=>t!=null).map(t=>t.type===U0?t:{type:U0,geometry:t})}var xu=z(92417),$F=z(81700),Vb=z(45575),Hb=z(93140),OF=z(99250),zd=z(53153),TF=z(23820);const Id={center:xu.A,collide:$F.A,nbody:Vb.A,link:Hb.A,x:OF.A,y:zd.A},wo="forces",Pd=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],RF=["static","iterations"],X0=["x","y","vx","vy"];function Y0(e){q.call(this,null,e)}Y0.Definition={type:"Force",metadata:{modifies:!0},params:[{name:"static",type:"boolean",default:!1},{name:"restart",type:"boolean",default:!1},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:!0,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:!0},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30,expr:!0},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:!0},{name:"strength",type:"number",expr:!0},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:!0,modify:!1,default:X0}]},(0,b.B)(Y0,q,{transform(e,t){var i=this.value,o=t.changed(t.ADD_REM),a=e.modified(Pd),l=e.iterations||300;if(i?(o&&(t.modifies("index"),i.nodes(t.source)),(a||t.changed(t.MOD))&&Q0(i,e,0,t)):(this.value=i=K0(t.source,e),i.on("tick",NF(t.dataflow,this)),e.static||(o=!0,i.tick()),t.modifies("index")),a||o||e.modified(RF)||t.changed()&&e.restart){if(i.alpha(Math.max(i.alpha(),e.alpha||1)).alphaDecay(1-Math.pow(i.alphaMin(),1/l)),e.static)for(i.stop();--l>=0;)i.tick();else if(i.stopped()&&i.restart(),!o)return t.StopPropagation}return this.finish(e,t)},finish(e,t){const i=t.dataflow;for(let h=this._argops,g=0,m=h.length,v;g<m;++g)if(v=h[g],!(v.name!==wo||v.op._argval.force!=="link")){for(var o=v.op._argops,a=0,l=o.length,f;a<l;++a)if(o[a].name==="links"&&(f=o[a].op.source)){i.pulse(f,i.changeset().reflow());break}}return t.reflow(e.modified()).modifies(X0)}});function NF(e,t){return()=>e.touch(t).run()}function K0(e,t){const i=(0,TF.A)(e),o=i.stop,a=i.restart;let l=!1;return i.stopped=()=>l,i.restart=()=>(l=!1,a()),i.stop=()=>(l=!0,o()),Q0(i,t,!0).on("end",()=>l=!0)}function Q0(e,t,i,o){var a=(0,b.YO)(t.forces),l,f,h,g;for(l=0,f=Pd.length;l<f;++l)h=Pd[l],h!==wo&&t.modified(h)&&e[h](t[h]);for(l=0,f=a.length;l<f;++l)g=wo+l,h=i||t.modified(wo,l)?MF(a[l]):o&&_F(a[l],o)?e.force(g):null,h&&e.force(g,h);for(f=e.numForces||0;l<f;++l)e.force(wo+l,null);return e.numForces=a.length,e}function _F(e,t){var i,o;for(i in e)if((0,b.Tn)(o=e[i])&&t.modified((0,b.nS)(o)))return 1;return 0}function MF(e){var t,i;(0,b.mQ)(Id,e.force)||(0,b.z3)("Unrecognized force: "+e.force),t=Id[e.force]();for(i in e)(0,b.Tn)(t[i])&&BF(t[i],e[i],e);return t}function BF(e,t,i){e((0,b.Tn)(t)?o=>t(o,i):t)}var Z0=z(79153),qb=z(78343),Xb=z(47289),Yb=z(75467),LF=z(31599),zF=z(57309),IF=z(32457),PF=z(81831),Kb=z(45360),UF=z(63959),jF=z(53306),Eu=z(32559),Au=z(73866);function Cu(e,t,i){const o={};return e.each(a=>{const l=a.data;i(l)&&(o[t(l)]=a)}),e.lookup=o,e}function ys(e){q.call(this,null,e)}ys.Definition={type:"Nest",metadata:{treesource:!0,changes:!0},params:[{name:"keys",type:"field",array:!0},{name:"generate",type:"boolean"}]};const Ud=e=>e.values;(0,b.B)(ys,q,{transform(e,t){t.source||(0,b.z3)("Nest transform requires an upstream data source.");var i=e.generate,o=e.modified(),a=t.clone(),l=this.value;return(!l||o||t.changed())&&(l&&l.each(f=>{f.children&&Bs(f.data)&&a.rem.push(f.data)}),this.value=l=(0,Z0.Ay)({values:(0,b.YO)(e.keys).reduce((f,h)=>(f.key(h),f),J0()).entries(a.source)},Ud),i&&l.each(f=>{f.children&&(f=Se(f.data),a.add.push(f),a.source.push(f))}),Cu(l,we,we)),a.source.root=l,a}});function J0(){const e=[],t={entries:a=>o(i(a,0),0),key:a=>(e.push(a),t)};function i(a,l){if(l>=e.length)return a;const f=a.length,h=e[l++],g={},m={};let v=-1,x,C,w;for(;++v<f;)x=h(C=a[v])+"",(w=g[x])?w.push(C):g[x]=[C];for(x in g)m[x]=i(g[x],l);return m}function o(a,l){if(++l>e.length)return a;const f=[];for(const h in a)f.push({key:h,values:o(a[h],l)});return f}return t}function wr(e){q.call(this,null,e)}const GF=(e,t)=>e.parent===t.parent?1:2;(0,b.B)(wr,q,{transform(e,t){(!t.source||!t.source.root)&&(0,b.z3)(this.constructor.name+" transform requires a backing tree data source.");const i=this.layout(e.method),o=this.fields,a=t.source.root,l=e.as||o;e.field?a.sum(e.field):a.count(),e.sort&&a.sort(Lr(e.sort,f=>f.data)),Qb(i,this.params,e),i.separation&&i.separation(e.separation!==!1?GF:b.xH);try{this.value=i(a)}catch(f){(0,b.z3)(f)}return a.each(f=>Zb(f,o,l)),t.reflow(e.modified()).modifies(l).modifies("leaf")}});function Qb(e,t,i){for(let o,a=0,l=t.length;a<l;++a)o=t[a],o in i&&e[o](i[o])}function Zb(e,t,i){const o=e.data,a=t.length-1;for(let l=0;l<a;++l)o[i[l]]=e[t[l]];o[i[a]]=e.children?e.children.length:0}const em=["x","y","r","depth","children"];function tm(e){wr.call(this,e)}tm.Definition={type:"Pack",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:em.length,default:em}]},(0,b.B)(tm,wr,{layout:qb.A,params:["radius","size","padding"],fields:em});const hc=["x0","y0","x1","y1","depth","children"];function nm(e){wr.call(this,e)}nm.Definition={type:"Partition",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:hc.length,default:hc}]},(0,b.B)(nm,wr,{layout:Xb.A,params:["size","round","padding"],fields:hc});function im(e){q.call(this,null,e)}im.Definition={type:"Stratify",metadata:{treesource:!0},params:[{name:"key",type:"field",required:!0},{name:"parentKey",type:"field",required:!0}]},(0,b.B)(im,q,{transform(e,t){t.source||(0,b.z3)("Stratify transform requires an upstream data source.");let i=this.value;const o=e.modified(),a=t.fork(t.ALL).materialize(t.SOURCE),l=!i||o||t.changed(t.ADD_REM)||t.modified(e.key.fields)||t.modified(e.parentKey.fields);return a.source=a.source.slice(),l&&(i=a.source.length?Cu((0,Yb.A)().id(e.key).parentId(e.parentKey)(a.source),e.key,b.vN):Cu((0,Yb.A)()([{}]),e.key,e.key)),a.source.root=this.value=i,a}});const Jb={tidy:LF.A,cluster:zF.A},rm=["x","y","depth","children"];function jd(e){wr.call(this,e)}jd.Definition={type:"Tree",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:!0,length:2},{name:"nodeSize",type:"number",array:!0,length:2},{name:"separation",type:"boolean",default:!0},{name:"as",type:"string",array:!0,length:rm.length,default:rm}]},(0,b.B)(jd,wr,{layout(e){const t=e||"tidy";if((0,b.mQ)(Jb,t))return Jb[t]();(0,b.z3)("Unrecognized Tree layout method: "+t)},params:["size","nodeSize"],fields:rm});function gc(e){q.call(this,[],e)}gc.Definition={type:"TreeLinks",metadata:{tree:!0,generates:!0,changes:!0},params:[]},(0,b.B)(gc,q,{transform(e,t){const i=this.value,o=t.source&&t.source.root,a=t.fork(t.NO_SOURCE),l={};return o||(0,b.z3)("TreeLinks transform requires a tree data source."),t.changed(t.ADD_REM)?(a.rem=i,t.visit(t.SOURCE,f=>l[we(f)]=1),o.each(f=>{const h=f.data,g=f.parent&&f.parent.data;g&&l[we(h)]&&l[we(g)]&&a.add.push(Se({source:g,target:h}))}),this.value=a.add):t.changed(t.MOD)&&(t.visit(t.MOD,f=>l[we(f)]=1),i.forEach(f=>{(l[we(f.source)]||l[we(f.target)])&&a.mod.push(f)})),a}});const pc={binary:IF.A,dice:PF.A,slice:Kb.A,slicedice:UF.A,squarify:jF.Ay,resquarify:Eu.A},Gd=["x0","y0","x1","y1","depth","children"];function Wd(e){wr.call(this,e)}Wd.Definition={type:"Treemap",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:Gd.length,default:Gd}]},(0,b.B)(Wd,wr,{layout(){const e=(0,Au.A)();return e.ratio=t=>{const i=e.tile();i.ratio&&e.tile(i.ratio(t))},e.method=t=>{(0,b.mQ)(pc,t)?e.tile(pc[t]):(0,b.z3)("Unrecognized Treemap layout method: "+t)},e},params:["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],fields:Gd});const Vd=4278190080;function ex(e,t){const i=e.bitmap();return(t||[]).forEach(o=>i.set(e(o.boundary[0]),e(o.boundary[3]))),[i,void 0]}function tx(e,t,i,o,a){const l=e.width,f=e.height,h=o||a,g=zn(l,f).getContext("2d"),m=zn(l,f).getContext("2d"),v=h&&zn(l,f).getContext("2d");i.forEach(J=>Hd(g,J,!1)),Hd(m,t,!1),h&&Hd(v,t,!0);const x=mc(g,l,f),C=mc(m,l,f),w=h&&mc(v,l,f),S=e.bitmap(),D=h&&e.bitmap();let k,O,R,I,V,W,ee,M;for(O=0;O<f;++O)for(k=0;k<l;++k)V=O*l+k,W=x[V]&Vd,M=C[V]&Vd,ee=h&&w[V]&Vd,(W||ee||M)&&(R=e(k),I=e(O),!a&&(W||M)&&S.set(R,I),h&&(W||ee)&&D.set(R,I));return[S,D]}function mc(e,t,i){return new Uint32Array(e.getImageData(0,0,t,i).data.buffer)}function Hd(e,t,i){if(!t.length)return;const o=t[0].mark.marktype;o==="group"?t.forEach(a=>{a.items.forEach(l=>Hd(e,l.items,i))}):Ei[o].draw(e,{items:i?t.map(nx):t})}function nx(e){const t=Oi(e,{});return t.stroke&&t.strokeOpacity!==0||t.fill&&t.fillOpacity!==0?{...t,strokeOpacity:1,stroke:"#000",fillOpacity:0}:t}const Do=5,$n=31,yc=32,vs=new Uint32Array(yc+1),Dr=new Uint32Array(yc+1);Dr[0]=0,vs[0]=~Dr[0];for(let e=1;e<=yc;++e)Dr[e]=Dr[e-1]<<1|1,vs[e]=~Dr[e];function WF(e,t){const i=new Uint32Array(~~((e*t+yc)/yc));function o(l,f){i[l]|=f}function a(l,f){i[l]&=f}return{array:i,get:(l,f)=>{const h=f*e+l;return i[h>>>Do]&1<<(h&$n)},set:(l,f)=>{const h=f*e+l;o(h>>>Do,1<<(h&$n))},clear:(l,f)=>{const h=f*e+l;a(h>>>Do,~(1<<(h&$n)))},getRange:(l,f,h,g)=>{let m=g,v,x,C,w;for(;m>=f;--m)if(v=m*e+l,x=m*e+h,C=v>>>Do,w=x>>>Do,C===w){if(i[C]&vs[v&$n]&Dr[(x&$n)+1])return!0}else{if(i[C]&vs[v&$n]||i[w]&Dr[(x&$n)+1])return!0;for(let S=C+1;S<w;++S)if(i[S])return!0}return!1},setRange:(l,f,h,g)=>{let m,v,x,C,w;for(;f<=g;++f)if(m=f*e+l,v=f*e+h,x=m>>>Do,C=v>>>Do,x===C)o(x,vs[m&$n]&Dr[(v&$n)+1]);else for(o(x,vs[m&$n]),o(C,Dr[(v&$n)+1]),w=x+1;w<C;++w)o(w,4294967295)},clearRange:(l,f,h,g)=>{let m,v,x,C,w;for(;f<=g;++f)if(m=f*e+l,v=f*e+h,x=m>>>Do,C=v>>>Do,x===C)a(x,Dr[m&$n]|vs[(v&$n)+1]);else for(a(x,Dr[m&$n]),a(C,vs[(v&$n)+1]),w=x+1;w<C;++w)a(w,0)},outOfBounds:(l,f,h,g)=>l<0||f<0||g>=t||h>=e}}function ix(e,t,i){const o=Math.max(1,Math.sqrt(e*t/1e6)),a=~~((e+2*i+o)/o),l=~~((t+2*i+o)/o),f=h=>~~((h+i)/o);return f.invert=h=>h*o-i,f.bitmap=()=>WF(a,l),f.ratio=o,f.padding=i,f.width=e,f.height=t,f}function om(e,t,i,o){const a=e.width,l=e.height;return function(f){const h=f.datum.datum.items[o].items,g=h.length,m=f.datum.fontSize,v=xi.width(f.datum,f.datum.text);let x=0,C,w,S,D,k,O,R;for(let I=0;I<g;++I)C=h[I].x,S=h[I].y,w=h[I].x2===void 0?C:h[I].x2,D=h[I].y2===void 0?S:h[I].y2,k=(C+w)/2,O=(S+D)/2,R=Math.abs(w-C+D-S),R>=x&&(x=R,f.x=k,f.y=O);return k=v/2,O=m/2,C=f.x-k,w=f.x+k,S=f.y-O,D=f.y+O,f.align="center",C<0&&w<=a?f.align="left":0<=C&&a<w&&(f.align="right"),f.baseline="middle",S<0&&D<=l?f.baseline="top":0<=S&&l<D&&(f.baseline="bottom"),!0}}function vc(e,t,i,o,a,l){let f=i/2;return e-f<0||e+f>a||t-(f=o/2)<0||t+f>l}function ko(e,t,i,o,a,l,f,h){const g=a*l/(o*2),m=e(t-g),v=e(t+g),x=e(i-(l=l/2)),C=e(i+l);return f.outOfBounds(m,x,v,C)||f.getRange(m,x,v,C)||h&&h.getRange(m,x,v,C)}function rx(e,t,i,o){const a=e.width,l=e.height,f=t[0],h=t[1];function g(m,v,x,C,w){const S=e.invert(m),D=e.invert(v);let k=x,O=l,R;if(!vc(S,D,C,w,a,l)&&!ko(e,S,D,w,C,k,f,h)&&!ko(e,S,D,w,C,w,f,null)){for(;O-k>=1;)R=(k+O)/2,ko(e,S,D,w,C,R,f,h)?O=R:k=R;if(k>x)return[S,D,k,!0]}}return function(m){const v=m.datum.datum.items[o].items,x=v.length,C=m.datum.fontSize,w=xi.width(m.datum,m.datum.text);let S=i?C:0,D=!1,k=!1,O=0,R,I,V,W,ee,M,J,ue,ge,Le,Xe,_t,bt,Ye,et,si,Qi;for(let Zi=0;Zi<x;++Zi){for(R=v[Zi].x,V=v[Zi].y,I=v[Zi].x2===void 0?R:v[Zi].x2,W=v[Zi].y2===void 0?V:v[Zi].y2,R>I&&(Qi=R,R=I,I=Qi),V>W&&(Qi=V,V=W,W=Qi),ge=e(R),Xe=e(I),Le=~~((ge+Xe)/2),_t=e(V),Ye=e(W),bt=~~((_t+Ye)/2),J=Le;J>=ge;--J)for(ue=bt;ue>=_t;--ue)si=g(J,ue,S,w,C),si&&([m.x,m.y,S,D]=si);for(J=Le;J<=Xe;++J)for(ue=bt;ue<=Ye;++ue)si=g(J,ue,S,w,C),si&&([m.x,m.y,S,D]=si);!D&&!i&&(et=Math.abs(I-R+W-V),ee=(R+I)/2,M=(V+W)/2,et>=O&&!vc(ee,M,w,C,a,l)&&!ko(e,ee,M,C,w,C,f,null)&&(O=et,m.x=ee,m.y=M,k=!0))}return D||k?(ee=w/2,M=C/2,f.setRange(e(m.x-ee),e(m.y-M),e(m.x+ee),e(m.y+M)),m.align="center",m.baseline="middle",!0):!1}}const VF=[-1,-1,1,1],HF=[-1,1,-1,1];function d3(e,t,i,o){const a=e.width,l=e.height,f=t[0],h=t[1],g=e.bitmap();return function(m){const v=m.datum.datum.items[o].items,x=v.length,C=m.datum.fontSize,w=xi.width(m.datum,m.datum.text),S=[];let D=i?C:0,k=!1,O=!1,R=0,I,V,W,ee,M,J,ue,ge,Le,Xe,_t,bt;for(let Ye=0;Ye<x;++Ye){for(I=v[Ye].x,W=v[Ye].y,V=v[Ye].x2===void 0?I:v[Ye].x2,ee=v[Ye].y2===void 0?W:v[Ye].y2,S.push([e((I+V)/2),e((W+ee)/2)]);S.length;)if([ue,ge]=S.pop(),!(f.get(ue,ge)||h.get(ue,ge)||g.get(ue,ge))){g.set(ue,ge);for(let et=0;et<4;++et)M=ue+VF[et],J=ge+HF[et],g.outOfBounds(M,J,M,J)||S.push([M,J]);if(M=e.invert(ue),J=e.invert(ge),Le=D,Xe=l,!vc(M,J,w,C,a,l)&&!ko(e,M,J,C,w,Le,f,h)&&!ko(e,M,J,C,w,C,f,null)){for(;Xe-Le>=1;)_t=(Le+Xe)/2,ko(e,M,J,C,w,_t,f,h)?Xe=_t:Le=_t;Le>D&&(m.x=M,m.y=J,D=Le,k=!0)}}!k&&!i&&(bt=Math.abs(V-I+ee-W),M=(I+V)/2,J=(W+ee)/2,bt>=R&&!vc(M,J,w,C,a,l)&&!ko(e,M,J,C,w,C,f,null)&&(R=bt,m.x=M,m.y=J,O=!0))}return k||O?(M=w/2,J=C/2,f.setRange(e(m.x-M),e(m.y-J),e(m.x+M),e(m.y+J)),m.align="center",m.baseline="middle",!0):!1}}const qF=["right","center","left"],XF=["bottom","middle","top"];function YF(e,t,i,o){const a=e.width,l=e.height,f=t[0],h=t[1],g=o.length;return function(m){const v=m.boundary,x=m.datum.fontSize;if(v[2]<0||v[5]<0||v[0]>a||v[3]>l)return!1;let C=m.textWidth??0,w,S,D,k,O,R,I,V,W,ee,M,J,ue,ge,Le;for(let Xe=0;Xe<g;++Xe){if(w=(i[Xe]&3)-1,S=(i[Xe]>>>2&3)-1,D=w===0&&S===0||o[Xe]<0,k=w&&S?Math.SQRT1_2:1,O=o[Xe]<0?-1:1,R=v[1+w]+o[Xe]*w*k,M=v[4+S]+O*x*S/2+o[Xe]*S*k,V=M-x/2,W=M+x/2,J=e(R),ge=e(V),Le=e(W),!C)if(ox(J,J,ge,Le,f,h,R,R,V,W,v,D))C=xi.width(m.datum,m.datum.text);else continue;if(ee=R+O*C*w/2,R=ee-C/2,I=ee+C/2,J=e(R),ue=e(I),ox(J,ue,ge,Le,f,h,R,I,V,W,v,D))return m.x=w?w*O<0?I:R:ee,m.y=S?S*O<0?W:V:M,m.align=qF[w*O+1],m.baseline=XF[S*O+1],f.setRange(J,ge,ue,Le),!0}return!1}}function ox(e,t,i,o,a,l,f,h,g,m,v,x){return!(a.outOfBounds(e,i,t,o)||(x&&l||a).getRange(e,i,t,o))}const sm=0,qd=4,am=8,Xd=0,um=1,lm=2,KF={"top-left":sm+Xd,top:sm+um,"top-right":sm+lm,left:qd+Xd,middle:qd+um,right:qd+lm,"bottom-left":am+Xd,bottom:am+um,"bottom-right":am+lm},QF={naive:om,"reduced-search":rx,floodfill:d3};function ZF(e,t,i,o,a,l,f,h,g,m,v){if(!e.length)return e;const x=Math.max(o.length,a.length),C=sx(o,x),w=JF(a,x),S=ew(e[0].datum),D=S==="group"&&e[0].datum.items[g].marktype,k=D==="area",O=ax(S,D,h,g),R=m===null||m===1/0,I=k&&v==="naive";let V=-1,W=-1;const ee=e.map(ge=>{const Le=R?xi.width(ge,ge.text):void 0;return V=Math.max(V,Le),W=Math.max(W,ge.fontSize),{datum:ge,opacity:0,x:void 0,y:void 0,align:void 0,baseline:void 0,boundary:O(ge),textWidth:Le}});m=m===null||m===1/0?Math.max(V,W)+Math.max(...o):m;const M=ix(t[0],t[1],m);let J;if(!I){i&&ee.sort((Xe,_t)=>i(Xe.datum,_t.datum));let ge=!1;for(let Xe=0;Xe<w.length&&!ge;++Xe)ge=w[Xe]===5||C[Xe]<0;const Le=(S&&f||k)&&e.map(Xe=>Xe.datum);J=l.length||Le?tx(M,Le||[],l,ge,k):ex(M,f&&ee)}const ue=k?QF[v](M,J,f,g):YF(M,J,w,C);return ee.forEach(ge=>ge.opacity=+ue(ge)),ee}function sx(e,t){const i=new Float64Array(t),o=e.length;for(let a=0;a<o;++a)i[a]=e[a]||0;for(let a=o;a<t;++a)i[a]=i[o-1];return i}function JF(e,t){const i=new Int8Array(t),o=e.length;for(let a=0;a<o;++a)i[a]|=KF[e[a]];for(let a=o;a<t;++a)i[a]=i[o-1];return i}function ew(e){return e&&e.mark&&e.mark.marktype}function ax(e,t,i,o){const a=l=>[l.x,l.x,l.x,l.y,l.y,l.y];return e?e==="line"||e==="area"?l=>a(l.datum):t==="line"?l=>{const f=l.datum.items[o].items;return a(f.length?f[i==="start"?0:f.length-1]:{x:NaN,y:NaN})}:l=>{const f=l.datum.bounds;return[f.x1,(f.x1+f.x2)/2,f.x2,f.y1,(f.y1+f.y2)/2,f.y2]}:a}const cm=["x","y","opacity","align","baseline"],ux=["top-left","left","bottom-left","top","bottom","top-right","right","bottom-right"];function fm(e){q.call(this,null,e)}fm.Definition={type:"Label",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"sort",type:"compare"},{name:"anchor",type:"string",array:!0,default:ux},{name:"offset",type:"number",array:!0,default:[1]},{name:"padding",type:"number",default:0,null:!0},{name:"lineAnchor",type:"string",values:["start","end"],default:"end"},{name:"markIndex",type:"number",default:0},{name:"avoidBaseMark",type:"boolean",default:!0},{name:"avoidMarks",type:"data",array:!0},{name:"method",type:"string",default:"naive"},{name:"as",type:"string",array:!0,length:cm.length,default:cm}]},(0,b.B)(fm,q,{transform(e,t){function i(l){const f=e[l];return(0,b.Tn)(f)&&t.modified(f.fields)}const o=e.modified();if(!(o||t.changed(t.ADD_REM)||i("sort")))return;(!e.size||e.size.length!==2)&&(0,b.z3)("Size parameter should be specified as a [width, height] array.");const a=e.as||cm;return ZF(t.materialize(t.SOURCE).source||[],e.size,e.sort,(0,b.YO)(e.offset==null?1:e.offset),(0,b.YO)(e.anchor||ux),e.avoidMarks||[],e.avoidBaseMark!==!1,e.lineAnchor||"end",e.markIndex||0,e.padding===void 0?0:e.padding,e.method||"naive").forEach(l=>{const f=l.datum;f[a[0]]=l.x,f[a[1]]=l.y,f[a[2]]=l.opacity,f[a[3]]=l.align,f[a[4]]=l.baseline}),t.reflow(o).modifies(a)}});function dm(e,t){var i=[],o=function(v){return v(h)},a,l,f,h,g,m;if(t==null)i.push(e);else for(a={},l=0,f=e.length;l<f;++l)h=e[l],g=t.map(o),m=a[g],m||(a[g]=m=[],m.dims=g,i.push(m)),m.push(h);return i}function hm(e){q.call(this,null,e)}hm.Definition={type:"Loess",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"bandwidth",type:"number",default:.3},{name:"as",type:"string",array:!0}]},(0,b.B)(hm,q,{transform(e,t){const i=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const o=t.materialize(t.SOURCE).source,a=dm(o,e.groupby),l=(e.groupby||[]).map(b.N6),f=l.length,h=e.as||[(0,b.N6)(e.x),(0,b.N6)(e.y)],g=[];a.forEach(m=>{W1(m,e.x,e.y,e.bandwidth||.3).forEach(v=>{const x={};for(let C=0;C<f;++C)x[l[C]]=m.dims[C];x[h[0]]=v[0],x[h[1]]=v[1],g.push(Se(x))})}),this.value&&(i.rem=this.value),this.value=i.add=i.source=g}return i}});const Yd={constant:j1,linear:mg,log:yg,exp:af,pow:lr,quad:vg,poly:bg},lx=(e,t)=>e==="poly"?t:e==="quad"?2:1;function gm(e){q.call(this,null,e)}gm.Definition={type:"Regression",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"string",default:"linear",values:Object.keys(Yd)},{name:"order",type:"number",default:3},{name:"extent",type:"number",array:!0,length:2},{name:"params",type:"boolean",default:!1},{name:"as",type:"string",array:!0}]},(0,b.B)(gm,q,{transform(e,t){const i=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const o=t.materialize(t.SOURCE).source,a=dm(o,e.groupby),l=(e.groupby||[]).map(b.N6),f=e.method||"linear",h=e.order==null?3:e.order,g=lx(f,h),m=e.as||[(0,b.N6)(e.x),(0,b.N6)(e.y)],v=Yd[f],x=[];let C=e.extent;(0,b.mQ)(Yd,f)||(0,b.z3)("Invalid regression method: "+f),C!=null&&f==="log"&&C[0]<=0&&(t.dataflow.warn("Ignoring extent with values <= 0 for log regression."),C=null),a.forEach(w=>{if(w.length<=g){t.dataflow.warn("Skipping regression with more parameters than data points.");return}const D=v(w,e.x,e.y,h);if(e.params){x.push(Se({keys:w.dims,coef:D.coef,rSquared:D.rSquared}));return}const k=C||(0,b.Xx)(w,e.x),O=R=>{const I={};for(let V=0;V<l.length;++V)I[l[V]]=w.dims[V];I[m[0]]=R[0],I[m[1]]=R[1],x.push(Se(I))};f==="linear"||f==="constant"?k.forEach(R=>O([R,D.predict(R)])):lf(D.predict,k,25,200).forEach(O)}),this.value&&(i.rem=this.value),this.value=i.add=i.source=x}return i}});var tw=z(10447);function pm(e){q.call(this,null,e)}pm.Definition={type:"Voronoi",metadata:{modifies:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"size",type:"number",array:!0,length:2},{name:"extent",type:"array",array:!0,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:!0,length:2}},{name:"as",type:"string",default:"path"}]};const nw=[-1e5,-1e5,1e5,1e5];(0,b.B)(pm,q,{transform(e,t){const i=e.as||"path",o=t.source;if(!o||!o.length)return t;let a=e.size;a=a?[0,0,a[0],a[1]]:(a=e.extent)?[a[0][0],a[0][1],a[1][0],a[1][1]]:nw;const l=this.value=tw.A.from(o,e.x,e.y).voronoi(a);for(let f=0,h=o.length;f<h;++f){const g=l.cellPolygon(f);o[f][i]=g&&!cx(g)?iw(g):null}return t.reflow(e.modified()).modifies(i)}});function iw(e){const t=e[0][0],i=e[0][1];let o=e.length-1;for(;e[o][0]===t&&e[o][1]===i;--o);return"M"+e.slice(0,o+1).join("L")+"Z"}function cx(e){return e.length===2&&e[0][0]===e[1][0]&&e[0][1]===e[1][1]}var mm=Math.PI/180,pa=64,Kd=2048;function fx(){var e=[256,256],t,i,o,a,l,f,h,g=ma,m=[],v=Math.random,x={};x.layout=function(){for(var S=C(zn()),D=sw((e[0]>>5)*e[1]),k=null,O=m.length,R=-1,I=[],V=m.map(ee=>({text:t(ee),font:i(ee),style:a(ee),weight:l(ee),rotate:f(ee),size:~~(o(ee)+1e-14),padding:h(ee),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:ee})).sort((ee,M)=>M.size-ee.size);++R<O;){var W=V[R];W.x=e[0]*(v()+.5)>>1,W.y=e[1]*(v()+.5)>>1,Yr(S,W,V,R),W.hasText&&w(D,W,k)&&(I.push(W),k?ow(k,W):k=[{x:W.x+W.x0,y:W.y+W.y0},{x:W.x+W.x1,y:W.y+W.y1}],W.x-=e[0]>>1,W.y-=e[1]>>1)}return I};function C(S){S.width=S.height=1;var D=Math.sqrt(S.getContext("2d").getImageData(0,0,1,1).data.length>>2);S.width=(pa<<5)/D,S.height=Kd/D;var k=S.getContext("2d");return k.fillStyle=k.strokeStyle="red",k.textAlign="center",{context:k,ratio:D}}function w(S,D,k){for(var O=D.x,R=D.y,I=Math.hypot(e[0],e[1]),V=g(e),W=v()<.5?1:-1,ee=-W,M,J,ue;(M=V(ee+=W))&&(J=~~M[0],ue=~~M[1],!(Math.min(Math.abs(J),Math.abs(ue))>=I));)if(D.x=O+J,D.y=R+ue,!(D.x+D.x0<0||D.y+D.y0<0||D.x+D.x1>e[0]||D.y+D.y1>e[1])&&(!k||!rw(D,S,e[0]))&&(!k||kr(D,k))){for(var ge=D.sprite,Le=D.width>>5,Xe=e[0]>>5,_t=D.x-(Le<<4),bt=_t&127,Ye=32-bt,et=D.y1-D.y0,si=(D.y+D.y0)*Xe+(_t>>5),Qi,Zi=0;Zi<et;Zi++){Qi=0;for(var Wc=0;Wc<=Le;Wc++)S[si+Wc]|=Qi<<Ye|(Wc<Le?(Qi=ge[Zi*Le+Wc])>>>bt:0);si+=Xe}return D.sprite=null,!0}return!1}return x.words=function(S){return arguments.length?(m=S,x):m},x.size=function(S){return arguments.length?(e=[+S[0],+S[1]],x):e},x.font=function(S){return arguments.length?(i=ya(S),x):i},x.fontStyle=function(S){return arguments.length?(a=ya(S),x):a},x.fontWeight=function(S){return arguments.length?(l=ya(S),x):l},x.rotate=function(S){return arguments.length?(f=ya(S),x):f},x.text=function(S){return arguments.length?(t=ya(S),x):t},x.spiral=function(S){return arguments.length?(g=aw[S]||S,x):g},x.fontSize=function(S){return arguments.length?(o=ya(S),x):o},x.padding=function(S){return arguments.length?(h=ya(S),x):h},x.random=function(S){return arguments.length?(v=S,x):v},x}function Yr(e,t,i,o){if(!t.sprite){var a=e.context,l=e.ratio;a.clearRect(0,0,(pa<<5)/l,Kd/l);var f=0,h=0,g=0,m=i.length,v,x,C,w,S;for(--o;++o<m;){if(t=i[o],a.save(),a.font=t.style+" "+t.weight+" "+~~((t.size+1)/l)+"px "+t.font,v=a.measureText(t.text+"m").width*l,C=t.size<<1,t.rotate){var D=Math.sin(t.rotate*mm),k=Math.cos(t.rotate*mm),O=v*k,R=v*D,I=C*k,V=C*D;v=Math.max(Math.abs(O+V),Math.abs(O-V))+31>>5<<5,C=~~Math.max(Math.abs(R+I),Math.abs(R-I))}else v=v+31>>5<<5;if(C>g&&(g=C),f+v>=pa<<5&&(f=0,h+=g,g=0),h+C>=Kd)break;a.translate((f+(v>>1))/l,(h+(C>>1))/l),t.rotate&&a.rotate(t.rotate*mm),a.fillText(t.text,0,0),t.padding&&(a.lineWidth=2*t.padding,a.strokeText(t.text,0,0)),a.restore(),t.width=v,t.height=C,t.xoff=f,t.yoff=h,t.x1=v>>1,t.y1=C>>1,t.x0=-t.x1,t.y0=-t.y1,t.hasText=!0,f+=v}for(var W=a.getImageData(0,0,(pa<<5)/l,Kd/l).data,ee=[];--o>=0;)if(t=i[o],!!t.hasText){for(v=t.width,x=v>>5,C=t.y1-t.y0,w=0;w<C*x;w++)ee[w]=0;if(f=t.xoff,f==null)return;h=t.yoff;var M=0,J=-1;for(S=0;S<C;S++){for(w=0;w<v;w++){var ue=x*S+(w>>5),ge=W[(h+S)*(pa<<5)+(f+w)<<2]?1<<31-w%32:0;ee[ue]|=ge,M|=ge}M?J=S:(t.y0++,C--,S--,h++)}t.y1=t.y0+J,t.sprite=ee.slice(0,(t.y1-t.y0)*x)}}}function rw(e,t,i){i>>=5;for(var o=e.sprite,a=e.width>>5,l=e.x-(a<<4),f=l&127,h=32-f,g=e.y1-e.y0,m=(e.y+e.y0)*i+(l>>5),v,x=0;x<g;x++){v=0;for(var C=0;C<=a;C++)if((v<<h|(C<a?(v=o[x*a+C])>>>f:0))&t[m+C])return!0;m+=i}return!1}function ow(e,t){var i=e[0],o=e[1];t.x+t.x0<i.x&&(i.x=t.x+t.x0),t.y+t.y0<i.y&&(i.y=t.y+t.y0),t.x+t.x1>o.x&&(o.x=t.x+t.x1),t.y+t.y1>o.y&&(o.y=t.y+t.y1)}function kr(e,t){return e.x+e.x1>t[0].x&&e.x+e.x0<t[1].x&&e.y+e.y1>t[0].y&&e.y+e.y0<t[1].y}function ma(e){var t=e[0]/e[1];return function(i){return[t*(i*=.1)*Math.cos(i),i*Math.sin(i)]}}function dx(e){var t=4,i=t*e[0]/e[1],o=0,a=0;return function(l){var f=l<0?-1:1;switch(Math.sqrt(1+4*f*l)-f&3){case 0:o+=i;break;case 1:a+=t;break;case 2:o-=i;break;default:a-=t;break}return[o,a]}}function sw(e){for(var t=[],i=-1;++i<e;)t[i]=0;return t}function ya(e){return typeof e=="function"?e:function(){return e}}var aw={archimedean:ma,rectangular:dx};const hx=["x","y","font","fontSize","fontStyle","fontWeight","angle"],On=["text","font","rotate","fontSize","fontStyle","fontWeight"];function Kr(e){q.call(this,fx(),e)}Kr.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:hx}]},(0,b.B)(Kr,q,{transform(e,t){e.size&&!(e.size[0]&&e.size[1])&&(0,b.z3)("Wordcloud size dimensions must be non-zero.");function i(S){const D=e[S];return(0,b.Tn)(D)&&t.modified(D.fields)}const o=e.modified();if(!(o||t.changed(t.ADD_REM)||On.some(i)))return;const a=t.materialize(t.SOURCE).source,l=this.value,f=e.as||hx;let h=e.fontSize||14,g;if((0,b.Tn)(h)?g=e.fontSizeRange:h=(0,b.dY)(h),g){const S=h,D=it("sqrt")().domain((0,b.Xx)(a,S)).range(g);h=k=>D(S(k))}a.forEach(S=>{S[f[0]]=NaN,S[f[1]]=NaN,S[f[3]]=0});const m=l.words(a).text(e.text).size(e.size||[500,500]).padding(e.padding||1).spiral(e.spiral||"archimedean").rotate(e.rotate||0).font(e.font||"sans-serif").fontStyle(e.fontStyle||"normal").fontWeight(e.fontWeight||"normal").fontSize(h).random(ar).layout(),v=l.size(),x=v[0]>>1,C=v[1]>>1,w=m.length;for(let S=0,D,k;S<w;++S)D=m[S],k=D.datum,k[f[0]]=D.x+x,k[f[1]]=D.y+C,k[f[2]]=D.font,k[f[3]]=D.size,k[f[4]]=D.style,k[f[5]]=D.weight,k[f[6]]=D.rotate;return t.reflow(o).modifies(f)}});var bc=z(59458);const xc=e=>new Uint8Array(e),va=e=>new Uint16Array(e),Su=e=>new Uint32Array(e);function uw(){let e=8,t=[],i=Su(0),o=Fu(0,e),a=Fu(0,e);return{data:()=>t,seen:()=>i=Ec(i,t.length),add(l){for(let f=0,h=t.length,g=l.length,m;f<g;++f)m=l[f],m._index=h++,t.push(m)},remove(l,f){const h=t.length,g=Array(h-l),m=t;let v,x,C;for(x=0;!f[x]&&x<h;++x)g[x]=t[x],m[x]=x;for(C=x;x<h;++x)v=t[x],f[x]?m[x]=-1:(m[x]=C,o[C]=o[x],a[C]=a[x],g[C]=v,v._index=C++),o[x]=0;return t=g,m},size:()=>t.length,curr:()=>o,prev:()=>a,reset:l=>a[l]=o[l],all:()=>e<257?255:e<65537?65535:4294967295,set(l,f){o[l]|=f},clear(l,f){o[l]&=~f},resize(l,f){const h=o.length;(l>h||f>e)&&(e=Math.max(f,e),o=Fu(l,e,o),a=Fu(l,e))}}}function Ec(e,t,i){return e.length>=t?e:(i=i||new e.constructor(t),i.set(e),i)}function Fu(e,t,i){const o=(t<257?xc:t<65537?va:Su)(e);return i&&o.set(i),o}function Qd(e,t,i){const o=1<<t;return{one:o,zero:~o,range:i.slice(),bisect:e.bisect,index:e.index,size:e.size,onAdd(a,l){const f=this,h=f.bisect(f.range,a.value),g=a.index,m=h[0],v=h[1],x=g.length;let C;for(C=0;C<m;++C)l[g[C]]|=o;for(C=v;C<x;++C)l[g[C]]|=o;return f}}}function bs(){let e=Su(0),t=[],i=0;function o(h,g,m){if(!g.length)return[];const v=i,x=g.length,C=Su(x);let w=Array(x),S,D,k;for(k=0;k<x;++k)w[k]=h(g[k]),C[k]=k;if(w=ym(w,C),v)S=t,D=e,t=Array(v+x),e=Su(v+x),lw(m,S,D,v,w,C,x,t,e);else{if(m>0)for(k=0;k<x;++k)C[k]+=m;t=w,e=C}return i=v+x,{index:C,value:w}}function a(h,g){const m=i;let v,x,C;for(x=0;!g[e[x]]&&x<m;++x);for(C=x;x<m;++x)g[v=e[x]]||(e[C]=v,t[C]=t[x],++C);i=m-h}function l(h){for(let g=0,m=i;g<m;++g)e[g]=h[e[g]]}function f(h,g){let m;return g?m=g.length:(g=t,m=i),[(0,ei.ah)(g,h[0],0,m),(0,ei.Jj)(g,h[1],0,m)]}return{insert:o,remove:a,bisect:f,reindex:l,index:()=>e,size:()=>i}}function ym(e,t){return e.sort.call(t,(i,o)=>{const a=e[i],l=e[o];return a<l?-1:a>l?1:0}),(0,bc.A)(e,t)}function lw(e,t,i,o,a,l,f,h,g){let m=0,v=0,x;for(x=0;m<o&&v<f;++x)t[m]<a[v]?(h[x]=t[m],g[x]=i[m++]):(h[x]=a[v],g[x]=l[v++]+e);for(;m<o;++m,++x)h[x]=t[m],g[x]=i[m];for(;v<f;++v,++x)h[x]=a[v],g[x]=l[v]+e}function vm(e){q.call(this,uw(),e),this._indices=null,this._dims=null}vm.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"query",type:"array",array:!0,required:!0,content:{type:"number",array:!0,length:2}}]},(0,b.B)(vm,q,{transform(e,t){if(this._dims){var i=e.modified("fields")||e.fields.some(o=>t.modified(o.fields));return i?this.reinit(e,t):this.eval(e,t)}else return this.init(e,t)},init(e,t){const i=e.fields,o=e.query,a=this._indices={},l=this._dims=[],f=o.length;let h=0,g,m;for(;h<f;++h)g=i[h].fname,m=a[g]||(a[g]=bs()),l.push(Qd(m,h,o[h]));return this.eval(e,t)},reinit(e,t){const i=t.materialize().fork(),o=e.fields,a=e.query,l=this._indices,f=this._dims,h=this.value,g=h.curr(),m=h.prev(),v=h.all(),x=i.rem=i.add,C=i.mod,w=a.length,S={};let D,k,O,R,I,V,W,ee,M;if(m.set(g),t.rem.length&&(I=this.remove(e,t,i)),t.add.length&&h.add(t.add),t.mod.length)for(V={},R=t.mod,W=0,ee=R.length;W<ee;++W)V[R[W]._index]=1;for(W=0;W<w;++W)M=o[W],(!f[W]||e.modified("fields",W)||t.modified(M.fields))&&(O=M.fname,(D=S[O])||(l[O]=k=bs(),S[O]=D=k.insert(M,t.source,0)),f[W]=Qd(k,W,a[W]).onAdd(D,g));for(W=0,ee=h.data().length;W<ee;++W)I[W]||(m[W]!==g[W]?x.push(W):V[W]&&g[W]!==v&&C.push(W));return h.mask=(1<<w)-1,i},eval(e,t){const i=t.materialize().fork(),o=this._dims.length;let a=0;return t.rem.length&&(this.remove(e,t,i),a|=(1<<o)-1),e.modified("query")&&!e.modified("fields")&&(a|=this.update(e,t,i)),t.add.length&&(this.insert(e,t,i),a|=(1<<o)-1),t.mod.length&&(this.modify(t,i),a|=(1<<o)-1),this.value.mask=a,i},insert(e,t,i){const o=t.add,a=this.value,l=this._dims,f=this._indices,h=e.fields,g={},m=i.add,v=a.size()+o.length,x=l.length;let C=a.size(),w,S,D;a.resize(v,x),a.add(o);const k=a.curr(),O=a.prev(),R=a.all();for(w=0;w<x;++w)S=h[w].fname,D=g[S]||(g[S]=f[S].insert(h[w],o,C)),l[w].onAdd(D,k);for(;C<v;++C)O[C]=R,k[C]!==R&&m.push(C)},modify(e,t){const i=t.mod,o=this.value,a=o.curr(),l=o.all(),f=e.mod;let h,g,m;for(h=0,g=f.length;h<g;++h)m=f[h]._index,a[m]!==l&&i.push(m)},remove(e,t,i){const o=this._indices,a=this.value,l=a.curr(),f=a.prev(),h=a.all(),g={},m=i.rem,v=t.rem;let x,C,w,S;for(x=0,C=v.length;x<C;++x)w=v[x]._index,g[w]=1,f[w]=S=l[w],l[w]=h,S!==h&&m.push(w);for(w in o)o[w].remove(C,g);return this.reindex(t,C,g),g},reindex(e,t,i){const o=this._indices,a=this.value;e.runAfter(()=>{const l=a.remove(t,i);for(const f in o)o[f].reindex(l)})},update(e,t,i){const o=this._dims,a=e.query,l=t.stamp,f=o.length;let h=0,g,m;for(i.filters=0,m=0;m<f;++m)e.modified("query",m)&&(g=m,++h);if(h===1)h=o[g].one,this.incrementOne(o[g],a[g],i.add,i.rem);else for(m=0,h=0;m<f;++m)e.modified("query",m)&&(h|=o[m].one,this.incrementAll(o[m],a[m],l,i.add),i.rem=i.add);return h},incrementAll(e,t,i,o){const a=this.value,l=a.seen(),f=a.curr(),h=a.prev(),g=e.index(),m=e.bisect(e.range),v=e.bisect(t),x=v[0],C=v[1],w=m[0],S=m[1],D=e.one;let k,O,R;if(x<w)for(k=x,O=Math.min(w,C);k<O;++k)R=g[k],l[R]!==i&&(h[R]=f[R],l[R]=i,o.push(R)),f[R]^=D;else if(x>w)for(k=w,O=Math.min(x,S);k<O;++k)R=g[k],l[R]!==i&&(h[R]=f[R],l[R]=i,o.push(R)),f[R]^=D;if(C>S)for(k=Math.max(x,S),O=C;k<O;++k)R=g[k],l[R]!==i&&(h[R]=f[R],l[R]=i,o.push(R)),f[R]^=D;else if(C<S)for(k=Math.max(w,C),O=S;k<O;++k)R=g[k],l[R]!==i&&(h[R]=f[R],l[R]=i,o.push(R)),f[R]^=D;e.range=t.slice()},incrementOne(e,t,i,o){const a=this.value,l=a.curr(),f=e.index(),h=e.bisect(e.range),g=e.bisect(t),m=g[0],v=g[1],x=h[0],C=h[1],w=e.one;let S,D,k;if(m<x)for(S=m,D=Math.min(x,v);S<D;++S)k=f[S],l[k]^=w,i.push(k);else if(m>x)for(S=x,D=Math.min(m,C);S<D;++S)k=f[S],l[k]^=w,o.push(k);if(v>C)for(S=Math.max(m,C),D=v;S<D;++S)k=f[S],l[k]^=w,i.push(k);else if(v<C)for(S=Math.max(x,v),D=C;S<D;++S)k=f[S],l[k]^=w,o.push(k);e.range=t.slice()}});function bm(e){q.call(this,null,e)}bm.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:!0,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:!0,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]},(0,b.B)(bm,q,{transform(e,t){const i=~(e.ignore||0),o=e.filter,a=o.mask;if(!(a&i))return t.StopPropagation;const l=t.fork(t.ALL),f=o.data(),h=o.curr(),g=o.prev(),m=v=>h[v]&i?null:f[v];return l.filter(l.MOD,m),a&a-1?(l.filter(l.ADD,v=>{const x=h[v]&i;return!x&&x^g[v]&i?f[v]:null}),l.filter(l.REM,v=>{const x=h[v]&i;return x&&!(x^(x^g[v]&i))?f[v]:null})):(l.filter(l.ADD,m),l.filter(l.REM,v=>(h[v]&i)===a?f[v]:null)),l.filter(l.SOURCE,v=>m(v._index))}});const cw="RawCode",ba="Literal",fw="Property",dw="Identifier",hw="ArrayExpression",gw="BinaryExpression",gx="CallExpression",pw="ConditionalExpression",xa="LogicalExpression",wu="MemberExpression",xm="ObjectExpression",mw="UnaryExpression";function $r(e){this.type=e}$r.prototype.visit=function(e){let t,i,o;if(e(this))return 1;for(t=$o(this),i=0,o=t.length;i<o;++i)if(t[i].visit(e))return 1};function $o(e){switch(e.type){case hw:return e.elements;case gw:case xa:return[e.left,e.right];case gx:return[e.callee].concat(e.arguments);case pw:return[e.test,e.consequent,e.alternate];case wu:return[e.object,e.property];case xm:return e.properties;case fw:return[e.key,e.value];case mw:return[e.argument];case dw:case ba:case cw:default:return[]}}var Pn,Ae,Y,xn,st,Ea=1,Aa=2,En=3,Oo=4,Zd=5,Nt=6,Un=7,Ac=8,yw=9;Pn={},Pn[Ea]="Boolean",Pn[Aa]="<end>",Pn[En]="Identifier",Pn[Oo]="Keyword",Pn[Zd]="Null",Pn[Nt]="Numeric",Pn[Un]="Punctuator",Pn[Ac]="String",Pn[yw]="RegularExpression";var vw="ArrayExpression",bw="BinaryExpression",xw="CallExpression",Em="ConditionalExpression",To="Identifier",Am="Literal",Ew="LogicalExpression",Aw="MemberExpression",px="ObjectExpression",Cm="Property",Cw="UnaryExpression",Yt="Unexpected token %0",Jd="Unexpected number",mx="Unexpected string",yx="Unexpected identifier",Sw="Unexpected reserved word",vx="Unexpected end of input",Sm="Invalid regular expression",Fm="Invalid regular expression: missing /",wm="Octal literals are not allowed in strict mode.",Fw="Duplicate data property in object literal not allowed in strict mode",An="ILLEGAL",Du="Disabled.",ww=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),bx=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function Cc(e,t){if(!e)throw new Error("ASSERT: "+t)}function Ro(e){return e>=48&&e<=57}function eh(e){return"0123456789abcdefABCDEF".includes(e)}function Sc(e){return"01234567".includes(e)}function Dw(e){return e===32||e===9||e===11||e===12||e===160||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].includes(e)}function Fc(e){return e===10||e===13||e===8232||e===8233}function ku(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e===92||e>=128&&ww.test(String.fromCharCode(e))}function th(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e===92||e>=128&&bx.test(String.fromCharCode(e))}const xx={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function Dm(){for(;Y<xn;){const e=Ae.charCodeAt(Y);if(Dw(e)||Fc(e))++Y;else break}}function km(e){var t,i,o,a=0;for(i=e==="u"?4:2,t=0;t<i;++t)Y<xn&&eh(Ae[Y])?(o=Ae[Y++],a=a*16+"0123456789abcdef".indexOf(o.toLowerCase())):Qe({},Yt,An);return String.fromCharCode(a)}function Ex(){var e,t,i,o;for(e=Ae[Y],t=0,e==="}"&&Qe({},Yt,An);Y<xn&&(e=Ae[Y++],!!eh(e));)t=t*16+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||e!=="}")&&Qe({},Yt,An),t<=65535?String.fromCharCode(t):(i=(t-65536>>10)+55296,o=(t-65536&1023)+56320,String.fromCharCode(i,o))}function $m(){var e,t;for(e=Ae.charCodeAt(Y++),t=String.fromCharCode(e),e===92&&(Ae.charCodeAt(Y)!==117&&Qe({},Yt,An),++Y,e=km("u"),(!e||e==="\\"||!ku(e.charCodeAt(0)))&&Qe({},Yt,An),t=e);Y<xn&&(e=Ae.charCodeAt(Y),!!th(e));)++Y,t+=String.fromCharCode(e),e===92&&(t=t.substr(0,t.length-1),Ae.charCodeAt(Y)!==117&&Qe({},Yt,An),++Y,e=km("u"),(!e||e==="\\"||!th(e.charCodeAt(0)))&&Qe({},Yt,An),t+=e);return t}function Ax(){var e,t;for(e=Y++;Y<xn;){if(t=Ae.charCodeAt(Y),t===92)return Y=e,$m();if(th(t))++Y;else break}return Ae.slice(e,Y)}function kw(){var e,t,i;return e=Y,t=Ae.charCodeAt(Y)===92?$m():Ax(),t.length===1?i=En:xx.hasOwnProperty(t)?i=Oo:t==="null"?i=Zd:t==="true"||t==="false"?i=Ea:i=En,{type:i,value:t,start:e,end:Y}}function Om(){var e=Y,t=Ae.charCodeAt(Y),i,o=Ae[Y],a,l,f;switch(t){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++Y,{type:Un,value:String.fromCharCode(t),start:e,end:Y};default:if(i=Ae.charCodeAt(Y+1),i===61)switch(t){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return Y+=2,{type:Un,value:String.fromCharCode(t)+String.fromCharCode(i),start:e,end:Y};case 33:case 61:return Y+=2,Ae.charCodeAt(Y)===61&&++Y,{type:Un,value:Ae.slice(e,Y),start:e,end:Y}}}if(f=Ae.substr(Y,4),f===">>>=")return Y+=4,{type:Un,value:f,start:e,end:Y};if(l=f.substr(0,3),l===">>>"||l==="<<="||l===">>=")return Y+=3,{type:Un,value:l,start:e,end:Y};if(a=l.substr(0,2),o===a[1]&&"+-<>&|".includes(o)||a==="=>")return Y+=2,{type:Un,value:a,start:e,end:Y};if(a==="//"&&Qe({},Yt,An),"<>=!+-*%&|^/".includes(o))return++Y,{type:Un,value:o,start:e,end:Y};Qe({},Yt,An)}function $w(e){let t="";for(;Y<xn&&eh(Ae[Y]);)t+=Ae[Y++];return t.length===0&&Qe({},Yt,An),ku(Ae.charCodeAt(Y))&&Qe({},Yt,An),{type:Nt,value:parseInt("0x"+t,16),start:e,end:Y}}function Ow(e){let t="0"+Ae[Y++];for(;Y<xn&&Sc(Ae[Y]);)t+=Ae[Y++];return(ku(Ae.charCodeAt(Y))||Ro(Ae.charCodeAt(Y)))&&Qe({},Yt,An),{type:Nt,value:parseInt(t,8),octal:!0,start:e,end:Y}}function Cx(){var e,t,i;if(i=Ae[Y],Cc(Ro(i.charCodeAt(0))||i===".","Numeric literal must start with a decimal digit or a decimal point"),t=Y,e="",i!=="."){if(e=Ae[Y++],i=Ae[Y],e==="0"){if(i==="x"||i==="X")return++Y,$w(t);if(Sc(i))return Ow(t);i&&Ro(i.charCodeAt(0))&&Qe({},Yt,An)}for(;Ro(Ae.charCodeAt(Y));)e+=Ae[Y++];i=Ae[Y]}if(i==="."){for(e+=Ae[Y++];Ro(Ae.charCodeAt(Y));)e+=Ae[Y++];i=Ae[Y]}if(i==="e"||i==="E")if(e+=Ae[Y++],i=Ae[Y],(i==="+"||i==="-")&&(e+=Ae[Y++]),Ro(Ae.charCodeAt(Y)))for(;Ro(Ae.charCodeAt(Y));)e+=Ae[Y++];else Qe({},Yt,An);return ku(Ae.charCodeAt(Y))&&Qe({},Yt,An),{type:Nt,value:parseFloat(e),start:t,end:Y}}function Tw(){var e="",t,i,o,a,l=!1;for(t=Ae[Y],Cc(t==="'"||t==='"',"String literal must starts with a quote"),i=Y,++Y;Y<xn;)if(o=Ae[Y++],o===t){t="";break}else if(o==="\\")if(o=Ae[Y++],!o||!Fc(o.charCodeAt(0)))switch(o){case"u":case"x":Ae[Y]==="{"?(++Y,e+=Ex()):e+=km(o);break;case"n":e+=`
`;break;case"r":e+="\r";break;case"t":e+="	";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:Sc(o)?(a="01234567".indexOf(o),a!==0&&(l=!0),Y<xn&&Sc(Ae[Y])&&(l=!0,a=a*8+"01234567".indexOf(Ae[Y++]),"0123".includes(o)&&Y<xn&&Sc(Ae[Y])&&(a=a*8+"01234567".indexOf(Ae[Y++]))),e+=String.fromCharCode(a)):e+=o;break}else o==="\r"&&Ae[Y]===`
`&&++Y;else{if(Fc(o.charCodeAt(0)))break;e+=o}return t!==""&&Qe({},Yt,An),{type:Ac,value:e,octal:l,start:i,end:Y}}function Rw(e,t){let i=e;t.includes("u")&&(i=i.replace(/\\u\{([0-9a-fA-F]+)\}/g,(o,a)=>{if(parseInt(a,16)<=1114111)return"x";Qe({},Sm)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(i)}catch{Qe({},Sm)}try{return new RegExp(e,t)}catch{return null}}function Nw(){var e,t,i,o,a;for(e=Ae[Y],Cc(e==="/","Regular expression literal must start with a slash"),t=Ae[Y++],i=!1,o=!1;Y<xn;)if(e=Ae[Y++],t+=e,e==="\\")e=Ae[Y++],Fc(e.charCodeAt(0))&&Qe({},Fm),t+=e;else if(Fc(e.charCodeAt(0)))Qe({},Fm);else if(i)e==="]"&&(i=!1);else if(e==="/"){o=!0;break}else e==="["&&(i=!0);return o||Qe({},Fm),a=t.substr(1,t.length-2),{value:a,literal:t}}function _w(){var e,t,i;for(t="",i="";Y<xn&&(e=Ae[Y],!!th(e.charCodeAt(0)));)++Y,e==="\\"&&Y<xn?Qe({},Yt,An):(i+=e,t+=e);return i.search(/[^gimuy]/g)>=0&&Qe({},Sm,i),{value:i,literal:t}}function Mw(){var e,t,i,o;return st=null,Dm(),e=Y,t=Nw(),i=_w(),o=Rw(t.value,i.value),{literal:t.literal+i.literal,value:o,regex:{pattern:t.value,flags:i.value},start:e,end:Y}}function Bw(e){return e.type===En||e.type===Oo||e.type===Ea||e.type===Zd}function Tm(){if(Dm(),Y>=xn)return{type:Aa,start:Y,end:Y};const e=Ae.charCodeAt(Y);return ku(e)?kw():e===40||e===41||e===59?Om():e===39||e===34?Tw():e===46?Ro(Ae.charCodeAt(Y+1))?Cx():Om():Ro(e)?Cx():Om()}function oi(){const e=st;return Y=e.end,st=Tm(),Y=e.end,e}function Sx(){const e=Y;st=Tm(),Y=e}function Lw(e){const t=new $r(vw);return t.elements=e,t}function nh(e,t,i){const o=new $r(e==="||"||e==="&&"?Ew:bw);return o.operator=e,o.left=t,o.right=i,o}function Bt(e,t){const i=new $r(xw);return i.callee=e,i.arguments=t,i}function Fi(e,t,i){const o=new $r(Em);return o.test=e,o.consequent=t,o.alternate=i,o}function wc(e){const t=new $r(To);return t.name=e,t}function Qr(e){const t=new $r(Am);return t.value=e.value,t.raw=Ae.slice(e.start,e.end),e.regex&&(t.raw==="//"&&(t.raw="/(?:)/"),t.regex=e.regex),t}function ih(e,t,i){const o=new $r(Aw);return o.computed=e==="[",o.object=t,o.property=i,o.computed||(i.member=!0),o}function Fx(e){const t=new $r(px);return t.properties=e,t}function Dc(e,t,i){const o=new $r(Cm);return o.key=t,o.value=i,o.kind=e,o}function rh(e,t){const i=new $r(Cw);return i.operator=e,i.argument=t,i.prefix=!0,i}function Qe(e,t){var i,o=Array.prototype.slice.call(arguments,2),a=t.replace(/%(\d)/g,(l,f)=>(Cc(f<o.length,"Message reference must be in range"),o[f]));throw i=new Error(a),i.index=Y,i.description=a,i}function Ca(e){e.type===Aa&&Qe(e,vx),e.type===Nt&&Qe(e,Jd),e.type===Ac&&Qe(e,mx),e.type===En&&Qe(e,yx),e.type===Oo&&Qe(e,Sw),Qe(e,Yt,e.value)}function Vt(e){const t=oi();(t.type!==Un||t.value!==e)&&Ca(t)}function pt(e){return st.type===Un&&st.value===e}function No(e){return st.type===Oo&&st.value===e}function oh(){const e=[];for(Y=st.start,Vt("[");!pt("]");)pt(",")?(oi(),e.push(null)):(e.push(_o()),pt("]")||Vt(","));return oi(),Lw(e)}function $u(){Y=st.start;const e=oi();return e.type===Ac||e.type===Nt?(e.octal&&Qe(e,wm),Qr(e)):wc(e.value)}function sh(){var e,t,i,o;if(Y=st.start,e=st,e.type===En)return i=$u(),Vt(":"),o=_o(),Dc("init",i,o);if(e.type===Aa||e.type===Un)Ca(e);else return t=$u(),Vt(":"),o=_o(),Dc("init",t,o)}function ah(){var e=[],t,i,o,a={},l=String;for(Y=st.start,Vt("{");!pt("}");)t=sh(),t.key.type===To?i=t.key.name:i=l(t.key.value),o="$"+i,Object.prototype.hasOwnProperty.call(a,o)?Qe({},Fw):a[o]=!0,e.push(t),pt("}")||Vt(",");return Vt("}"),Fx(e)}function uh(){Vt("(");const e=Ou();return Vt(")"),e}const lh={if:1};function wx(){var e,t,i;if(pt("("))return uh();if(pt("["))return oh();if(pt("{"))return ah();if(e=st.type,Y=st.start,e===En||lh[st.value])i=wc(oi().value);else if(e===Ac||e===Nt)st.octal&&Qe(st,wm),i=Qr(oi());else{if(e===Oo)throw new Error(Du);e===Ea?(t=oi(),t.value=t.value==="true",i=Qr(t)):e===Zd?(t=oi(),t.value=null,i=Qr(t)):pt("/")||pt("/=")?(i=Qr(Mw()),Sx()):Ca(oi())}return i}function zw(){const e=[];if(Vt("("),!pt(")"))for(;Y<xn&&(e.push(_o()),!pt(")"));)Vt(",");return Vt(")"),e}function Iw(){Y=st.start;const e=oi();return Bw(e)||Ca(e),wc(e.value)}function Pw(){return Vt("."),Iw()}function Uw(){Vt("[");const e=Ou();return Vt("]"),e}function jw(){var e,t,i;for(e=wx();;)if(pt("."))i=Pw(),e=ih(".",e,i);else if(pt("("))t=zw(),e=Bt(e,t);else if(pt("["))i=Uw(),e=ih("[",e,i);else break;return e}function Rm(){const e=jw();if(st.type===Un&&(pt("++")||pt("--")))throw new Error(Du);return e}function kc(){var e,t;if(st.type!==Un&&st.type!==Oo)t=Rm();else{if(pt("++")||pt("--"))throw new Error(Du);if(pt("+")||pt("-")||pt("~")||pt("!"))e=oi(),t=kc(),t=rh(e.value,t);else{if(No("delete")||No("void")||No("typeof"))throw new Error(Du);t=Rm()}}return t}function Dx(e){let t=0;if(e.type!==Un&&e.type!==Oo)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11;break}return t}function Gw(){var e,t,i,o,a,l,f,h,g,m;if(e=st,g=kc(),o=st,a=Dx(o),a===0)return g;for(o.prec=a,oi(),t=[e,st],f=kc(),l=[g,o,f];(a=Dx(st))>0;){for(;l.length>2&&a<=l[l.length-2].prec;)f=l.pop(),h=l.pop().value,g=l.pop(),t.pop(),i=nh(h,g,f),l.push(i);o=oi(),o.prec=a,l.push(o),t.push(st),i=kc(),l.push(i)}for(m=l.length-1,i=l[m],t.pop();m>1;)t.pop(),i=nh(l[m-1].value,l[m-2],i),m-=2;return i}function _o(){var e,t,i;return e=Gw(),pt("?")&&(oi(),t=_o(),Vt(":"),i=_o(),e=Fi(e,t,i)),e}function Ou(){const e=_o();if(pt(","))throw new Error(Du);return e}function kx(e){Ae=e,Y=0,xn=Ae.length,st=null,Sx();const t=Ou();if(st.type!==Aa)throw new Error("Unexpect token after expression.");return t}var $x={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function ch(e){function t(f,h,g,m){let v=e(h[0]);return g&&(v=g+"("+v+")",g.lastIndexOf("new ",0)===0&&(v="("+v+")")),v+"."+f+(m<0?"":m===0?"()":"("+h.slice(1).map(e).join(",")+")")}function i(f,h,g){return m=>t(f,m,h,g)}const o="new Date",a="String",l="RegExp";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",hypot:"Math.hypot",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(f){f.length<3&&(0,b.z3)("Missing arguments to clamp function."),f.length>3&&(0,b.z3)("Too many arguments to clamp function.");const h=f.map(e);return"Math.max("+h[1]+", Math.min("+h[2]+","+h[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:o,date:i("getDate",o,0),day:i("getDay",o,0),year:i("getFullYear",o,0),month:i("getMonth",o,0),hours:i("getHours",o,0),minutes:i("getMinutes",o,0),seconds:i("getSeconds",o,0),milliseconds:i("getMilliseconds",o,0),time:i("getTime",o,0),timezoneoffset:i("getTimezoneOffset",o,0),utcdate:i("getUTCDate",o,0),utcday:i("getUTCDay",o,0),utcyear:i("getUTCFullYear",o,0),utcmonth:i("getUTCMonth",o,0),utchours:i("getUTCHours",o,0),utcminutes:i("getUTCMinutes",o,0),utcseconds:i("getUTCSeconds",o,0),utcmilliseconds:i("getUTCMilliseconds",o,0),length:i("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:i("toUpperCase",a,0),lower:i("toLowerCase",a,0),substring:i("substring",a),split:i("split",a),trim:i("trim",a,0),regexp:l,test:i("test",l),if:function(f){f.length<3&&(0,b.z3)("Missing arguments to if function."),f.length>3&&(0,b.z3)("Too many arguments to if function.");const h=f.map(e);return"("+h[0]+"?"+h[1]+":"+h[2]+")"}}}function $c(e){const t=e&&e.length-1;return t&&(e[0]==='"'&&e[t]==='"'||e[0]==="'"&&e[t]==="'")?e.slice(1,-1):e}function Ox(e){e=e||{};const t=e.allowed?(0,b.M1)(e.allowed):{},i=e.forbidden?(0,b.M1)(e.forbidden):{},o=e.constants||$x,a=(e.functions||ch)(x),l=e.globalvar,f=e.fieldvar,h=(0,b.Tn)(l)?l:S=>`${l}["${S}"]`;let g={},m={},v=0;function x(S){if((0,b.Kg)(S))return S;const D=C[S.type];return D==null&&(0,b.z3)("Unsupported type: "+S.type),D(S)}const C={Literal:S=>S.raw,Identifier:S=>{const D=S.name;return v>0?D:(0,b.mQ)(i,D)?(0,b.z3)("Illegal identifier: "+D):(0,b.mQ)(o,D)?o[D]:(0,b.mQ)(t,D)?D:(g[D]=1,h(D))},MemberExpression:S=>{const D=!S.computed,k=x(S.object);D&&(v+=1);const O=x(S.property);return k===f&&(m[$c(O)]=1),D&&(v-=1),k+(D?"."+O:"["+O+"]")},CallExpression:S=>{S.callee.type!=="Identifier"&&(0,b.z3)("Illegal callee type: "+S.callee.type);const D=S.callee.name,k=S.arguments,O=(0,b.mQ)(a,D)&&a[D];return O||(0,b.z3)("Unrecognized function: "+D),(0,b.Tn)(O)?O(k):O+"("+k.map(x).join(",")+")"},ArrayExpression:S=>"["+S.elements.map(x).join(",")+"]",BinaryExpression:S=>"("+x(S.left)+" "+S.operator+" "+x(S.right)+")",UnaryExpression:S=>"("+S.operator+x(S.argument)+")",ConditionalExpression:S=>"("+x(S.test)+"?"+x(S.consequent)+":"+x(S.alternate)+")",LogicalExpression:S=>"("+x(S.left)+S.operator+x(S.right)+")",ObjectExpression:S=>"{"+S.properties.map(x).join(",")+"}",Property:S=>{v+=1;const D=x(S.key);return v-=1,D+":"+x(S.value)}};function w(S){const D={code:x(S),globals:Object.keys(g),fields:Object.keys(m)};return g={},m={},D}return w.functions=a,w.constants=o,w}var Tx=z(59820),Ww=z(19352),Vw=z(89241),Oc=z(34518),fh=z(38959),Hw=z(21419);const Rx=Symbol("vega_selection_getter");function Nx(e){return(!e.getter||!e.getter[Rx])&&(e.getter=(0,b.ZZ)(e.field),e.getter[Rx]=!0),e.getter}const dh="intersect",hh="union",qw="vlMulti",Xw="vlPoint",_x="or",Yw="and",Zr="_vgsid_",Tc=(0,b.ZZ)(Zr),Kw="E",Qw="R",Zw="R-E",Jw="R-LE",e2="R-RE",t2="E-LT",n2="E-LTE",i2="E-GT",r2="E-GTE",o2="E-VALID",s2="E-ONE",Tu="index:unit";function Mx(e,t){for(var i=t.fields,o=t.values,a=i.length,l=0,f,h;l<a;++l)if(h=i[l],f=Nx(h)(e),(0,b.$P)(f)&&(f=(0,b.Ro)(f)),(0,b.$P)(o[l])&&(o[l]=(0,b.Ro)(o[l])),(0,b.cy)(o[l])&&(0,b.$P)(o[l][0])&&(o[l]=o[l].map(b.Ro)),h.type===Kw){if((0,b.cy)(o[l])?!o[l].includes(f):f!==o[l])return!1}else if(h.type===Qw){if(!(0,b.PK)(f,o[l]))return!1}else if(h.type===e2){if(!(0,b.PK)(f,o[l],!0,!1))return!1}else if(h.type===Zw){if(!(0,b.PK)(f,o[l],!1,!1))return!1}else if(h.type===Jw){if(!(0,b.PK)(f,o[l],!1,!0))return!1}else if(h.type===t2){if(f>=o[l])return!1}else if(h.type===n2){if(f>o[l])return!1}else if(h.type===i2){if(f<=o[l])return!1}else if(h.type===r2){if(f<o[l])return!1}else if(h.type===o2){if(f===null||isNaN(f))return!1}else if(h.type===s2&&o[l].indexOf(f)===-1)return!1;return!0}function a2(e,t,i){for(var o=this.context.data[e],a=o?o.values.value:[],l=o?o[Tu]&&o[Tu].value:void 0,f=i===dh,h=a.length,g=0,m,v,x,C,w;g<h;++g)if(m=a[g],l&&f){if(v=v||{},x=v[C=m.unit]||0,x===-1)continue;if(w=Mx(t,m),v[C]=w?-1:++x,w&&l.size===1)return!0;if(!w&&x===l.get(C).count)return!1}else if(w=Mx(t,m),f^w)return w;return h&&f}const Bx=(0,jt.A)(Tc),u2=Bx.left,l2=Bx.right;function c2(e,t,i){const o=this.context.data[e],a=o?o.values.value:[],l=o?o[Tu]&&o[Tu].value:void 0,f=i===dh,h=Tc(t),g=u2(a,h);if(g===a.length||Tc(a[g])!==h)return!1;if(l&&f){if(l.size===1)return!0;if(l2(a,h)-g<l.size)return!1}return!0}function f2(e,t){return e.map(i=>(0,b.X$)(t.fields?{values:t.fields.map(o=>Nx(o)(i.datum))}:{[Zr]:Tc(i.datum)},t))}function d2(e,t,i,o){for(var a=this.context.data[e],l=a?a.values.value:[],f={},h={},g={},m,v,x,C,w,S,D,k,O,R,I=l.length,V=0,W,ee;V<I;++V)if(m=l[V],C=m.unit,v=m.fields,x=m.values,v&&x){for(W=0,ee=v.length;W<ee;++W)w=v[W],D=f[w.field]||(f[w.field]={}),k=D[C]||(D[C]=[]),g[w.field]=O=w.type.charAt(0),R=Nm[`${O}_union`],D[C]=R(k,(0,b.YO)(x[W]));i&&(k=h[C]||(h[C]=[]),k.push((0,b.YO)(x).reduce((M,J,ue)=>(M[v[ue].field]=J,M),{})))}else w=Zr,S=Tc(m),D=f[w]||(f[w]={}),k=D[C]||(D[C]=[]),k.push(S),i&&(k=h[C]||(h[C]=[]),k.push({[Zr]:S}));if(t=t||hh,f[Zr]?f[Zr]=Nm[`${Zr}_${t}`](...Object.values(f[Zr])):Object.keys(f).forEach(M=>{f[M]=Object.keys(f[M]).map(J=>f[M][J]).reduce((J,ue)=>J===void 0?ue:Nm[`${g[M]}_${t}`](J,ue))}),l=Object.keys(h),i&&l.length){const M=o?Xw:qw;f[M]=t===hh?{[_x]:l.reduce((J,ue)=>(J.push(...h[ue]),J),[])}:{[Yw]:l.map(J=>({[_x]:h[J]}))}}return f}var Nm={[`${Zr}_union`]:fh.A,[`${Zr}_intersect`]:Hw.A,E_union:function(e,t){if(!e.length)return t;for(var i=0,o=t.length;i<o;++i)e.includes(t[i])||e.push(t[i]);return e},E_intersect:function(e,t){return e.length?e.filter(i=>t.includes(i)):t},R_union:function(e,t){var i=(0,b.Ro)(t[0]),o=(0,b.Ro)(t[1]);return i>o&&(i=t[1],o=t[0]),e.length?(e[0]>i&&(e[0]=i),e[1]<o&&(e[1]=o),e):[i,o]},R_intersect:function(e,t){var i=(0,b.Ro)(t[0]),o=(0,b.Ro)(t[1]);return i>o&&(i=t[1],o=t[0]),e.length?o<e[0]||e[1]<i?[]:(e[0]<i&&(e[0]=i),e[1]>o&&(e[1]=o),e):[i,o]}};const h3=":",gh="@";function _m(e,t,i,o){t[0].type!==ba&&(0,b.z3)("First argument to selection functions must be a string literal.");const a=t[0].value,l=t.length>=2&&(0,b.se)(t).value,f="unit",h=gh+f,g=h3+a;l===dh&&!(0,b.mQ)(o,h)&&(o[h]=i.getData(a).indataRef(i,f)),(0,b.mQ)(o,g)||(o[g]=i.getData(a).tuplesRef())}function Mm(e){const t=this.context.data[e];return t?t.values.value:[]}function h2(e,t,i){const o=this.context.data[e]["index:"+t],a=o?o.value.get(i):void 0;return a&&a.count}function Lx(e,t){const i=this.context.dataflow,o=this.context.data[e],a=o.input;return i.pulse(a,i.changeset().remove(b.vN).insert(t)),1}function g2(e,t,i){if(e){const o=this.context.dataflow,a=e.mark.source;o.pulse(a,o.changeset().encode(e,t))}return i!==void 0?i:e}const Rc=e=>function(t,i){const o=this.context.dataflow.locale();return t===null?"null":o[e](i)(t)},Bm=Rc("format"),zx=Rc("timeFormat"),p2=Rc("utcFormat"),m2=Rc("timeParse"),Ix=Rc("utcParse"),Ru=new Date(2e3,0,1);function Nu(e,t,i){return!Number.isInteger(e)||!Number.isInteger(t)?"":(Ru.setYear(2e3),Ru.setMonth(e),Ru.setDate(t),zx.call(this,Ru,i))}function y2(e){return Nu.call(this,e,1,"%B")}function v2(e){return Nu.call(this,e,1,"%b")}function b2(e){return Nu.call(this,0,2+e,"%A")}function x2(e){return Nu.call(this,0,2+e,"%a")}const E2=":",Px="@",Lm="%",Ux="$";function zm(e,t,i,o){t[0].type!==ba&&(0,b.z3)("First argument to data functions must be a string literal.");const a=t[0].value,l=E2+a;if(!(0,b.mQ)(l,o))try{o[l]=i.getData(a).tuplesRef()}catch{}}function A2(e,t,i,o){t[0].type!==ba&&(0,b.z3)("First argument to indata must be a string literal."),t[1].type!==ba&&(0,b.z3)("Second argument to indata must be a string literal.");const a=t[0].value,l=t[1].value,f=Px+l;(0,b.mQ)(f,o)||(o[f]=i.getData(a).indataRef(i,l))}function jn(e,t,i,o){if(t[0].type===ba)jx(i,o,t[0].value);else for(e in i.scales)jx(i,o,e)}function jx(e,t,i){const o=Lm+i;if(!(0,b.mQ)(t,o))try{t[o]=e.scaleRef(i)}catch{}}function Jr(e,t){if((0,b.Kg)(e)){const i=t.scales[e];return i&&Ys(i.value)?i.value:void 0}}function C2(e,t,i){t.__bandwidth=a=>a&&a.bandwidth?a.bandwidth():0,i._bandwidth=jn,i._range=jn,i._scale=jn;const o=a=>"_["+(a.type===ba?(0,b.r$)(Lm+a.value):(0,b.r$)(Lm)+"+"+e(a))+"]";return{_bandwidth:a=>`this.__bandwidth(${o(a[0])})`,_range:a=>`${o(a[0])}.range()`,_scale:a=>`${o(a[0])}(${e(a[1])})`}}function Im(e,t){return function(i,o,a){if(i){const l=Jr(i,(a||this).context);return l&&l.path[e](o)}else return t(o)}}const S2=Im("area",Tx.Ay),F2=Im("bounds",Ww.A),w2=Im("centroid",Vw.A);function D2(e,t){const i=Jr(e,(t||this).context);return i&&i.scale()}function k2(e){const t=this.context.group;let i=!1;if(t)for(;e;){if(e===t){i=!0;break}e=e.mark.group}return i}function Pm(e,t,i){try{e[t].apply(e,["EXPRESSION"].concat([].slice.call(i)))}catch(o){e.warn(o)}return i[i.length-1]}function $2(){return Pm(this.context.dataflow,"warn",arguments)}function O2(){return Pm(this.context.dataflow,"info",arguments)}function T2(){return Pm(this.context.dataflow,"debug",arguments)}function Um(e){const t=e/255;return t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}function xs(e){const t=(0,dc.Qh)(e),i=Um(t.r),o=Um(t.g),a=Um(t.b);return .2126*i+.7152*o+.0722*a}function Gx(e,t){const i=xs(e),o=xs(t),a=Math.max(i,o),l=Math.min(i,o);return(a+.05)/(l+.05)}function R2(){const e=[].slice.call(arguments);return e.unshift({}),(0,b.X$)(...e)}function Es(e,t){return e===t||e!==e&&t!==t?!0:(0,b.cy)(e)?(0,b.cy)(t)&&e.length===t.length?N2(e,t):!1:(0,b.Gv)(e)&&(0,b.Gv)(t)?As(e,t):!1}function N2(e,t){for(let i=0,o=e.length;i<o;++i)if(!Es(e[i],t[i]))return!1;return!0}function As(e,t){for(const i in e)if(!Es(e[i],t[i]))return!1;return!0}function ph(e){return t=>As(e,t)}function _2(e,t,i,o,a,l){const f=this.context.dataflow,h=this.context.data[e],g=h.input,m=f.stamp();let v=h.changes,x,C;if(f._trigger===!1||!(g.value.length||t||o))return 0;if((!v||v.stamp<m)&&(h.changes=v=f.changeset(),v.stamp=m,f.runAfter(()=>{h.modified=!0,f.pulse(g,v).run()},!0,1)),i&&(x=i===!0?b.vN:(0,b.cy)(i)||Bs(i)?i:ph(i),v.remove(x)),t&&v.insert(t),o&&(x=ph(o),g.value.some(x)?v.remove(x):v.insert(o)),a)for(C in l)v.modify(a,C,l[C]);return 1}function M2(e){const t=e.touches,i=t[0].clientX-t[1].clientX,o=t[0].clientY-t[1].clientY;return Math.hypot(i,o)}function Wx(e){const t=e.touches;return Math.atan2(t[0].clientY-t[1].clientY,t[0].clientX-t[1].clientX)}const jm={};function B2(e,t){const i=jm[t]||(jm[t]=(0,b.ZZ)(t));return(0,b.cy)(e)?e.map(i):i(e)}function eo(e){return(0,b.cy)(e)||ArrayBuffer.isView(e)?e:null}function Gm(e){return eo(e)||((0,b.Kg)(e)?e:null)}function L2(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),o=1;o<t;o++)i[o-1]=arguments[o];return eo(e).join(...i)}function z2(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),o=1;o<t;o++)i[o-1]=arguments[o];return Gm(e).indexOf(...i)}function Vx(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),o=1;o<t;o++)i[o-1]=arguments[o];return Gm(e).lastIndexOf(...i)}function Hx(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),o=1;o<t;o++)i[o-1]=arguments[o];return Gm(e).slice(...i)}function I2(e,t,i){return(0,b.Tn)(i)&&(0,b.z3)("Function argument passed to replace."),String(e).replace(t,i)}function Sa(e){return eo(e).slice().reverse()}function Wm(e){return eo(e).slice().sort(b.V_)}function qx(e,t,i){return by(e||0,t||0,i||0)}function Xx(e,t){const i=Jr(e,(t||this).context);return i&&i.bandwidth?i.bandwidth():0}function Nc(e,t){const i=Jr(e,(t||this).context);return i?i.copy():void 0}function P2(e,t){const i=Jr(e,(t||this).context);return i?i.domain():[]}function Fa(e,t,i){const o=Jr(e,(i||this).context);return o?(0,b.cy)(t)?(o.invertRange||o.invert)(t):(o.invert||o.invertExtent)(t):void 0}function mh(e,t){const i=Jr(e,(t||this).context);return i&&i.range?i.range():[]}function U2(e,t,i){const o=Jr(e,(i||this).context);return o?o(t):void 0}function wa(e,t,i,o,a){let l=typeof e=="string"?Jr(e,(a||this).context):e;const f=Ny(t,i);let h=l.domain(),g=h[0],m=(0,b.se)(h),v=b.D_;return m-g?v=ip(l,g,m):l=(l.interpolator?it("sequential")().interpolator(l.interpolator()):it("linear")().interpolate(l.interpolate()).range(l.range())).domain([g=0,m=1]),l.ticks&&(h=l.ticks(+o||15),g!==h[0]&&h.unshift(g),m!==(0,b.se)(h)&&h.push(m)),h.forEach(x=>f.stop(v(x),l(x))),f}function j2(e,t,i){const o=Jr(e,(i||this).context);return function(a){return o?o.path.context(a)(t):""}}function Xi(e){let t=null;return function(i){return i?Sl(i,t=t||Qs(e)):e}}const Vm=e=>e.data;function Yx(e,t){const i=Mm.call(t,e);return i.root&&i.root.lookup||{}}function yh(e,t,i){const o=Yx(e,this),a=o[t],l=o[i];return a&&l?a.path(l).map(Vm):void 0}function Hm(e,t){const i=Yx(e,this)[t];return i?i.ancestors().map(Vm):void 0}const Kx=()=>typeof window<"u"&&window||null;function G2(){const e=Kx();return e?e.screen:{}}function W2(){const e=Kx();return e?[e.innerWidth,e.innerHeight]:[void 0,void 0]}function _c(){const e=this.context.dataflow,t=e.container&&e.container();return t?[t.clientWidth,t.clientHeight]:[void 0,void 0]}function Qx(e,t,i){if(!e)return[];const[o,a]=e,l=new Dt().set(o[0],o[1],a[0],a[1]),f=i||this.context.dataflow.scenegraph().root;return c0(f,l,Da(t))}function Da(e){let t=null;if(e){const i=(0,b.YO)(e.marktype),o=(0,b.YO)(e.markname);t=a=>(!i.length||i.some(l=>a.marktype===l))&&(!o.length||o.some(l=>a.name===l))}return t}function Zx(e,t,i){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:5;e=(0,b.YO)(e);const a=e[e.length-1];return a===void 0||Math.hypot(a[0]-t,a[1]-i)>o?[...e,[t,i]]:e}function vh(e){return(0,b.YO)(e).reduce((t,i,o)=>{let[a,l]=i;return t+=o==0?`M ${a},${l} `:o===e.length-1?" Z":`L ${a},${l} `},"")}function V2(e,t,i){const{x:o,y:a,mark:l}=i,f=new Dt().set(Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER);for(const[g,m]of t)g<f.x1&&(f.x1=g),g>f.x2&&(f.x2=g),m<f.y1&&(f.y1=m),m>f.y2&&(f.y2=m);return f.translate(o,a),Qx([[f.x1,f.y1],[f.x2,f.y2]],e,l).filter(g=>qm(g.x,g.y,t))}function qm(e,t,i){let o=0;for(let a=0,l=i.length-1;a<i.length;l=a++){const[f,h]=i[l],[g,m]=i[a];m>t!=h>t&&e<(f-g)*(t-m)/(h-m)+g&&o++}return o&1}const _u={random(){return ar()},cumulativeNormal:Tt,cumulativeLogNormal:rf,cumulativeUniform:P1,densityNormal:ur,densityLogNormal:Gs,densityUniform:I1,quantileNormal:ja,quantileLogNormal:L1,quantileUniform:U1,sampleNormal:Ua,sampleLogNormal:B1,sampleUniform:z1,isArray:b.cy,isBoolean:b.Lm,isDate:b.$P,isDefined(e){return e!==void 0},isNumber:b.Et,isObject:b.Gv,isRegExp:b.gd,isString:b.Kg,isTuple:Bs,isValid(e){return e!=null&&e===e},toBoolean:b.G4,toDate(e){return(0,b.ay)(e)},toNumber:b.Ro,toString:b.dI,indexof:z2,join:L2,lastindexof:Vx,replace:I2,reverse:Sa,sort:Wm,slice:Hx,flush:b.bX,lerp:b.Cc,merge:R2,pad:b.eV,peek:b.se,pluck:B2,span:b.Ln,inrange:b.PK,truncate:b.xv,rgb:dc.Qh,lab:Oc.Ay,hcl:Oc.aq,hsl:dc.KI,luminance:xs,contrast:Gx,sequence:nt.A,format:Bm,utcFormat:p2,utcParse:Ix,utcOffset:Yh,utcSequence:Qh,timeFormat:zx,timeParse:m2,timeOffset:Yc,timeSequence:Uo,timeUnitSpecifier:ks,monthFormat:y2,monthAbbrevFormat:v2,dayFormat:b2,dayAbbrevFormat:x2,quarter:b.$G,utcquarter:b.vu,week:Gu,utcweek:Vh,dayofyear:zo,utcdayofyear:$s,warn:$2,info:O2,debug:T2,extent(e){return(0,b.Xx)(e)},inScope:k2,intersect:Qx,clampRange:b.BS,pinchDistance:M2,pinchAngle:Wx,screen:G2,containerSize:_c,windowSize:W2,bandspace:qx,setdata:Lx,pathShape:Xi,panLinear:b.VC,panLog:b.KH,panPow:b.co,panSymlog:b.zy,zoomLinear:b.lL,zoomLog:b.oV,zoomPow:b.SW,zoomSymlog:b.B2,encode:g2,modify:_2,lassoAppend:Zx,lassoPath:vh,intersectLasso:V2},Jx=["view","item","group","xy","x","y"],eE="event.vega.",Mu="this.",bh={},Xm={forbidden:["_"],allowed:["datum","event","item"],fieldvar:"datum",globalvar:e=>`_[${(0,b.r$)(Ux+e)}]`,functions:tE,constants:$x,visitors:bh},ka=Ox(Xm);function tE(e){const t=ch(e);Jx.forEach(i=>t[i]=eE+i);for(const i in _u)t[i]=Mu+i;return(0,b.X$)(t,C2(e,_u,bh)),t}function Ht(e,t,i){return arguments.length===1?_u[e]:(_u[e]=t,i&&(bh[e]=i),ka&&(ka.functions[e]=Mu+e),this)}Ht("bandwidth",Xx,jn),Ht("copy",Nc,jn),Ht("domain",P2,jn),Ht("range",mh,jn),Ht("invert",Fa,jn),Ht("scale",U2,jn),Ht("gradient",wa,jn),Ht("geoArea",S2,jn),Ht("geoBounds",F2,jn),Ht("geoCentroid",w2,jn),Ht("geoShape",j2,jn),Ht("geoScale",D2,jn),Ht("indata",h2,A2),Ht("data",Mm,zm),Ht("treePath",yh,zm),Ht("treeAncestors",Hm,zm),Ht("vlSelectionTest",a2,_m),Ht("vlSelectionIdTest",c2,_m),Ht("vlSelectionResolve",d2,_m),Ht("vlSelectionTuples",f2);function Kt(e,t){const i={};let o;try{e=(0,b.Kg)(e)?e:(0,b.r$)(e)+"",o=kx(e)}catch{(0,b.z3)("Expression parse error: "+e)}o.visit(l=>{if(l.type!==gx)return;const f=l.callee.name,h=Xm.visitors[f];h&&h(f,l.arguments,t,i)});const a=ka(o);return a.globals.forEach(l=>{const f=Ux+l;!(0,b.mQ)(i,f)&&t.getSignal(l)&&(i[f]=t.signalRef(l))}),{$expr:(0,b.X$)({code:a.code},t.options.ast?{ast:o}:null),$fields:a.fields,$params:i}}function H2(e){const t=this,i=e.operators||[];return e.background&&(t.background=e.background),e.eventConfig&&(t.eventConfig=e.eventConfig),e.locale&&(t.locale=e.locale),i.forEach(o=>t.parseOperator(o)),i.forEach(o=>t.parseOperatorParameters(o)),(e.streams||[]).forEach(o=>t.parseStream(o)),(e.updates||[]).forEach(o=>t.parseUpdate(o)),t.resolve()}const q2=(0,b.M1)(["rule"]),nE=(0,b.M1)(["group","image","rect"]);function X2(e,t){let i="";return q2[t]||(e.x2&&(e.x?(nE[t]&&(i+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),i+="o.width=o.x2-o.x;"):i+="o.x=o.x2-(o.width||0);"),e.xc&&(i+="o.x=o.xc-(o.width||0)/2;"),e.y2&&(e.y?(nE[t]&&(i+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),i+="o.height=o.y2-o.y;"):i+="o.y=o.y2-(o.height||0);"),e.yc&&(i+="o.y=o.yc-(o.height||0)/2;")),i}function Ym(e){return(e+"").toLowerCase()}function Y2(e){return Ym(e)==="operator"}function K2(e){return Ym(e)==="collect"}function Bu(e,t,i){i.endsWith(";")||(i="return("+i+");");const o=Function(...t.concat(i));return e&&e.functions?o.bind(e.functions):o}function iE(e,t,i,o){return`((u = ${e}) < (v = ${t}) || u == null) && v != null ? ${i}
  : (u > v || v == null) && u != null ? ${o}
  : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? ${i}
  : v !== v && u === u ? ${o} : `}var rE={operator:(e,t)=>Bu(e,["_"],t.code),parameter:(e,t)=>Bu(e,["datum","_"],t.code),event:(e,t)=>Bu(e,["event"],t.code),handler:(e,t)=>{const i=`var datum=event.item&&event.item.datum;return ${t.code};`;return Bu(e,["_","event"],i)},encode:(e,t)=>{const{marktype:i,channels:o}=t;let a="var o=item,datum=o.datum,m=0,$;";for(const l in o){const f="o["+(0,b.r$)(l)+"]";a+=`$=${o[l].code};if(${f}!==$)${f}=$,m=1;`}return a+=X2(o,i),a+="return m;",Bu(e,["item","_"],a)},codegen:{get(e){const t=`[${e.map(b.r$).join("][")}]`,i=Function("_",`return _${t};`);return i.path=t,i},comparator(e,t){let i;const o=(l,f)=>{const h=t[f];let g,m;return l.path?(g=`a${l.path}`,m=`b${l.path}`):((i=i||{})["f"+f]=l,g=`this.f${f}(a)`,m=`this.f${f}(b)`),iE(g,m,-h,h)},a=Function("a","b","var u, v; return "+e.map(o).join("")+"0;");return i?a.bind(i):a}}};function g3(e){const t=this;Y2(e.type)||!e.type?t.operator(e,e.update?t.operatorExpression(e.update):null):t.transform(e,e.type)}function Q2(e){const t=this;if(e.params){const i=t.get(e.id);i||(0,b.z3)("Invalid operator id: "+e.id),t.dataflow.connect(i,i.parameters(t.parseParameters(e.params),e.react,e.initonly))}}function Km(e,t){t=t||{};const i=this;for(const o in e){const a=e[o];t[o]=(0,b.cy)(a)?a.map(l=>oE(l,i,t)):oE(a,i,t)}return t}function oE(e,t,i){if(!e||!(0,b.Gv)(e))return e;for(let o=0,a=xh.length,l;o<a;++o)if(l=xh[o],(0,b.mQ)(e,l.key))return l.parse(e,t,i);return e}var xh=[{key:"$ref",parse:Eh},{key:"$key",parse:J2},{key:"$expr",parse:Z2},{key:"$field",parse:Ah},{key:"$encode",parse:tD},{key:"$compare",parse:eD},{key:"$context",parse:nD},{key:"$subflow",parse:iD},{key:"$tupleid",parse:rD}];function Eh(e,t){return t.get(e.$ref)||(0,b.z3)("Operator not defined: "+e.$ref)}function Z2(e,t,i){e.$params&&t.parseParameters(e.$params,i);const o="e:"+e.$expr.code;return t.fn[o]||(t.fn[o]=(0,b.sY)(t.parameterExpression(e.$expr),e.$fields))}function J2(e,t){const i="k:"+e.$key+"_"+!!e.$flat;return t.fn[i]||(t.fn[i]=(0,b.Eb)(e.$key,e.$flat,t.expr.codegen))}function Ah(e,t){if(!e.$field)return null;const i="f:"+e.$field+"_"+e.$name;return t.fn[i]||(t.fn[i]=(0,b.ZZ)(e.$field,e.$name,t.expr.codegen))}function eD(e,t){const i="c:"+e.$compare+"_"+e.$order,o=(0,b.YO)(e.$compare).map(a=>a&&a.$tupleid?we:a);return t.fn[i]||(t.fn[i]=(0,b.UD)(o,e.$order,t.expr.codegen))}function tD(e,t){const i=e.$encode,o={};for(const a in i){const l=i[a];o[a]=(0,b.sY)(t.encodeExpression(l.$expr),l.$fields),o[a].output=l.$output}return o}function nD(e,t){return t}function iD(e,t){const i=e.$subflow;return function(o,a,l){const f=t.fork().parse(i),h=f.get(i.operators[0].id),g=f.signals.parent;return g&&g.set(l),h.detachSubflow=()=>t.detach(f),h}}function rD(){return we}function oD(e){var t=this,i=e.filter!=null?t.eventExpression(e.filter):void 0,o=e.stream!=null?t.get(e.stream):void 0,a;e.source?o=t.events(e.source,e.type,i):e.merge&&(a=e.merge.map(l=>t.get(l)),o=a[0].merge.apply(a[0],a.slice(1))),e.between&&(a=e.between.map(l=>t.get(l)),o=o.between(a[0],a[1])),e.filter&&(o=o.filter(i)),e.throttle!=null&&(o=o.throttle(+e.throttle)),e.debounce!=null&&(o=o.debounce(+e.debounce)),o==null&&(0,b.z3)("Invalid stream definition: "+JSON.stringify(e)),e.consume&&o.consume(!0),t.stream(e,o)}function sD(e){var t=this,i=(0,b.Gv)(i=e.source)?i.$ref:i,o=t.get(i),a=null,l=e.update,f=void 0;o||(0,b.z3)("Source not defined: "+e.source),a=e.target&&e.target.$expr?t.eventExpression(e.target.$expr):t.get(e.target),l&&l.$expr&&(l.$params&&(f=t.parseParameters(l.$params)),l=t.handlerExpression(l.$expr)),t.update(e,o,a,l,f)}const aD={skip:!0};function uD(e){var t=this,i={};if(e.signals){var o=i.signals={};Object.keys(t.signals).forEach(l=>{const f=t.signals[l];e.signals(l,f)&&(o[l]=f.value)})}if(e.data){var a=i.data={};Object.keys(t.data).forEach(l=>{const f=t.data[l];e.data(l,f)&&(a[l]=f.input.value)})}return t.subcontext&&e.recurse!==!1&&(i.subcontext=t.subcontext.map(l=>l.getState(e))),i}function lD(e){var t=this,i=t.dataflow,o=e.data,a=e.signals;Object.keys(a||{}).forEach(l=>{i.update(t.signals[l],a[l],aD)}),Object.keys(o||{}).forEach(l=>{i.pulse(t.data[l].input,i.changeset().remove(b.vN).insert(o[l]))}),(e.subcontext||[]).forEach((l,f)=>{const h=t.subcontext[f];h&&h.setState(l)})}function sE(e,t,i,o){return new aE(e,t,i,o)}function aE(e,t,i,o){this.dataflow=e,this.transforms=t,this.events=e.events.bind(e),this.expr=o||rE,this.signals={},this.scales={},this.nodes={},this.data={},this.fn={},i&&(this.functions=Object.create(i),this.functions.context=this)}function uE(e){this.dataflow=e.dataflow,this.transforms=e.transforms,this.events=e.events,this.expr=e.expr,this.signals=Object.create(e.signals),this.scales=Object.create(e.scales),this.nodes=Object.create(e.nodes),this.data=Object.create(e.data),this.fn=Object.create(e.fn),e.functions&&(this.functions=Object.create(e.functions),this.functions.context=this)}aE.prototype=uE.prototype={fork(){const e=new uE(this);return(this.subcontext||(this.subcontext=[])).push(e),e},detach(e){this.subcontext=this.subcontext.filter(i=>i!==e);const t=Object.keys(e.nodes);for(const i of t)e.nodes[i]._targets=null;for(const i of t)e.nodes[i].detach();e.nodes=null},get(e){return this.nodes[e]},set(e,t){return this.nodes[e]=t},add(e,t){const i=this,o=i.dataflow,a=e.value;if(i.set(e.id,t),K2(e.type)&&a&&(a.$ingest?o.ingest(t,a.$ingest,a.$format):a.$request?o.preload(t,a.$request,a.$format):o.pulse(t,o.changeset().insert(a))),e.root&&(i.root=t),e.parent){let l=i.get(e.parent.$ref);l?(o.connect(l,[t]),t.targets().add(l)):(i.unresolved=i.unresolved||[]).push(()=>{l=i.get(e.parent.$ref),o.connect(l,[t]),t.targets().add(l)})}if(e.signal&&(i.signals[e.signal]=t),e.scale&&(i.scales[e.scale]=t),e.data)for(const l in e.data){const f=i.data[l]||(i.data[l]={});e.data[l].forEach(h=>f[h]=t)}},resolve(){return(this.unresolved||[]).forEach(e=>e()),delete this.unresolved,this},operator(e,t){this.add(e,this.dataflow.add(e.value,t))},transform(e,t){this.add(e,this.dataflow.add(this.transforms[Ym(t)]))},stream(e,t){this.set(e.id,t)},update(e,t,i,o,a){this.dataflow.on(t,i,o,a,e.options)},operatorExpression(e){return this.expr.operator(this,e)},parameterExpression(e){return this.expr.parameter(this,e)},eventExpression(e){return this.expr.event(this,e)},handlerExpression(e){return this.expr.handler(this,e)},encodeExpression(e){return this.expr.encode(this,e)},parse:H2,parseOperator:g3,parseOperatorParameters:Q2,parseParameters:Km,parseStream:oD,parseUpdate:sD,getState:uD,setState:lD};var cD=z(77524);function fD(e){const t=e.container();t&&(t.setAttribute("role","graphics-document"),t.setAttribute("aria-roleDescription","visualization"),lE(t,e.description()))}function lE(e,t){e&&(t==null?e.removeAttribute("aria-label"):e.setAttribute("aria-label",t))}function dD(e){e.add(null,t=>(e._background=t.bg,e._resize=1,t.bg),{bg:e._signals.background})}const Qm="default";function hD(e){const t=e._signals.cursor||(e._signals.cursor=e.add({user:Qm,item:null}));e.on(e.events("view","pointermove"),t,(i,o)=>{const a=t.value,l=a?(0,b.Kg)(a)?a:a.user:Qm,f=o.item&&o.item.cursor||null;return a&&l===a.user&&f==a.item?a:{user:l,item:f}}),e.add(null,function(i){let o=i.cursor,a=this.value;return(0,b.Kg)(o)||(a=o.item,o=o.user),Zm(e,o&&o!==Qm?o:a||o),a},{cursor:t})}function Zm(e,t){const i=e.globalCursor()?typeof document<"u"&&document.body:e.container();if(i)return t==null?i.style.removeProperty("cursor"):i.style.cursor=t}function Ch(e,t){var i=e._runtime.data;return(0,b.mQ)(i,t)||(0,b.z3)("Unrecognized data set: "+t),i[t]}function gD(e,t){return arguments.length<2?Ch(this,e).values.value:Sh.call(this,e,Ot().remove(b.vN).insert(t))}function Sh(e,t){wt(t)||(0,b.z3)("Second argument to changes must be a changeset.");const i=Ch(this,e);return i.modified=!0,this.pulse(i.input,t)}function pD(e,t){return Sh.call(this,e,Ot().insert(t))}function mD(e,t){return Sh.call(this,e,Ot().remove(t))}function cE(e){var t=e.padding();return Math.max(0,e._viewWidth+t.left+t.right)}function fE(e){var t=e.padding();return Math.max(0,e._viewHeight+t.top+t.bottom)}function Mc(e){var t=e.padding(),i=e._origin;return[t.left+i[0],t.top+i[1]]}function yD(e){var t=Mc(e),i=cE(e),o=fE(e);e._renderer.background(e.background()),e._renderer.resize(i,o,t),e._handler.origin(t),e._resizeListeners.forEach(a=>{try{a(i,o)}catch(l){e.error(l)}})}function dE(e,t,i){var o=e._renderer,a=o&&o.canvas(),l,f,h;return a&&(h=Mc(e),f=t.changedTouches?t.changedTouches[0]:t,l=au(f,a),l[0]-=h[0],l[1]-=h[1]),t.dataflow=e,t.item=i,t.vega=vD(e,i,l),t}function vD(e,t,i){const o=t?t.mark.marktype==="group"?t:t.mark.group:null;function a(f){var h=o,g;if(f){for(g=t;g;g=g.mark.group)if(g.mark.name===f){h=g;break}}return h&&h.mark&&h.mark.interactive?h:{}}function l(f){if(!f)return i;(0,b.Kg)(f)&&(f=a(f));const h=i.slice();for(;f;)h[0]-=f.x||0,h[1]-=f.y||0,f=f.mark&&f.mark.group;return h}return{view:(0,b.dY)(e),item:(0,b.dY)(t||{}),group:a,xy:l,x:f=>l(f)[0],y:f=>l(f)[1]}}const hE="view",bD="timer",xD="window",gE={trap:!1};function p3(e){const t=(0,b.X$)({defaults:{}},e),i=(o,a)=>{a.forEach(l=>{(0,b.cy)(o[l])&&(o[l]=(0,b.M1)(o[l]))})};return i(t.defaults,["prevent","allow"]),i(t,["view","window","selector"]),t}function ED(e,t,i,o){e._eventListeners.push({type:i,sources:(0,b.YO)(t),handler:o})}function AD(e,t){var i=e._eventConfig.defaults,o=i.prevent,a=i.allow;return o===!1||a===!0?!1:o===!0||a===!1?!0:o?o[t]:a?!a[t]:e.preventDefault()}function Fh(e,t,i){const o=e._eventConfig&&e._eventConfig[t];return o===!1||(0,b.Gv)(o)&&!o[i]?(e.warn(`Blocked ${t} ${i} event listener.`),!1):!0}function CD(e,t,i){var o=this,a=new rr(i),l=function(m,v){o.runAsync(null,()=>{e===hE&&AD(o,t)&&m.preventDefault(),a.receive(dE(o,m,v))})},f;if(e===bD)Fh(o,"timer",t)&&o.timer(l,t);else if(e===hE)Fh(o,"view",t)&&o.addEventListener(t,l,gE);else if(e===xD?Fh(o,"window",t)&&typeof window<"u"&&(f=[window]):typeof document<"u"&&Fh(o,"selector",t)&&(f=Array.from(document.querySelectorAll(e))),!f)o.warn("Can not resolve event source: "+e);else{for(var h=0,g=f.length;h<g;++h)f[h].addEventListener(t,l);ED(o,f,t,l)}return a}function pE(e){return e.item}function mE(e){return e.item.mark.source}function yE(e){return function(t,i){return i.vega.view().changeset().encode(i.item,e)}}function m3(e,t){return e=[e||"hover"],t=[t||"update",e[0]],this.on(this.events("view","pointerover",pE),mE,yE(e)),this.on(this.events("view","pointerout",pE),mE,yE(t)),this}function Jm(){var e=this._tooltip,t=this._timers,i=this._handler.handlers(),o=this._eventListeners,a,l,f,h,g;for(a=t.length;--a>=0;)t[a].stop();for(a=o.length;--a>=0;)for(f=o[a],l=f.sources.length;--l>=0;)f.sources[l].removeEventListener(f.type,f.handler);for(e&&e.call(this,this._handler,null,null,null),a=i.length;--a>=0;)g=i[a].type,h=i[a].handler,this._handler.off(g,h);return this}function Gn(e,t,i){const o=document.createElement(e);for(const a in t)o.setAttribute(a,t[a]);return i!=null&&(o.textContent=i),o}const SD="vega-bind",vE="vega-bind-name",FD="vega-bind-radio";function wD(e,t,i){if(!t)return;const o=i.param;let a=i.state;return a||(a=i.state={elements:null,active:!1,set:null,update:f=>{f!=e.signal(o.signal)&&e.runAsync(null,()=>{a.source=!0,e.signal(o.signal,f)})}},o.debounce&&(a.update=(0,b.sg)(o.debounce,a.update))),(o.input==null&&o.element?DD:e1)(a,t,o,e),a.active||(e.on(e._signals[o.signal],null,()=>{a.source?a.source=!1:a.set(e.signal(o.signal))}),a.active=!0),a}function DD(e,t,i,o){const a=i.event||"input",l=()=>e.update(t.value);o.signal(i.signal,t.value),t.addEventListener(a,l),ED(o,t,a,l),e.set=f=>{t.value=f,t.dispatchEvent(y3(a))}}function y3(e){return typeof Event<"u"?new Event(e):{type:e}}function e1(e,t,i,o){const a=o.signal(i.signal),l=Gn("div",{class:SD}),f=i.input==="radio"?l:l.appendChild(Gn("label"));f.appendChild(Gn("span",{class:vE},i.name||i.signal)),t.appendChild(l);let h=v3;switch(i.input){case"checkbox":h=wh;break;case"select":h=t1;break;case"radio":h=bE;break;case"range":h=xE;break}h(e,f,i,a)}function v3(e,t,i,o){const a=Gn("input");for(const l in i)l!=="signal"&&l!=="element"&&a.setAttribute(l==="input"?"type":l,i[l]);a.setAttribute("name",i.signal),a.value=o,t.appendChild(a),a.addEventListener("input",()=>e.update(a.value)),e.elements=[a],e.set=l=>a.value=l}function wh(e,t,i,o){const a={type:"checkbox",name:i.signal};o&&(a.checked=!0);const l=Gn("input",a);t.appendChild(l),l.addEventListener("change",()=>e.update(l.checked)),e.elements=[l],e.set=f=>l.checked=!!f||null}function t1(e,t,i,o){const a=Gn("select",{name:i.signal}),l=i.labels||[];i.options.forEach((f,h)=>{const g={value:f};n1(f,o)&&(g.selected=!0),a.appendChild(Gn("option",g,(l[h]||f)+""))}),t.appendChild(a),a.addEventListener("change",()=>{e.update(i.options[a.selectedIndex])}),e.elements=[a],e.set=f=>{for(let h=0,g=i.options.length;h<g;++h)if(n1(i.options[h],f)){a.selectedIndex=h;return}}}function bE(e,t,i,o){const a=Gn("span",{class:FD}),l=i.labels||[];t.appendChild(a),e.elements=i.options.map((f,h)=>{const g={type:"radio",name:i.signal,value:f};n1(f,o)&&(g.checked=!0);const m=Gn("input",g);m.addEventListener("change",()=>e.update(f));const v=Gn("label",{},(l[h]||f)+"");return v.prepend(m),a.appendChild(v),m}),e.set=f=>{const h=e.elements,g=h.length;for(let m=0;m<g;++m)n1(h[m].value,f)&&(h[m].checked=!0)}}function xE(e,t,i,o){o=o!==void 0?o:(+i.max+ +i.min)/2;const a=i.max!=null?i.max:Math.max(100,+o)||100,l=i.min||Math.min(0,a,+o)||0,f=i.step||(0,on.sG)(l,a,100),h=Gn("input",{type:"range",name:i.signal,min:l,max:a,step:f});h.value=o;const g=Gn("span",{},+o);t.appendChild(h),t.appendChild(g);const m=()=>{g.textContent=h.value,e.update(+h.value)};h.addEventListener("input",m),h.addEventListener("change",m),e.elements=[h],e.set=v=>{h.value=v,g.textContent=v}}function n1(e,t){return e===t||e+""==t+""}function EE(e,t,i,o,a,l){return t=t||new o(e.loader()),t.initialize(i,cE(e),fE(e),Mc(e),a,l).background(e.background())}function Lu(e,t){return t?function(){try{t.apply(this,arguments)}catch(i){e.error(i)}}:null}function AE(e,t,i,o){const a=new o(e.loader(),Lu(e,e.tooltip())).scene(e.scenegraph().root).initialize(i,Mc(e),e);return t&&t.handlers().forEach(l=>{a.on(l.type,l.handler)}),a}function Dh(e,t){const i=this,o=i._renderType,a=i._eventConfig.bind,l=hu(o);e=i._el=e?kh(i,e,!0):null,fD(i),l||i.error("Unrecognized renderer type: "+o);const f=l.handler||cu,h=e?l.renderer:l.headless;return i._renderer=h?EE(i,i._renderer,e,h):null,i._handler=AE(i,i._handler,e,f),i._redraw=!0,e&&a!=="none"&&(t=t?i._elBind=kh(i,t,!0):e.appendChild(Gn("form",{class:"vega-bindings"})),i._bind.forEach(g=>{g.param.element&&a!=="container"&&(g.element=kh(i,g.param.element,!!g.param.input))}),i._bind.forEach(g=>{wD(i,g.element||t,g)})),i}function kh(e,t,i){if(typeof t=="string")if(typeof document<"u"){if(t=document.querySelector(t),!t)return e.error("Signal bind element not found: "+t),null}else return e.error("DOM document instance not found."),null;if(t&&i)try{t.textContent=""}catch(o){t=null,e.error(o)}return t}const zu=e=>+e||0,kD=e=>({top:e,bottom:e,left:e,right:e});function $a(e){return(0,b.Gv)(e)?{top:zu(e.top),bottom:zu(e.bottom),left:zu(e.left),right:zu(e.right)}:kD(zu(e))}async function CE(e,t,i,o){const a=hu(t),l=a&&a.headless;return l||(0,b.z3)("Unrecognized renderer type: "+t),await e.runAsync(),EE(e,null,null,l,i,o).renderAsync(e._scenegraph.root)}async function i1(e,t){e!==Cr.Canvas&&e!==Cr.SVG&&e!==Cr.PNG&&(0,b.z3)("Unrecognized image type: "+e);const i=await CE(this,e,t);return e===Cr.SVG?SE(i.svg(),"image/svg+xml"):i.canvas().toDataURL("image/png")}function SE(e,t){const i=new Blob([e],{type:t});return window.URL.createObjectURL(i)}async function b3(e,t){return(await CE(this,Cr.Canvas,e,t)).canvas()}async function Iu(e){return(await CE(this,Cr.SVG,e)).svg()}function $D(e,t,i){return sE(e,Bn,_u,i).parse(t)}function x3(e){var t=this._runtime.scales;return(0,b.mQ)(t,e)||(0,b.z3)("Unrecognized scale or projection: "+e),t[e].value}var FE="width",wE="height",DE="padding",kE={skip:!0};function $E(e,t){var i=e.autosize(),o=e.padding();return t-(i&&i.contains===DE?o.left+o.right:0)}function OD(e,t){var i=e.autosize(),o=e.padding();return t-(i&&i.contains===DE?o.top+o.bottom:0)}function TD(e){var t=e._signals,i=t[FE],o=t[wE],a=t[DE];function l(){e._autosize=e._resize=1}e._resizeWidth=e.add(null,h=>{e._width=h.size,e._viewWidth=$E(e,h.size),l()},{size:i}),e._resizeHeight=e.add(null,h=>{e._height=h.size,e._viewHeight=OD(e,h.size),l()},{size:o});const f=e.add(null,l,{pad:a});e._resizeWidth.rank=i.rank+1,e._resizeHeight.rank=o.rank+1,f.rank=a.rank+1}function RD(e,t,i,o,a,l){this.runAfter(f=>{let h=0;f._autosize=0,f.width()!==i&&(h=1,f.signal(FE,i,kE),f._resizeWidth.skip(!0)),f.height()!==o&&(h=1,f.signal(wE,o,kE),f._resizeHeight.skip(!0)),f._viewWidth!==e&&(f._resize=1,f._viewWidth=e),f._viewHeight!==t&&(f._resize=1,f._viewHeight=t),(f._origin[0]!==a[0]||f._origin[1]!==a[1])&&(f._resize=1,f._origin=a),h&&f.run("enter"),l&&f.runAfter(g=>g.resize())},!1,1)}function E3(e){return this._runtime.getState(e||{data:ND,signals:_D,recurse:!0})}function ND(e,t){return t.modified&&(0,b.cy)(t.input.value)&&!e.startsWith("_:vega:_")}function _D(e,t){return!(e==="parent"||t instanceof Bn.proxy)}function A3(e){return this.runAsync(null,t=>{t._trigger=!1,t._runtime.setState(e)},t=>{t._trigger=!0}),this}function MD(e,t){function i(o){e({timestamp:Date.now(),elapsed:o})}this._timers.push((0,cD.A)(i,t))}function BD(e,t,i,o){const a=e.element();a&&a.setAttribute("title",C3(o))}function C3(e){return e==null?"":(0,b.cy)(e)?OE(e):(0,b.Gv)(e)&&!(0,b.$P)(e)?LD(e):e+""}function LD(e){return Object.keys(e).map(t=>{const i=e[t];return t+": "+((0,b.cy)(i)?OE(i):TE(i))}).join(`
`)}function OE(e){return"["+e.map(TE).join(", ")+"]"}function TE(e){return(0,b.cy)(e)?"[\u2026]":(0,b.Gv)(e)&&!(0,b.$P)(e)?"{\u2026}":e}function zD(){if(this.renderer()==="canvas"&&this._renderer._canvas){let e=null;const t=()=>{e?.();const i=matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`);i.addEventListener("change",t),e=()=>{i.removeEventListener("change",t)},this._renderer._canvas.getContext("2d").pixelRatio=window.devicePixelRatio||1,this._redraw=!0,this._resize=1,this.resize().runAsync()};t()}}function RE(e,t){const i=this;if(t=t||{},js.call(i),t.loader&&i.loader(t.loader),t.logger&&i.logger(t.logger),t.logLevel!=null&&i.logLevel(t.logLevel),t.locale||e.locale){const l=(0,b.X$)({},e.locale,t.locale);i.locale(Ns(l.number,l.time))}i._el=null,i._elBind=null,i._renderType=t.renderer||Cr.Canvas,i._scenegraph=new Cv;const o=i._scenegraph.root;i._renderer=null,i._tooltip=t.tooltip||BD,i._redraw=!0,i._handler=new cu().scene(o),i._globalCursor=!1,i._preventDefault=!1,i._timers=[],i._eventListeners=[],i._resizeListeners=[],i._eventConfig=p3(e.eventConfig),i.globalCursor(i._eventConfig.globalCursor);const a=$D(i,e,t.expr);i._runtime=a,i._signals=a.signals,i._bind=(e.bindings||[]).map(l=>({state:null,param:(0,b.X$)({},l)})),a.root&&a.root.set(o),o.source=a.data.root.input,i.pulse(a.data.root.input,i.changeset().insert(o.items)),i._width=i.width(),i._height=i.height(),i._viewWidth=$E(i,i._width),i._viewHeight=OD(i,i._height),i._origin=[0,0],i._resize=0,i._autosize=1,TD(i),dD(i),hD(i),i.description(e.description),t.hover&&i.hover(),t.container&&i.initialize(t.container,t.bind),t.watchPixelRatio&&i._watchPixelRatio()}function $h(e,t){return(0,b.mQ)(e._signals,t)?e._signals[t]:(0,b.z3)("Unrecognized signal name: "+(0,b.r$)(t))}function NE(e,t){const i=(e._targets||[]).filter(o=>o._update&&o._update.handler===t);return i.length?i[0]:null}function ID(e,t,i,o){let a=NE(i,o);return a||(a=Lu(e,()=>o(t,i.value)),a.handler=o,e.on(i,null,a)),e}function _E(e,t,i){const o=NE(t,i);return o&&t._targets.remove(o),e}(0,b.B)(RE,js,{async evaluate(e,t,i){if(await js.prototype.evaluate.call(this,e,t),this._redraw||this._resize)try{this._renderer&&(this._resize&&(this._resize=0,yD(this)),await this._renderer.renderAsync(this._scenegraph.root)),this._redraw=!1}catch(o){this.error(o)}return i&&Ku(this,i),this},dirty(e){this._redraw=!0,this._renderer&&this._renderer.dirty(e)},description(e){if(arguments.length){const t=e!=null?e+"":null;return t!==this._desc&&lE(this._el,this._desc=t),this}return this._desc},container(){return this._el},scenegraph(){return this._scenegraph},origin(){return this._origin.slice()},signal(e,t,i){const o=$h(this,e);return arguments.length===1?o.value:this.update(o,t,i)},width(e){return arguments.length?this.signal("width",e):this.signal("width")},height(e){return arguments.length?this.signal("height",e):this.signal("height")},padding(e){return arguments.length?this.signal("padding",$a(e)):$a(this.signal("padding"))},autosize(e){return arguments.length?this.signal("autosize",e):this.signal("autosize")},background(e){return arguments.length?this.signal("background",e):this.signal("background")},renderer(e){return arguments.length?(hu(e)||(0,b.z3)("Unrecognized renderer type: "+e),e!==this._renderType&&(this._renderType=e,this._resetRenderer()),this):this._renderType},tooltip(e){return arguments.length?(e!==this._tooltip&&(this._tooltip=e,this._resetRenderer()),this):this._tooltip},loader(e){return arguments.length?(e!==this._loader&&(js.prototype.loader.call(this,e),this._resetRenderer()),this):this._loader},resize(){return this._autosize=1,this.touch($h(this,"autosize"))},_resetRenderer(){this._renderer&&(this._renderer=null,this.initialize(this._el,this._elBind))},_resizeView:RD,addEventListener(e,t,i){let o=t;return i&&i.trap===!1||(o=Lu(this,t),o.raw=t),this._handler.on(e,o),this},removeEventListener(e,t){for(var i=this._handler.handlers(e),o=i.length,a,l;--o>=0;)if(l=i[o].type,a=i[o].handler,e===l&&(t===a||t===a.raw)){this._handler.off(l,a);break}return this},addResizeListener(e){const t=this._resizeListeners;return t.includes(e)||t.push(e),this},removeResizeListener(e){var t=this._resizeListeners,i=t.indexOf(e);return i>=0&&t.splice(i,1),this},addSignalListener(e,t){return ID(this,e,$h(this,e),t)},removeSignalListener(e,t){return _E(this,$h(this,e),t)},addDataListener(e,t){return ID(this,e,Ch(this,e).values,t)},removeDataListener(e,t){return _E(this,Ch(this,e).values,t)},globalCursor(e){if(arguments.length){if(this._globalCursor!==!!e){const t=Zm(this,null);this._globalCursor=!!e,t&&Zm(this,t)}return this}else return this._globalCursor},preventDefault(e){return arguments.length?(this._preventDefault=e,this):this._preventDefault},timer:MD,events:CD,finalize:Jm,hover:m3,data:gD,change:Sh,insert:pD,remove:mD,scale:x3,initialize:Dh,toImageURL:i1,toCanvas:b3,toSVG:Iu,getState:E3,setState:A3,_watchPixelRatio:zD});var Oh=z(82722);function ME(e){return(0,b.Gv)(e)?e:{type:e||"pad"}}const Bc=e=>+e||0,r1=e=>({top:e,bottom:e,left:e,right:e});function BE(e){return(0,b.Gv)(e)?e.signal?e:{top:Bc(e.top),bottom:Bc(e.bottom),left:Bc(e.left),right:Bc(e.right)}:r1(Bc(e))}const rn=e=>(0,b.Gv)(e)&&!(0,b.cy)(e)?(0,b.X$)({},e):{value:e};function LE(e,t,i,o){return i!=null?((0,b.Gv)(i)&&!(0,b.cy)(i)||(0,b.cy)(i)&&i.length&&(0,b.Gv)(i[0])?e.update[t]=i:e[o||"enter"][t]={value:i},1):0}function Tn(e,t,i){for(const o in t)LE(e,o,t[o]);for(const o in i)LE(e,o,i[o],"update")}function Pu(e,t,i){for(const o in t)i&&(0,b.mQ)(i,o)||(e[o]=(0,b.X$)(e[o]||{},t[o]));return e}function Oa(e,t){return t&&(t.enter&&t.enter[e]||t.update&&t.update[e])}const o1="mark",s1="frame",Th="scope",PD="axis",UD="axis-domain",jD="axis-grid",GD="axis-label",WD="axis-tick",VD="axis-title",HD="legend",qD="legend-band",XD="legend-entry",YD="legend-gradient",zE="legend-label",KD="legend-symbol",QD="legend-title",ZD="title",JD="title-text",ek="title-subtitle";function tk(e,t,i,o,a){const l={},f={};let h,g,m,v;g="lineBreak",t==="text"&&a[g]!=null&&!Oa(g,e)&&a1(l,g,a[g]),(i=="legend"||String(i).startsWith("axis"))&&(i=null),v=i===s1?a.group:i===o1?(0,b.X$)({},a.mark,a[t]):null;for(g in v)m=Oa(g,e)||(g==="fill"||g==="stroke")&&(Oa("fill",e)||Oa("stroke",e)),m||a1(l,g,v[g]);(0,b.YO)(o).forEach(x=>{const C=a.style&&a.style[x];for(const w in C)Oa(w,e)||a1(l,w,C[w])}),e=(0,b.X$)({},e);for(g in l)v=l[g],v.signal?(h=h||{})[g]=v:f[g]=v;return e.enter=(0,b.X$)(f,e.enter),h&&(e.update=(0,b.X$)(h,e.update)),e}function a1(e,t,i){e[t]=i&&i.signal?{signal:i.signal}:{value:i}}const IE=e=>(0,b.Kg)(e)?(0,b.r$)(e):e.signal?`(${e.signal})`:Yi(e);function Rh(e){if(e.gradient!=null)return ik(e);let t=e.signal?`(${e.signal})`:e.color?nk(e.color):e.field!=null?Yi(e.field):e.value!==void 0?(0,b.r$)(e.value):void 0;return e.scale!=null&&(t=PE(e,t)),t===void 0&&(t=null),e.exponent!=null&&(t=`pow(${t},${u1(e.exponent)})`),e.mult!=null&&(t+=`*${u1(e.mult)}`),e.offset!=null&&(t+=`+${u1(e.offset)}`),e.round&&(t=`round(${t})`),t}const Nh=(e,t,i,o)=>`(${e}(${[t,i,o].map(Rh).join(",")})+'')`;function nk(e){return e.c?Nh("hcl",e.h,e.c,e.l):e.h||e.s?Nh("hsl",e.h,e.s,e.l):e.l||e.a?Nh("lab",e.l,e.a,e.b):e.r||e.g||e.b?Nh("rgb",e.r,e.g,e.b):null}function ik(e){const t=[e.start,e.stop,e.count].map(i=>i==null?null:(0,b.r$)(i));for(;t.length&&(0,b.se)(t)==null;)t.pop();return t.unshift(IE(e.gradient)),`gradient(${t.join(",")})`}function u1(e){return(0,b.Gv)(e)?"("+Rh(e)+")":e}function Yi(e){return Uu((0,b.Gv)(e)?e:{datum:e})}function Uu(e){let t,i,o;if(e.signal)t="datum",o=e.signal;else if(e.group||e.parent){for(i=Math.max(1,e.level||1),t="item";i-- >0;)t+=".mark.group";e.parent?(o=e.parent,t+=".datum"):o=e.group}else e.datum?(t="datum",o=e.datum):(0,b.z3)("Invalid field reference: "+(0,b.r$)(e));return e.signal||(o=(0,b.Kg)(o)?(0,b.iv)(o).map(b.r$).join("]["):Uu(o)),t+"["+o+"]"}function PE(e,t){const i=IE(e.scale);return e.range!=null?t=`lerp(_range(${i}), ${+e.range})`:(t!==void 0&&(t=`_scale(${i}, ${t})`),e.band&&(t=(t?t+"+":"")+`_bandwidth(${i})`+(+e.band==1?"":"*"+u1(e.band)),e.extra&&(t=`(datum.extra ? _scale(${i}, datum.extra.value) : ${t})`)),t==null&&(t="0")),t}function rk(e){let t="";return e.forEach(i=>{const o=Rh(i);t+=i.test?`(${i.test})?${o}:`:o}),(0,b.se)(t)===":"&&(t+="null"),t}function UE(e,t,i,o,a,l){const f={};l=l||{},l.encoders={$encode:f},e=tk(e,t,i,o,a.config);for(const h in e)f[h]=Lc(e[h],t,l,a);return l}function Lc(e,t,i,o){const a={},l={};for(const f in e)e[f]!=null&&(a[f]=ok(_h(e[f]),o,i,l));return{$expr:{marktype:t,channels:a},$fields:Object.keys(l),$output:Object.keys(e)}}function _h(e){return(0,b.cy)(e)?rk(e):Rh(e)}function ok(e,t,i,o){const a=Kt(e,t);return a.$fields.forEach(l=>o[l]=1),(0,b.X$)(i,a.$params),a.$expr}const sk="outer",ak=["value","update","init","react","bind"];function jE(e,t){(0,b.z3)(e+' for "outer" push: '+(0,b.r$)(t))}function l1(e,t){const i=e.name;if(e.push===sk)t.signals[i]||jE("No prior signal definition",i),ak.forEach(o=>{e[o]!==void 0&&jE("Invalid property ",o)});else{const o=t.addSignal(i,e.value);e.react===!1&&(o.react=!1),e.bind&&t.addBinding(i,e.bind)}}function c1(e,t,i,o){this.id=-1,this.type=e,this.value=t,this.params=i,o&&(this.parent=o)}function zc(e,t,i,o){return new c1(e,t,i,o)}function Ic(e,t){return zc("operator",e,t)}function ke(e){const t={$ref:e.id};return e.id<0&&(e.refs=e.refs||[]).push(t),t}function Pc(e,t){return t?{$field:e,$name:t}:{$field:e}}const Mh=Pc("key");function GE(e,t){return{$compare:e,$order:t}}function uk(e,t){const i={$key:e};return t&&(i.$flat=!0),i}const n="ascending",r="descending";function s(e){return(0,b.Gv)(e)?(e.order===r?"-":"+")+u(e.op,e.field):""}function u(e,t){return(e&&e.signal?"$"+e.signal:e||"")+(e&&t?"_":"")+(t&&t.signal?"$"+t.signal:t||"")}const c="scope",d="view";function p(e){return e&&e.signal}function y(e){return e&&e.expr}function E(e){if(p(e))return!0;if((0,b.Gv)(e)){for(const t in e)if(E(e[t]))return!0}return!1}function A(e,t){return e??t}function F(e){return e&&e.signal||e}const $="timer";function _(e,t){return(e.merge?T:e.stream?B:e.type?G:(0,b.z3)("Invalid stream specification: "+(0,b.r$)(e)))(e,t)}function L(e){return e===c?d:e||d}function T(e,t){const i=e.merge.map(a=>_(a,t)),o=H({merge:i},e,t);return t.addStream(o).id}function B(e,t){const i=_(e.stream,t),o=H({stream:i},e,t);return t.addStream(o).id}function G(e,t){let i;e.type===$?(i=t.event($,e.throttle),e={between:e.between,filter:e.filter}):i=t.event(L(e.source),e.type);const o=H({stream:i},e,t);return Object.keys(o).length===1?i:t.addStream(o).id}function H(e,t,i){let o=t.between;return o&&(o.length!==2&&(0,b.z3)('Stream "between" parameter must have 2 entries: '+(0,b.r$)(t)),e.between=[_(o[0],i),_(o[1],i)]),o=t.filter?[].concat(t.filter):[],(t.marktype||t.markname||t.markrole)&&o.push(Z(t.marktype,t.markname,t.markrole)),t.source===c&&o.push("inScope(event.item)"),o.length&&(e.filter=Kt("("+o.join(")&&(")+")",i).$expr),(o=t.throttle)!=null&&(e.throttle=+o),(o=t.debounce)!=null&&(e.debounce=+o),t.consume&&(e.consume=!0),e}function Z(e,t,i){const o="event.item";return o+(e&&e!=="*"?"&&"+o+".mark.marktype==='"+e+"'":"")+(i?"&&"+o+".mark.role==='"+i+"'":"")+(t?"&&"+o+".mark.name==='"+t+"'":"")}const ve={code:"_.$value",ast:{type:"Identifier",value:"value"}};function De(e,t,i){const o=e.encode,a={target:i};let l=e.events,f=e.update,h=[];l||(0,b.z3)("Signal update missing events specification."),(0,b.Kg)(l)&&(l=(0,Oh.P)(l,t.isSubscope()?c:d)),l=(0,b.YO)(l).filter(g=>g.signal||g.scale?(h.push(g),0):1),h.length>1&&(h=[$e(h)]),l.length&&h.push(l.length>1?{merge:l}:l[0]),o!=null&&(f&&(0,b.z3)("Signal encode and update are mutually exclusive."),f="encode(item(),"+(0,b.r$)(o)+")"),a.update=(0,b.Kg)(f)?Kt(f,t):f.expr!=null?Kt(f.expr,t):f.value!=null?f.value:f.signal!=null?{$expr:ve,$params:{$value:t.signalRef(f.signal)}}:(0,b.z3)("Invalid signal update specification."),e.force&&(a.options={force:!0}),h.forEach(g=>t.addUpdate((0,b.X$)(be(g,t),a)))}function be(e,t){return{source:e.signal?t.signalRef(e.signal):e.scale?t.scaleRef(e.scale):_(e,t)}}function $e(e){return{signal:"["+e.map(t=>t.scale?'scale("'+t.scale+'")':t.signal)+"]"}}function Re(e,t){const i=t.getSignal(e.name);let o=e.update;e.init&&(o?(0,b.z3)("Signals can not include both init and update expressions."):(o=e.init,i.initonly=!0)),o&&(o=Kt(o,t),i.update=o.$expr,i.params=o.$params),e.on&&e.on.forEach(a=>De(a,t,i.id))}const me=e=>(t,i,o)=>zc(e,i,t||void 0,o),Ut=me("aggregate"),dn=me("axisticks"),wi=me("bound"),Qt=me("collect"),ye=me("compare"),he=me("datajoin"),Te=me("encode"),Oe=me("expression"),Ne=me("facet"),Fe=me("field"),Ie=me("key"),at=me("legendentries"),je=me("load"),St=me("mark"),Rn=me("multiextent"),Lt=me("multivalues"),Cs=me("overlap"),Bh=me("params"),WE=me("prefacet"),VE=me("projection"),S3=me("proxy"),lk=me("relay"),f1=me("render"),ck=me("scale"),Ss=me("sieve"),HE=me("sortitems"),d1=me("viewlayout"),Lh=me("values");let qE=0;const XE={min:"min",max:"max",count:"sum"};function t$(e,t){const i=e.type||"linear";np(i)||(0,b.z3)("Unrecognized scale type: "+(0,b.r$)(i)),t.addScale(e.name,{type:i,domain:void 0})}function n$(e,t){const i=t.getScale(e.name).params;let o;i.domain=F3(e.domain,e,t),e.range!=null&&(i.range=D3(e,t,i)),e.interpolate!=null&&d$(e.interpolate,i),e.nice!=null&&(i.nice=f$(e.nice,t)),e.bins!=null&&(i.bins=c$(e.bins,t));for(o in e)(0,b.mQ)(i,o)||o==="name"||(i[o]=to(e[o],t))}function to(e,t){return(0,b.Gv)(e)?e.signal?t.signalRef(e.signal):(0,b.z3)("Unsupported object: "+(0,b.r$)(e)):e}function YE(e,t){return e.signal?t.signalRef(e.signal):e.map(i=>to(i,t))}function KE(e){(0,b.z3)("Can not find data set: "+(0,b.r$)(e))}function F3(e,t,i){if(!e){(t.domainMin!=null||t.domainMax!=null)&&(0,b.z3)("No scale domain defined for domainMin/domainMax to override.");return}return e.signal?i.signalRef(e.signal):((0,b.cy)(e)?i$:e.fields?o$:r$)(e,t,i)}function i$(e,t,i){return e.map(o=>to(o,i))}function r$(e,t,i){const o=i.getData(e.data);return o||KE(e.data),hr(t.type)?o.valuesRef(i,e.field,w3(e.sort,!1)):ln(t.type)?o.domainRef(i,e.field):o.extentRef(i,e.field)}function o$(e,t,i){const o=e.data,a=e.fields.reduce((l,f)=>(f=(0,b.Kg)(f)?{data:o,field:f}:(0,b.cy)(f)||f.signal?s$(f,i):f,l.push(f),l),[]);return(hr(t.type)?a$:ln(t.type)?u$:l$)(e,i,a)}function s$(e,t){const i="_:vega:_"+qE++,o=Qt({});if((0,b.cy)(e))o.value={$ingest:e};else if(e.signal){const a="setdata("+(0,b.r$)(i)+","+e.signal+")";o.params.input=t.signalRef(a)}return t.addDataPipeline(i,[o,Ss({})]),{data:i,field:"data"}}function a$(e,t,i){const o=w3(e.sort,!0);let a,l;const f=i.map(m=>{const v=t.getData(m.data);return v||KE(m.data),v.countsRef(t,m.field,o)}),h={groupby:Mh,pulse:f};o&&(a=o.op||"count",l=o.field?u(a,o.field):"count",h.ops=[XE[a]],h.fields=[t.fieldRef(l)],h.as=[l]),a=t.add(Ut(h));const g=t.add(Qt({pulse:ke(a)}));return l=t.add(Lh({field:Mh,sort:t.sortRef(o),pulse:ke(g)})),ke(l)}function w3(e,t){return e&&(!e.field&&!e.op?(0,b.Gv)(e)?e.field="key":e={field:"key"}:!e.field&&e.op!=="count"?(0,b.z3)("No field provided for sort aggregate op: "+e.op):t&&e.field&&e.op&&!XE[e.op]&&(0,b.z3)("Multiple domain scales can not be sorted using "+e.op)),e}function u$(e,t,i){const o=i.map(a=>{const l=t.getData(a.data);return l||KE(a.data),l.domainRef(t,a.field)});return ke(t.add(Lt({values:o})))}function l$(e,t,i){const o=i.map(a=>{const l=t.getData(a.data);return l||KE(a.data),l.extentRef(t,a.field)});return ke(t.add(Rn({extents:o})))}function c$(e,t){return e.signal||(0,b.cy)(e)?YE(e,t):t.objectProperty(e)}function f$(e,t){return e.signal?t.signalRef(e.signal):(0,b.Gv)(e)?{interval:to(e.interval),step:to(e.step)}:to(e)}function d$(e,t){t.interpolate=to(e.type||e),e.gamma!=null&&(t.interpolateGamma=to(e.gamma))}function D3(e,t,i){const o=t.config.range;let a=e.range;if(a.signal)return t.signalRef(a.signal);if((0,b.Kg)(a)){if(o&&(0,b.mQ)(o,a))return e=(0,b.X$)({},e,{range:o[a]}),D3(e,t,i);a==="width"?a=[0,{signal:"width"}]:a==="height"?a=hr(e.type)?[0,{signal:"height"}]:[{signal:"height"},0]:(0,b.z3)("Unrecognized scale range value: "+(0,b.r$)(a))}else if(a.scheme){i.scheme=(0,b.cy)(a.scheme)?YE(a.scheme,t):to(a.scheme,t),a.extent&&(i.schemeExtent=YE(a.extent,t)),a.count&&(i.schemeCount=to(a.count,t));return}else if(a.step){i.rangeStep=to(a.step,t);return}else{if(hr(e.type)&&!(0,b.cy)(a))return F3(a,e,t);(0,b.cy)(a)||(0,b.z3)("Unsupported range type: "+(0,b.r$)(a))}return a.map(l=>((0,b.cy)(l)?YE:to)(l,t))}function h$(e,t){const i=t.config.projection||{},o={};for(const a in e)a!=="name"&&(o[a]=fk(e[a],a,t));for(const a in i)o[a]==null&&(o[a]=fk(i[a],a,t));t.addProjection(e.name,o)}function fk(e,t,i){return(0,b.cy)(e)?e.map(o=>fk(o,t,i)):(0,b.Gv)(e)?e.signal?i.signalRef(e.signal):t==="fit"?e:(0,b.z3)("Unsupported parameter object: "+(0,b.r$)(e)):e}const Mo="top",zh="left",Ih="right",ju="bottom",k3="center",g$="vertical",p$="start",m$="middle",y$="end",dk="index",hk="label",v$="offset",Ph="perc",b$="perc2",no="value",h1="guide-label",gk="guide-title",x$="group-title",E$="group-subtitle",$3="symbol",QE="gradient",pk="discrete",mk="size",yk=[mk,"shape","fill","stroke","strokeWidth","strokeDash","opacity"],g1={name:1,style:1,interactive:1},rt={value:0},io={value:1},ZE="group",O3="rect",vk="rule",A$="symbol",Uc="text";function p1(e){return e.type=ZE,e.interactive=e.interactive||!1,e}function Ki(e,t){const i=(o,a)=>A(e[o],A(t[o],a));return i.isVertical=o=>g$===A(e.direction,t.direction||(o?t.symbolDirection:t.gradientDirection)),i.gradientLength=()=>A(e.gradientLength,t.gradientLength||t.gradientWidth),i.gradientThickness=()=>A(e.gradientThickness,t.gradientThickness||t.gradientHeight),i.entryColumns=()=>A(e.columns,A(t.columns,+i.isVertical(!0))),i}function T3(e,t){const i=t&&(t.update&&t.update[e]||t.enter&&t.enter[e]);return i&&i.signal?i:i?i.value:null}function C$(e,t,i){const o=t.config.style[i];return o&&o[e]}function JE(e,t,i){return`item.anchor === '${p$}' ? ${e} : item.anchor === '${y$}' ? ${t} : ${i}`}const bk=JE((0,b.r$)(zh),(0,b.r$)(Ih),(0,b.r$)(k3));function S$(e){const t=e("tickBand");let i=e("tickOffset"),o,a;return t?t.signal?(o={signal:`(${t.signal}) === 'extent' ? 1 : 0.5`},a={signal:`(${t.signal}) === 'extent'`},(0,b.Gv)(i)||(i={signal:`(${t.signal}) === 'extent' ? 0 : ${i}`})):t==="extent"?(o=1,a=!0,i=0):(o=.5,a=!1):(o=e("bandPosition"),a=e("tickExtra")),{extra:a,band:o,offset:i}}function R3(e,t){return t?e?(0,b.Gv)(e)?Object.assign({},e,{offset:R3(e.offset,t)}):{value:e,offset:t}:t:e}function Or(e,t){return t?(e.name=t.name,e.style=t.style||e.style,e.interactive=!!t.interactive,e.encode=Pu(e.encode,t,g1)):e.interactive=!1,e}function F$(e,t,i,o){const a=Ki(e,i),l=a.isVertical(),f=a.gradientThickness(),h=a.gradientLength();let g,m,v,x,C;l?(m=[0,1],v=[0,0],x=f,C=h):(m=[0,0],v=[1,0],x=h,C=f);const w={enter:g={opacity:rt,x:rt,y:rt,width:rn(x),height:rn(C)},update:(0,b.X$)({},g,{opacity:io,fill:{gradient:t,start:m,stop:v}}),exit:{opacity:rt}};return Tn(w,{stroke:a("gradientStrokeColor"),strokeWidth:a("gradientStrokeWidth")},{opacity:a("gradientOpacity")}),Or({type:O3,role:YD,encode:w},o)}function w$(e,t,i,o,a){const l=Ki(e,i),f=l.isVertical(),h=l.gradientThickness(),g=l.gradientLength();let m,v,x,C,w="";f?(m="y",x="y2",v="x",C="width",w="1-"):(m="x",x="x2",v="y",C="height");const S={opacity:rt,fill:{scale:t,field:no}};S[m]={signal:w+"datum."+Ph,mult:g},S[v]=rt,S[x]={signal:w+"datum."+b$,mult:g},S[C]=rn(h);const D={enter:S,update:(0,b.X$)({},S,{opacity:io}),exit:{opacity:rt}};return Tn(D,{stroke:l("gradientStrokeColor"),strokeWidth:l("gradientStrokeWidth")},{opacity:l("gradientOpacity")}),Or({type:O3,role:qD,key:no,from:a,encode:D},o)}const D$=`datum.${Ph}<=0?"${zh}":datum.${Ph}>=1?"${Ih}":"${k3}"`,k$=`datum.${Ph}<=0?"${ju}":datum.${Ph}>=1?"${Mo}":"${m$}"`;function N3(e,t,i,o){const a=Ki(e,t),l=a.isVertical(),f=rn(a.gradientThickness()),h=a.gradientLength();let g=a("labelOverlap"),m,v,x,C,w="";const S={enter:m={opacity:rt},update:v={opacity:io,text:{field:hk}},exit:{opacity:rt}};return Tn(S,{fill:a("labelColor"),fillOpacity:a("labelOpacity"),font:a("labelFont"),fontSize:a("labelFontSize"),fontStyle:a("labelFontStyle"),fontWeight:a("labelFontWeight"),limit:A(e.labelLimit,t.gradientLabelLimit)}),l?(m.align={value:"left"},m.baseline=v.baseline={signal:k$},x="y",C="x",w="1-"):(m.align=v.align={signal:D$},m.baseline={value:"top"},x="x",C="y"),m[x]=v[x]={signal:w+"datum."+Ph,mult:h},m[C]=v[C]=f,f.offset=A(e.labelOffset,t.gradientLabelOffset)||0,g=g?{separation:a("labelSeparation"),method:g,order:"datum."+dk}:void 0,Or({type:Uc,role:zE,style:h1,key:no,from:o,encode:S,overlap:g},i)}function $$(e,t,i,o,a){const l=Ki(e,t),f=i.entries,h=!!(f&&f.interactive),g=f?f.name:void 0,m=l("clipHeight"),v=l("symbolOffset"),x={data:"value"},C=`(${a}) ? datum.${v$} : datum.${mk}`,w=m?rn(m):{field:mk},S=`datum.${dk}`,D=`max(1, ${a})`;let k,O,R,I,V;w.mult=.5,k={enter:O={opacity:rt,x:{signal:C,mult:.5,offset:v},y:w},update:R={opacity:io,x:O.x,y:O.y},exit:{opacity:rt}};let W=null,ee=null;e.fill||(W=t.symbolBaseFillColor,ee=t.symbolBaseStrokeColor),Tn(k,{fill:l("symbolFillColor",W),shape:l("symbolType"),size:l("symbolSize"),stroke:l("symbolStrokeColor",ee),strokeDash:l("symbolDash"),strokeDashOffset:l("symbolDashOffset"),strokeWidth:l("symbolStrokeWidth")},{opacity:l("symbolOpacity")}),yk.forEach(ge=>{e[ge]&&(R[ge]=O[ge]={scale:e[ge],field:no})});const M=Or({type:A$,role:KD,key:no,from:x,clip:m?!0:void 0,encode:k},i.symbols),J=rn(v);J.offset=l("labelOffset"),k={enter:O={opacity:rt,x:{signal:C,offset:J},y:w},update:R={opacity:io,text:{field:hk},x:O.x,y:O.y},exit:{opacity:rt}},Tn(k,{align:l("labelAlign"),baseline:l("labelBaseline"),fill:l("labelColor"),fillOpacity:l("labelOpacity"),font:l("labelFont"),fontSize:l("labelFontSize"),fontStyle:l("labelFontStyle"),fontWeight:l("labelFontWeight"),limit:l("labelLimit")});const ue=Or({type:Uc,role:zE,style:h1,key:no,from:x,encode:k},i.labels);return k={enter:{noBound:{value:!m},width:rt,height:m?rn(m):rt,opacity:rt},exit:{opacity:rt},update:R={opacity:io,row:{signal:null},column:{signal:null}}},l.isVertical(!0)?(I=`ceil(item.mark.items.length / ${D})`,R.row.signal=`${S}%${I}`,R.column.signal=`floor(${S} / ${I})`,V={field:["row",S]}):(R.row.signal=`floor(${S} / ${D})`,R.column.signal=`${S} % ${D}`,V={field:S}),R.column.signal=`(${a})?${R.column.signal}:${S}`,o={facet:{data:o,name:"value",groupby:dk}},p1({role:Th,from:o,encode:Pu(k,f,g1),marks:[M,ue],name:g,interactive:h,sort:V})}function O$(e,t){const i=Ki(e,t);return{align:i("gridAlign"),columns:i.entryColumns(),center:{row:!0,column:!1},padding:{row:i("rowPadding"),column:i("columnPadding")}}}const xk='item.orient === "left"',Ek='item.orient === "right"',eA=`(${xk} || ${Ek})`,T$=`datum.vgrad && ${eA}`,R$=JE('"top"','"bottom"','"middle"'),N$=JE('"right"','"left"','"center"'),_$=`datum.vgrad && ${Ek} ? (${N$}) : (${eA} && !(datum.vgrad && ${xk})) ? "left" : ${bk}`,M$=`item._anchor || (${eA} ? "middle" : "start")`,B$=`${T$} ? (${xk} ? -90 : 90) : 0`,L$=`${eA} ? (datum.vgrad ? (${Ek} ? "bottom" : "top") : ${R$}) : "top"`;function z$(e,t,i,o){const a=Ki(e,t),l={enter:{opacity:rt},update:{opacity:io,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:rt}};return Tn(l,{orient:a("titleOrient"),_anchor:a("titleAnchor"),anchor:{signal:M$},angle:{signal:B$},align:{signal:_$},baseline:{signal:L$},text:e.title,fill:a("titleColor"),fillOpacity:a("titleOpacity"),font:a("titleFont"),fontSize:a("titleFontSize"),fontStyle:a("titleFontStyle"),fontWeight:a("titleFontWeight"),limit:a("titleLimit"),lineHeight:a("titleLineHeight")},{align:a("titleAlign"),baseline:a("titleBaseline")}),Or({type:Uc,role:QD,style:gk,from:o,encode:l},i)}function I$(e,t){let i;return(0,b.Gv)(e)&&(e.signal?i=e.signal:e.path?i="pathShape("+_3(e.path)+")":e.sphere&&(i="geoShape("+_3(e.sphere)+', {type: "Sphere"})')),i?t.signalRef(i):!!e}function _3(e){return(0,b.Gv)(e)&&e.signal?e.signal:(0,b.r$)(e)}function M3(e){const t=e.role||"";return t.startsWith("axis")||t.startsWith("legend")||t.startsWith("title")?t:e.type===ZE?Th:t||o1}function P$(e){return{marktype:e.type,name:e.name||void 0,role:e.role||M3(e),zindex:+e.zindex||void 0,aria:e.aria,description:e.description}}function U$(e,t){return e&&e.signal?t.signalRef(e.signal):e!==!1}function Ak(e,t){const i=Ln(e.type);i||(0,b.z3)("Unrecognized transform type: "+(0,b.r$)(e.type));const o=zc(i.type.toLowerCase(),null,B3(i,e,t));return e.signal&&t.addSignal(e.signal,t.proxy(o)),o.metadata=i.metadata||{},o}function B3(e,t,i){const o={},a=e.params.length;for(let l=0;l<a;++l){const f=e.params[l];o[f.name]=j$(f,t,i)}return o}function j$(e,t,i){const o=e.type,a=t[e.name];if(o==="index")return G$(e,t,i);if(a===void 0){e.required&&(0,b.z3)("Missing required "+(0,b.r$)(t.type)+" parameter: "+(0,b.r$)(e.name));return}else{if(o==="param")return W$(e,t,i);if(o==="projection")return i.projectionRef(t[e.name])}return e.array&&!p(a)?a.map(l=>L3(e,l,i)):L3(e,a,i)}function L3(e,t,i){const o=e.type;if(p(t))return I3(o)?(0,b.z3)("Expression references can not be signals."):Ck(o)?i.fieldRef(t):P3(o)?i.compareRef(t):i.signalRef(t.signal);{const a=e.expr||Ck(o);return a&&V$(t)?i.exprRef(t.expr,t.as):a&&H$(t)?Pc(t.field,t.as):I3(o)?Kt(t,i):q$(o)?ke(i.getData(t).values):Ck(o)?Pc(t):P3(o)?i.compareRef(t):t}}function G$(e,t,i){return(0,b.Kg)(t.from)||(0,b.z3)('Lookup "from" parameter must be a string literal.'),i.getData(t.from).lookupRef(i,t.key)}function W$(e,t,i){const o=t[e.name];return e.array?((0,b.cy)(o)||(0,b.z3)("Expected an array of sub-parameters. Instead: "+(0,b.r$)(o)),o.map(a=>z3(e,a,i))):z3(e,o,i)}function z3(e,t,i){const o=e.params.length;let a;for(let f=0;f<o;++f){a=e.params[f];for(const h in a.key)if(a.key[h]!==t[h]){a=null;break}if(a)break}a||(0,b.z3)("Unsupported parameter: "+(0,b.r$)(t));const l=(0,b.X$)(B3(a,t,i),a.key);return ke(i.add(Bh(l)))}const V$=e=>e&&e.expr,H$=e=>e&&e.field,q$=e=>e==="data",I3=e=>e==="expr",Ck=e=>e==="field",P3=e=>e==="compare";function X$(e,t,i){let o,a,l,f,h;return e?(o=e.facet)&&(t||(0,b.z3)("Only group marks can be faceted."),o.field!=null?f=h=tA(o,i):(e.data?h=ke(i.getData(e.data).aggregate):(l=Ak((0,b.X$)({type:"aggregate",groupby:(0,b.YO)(o.groupby)},o.aggregate),i),l.params.key=i.keyRef(o.groupby),l.params.pulse=tA(o,i),f=h=ke(i.add(l))),a=i.keyRef(o.groupby,!0))):f=ke(i.add(Qt(null,[{}]))),f||(f=tA(e,i)),{key:a,pulse:f,parent:h}}function tA(e,t){return e.$ref?e:e.data&&e.data.$ref?e.data:ke(t.getData(e.data).output)}function jc(e,t,i,o,a){this.scope=e,this.input=t,this.output=i,this.values=o,this.aggregate=a,this.index={}}jc.fromEntries=function(e,t){const i=t.length,o=t[i-1],a=t[i-2];let l=t[0],f=null,h=1;for(l&&l.type==="load"&&(l=t[1]),e.add(t[0]);h<i;++h)t[h].params.pulse=ke(t[h-1]),e.add(t[h]),t[h].type==="aggregate"&&(f=t[h]);return new jc(e,l,a,o,f)};function U3(e){return(0,b.Kg)(e)?e:null}function j3(e,t,i){const o=u(i.op,i.field);let a;if(t.ops){for(let l=0,f=t.as.length;l<f;++l)if(t.as[l]===o)return}else t.ops=["count"],t.fields=[null],t.as=["count"];i.op&&(t.ops.push((a=i.op.signal)?e.signalRef(a):i.op),t.fields.push(e.fieldRef(i.field)),t.as.push(o))}function m1(e,t,i,o,a,l,f){const h=t[i]||(t[i]={}),g=s(l);let m=U3(a),v,x;if(m!=null&&(e=t.scope,m=m+(g?"|"+g:""),v=h[m]),!v){const C=l?{field:Mh,pulse:t.countsRef(e,a,l)}:{field:e.fieldRef(a),pulse:ke(t.output)};g&&(C.sort=e.sortRef(l)),x=e.add(zc(o,void 0,C)),f&&(t.index[a]=x),v=ke(x),m!=null&&(h[m]=v)}return v}jc.prototype={countsRef(e,t,i){const o=this,a=o.counts||(o.counts={}),l=U3(t);let f,h,g;return l!=null&&(e=o.scope,f=a[l]),f?i&&i.field&&j3(e,f.agg.params,i):(g={groupby:e.fieldRef(t,"key"),pulse:ke(o.output)},i&&i.field&&j3(e,g,i),h=e.add(Ut(g)),f=e.add(Qt({pulse:ke(h)})),f={agg:h,ref:ke(f)},l!=null&&(a[l]=f)),f.ref},tuplesRef(){return ke(this.values)},extentRef(e,t){return m1(e,this,"extent","extent",t,!1)},domainRef(e,t){return m1(e,this,"domain","values",t,!1)},valuesRef(e,t,i){return m1(e,this,"vals","values",t,i||!0)},lookupRef(e,t){return m1(e,this,"lookup","tupleindex",t,!1)},indataRef(e,t){return m1(e,this,"indata","tupleindex",t,!0,!0)}};function Y$(e,t,i){const o=e.from.facet,a=o.name,l=tA(o,t);let f;o.name||(0,b.z3)("Facet must have a name: "+(0,b.r$)(o)),o.data||(0,b.z3)("Facet must reference a data set: "+(0,b.r$)(o)),o.field?f=t.add(WE({field:t.fieldRef(o.field),pulse:l})):o.groupby?f=t.add(Ne({key:t.keyRef(o.groupby),group:ke(t.proxy(i.parent)),pulse:l})):(0,b.z3)("Facet must specify groupby or field: "+(0,b.r$)(o));const h=t.fork(),g=h.add(Qt()),m=h.add(Ss({pulse:ke(g)}));h.addData(a,new jc(h,g,g,m)),h.addSignal("parent",null),f.params.subflow={$subflow:h.parse(e).toRuntime()}}function K$(e,t,i){const o=t.add(WE({pulse:i.pulse})),a=t.fork();a.add(Ss()),a.addSignal("parent",null),o.params.subflow={$subflow:a.parse(e).toRuntime()}}function G3(e,t,i){const o=e.remove,a=e.insert,l=e.toggle,f=e.modify,h=e.values,g=t.add(Ic()),m="if("+e.trigger+',modify("'+i+'",'+[a,o,l,f,h].map(x=>x??"null").join(",")+"),0)",v=Kt(m,t);g.update=v.$expr,g.params=v.$params}function nA(e,t){const i=M3(e),o=e.type===ZE,a=e.from&&e.from.facet,l=e.overlap;let f=e.layout||i===Th||i===s1,h,g,m,v,x,C,w;const S=i===o1||f||a,D=X$(e.from,o,t);g=t.add(he({key:D.key||(e.key?Pc(e.key):void 0),pulse:D.pulse,clean:!o}));const k=ke(g);g=m=t.add(Qt({pulse:k})),g=t.add(St({markdef:P$(e),interactive:U$(e.interactive,t),clip:I$(e.clip,t),context:{$context:!0},groups:t.lookup(),parent:t.signals.parent?t.signalRef("parent"):null,index:t.markpath(),pulse:ke(g)}));const O=ke(g);g=v=t.add(Te(UE(e.encode,e.type,i,e.style,t,{mod:!1,pulse:O}))),g.params.parent=t.encode(),e.transform&&e.transform.forEach(ee=>{const M=Ak(ee,t),J=M.metadata;(J.generates||J.changes)&&(0,b.z3)("Mark transforms should not generate new data."),J.nomod||(v.params.mod=!0),M.params.pulse=ke(g),t.add(g=M)}),e.sort&&(g=t.add(HE({sort:t.compareRef(e.sort),pulse:ke(g)})));const R=ke(g);(a||f)&&(f=t.add(d1({layout:t.objectProperty(e.layout),legends:t.legends,mark:O,pulse:R})),C=ke(f));const I=t.add(wi({mark:O,pulse:C||R}));w=ke(I),o&&(S&&(h=t.operators,h.pop(),f&&h.pop()),t.pushState(R,C||w,k),a?Y$(e,t,D):S?K$(e,t,D):t.parse(e),t.popState(),S&&(f&&h.push(f),h.push(I))),l&&(w=Q$(l,w,t));const V=t.add(f1({pulse:w})),W=t.add(Ss({pulse:ke(V)},void 0,t.parent()));e.name!=null&&(x=e.name,t.addData(x,new jc(t,m,V,W)),e.on&&e.on.forEach(ee=>{(ee.insert||ee.remove||ee.toggle)&&(0,b.z3)("Marks only support modify triggers."),G3(ee,t,x)}))}function Q$(e,t,i){const o=e.method,a=e.bound,l=e.separation,f={separation:p(l)?i.signalRef(l.signal):l,method:p(o)?i.signalRef(o.signal):o,pulse:t};if(e.order&&(f.sort=i.compareRef({field:e.order})),a){const h=a.tolerance;f.boundTolerance=p(h)?i.signalRef(h.signal):+h,f.boundScale=i.scaleRef(a.scale),f.boundOrient=a.orient}return ke(i.add(Cs(f)))}function Z$(e,t){const i=t.config.legend,o=e.encode||{},a=Ki(e,i),l=o.legend||{},f=l.name||void 0,h=l.interactive,g=l.style,m={};let v=0,x,C,w;yk.forEach(I=>e[I]?(m[I]=e[I],v=v||e[I]):0),v||(0,b.z3)("Missing valid scale for legend.");const S=J$(e,t.scaleType(v)),D={title:e.title!=null,scales:m,type:S,vgrad:S!=="symbol"&&a.isVertical()},k=ke(t.add(Qt(null,[D]))),O={enter:{x:{value:0},y:{value:0}}},R=ke(t.add(at(C={type:S,scale:t.scaleRef(v),count:t.objectProperty(a("tickCount")),limit:t.property(a("symbolLimit")),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)})));return S===QE?(w=[F$(e,v,i,o.gradient),N3(e,i,o.labels,R)],C.count=C.count||t.signalRef(`max(2,2*floor((${F(a.gradientLength())})/100))`)):S===pk?w=[w$(e,v,i,o.gradient,R),N3(e,i,o.labels,R)]:(x=O$(e,i),w=[$$(e,i,o,R,F(x.columns))],C.size=n5(e,t,w[0].marks)),w=[p1({role:XD,from:k,encode:O,marks:w,layout:x,interactive:h})],D.title&&w.push(z$(e,i,o.title,k)),nA(p1({role:HD,from:k,encode:Pu(t5(a,e,i),l,g1),marks:w,aria:a("aria"),description:a("description"),zindex:a("zindex"),name:f,interactive:h,style:g}),t)}function J$(e,t){let i=e.type||$3;return!e.type&&e5(e)===1&&(e.fill||e.stroke)&&(i=yl(t)?QE:vl(t)?pk:$3),i!==QE?i:vl(t)?pk:QE}function e5(e){return yk.reduce((t,i)=>t+(e[i]?1:0),0)}function t5(e,t,i){const o={enter:{},update:{}};return Tn(o,{orient:e("orient"),offset:e("offset"),padding:e("padding"),titlePadding:e("titlePadding"),cornerRadius:e("cornerRadius"),fill:e("fillColor"),stroke:e("strokeColor"),strokeWidth:i.strokeWidth,strokeDash:i.strokeDash,x:e("legendX"),y:e("legendY"),format:t.format,formatType:t.formatType}),o}function n5(e,t,i){const o=F(W3("size",e,i)),a=F(W3("strokeWidth",e,i)),l=F(i5(i[1].encode,t,h1));return Kt(`max(ceil(sqrt(${o})+${a}),${l})`,t)}function W3(e,t,i){return t[e]?`scale("${t[e]}",datum)`:T3(e,i[0].encode)}function i5(e,t,i){return T3("fontSize",e)||C$("fontSize",t,i)}const r5=`item.orient==="${zh}"?-90:item.orient==="${Ih}"?90:0`;function o5(e,t){e=(0,b.Kg)(e)?{text:e}:e;const i=Ki(e,t.config.title),o=e.encode||{},a=o.group||{},l=a.name||void 0,f=a.interactive,h=a.style,g=[],m={},v=ke(t.add(Qt(null,[m])));return g.push(u5(e,i,s5(e),v)),e.subtitle&&g.push(l5(e,i,o.subtitle,v)),nA(p1({role:ZD,from:v,encode:a5(i,a),marks:g,aria:i("aria"),description:i("description"),zindex:i("zindex"),name:l,interactive:f,style:h}),t)}function s5(e){const t=e.encode;return t&&t.title||(0,b.X$)({name:e.name,interactive:e.interactive,style:e.style},t)}function a5(e,t){const i={enter:{},update:{}};return Tn(i,{orient:e("orient"),anchor:e("anchor"),align:{signal:bk},angle:{signal:r5},limit:e("limit"),frame:e("frame"),offset:e("offset")||0,padding:e("subtitlePadding")}),Pu(i,t,g1)}function u5(e,t,i,o){const a={value:0},l=e.text,f={enter:{opacity:a},update:{opacity:{value:1}},exit:{opacity:a}};return Tn(f,{text:l,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("color"),font:t("font"),fontSize:t("fontSize"),fontStyle:t("fontStyle"),fontWeight:t("fontWeight"),lineHeight:t("lineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),Or({type:Uc,role:JD,style:x$,from:o,encode:f},i)}function l5(e,t,i,o){const a={value:0},l=e.subtitle,f={enter:{opacity:a},update:{opacity:{value:1}},exit:{opacity:a}};return Tn(f,{text:l,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("subtitleColor"),font:t("subtitleFont"),fontSize:t("subtitleFontSize"),fontStyle:t("subtitleFontStyle"),fontWeight:t("subtitleFontWeight"),lineHeight:t("subtitleLineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),Or({type:Uc,role:ek,style:E$,from:o,encode:f},i)}function c5(e,t){const i=[];e.transform&&e.transform.forEach(o=>{i.push(Ak(o,t))}),e.on&&e.on.forEach(o=>{G3(o,t,e.name)}),t.addDataPipeline(e.name,f5(e,t,i))}function f5(e,t,i){const o=[];let a=null,l=!1,f=!1,h,g,m,v,x;for(e.values?p(e.values)||E(e.format)?(o.push(V3(t,e)),o.push(a=Gc())):o.push(a=Gc({$ingest:e.values,$format:e.format})):e.url?E(e.url)||E(e.format)?(o.push(V3(t,e)),o.push(a=Gc())):o.push(a=Gc({$request:e.url,$format:e.format})):e.source&&(a=h=(0,b.YO)(e.source).map(C=>ke(t.getData(C).output)),o.push(null)),g=0,m=i.length;g<m;++g)v=i[g],x=v.metadata,!a&&!x.source&&o.push(a=Gc()),o.push(v),x.generates&&(f=!0),x.modifies&&!f&&(l=!0),x.source?a=v:x.changes&&(a=null);return h&&(m=h.length-1,o[0]=lk({derive:l,pulse:m?h:h[0]}),(l||m)&&o.splice(1,0,Gc())),a||o.push(Gc()),o.push(Ss({})),o}function Gc(e){const t=Qt({},e);return t.metadata={source:!0},t}function V3(e,t){return je({url:t.url?e.property(t.url):void 0,async:t.async?e.property(t.async):void 0,values:t.values?e.property(t.values):void 0,format:e.objectProperty(t.format)})}const H3=e=>e===ju||e===Mo,iA=(e,t,i)=>p(e)?p5(e.signal,t,i):e===zh||e===Mo?t:i,Nn=(e,t,i)=>p(e)?h5(e.signal,t,i):H3(e)?t:i,Bo=(e,t,i)=>p(e)?g5(e.signal,t,i):H3(e)?i:t,q3=(e,t,i)=>p(e)?m5(e.signal,t,i):e===Mo?{value:t}:{value:i},d5=(e,t,i)=>p(e)?y5(e.signal,t,i):e===Ih?{value:t}:{value:i},h5=(e,t,i)=>X3(`${e} === '${Mo}' || ${e} === '${ju}'`,t,i),g5=(e,t,i)=>X3(`${e} !== '${Mo}' && ${e} !== '${ju}'`,t,i),p5=(e,t,i)=>Sk(`${e} === '${zh}' || ${e} === '${Mo}'`,t,i),m5=(e,t,i)=>Sk(`${e} === '${Mo}'`,t,i),y5=(e,t,i)=>Sk(`${e} === '${Ih}'`,t,i),X3=(e,t,i)=>(t=t!=null?rn(t):t,i=i!=null?rn(i):i,Y3(t)&&Y3(i)?(t=t?t.signal||(0,b.r$)(t.value):null,i=i?i.signal||(0,b.r$)(i.value):null,{signal:`${e} ? (${t}) : (${i})`}):[(0,b.X$)({test:e},t)].concat(i||[])),Y3=e=>e==null||Object.keys(e).length===1,Sk=(e,t,i)=>({signal:`${e} ? (${Uh(t)}) : (${Uh(i)})`}),v5=(e,t,i,o,a)=>({signal:(o!=null?`${e} === '${zh}' ? (${Uh(o)}) : `:"")+(i!=null?`${e} === '${ju}' ? (${Uh(i)}) : `:"")+(a!=null?`${e} === '${Ih}' ? (${Uh(a)}) : `:"")+(t!=null?`${e} === '${Mo}' ? (${Uh(t)}) : `:"")+"(null)"}),Uh=e=>p(e)?e.signal:e==null?null:(0,b.r$)(e),b5=(e,t)=>t===0?0:p(e)?{signal:`(${e.signal}) * ${t}`}:{value:e*t},jh=(e,t)=>{const i=e.signal;return i&&i.endsWith("(null)")?{signal:i.slice(0,-6)+t.signal}:e};function Gh(e,t,i,o){let a;if(t&&(0,b.mQ)(t,e))return t[e];if((0,b.mQ)(i,e))return i[e];if(e.startsWith("title")){switch(e){case"titleColor":a="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":a=e[5].toLowerCase()+e.slice(6)}return o[gk][a]}else if(e.startsWith("label")){switch(e){case"labelColor":a="fill";break;case"labelFont":case"labelFontSize":a=e[5].toLowerCase()+e.slice(6)}return o[h1][a]}return null}function K3(e){const t={};for(const i of e)if(i)for(const o in i)t[o]=1;return Object.keys(t)}function x5(e,t){var i=t.config,o=i.style,a=i.axis,l=t.scaleType(e.scale)==="band"&&i.axisBand,f=e.orient,h,g,m;if(p(f)){const x=K3([i.axisX,i.axisY]),C=K3([i.axisTop,i.axisBottom,i.axisLeft,i.axisRight]);h={};for(m of x)h[m]=Nn(f,Gh(m,i.axisX,a,o),Gh(m,i.axisY,a,o));g={};for(m of C)g[m]=v5(f.signal,Gh(m,i.axisTop,a,o),Gh(m,i.axisBottom,a,o),Gh(m,i.axisLeft,a,o),Gh(m,i.axisRight,a,o))}else h=f===Mo||f===ju?i.axisX:i.axisY,g=i["axis"+f[0].toUpperCase()+f.slice(1)];return h||g||l?(0,b.X$)({},a,h,g,l):a}function E5(e,t,i,o){const a=Ki(e,t),l=e.orient;let f,h;const g={enter:f={opacity:rt},update:h={opacity:io},exit:{opacity:rt}};Tn(g,{stroke:a("domainColor"),strokeCap:a("domainCap"),strokeDash:a("domainDash"),strokeDashOffset:a("domainDashOffset"),strokeWidth:a("domainWidth"),strokeOpacity:a("domainOpacity")});const m=Q3(e,0),v=Q3(e,1);return f.x=h.x=Nn(l,m,rt),f.x2=h.x2=Nn(l,v),f.y=h.y=Bo(l,m,rt),f.y2=h.y2=Bo(l,v),Or({type:vk,role:UD,from:o,encode:g},i)}function Q3(e,t){return{scale:e.scale,range:t}}function A5(e,t,i,o,a){const l=Ki(e,t),f=e.orient,h=e.gridScale,g=iA(f,1,-1),m=C5(e.offset,g);let v,x,C;const w={enter:v={opacity:rt},update:C={opacity:io},exit:x={opacity:rt}};Tn(w,{stroke:l("gridColor"),strokeCap:l("gridCap"),strokeDash:l("gridDash"),strokeDashOffset:l("gridDashOffset"),strokeOpacity:l("gridOpacity"),strokeWidth:l("gridWidth")});const S={scale:e.scale,field:no,band:a.band,extra:a.extra,offset:a.offset,round:l("tickRound")},D=Nn(f,{signal:"height"},{signal:"width"}),k=h?{scale:h,range:0,mult:g,offset:m}:{value:0,offset:m},O=h?{scale:h,range:1,mult:g,offset:m}:(0,b.X$)(D,{mult:g,offset:m});return v.x=C.x=Nn(f,S,k),v.y=C.y=Bo(f,S,k),v.x2=C.x2=Bo(f,O),v.y2=C.y2=Nn(f,O),x.x=Nn(f,S),x.y=Bo(f,S),Or({type:vk,role:jD,key:no,from:o,encode:w},i)}function C5(e,t){if(t!==1)if(!(0,b.Gv)(e))e=p(t)?{signal:`(${t.signal}) * (${e||0})`}:t*(e||0);else{let i=e=(0,b.X$)({},e);for(;i.mult!=null;)if((0,b.Gv)(i.mult))i=i.mult=(0,b.X$)({},i.mult);else return i.mult=p(t)?{signal:`(${i.mult}) * (${t.signal})`}:i.mult*t,e;i.mult=t}return e}function S5(e,t,i,o,a,l){const f=Ki(e,t),h=e.orient,g=iA(h,-1,1);let m,v,x;const C={enter:m={opacity:rt},update:x={opacity:io},exit:v={opacity:rt}};Tn(C,{stroke:f("tickColor"),strokeCap:f("tickCap"),strokeDash:f("tickDash"),strokeDashOffset:f("tickDashOffset"),strokeOpacity:f("tickOpacity"),strokeWidth:f("tickWidth")});const w=rn(a);w.mult=g;const S={scale:e.scale,field:no,band:l.band,extra:l.extra,offset:l.offset,round:f("tickRound")};return x.y=m.y=Nn(h,rt,S),x.y2=m.y2=Nn(h,w),v.x=Nn(h,S),x.x=m.x=Bo(h,rt,S),x.x2=m.x2=Bo(h,w),v.y=Bo(h,S),Or({type:vk,role:WD,key:no,from:o,encode:C},i)}function Fk(e,t,i,o,a){return{signal:'flush(range("'+e+'"), scale("'+e+'", datum.value), '+t+","+i+","+o+","+a+")"}}function F5(e,t,i,o,a,l){const f=Ki(e,t),h=e.orient,g=e.scale,m=iA(h,-1,1),v=F(f("labelFlush")),x=F(f("labelFlushOffset")),C=f("labelAlign"),w=f("labelBaseline");let S=v===0||!!v,D;const k=rn(a);k.mult=m,k.offset=rn(f("labelPadding")||0),k.offset.mult=m;const O={scale:g,field:no,band:.5,offset:R3(l.offset,f("labelOffset"))},R=Nn(h,S?Fk(g,v,'"left"','"right"','"center"'):{value:"center"},d5(h,"left","right")),I=Nn(h,q3(h,"bottom","top"),S?Fk(g,v,'"top"','"bottom"','"middle"'):{value:"middle"}),V=Fk(g,v,`-(${x})`,x,0);S=S&&x;const W={opacity:rt,x:Nn(h,O,k),y:Bo(h,O,k)},ee={enter:W,update:D={opacity:io,text:{field:hk},x:W.x,y:W.y,align:R,baseline:I},exit:{opacity:rt,x:W.x,y:W.y}};Tn(ee,{dx:!C&&S?Nn(h,V):null,dy:!w&&S?Bo(h,V):null}),Tn(ee,{angle:f("labelAngle"),fill:f("labelColor"),fillOpacity:f("labelOpacity"),font:f("labelFont"),fontSize:f("labelFontSize"),fontWeight:f("labelFontWeight"),fontStyle:f("labelFontStyle"),limit:f("labelLimit"),lineHeight:f("labelLineHeight")},{align:C,baseline:w});const M=f("labelBound");let J=f("labelOverlap");return J=J||M?{separation:f("labelSeparation"),method:J,order:"datum.index",bound:M?{scale:g,orient:h,tolerance:M}:null}:void 0,D.align!==R&&(D.align=jh(D.align,R)),D.baseline!==I&&(D.baseline=jh(D.baseline,I)),Or({type:Uc,role:GD,style:h1,key:no,from:o,encode:ee,overlap:J},i)}function w5(e,t,i,o){const a=Ki(e,t),l=e.orient,f=iA(l,-1,1);let h,g;const m={enter:h={opacity:rt,anchor:rn(a("titleAnchor",null)),align:{signal:bk}},update:g=(0,b.X$)({},h,{opacity:io,text:rn(e.title)}),exit:{opacity:rt}},v={signal:`lerp(range("${e.scale}"), ${JE(0,1,.5)})`};return g.x=Nn(l,v),g.y=Bo(l,v),h.angle=Nn(l,rt,b5(f,90)),h.baseline=Nn(l,q3(l,ju,Mo),{value:ju}),g.angle=h.angle,g.baseline=h.baseline,Tn(m,{fill:a("titleColor"),fillOpacity:a("titleOpacity"),font:a("titleFont"),fontSize:a("titleFontSize"),fontStyle:a("titleFontStyle"),fontWeight:a("titleFontWeight"),limit:a("titleLimit"),lineHeight:a("titleLineHeight")},{align:a("titleAlign"),angle:a("titleAngle"),baseline:a("titleBaseline")}),D5(a,l,m,i),m.update.align=jh(m.update.align,h.align),m.update.angle=jh(m.update.angle,h.angle),m.update.baseline=jh(m.update.baseline,h.baseline),Or({type:Uc,role:VD,style:gk,from:o,encode:m},i)}function D5(e,t,i,o){const a=(h,g)=>h!=null?(i.update[g]=jh(rn(h),i.update[g]),!1):!Oa(g,o),l=a(e("titleX"),"x"),f=a(e("titleY"),"y");i.enter.auto=f===l?rn(f):Nn(t,rn(f),rn(l))}function k5(e,t){const i=x5(e,t),o=e.encode||{},a=o.axis||{},l=a.name||void 0,f=a.interactive,h=a.style,g=Ki(e,i),m=S$(g),v={scale:e.scale,ticks:!!g("ticks"),labels:!!g("labels"),grid:!!g("grid"),domain:!!g("domain"),title:e.title!=null},x=ke(t.add(Qt({},[v]))),C=ke(t.add(dn({scale:t.scaleRef(e.scale),extra:t.property(m.extra),count:t.objectProperty(e.tickCount),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)}))),w=[];let S;return v.grid&&w.push(A5(e,i,o.grid,C,m)),v.ticks&&(S=g("tickSize"),w.push(S5(e,i,o.ticks,C,S,m))),v.labels&&(S=v.ticks?S:0,w.push(F5(e,i,o.labels,C,S,m))),v.domain&&w.push(E5(e,i,o.domain,x)),v.title&&w.push(w5(e,i,o.title,x)),nA(p1({role:PD,from:x,encode:Pu($5(g,e),a,g1),marks:w,aria:g("aria"),description:g("description"),zindex:g("zindex"),name:l,interactive:f,style:h}),t)}function $5(e,t){const i={enter:{},update:{}};return Tn(i,{orient:e("orient"),offset:e("offset")||0,position:A(t.position,0),titlePadding:e("titlePadding"),minExtent:e("minExtent"),maxExtent:e("maxExtent"),range:{signal:`abs(span(range("${t.scale}")))`},translate:e("translate"),format:t.format,formatType:t.formatType}),i}function Z3(e,t,i){const o=(0,b.YO)(e.signals),a=(0,b.YO)(e.scales);return i||o.forEach(l=>l1(l,t)),(0,b.YO)(e.projections).forEach(l=>h$(l,t)),a.forEach(l=>t$(l,t)),(0,b.YO)(e.data).forEach(l=>c5(l,t)),a.forEach(l=>n$(l,t)),(i||o).forEach(l=>Re(l,t)),(0,b.YO)(e.axes).forEach(l=>k5(l,t)),(0,b.YO)(e.marks).forEach(l=>nA(l,t)),(0,b.YO)(e.legends).forEach(l=>Z$(l,t)),e.title&&o5(e.title,t),t.parseLambdas(),t}const O5=e=>Pu({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},e);function T5(e,t){const i=t.config,o=ke(t.root=t.add(Ic())),a=R5(e,i);a.forEach(m=>l1(m,t)),t.description=e.description||i.description,t.eventConfig=i.events,t.legends=t.objectProperty(i.legend&&i.legend.layout),t.locale=i.locale;const l=t.add(Qt()),f=t.add(Te(UE(O5(e.encode),ZE,s1,e.style,t,{pulse:ke(l)}))),h=t.add(d1({layout:t.objectProperty(e.layout),legends:t.legends,autosize:t.signalRef("autosize"),mark:o,pulse:ke(f)}));t.operators.pop(),t.pushState(ke(f),ke(h),null),Z3(e,t,a),t.operators.push(h);let g=t.add(wi({mark:o,pulse:ke(h)}));return g=t.add(f1({pulse:ke(g)})),g=t.add(Ss({pulse:ke(g)})),t.addData("root",new jc(t,l,l,g)),t}function y1(e,t){return t&&t.signal?{name:e,update:t.signal}:{name:e,value:t}}function R5(e,t){const i=f=>A(e[f],t[f]),o=[y1("background",i("background")),y1("autosize",ME(i("autosize"))),y1("padding",BE(i("padding"))),y1("width",i("width")||0),y1("height",i("height")||0)],a=o.reduce((f,h)=>(f[h.name]=h,f),{}),l={};return(0,b.YO)(e.signals).forEach(f=>{(0,b.mQ)(a,f.name)?f=(0,b.X$)(a[f.name],f):o.push(f),l[f.name]=f}),(0,b.YO)(t.signals).forEach(f=>{!(0,b.mQ)(l,f.name)&&!(0,b.mQ)(a,f.name)&&o.push(f)}),o}function J3(e,t){this.config=e||{},this.options=t||{},this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.eventConfig=null,this.locale=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function e$(e){this.config=e.config,this.options=e.options,this.legends=e.legends,this.field=Object.create(e.field),this.signals=Object.create(e.signals),this.lambdas=Object.create(e.lambdas),this.scales=Object.create(e.scales),this.events=Object.create(e.events),this.data=Object.create(e.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++e._nextsub[0],this._nextsub=e._nextsub,this._parent=e._parent.slice(),this._encode=e._encode.slice(),this._lookup=e._lookup.slice(),this._markpath=e._markpath}J3.prototype=e$.prototype={parse(e){return Z3(e,this)},fork(){return new e$(this)},isSubscope(){return this._subid>0},toRuntime(){return this.finish(),{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},id(){return(this._subid?this._subid+":":0)+this._id++},add(e){return this.operators.push(e),e.id=this.id(),e.refs&&(e.refs.forEach(t=>{t.$ref=e.id}),e.refs=null),e},proxy(e){const t=e instanceof c1?ke(e):e;return this.add(S3({value:t}))},addStream(e){return this.streams.push(e),e.id=this.id(),e},addUpdate(e){return this.updates.push(e),e},finish(){let e,t;this.root&&(this.root.root=!0);for(e in this.signals)this.signals[e].signal=e;for(e in this.scales)this.scales[e].scale=e;function i(o,a,l){let f,h;o&&(f=o.data||(o.data={}),h=f[a]||(f[a]=[]),h.push(l))}for(e in this.data){t=this.data[e],i(t.input,e,"input"),i(t.output,e,"output"),i(t.values,e,"values");for(const o in t.index)i(t.index[o],e,"index:"+o)}return this},pushState(e,t,i){this._encode.push(ke(this.add(Ss({pulse:e})))),this._parent.push(t),this._lookup.push(i?ke(this.proxy(i)):null),this._markpath.push(-1)},popState(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},parent(){return(0,b.se)(this._parent)},encode(){return(0,b.se)(this._encode)},lookup(){return(0,b.se)(this._lookup)},markpath(){const e=this._markpath;return++e[e.length-1]},fieldRef(e,t){if((0,b.Kg)(e))return Pc(e,t);e.signal||(0,b.z3)("Unsupported field reference: "+(0,b.r$)(e));const i=e.signal;let o=this.field[i];if(!o){const a={name:this.signalRef(i)};t&&(a.as=t),this.field[i]=o=ke(this.add(Fe(a)))}return o},compareRef(e){let t=!1;const i=l=>p(l)?(t=!0,this.signalRef(l.signal)):y(l)?(t=!0,this.exprRef(l.expr)):l,o=(0,b.YO)(e.field).map(i),a=(0,b.YO)(e.order).map(i);return t?ke(this.add(ye({fields:o,orders:a}))):GE(o,a)},keyRef(e,t){let i=!1;const o=l=>p(l)?(i=!0,ke(a[l.signal])):l,a=this.signals;return e=(0,b.YO)(e).map(o),i?ke(this.add(Ie({fields:e,flat:t}))):uk(e,t)},sortRef(e){if(!e)return e;const t=u(e.op,e.field),i=e.order||n;return i.signal?ke(this.add(ye({fields:t,orders:this.signalRef(i.signal)}))):GE(t,i)},event(e,t){const i=e+":"+t;if(!this.events[i]){const o=this.id();this.streams.push({id:o,source:e,type:t}),this.events[i]=o}return this.events[i]},hasOwnSignal(e){return(0,b.mQ)(this.signals,e)},addSignal(e,t){this.hasOwnSignal(e)&&(0,b.z3)("Duplicate signal name: "+(0,b.r$)(e));const i=t instanceof c1?t:this.add(Ic(t));return this.signals[e]=i},getSignal(e){return this.signals[e]||(0,b.z3)("Unrecognized signal name: "+(0,b.r$)(e)),this.signals[e]},signalRef(e){return this.signals[e]?ke(this.signals[e]):((0,b.mQ)(this.lambdas,e)||(this.lambdas[e]=this.add(Ic(null))),ke(this.lambdas[e]))},parseLambdas(){const e=Object.keys(this.lambdas);for(let t=0,i=e.length;t<i;++t){const o=e[t],a=Kt(o,this),l=this.lambdas[o];l.params=a.$params,l.update=a.$expr}},property(e){return e&&e.signal?this.signalRef(e.signal):e},objectProperty(e){return!e||!(0,b.Gv)(e)?e:this.signalRef(e.signal||wk(e))},exprRef(e,t){const i={expr:Kt(e,this)};return t&&(i.expr.$name=t),ke(this.add(Oe(i)))},addBinding(e,t){this.bindings||(0,b.z3)("Nested signals do not support binding: "+(0,b.r$)(e)),this.bindings.push((0,b.X$)({signal:e},t))},addScaleProj(e,t){(0,b.mQ)(this.scales,e)&&(0,b.z3)("Duplicate scale or projection name: "+(0,b.r$)(e)),this.scales[e]=this.add(t)},addScale(e,t){this.addScaleProj(e,ck(t))},addProjection(e,t){this.addScaleProj(e,VE(t))},getScale(e){return this.scales[e]||(0,b.z3)("Unrecognized scale name: "+(0,b.r$)(e)),this.scales[e]},scaleRef(e){return ke(this.getScale(e))},scaleType(e){return this.getScale(e).params.type},projectionRef(e){return this.scaleRef(e)},projectionType(e){return this.scaleType(e)},addData(e,t){return(0,b.mQ)(this.data,e)&&(0,b.z3)("Duplicate data set name: "+(0,b.r$)(e)),this.data[e]=t},getData(e){return this.data[e]||(0,b.z3)("Undefined data set name: "+(0,b.r$)(e)),this.data[e]},addDataPipeline(e,t){return(0,b.mQ)(this.data,e)&&(0,b.z3)("Duplicate data set name: "+(0,b.r$)(e)),this.addData(e,jc.fromEntries(this,t))}};function wk(e){return((0,b.cy)(e)?N5:_5)(e)}function N5(e){const t=e.length;let i="[";for(let o=0;o<t;++o){const a=e[o];i+=(o>0?",":"")+((0,b.Gv)(a)?a.signal||wk(a):(0,b.r$)(a))}return i+"]"}function _5(e){let t="{",i=0,o,a;for(o in e)a=e[o],t+=(++i>1?",":"")+(0,b.r$)(o)+":"+((0,b.Gv)(a)?a.signal||wk(a):(0,b.r$)(a));return t+"}"}function M5(){const e="sans-serif",o="#4c78a8",a="#000",l="#888",f="#ddd";return{description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:o},area:{fill:o},image:null,line:{stroke:o,strokeWidth:2},path:{stroke:o},rect:{fill:o},rule:{stroke:a},shape:{stroke:o},symbol:{fill:o,size:64},text:{fill:a,font:e,fontSize:11},trail:{fill:o,size:2},style:{"guide-label":{fill:a,font:e,fontSize:10},"guide-title":{fill:a,font:e,fontSize:11,fontWeight:"bold"},"group-title":{fill:a,font:e,fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:a,font:e,fontSize:12},point:{size:30,strokeWidth:2,shape:"circle"},circle:{size:30,strokeWidth:2},square:{size:30,strokeWidth:2,shape:"square"},cell:{fill:"transparent",stroke:f},view:{fill:"transparent"}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:l,grid:!1,gridWidth:1,gridColor:f,labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:l,tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:f,gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:l,titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}function B5(e,t,i){return(0,b.Gv)(e)||(0,b.z3)("Input Vega specification must be an object."),t=(0,b.io)(M5(),t,e.config),T5(e,new J3(t,i)).toRuntime()}var L5="5.31.0";(0,b.X$)(Bn,Ve,hn,gn,Wn,Vn,_n,ot,ai,Hn,Di,qn)}}]);

//# sourceMappingURL=vega.bundle.42a5adae.js.map